OBJECT Codeunit 99008903 POS Print Utility										
{										
OBJECT-PROPERTIES										
{										
Date=13/06/17;										
Time=03:10:27 p.m.;										
Modified=Yes;										
"Version List=LSW17.10.01,CONSISA;"										
}										
PROPERTIES										
{										
OnRun=BEGIN										
END;										
										
}										
CODE										
{										
VAR										
"Text008@1083 : TextConst 'ENU=""Original trans. no. "";ESP=No. Original Trans.';"										
Text011@1026 : TextConst 'ENU=Gross Sales;ESP=Ventas Brutas';										
Text012@1027 : TextConst 'ENU=Discount;ESP=Descuento';										
Text013@1084 : TextConst 'ENU=Trans. no.;ESP=No. Trans.';										
Text014@1085 : TextConst 'ENU=Auth. no.;ESP=No. Autor.';										
Text002@1086 : TextConst 'ENU=Expires;ESP=Termina';										
Text004@1087 : TextConst 'ENU=Monto;ESP=Importe';										
Text020@1088 : TextConst 'ENU=Slip;ESP=Nß';										
Text021@1089 : TextConst 'ENU=Trans.;ESP=Transacci¢n';										
Text048@1090 : TextConst 'ENU=Date;ESP=Fecha';										
Text051@1091 : TextConst 'ENU=Staff;ESP=Empleados';										
Text052@1092 : TextConst 'ENU=Trans;ESP=Trans';										
Text063@1093 : TextConst 'ENU=VAT;ESP=IVA';										
Text063_2@1100409069 : TextConst 'ENU=Net.Amt;ESP=Valor Neto';										
Text078@1100409038 : TextConst 'ENU=Store no.;ESP=No.Tienda';										
Text079@1094 : TextConst 'ENU=Terminal;ESP=Terminal';										
Text005@1095 : TextConst 'ENU=Total;ESP=Total';										
Text009@1096 : TextConst 'ENU=Float entry;ESP=Entrada Efectivo';										
Text010@1097 : TextConst 'ENU=Tender Remove;ESP=Retirar Efectivo';										
Text001@1033 : TextConst 'ENU=Insert document in printer.;ESP=Insertar Documento en impresora';										
Text003@1034 : TextConst 'ENU=RETURN;ESP=DEVOLUCION';										
Text006@1035 : TextConst 'ENU=Paid into account no.;ESP=Pago a no. cuenta';										
Text007@1036 : TextConst 'ENU=Cargar cuenta n.;ESP=Cargar No. Cuenta';										
Text015@1038 : TextConst 'ENU=Charged to my debetcard;ESP=Cargado a mi Tarjeta de DÇbito';										
Text016@1039 : TextConst 'ENU=Charged to my creditcard;ESP=Cargado a mi Tarjeta CrÇdito';										
Text017@1040 : TextConst 'ENU=Refunded to above card;ESP=Reembolsado para anular tarjeta';										
Text018@1041 : TextConst 'ENU=Cardholder signature;ESP=Firma propietario tarjeta';										
Text019@1042 : TextConst 'ENU=Operator signature;ESP=Firma Operador';										
Text022@1043 : TextConst 'ENU=MERCHANT COPY;ESP=COPIA VENDEDOR';										
Text023@1044 : TextConst 'ENU=CARDHOLDER COPY;ESP=COPIA CLIENTE';										
Text024@1029 : TextConst 'ENU=Total Discount;ESP=Descuento Total';										
Text025@1045 : TextConst 'ENU=R E F U N D;ESP=D E V O L U C I O N';										
Text026@1046 : TextConst 'ENU=V O I D;ESP=A N U L A D O';										
Text027@1030 : TextConst 'ENU=Total Net Sales;ESP=Ventas Netas Totales';										
Text028@1037 : TextConst 'ENU=No. of Transactions;ESP=No. Transacciones';										
Text029@1048 : TextConst 'ENU=Items Sold;ESP=Productos Vendidos';										
Text030@1054 : TextConst 'ENU=No. of Refunds;ESP=No. de Reembolsos';										
Text031@1058 : TextConst 'ENU=No. of Suspended;ESP=No. de Suspensiones';										
Text032@1098 : TextConst 'ENU=No. of Voided;ESP=No. de Anulaciones';										
Text033@1047 : TextConst 'ENU=SUSPENDED;ESP=SUSPENDIDO';										
Text034@1099 : TextConst 'ENU=No. of Training;ESP=No. de Training';										
Text035@1100409047 : TextConst 'ENU=Accumulated Net Sales;ESP=Ventas Netas Acumuladas';										
Text036@1049 : TextConst 'ENU=TRANSACCION ANULADA;ESP=TRANSACCION ANULADA';										
Text037@1100 : TextConst 'ENU=No. of Open Drawer;ESP=No. Aperturas Caj¢n';										
Text039@1050 : TextConst 'ENU=DRAWER COPY;ESP=COPIA CAJON';										
Text040@1051 : TextConst 'ENU=COPY WITH REMOVAL;ESP=COPIA CON EXTRACCION';										
Text042@1052 : TextConst 'ENU=Subtotal;ESP=Subtotal';										
Text043@1053 : TextConst 'ENU=Total disc.;ESP=Descuento Total';										
Text044@1104 : TextConst 'ENU=Service Charge;ESP=Cargo Servicio';										
Text046@1055 : TextConst 'ENU=** COPY **;ESP=** COPIA **';										
Text047@1056 : TextConst 'ENU=** TRAINING **;ESP=** ENTRENAMIENTO **';										
Text071@1057 : TextConst 'ENU=Description;ESP=Descripci¢n';										
"Text074@1059 : TextConst 'ENU=""Item No.: "";ESP=No. Prod.';"										
"Text075@1060 : TextConst 'ENU=""Barcode: "";ESP=C¢d. Barras';"										
Text081@1061 : TextConst 'ENU=Mix & Match;ESP=Mix & Match';										
Text082@1062 : TextConst 'ENU=Multibuy;ESP=Multicompra';										
Text083@1063 : TextConst 'ENU=Discount Offer;ESP=Oferta Descuento';										
Text084@1064 : TextConst 'ENU=Line Discount;ESP=Descuento L°nea';										
Text085@1065 : TextConst 'ENU=Customer Discount;ESP=Descuento Cliente';										
Text086@1120 : TextConst 'ENU=Infocode Discount;ESP=Descuento Infoc¢digo';										
Text088@1066 : TextConst 'ENU=Discount Details;ESP=Detalle Descuento';										
Text093@1067 : TextConst 'ENU=Rounding;ESP=Redondeos';										
Text094@1068 : TextConst 'ENU=Firma;ESP=Firma';										
Text096@1069 : TextConst 'ENU=Remove document;ESP=Quitar documento';										
"Text097@1070 : TextConst 'ENU=Please insert new page in printer.;ESP=Por favor, inserte una nueva p†gina en la impresora';"										
Text106@1071 : TextConst 'ENU=TOTAL-Z;ESP=Z-REPORT';										
Text107@1072 : TextConst 'ENU=TOTAL-X;ESP=X-REPORT';										
Text108@1100409068 : TextConst 'ENU=Y-REPORT;ESP=INFORME-Y';										
Text112@1073 : TextConst 'ENU=Tender declaration:;ESP=Declaraci¢n Caja';										
Text116@1074 : TextConst 'ENU=Z-Report ID:;ESP=ID Informe-Z';										
Text117@1100409074 : TextConst 'ENU=Y-Report ID:;ESP=ID Informe-Y:';										
Text121@1075 : TextConst 'ENU=million;ESP=mill¢n';										
Text122@1076 : TextConst 'ENU=thousand;ESP=mil';										
"Text123@1077 : TextConst 'ENU=,one,two,three,four,five,six,seven,eight,nine;ESP=,uno,dos,tres,cuatro,cinco,seis,siete,ocho,nueve';"										
Text124@1078 : TextConst 'ENU=hundred;ESP=cien';										
Text125@1079 : TextConst 'ENU=and;ESP=y';										
"Text126@1080 : TextConst 'ENU=,,twenty,thirty,forty,fifty,sixty,seventy,eighty,ninety;ESP=,,veinte,treinta,cuarenta,cincuenta,sese"	nta	",se"	te	nta	",ochenta,noventa';"					
"Text127@1081 : TextConst 'ENU=zero,one,two,three,four,five,six,seven,eight,nine,ten,eleven,;ESP=cedro,uno,dos,tres,cuatro,cinco,se"	"is,"	sie	te	",oc"	"ho,nueve,diez,once,';"					
"Text128@1082 : TextConst 'ENU=twelve,thirteen,fourteen,fifteen,sixteen,seventeen,eighteen,nineteen;ESP=doce,trece,catorce,quince,d"	iec	isÇ	is	",di"	"ecisiete,dieciocho,diecinueve';"					
Text129@1102 : TextConst 'ENU=The length of the barcode is not correct.;ESP=La longitud del C¢d. Barras es incorrecta.';										
Text130@1101 : TextConst 'ENU=%1 for %2 is missing in %3.;ESP=%1 para %2 se perdieron en %3.';										
Text131@1025 : TextConst 'ENU=pcs;ESP=pcs';										
Text132@1028 : TextConst 'ENU=Expires;ESP=Termina';										
Text133@1103 : TextConst 'ENU=VAT RegNo.:;ESP=NIF';										
Text134@1107 : TextConst 'ENU=No. of Paying Customers;ESP=No. de Clientes con Pagos';										
Text139@1108 : TextConst 'ENU=No. of logins;ESP=No. de Inicio Sesi¢n';										
"Text140@1200070008 : TextConst 'ENU=""Error in Transacton Server connection "";ESP=Error en Conexi¢n Servidor Transacciones';"										
Text141@1200070009 : TextConst 'ENU=THIS Z IS FOR TERMINAL %1 ONLY!;ESP=ESTE Z ES SOLO PARA TERMINAL %1!';										
Text500@1105 : TextConst 'ENU=Table;ESP=Tabla';										
POSSESSION@1100409125 : Codeunit 99008919;										
PosSetup@1000 : Record 99008900;										
TendDeclEntry@10012006 : Record 99001465;										
TempTendDeclEntry@1100409001 : TEMPORARY Record 99001465;										
PaymEntry@1100409000 : Record 99001474;										
TenderType@1100409005 : Record 99001462;										
GenLedSetup@1100409004 : Record 98;										
Currency@1100409003 : Record 4;										
RetailLocation@1100409002 : Record 99001512;										
UOM@1100409007 : Record 204;										
GenPosFunc@1100409008 : Record 99001515;										
Store@1100409009 : Record 99001470;										
TempTransInfoCode@10012008 : TEMPORARY Record 99001478;										
glTrans@10012009 : Record 99001472;										
Globals@1100409006 : Codeunit 99008919;										
BOUTIL@1200070000 : Codeunit 99001452;										
ApplMan@1100409010 : Codeunit 1;										
POSFunctions@1100409011 : Codeunit 99008900;										
RetailHelper@1100409046 : Codeunit 10000705;										
POSGUI@1100409081 : Codeunit 99001575;										
Value@1003 : ARRAY [10] OF Text[250];										
LineLen@1004 : Integer;										
InvLineLen@1005 : Integer;										
LinesPrinted@1006 : Integer;										
PageNo@1007 : Integer;										
PrintErrorTxt@1010 : Text[250];										
IsInvoice@1011 : Boolean;										
LocalTotal@1014 : Decimal;										
Sign@1015 : Integer;										
Text_DelNot@1200070001 : TextConst 'ENU=DELIVERY;ESP=REPARTO';										
Text501@1100409013 : TextConst 'ENU=Deal;ESP=Men£ Promoci¢n';										
tmpDeal@1100409014 : TEMPORARY Record 99001502;										
Text502@1100409049 : TextConst 'ENU=Deal Modifier;ESP=Modificador Promo.';										
Text142@1200070007 : TextConst 'ENU=REJECTED;ESP=RECHAZADO';										
Text143@1200070010 : TextConst 'ENU=Quantity;ESP=Cantidad';										
Text144@1200070011 : TextConst 'ENU=Balance;ESP=Saldo';										
Text145@1100409012 : TextConst 'ENU=Voided;ESP=Anulado';										
VoidedVoucher@1200040000 : Boolean;										
Text146@1200070012 : TextConst 'ENU=SEAT:;ESP=ASIENTO:';										
GlobalScreenLines@1200070013 : ARRAY [300] OF Text[250];										
Text147@1200070015 : TextConst 'ENU=Negative Adjustment;ESP=Negativo';										
Text148@1200070016 : TextConst 'ENU=ItemNo./Variant;ESP=NoProducto/Variante';										
Text149@1200070017 : TextConst 'ENU=Payment;ESP=Pago';										
Text150@1200070018 : TextConst 'ENU=Change;ESP=Cambiar';										
Text151@1100409015 : TextConst 'ENU=Cantidad de Art°culos:;ESP=N£mero de Productos';										
Text152@1100409016 : TextConst 'ENU=Ahorro Total:;ESP=Total Salvaciones';										
Text153@1100409017 : TextConst 'ENU=Transaction Server Error;ESP=Error Servidor Transacciones';										
Text154@1100409018 : TextConst 'ENU=No. Susp. with Payment;ESP=No. Susp. con Pago';										
Text155@1100409019 : TextConst 'ENU=Suspended Prepayment;ESP=Prepago Suspendido';										
Text156@1100409020 : TextConst 'ENU=CID-REPORT;ESP=EFECTIVO EN CAJA';										
Text157@1100409021 : TextConst 'ENU=To Bank:;ESP=A Banco';										
Text158@1100409022 : TextConst 'ENU=Bag No.;ESP=No. Bolsa';										
Text159@1100409023 : TextConst 'ENU=Tender Type;ESP=Medio de Pago';										
Text160@1100409024 : TextConst 'ENU=Qty.;ESP=Cdad.';										
Text161@1100409025 : TextConst 'ENU=%1 Transactions are pending;ESP=%1 Transacciones est†n pendientes';										
tmpCode@10012000 : Code[50];										
Text162@10012001 : TextConst 'ENU=Denomination;ESP=Denominaci¢n';										
Text163@10012002 : TextConst 'ENU=SAFE TRANSACTION;ESP=TRANSACCION SEGURA';										
Text164@10012003 : TextConst 'ENU=BANK TRANSACTION;ESP=TRANSC. BANCARIA';										
Text165@10012007 : TextConst 'ENU=Coupon;ESP=Cup¢n';										
CouponPrinting@10012004 : Boolean;										
Text166@10012005 : TextConst 'ENU=%1 for %2 is missing;ESP=No se encuetra %1para %2';										
bSecondPrintActive@10012011 : Boolean;										
Text167@1100409072 : TextConst 'ENU=FLOAT TRANSACTION;ESP=TRANS. ABONO IMPORTE';										
Text201@1100409037 : TextConst 'ENU=until;ESP=hasta';										
"Text215@1100409026 : TextConst 'ENU=""ERROR printing on station: "";ESP=""ERROR al imprimir en estaci¢n: ""';"										
PosPriceUtil@1100409039 : Codeunit 99008906;										
Text216@1100409040 : TextConst 'ENU=SPO;ESP=Ped.Esp.';										
totSPOAmount@1100409041 : Decimal;										
Text217@1100409042 : TextConst 'ENU=Pre-Receipt;ESP=Pre-Recibo';										
Text218@1100409043 : TextConst 'ENU=Prev. Prepayments;ESP=Prev. Prepagos';										
gNoSuspPOSTransactionsVoided@1100409044 : Integer;										
Text230@1100409045 : TextConst 'ENU=System Voided;ESP=Sistema Anulado';										
TmpPrintedSalesEntry@1100409048 : TEMPORARY Record 99001473;										
TmpPrintedDealPOSTransLine@1100409058 : TEMPORARY Record 99008981;										
CpnPrinting@1100409050 : Boolean;										
CpnBarcodeMaskSymbology@1100409051 : Text[30];										
Text231@1100409052 : TextConst 'ENU=TABLE TRANSFER;ESP=TABLE TRANSFER';										
PrintBuffer@1100409054 : TEMPORARY Record 10000772;										
PrintBufferIndex@1100409055 : Integer;										
Text232@1100409057 : TextConst 'ENU=Points;ESP=Puntos';										
Text233@1100409059 : TextConst 'ENU=TODAY;ESP=HOY';										
Text234@1100409060 : TextConst 'ENU=For the table;ESP=Para la mesa';										
TerminalNo@1100409061 : Code[10];										
Text235@1100409062 : TextConst 'ENU=No. of Covers;ESP=No. de Cubiertos';										
Text236@1100409063 : TextConst 'ENU=No. of Split Trans.;ESP=No. de Trans. Divididas';										
Text237@1100409064 : TextConst 'ENU=Average of Covers per Table;ESP=Media de Cubiertos por Mesa';										
Text238@1100409065 : TextConst 'ENU=Avg. Paying Cust. per Table;ESP=Media de Pagos Cliente por Mesa';										
Text239@1100409066 : TextConst 'ENU=Pre-Receipt COPY %1;ESP=COPIA Pre-Recibo %1';										
PeriodicDiscountInfoTEMP@1100409168 : TEMPORARY Record 99001453;										
Subtotal@1100409070 : Decimal;										
TotalAmt@1100409071 : Decimal;										
"DiffText@1100409053 : TextConst 'ENU=""   Difference"";ESP=""   Diferencia""';"										
Text300@1100409087 : TextConst 'ENU=Foreign Currency:;ESP=Divisa Extranjera:';										
Text301@1100409085 : TextConst 'ENU=Local and Foreign:;ESP=Local y Extranjera:';										
Text320@1100409073 : TextConst 'ENU=Float;ESP=Efectivo';										
TipsAmount1@1100409075 : Decimal;										
TipsAmount2@1100409078 : Decimal;										
TipsText1@1100409076 : Text;										
TipsText2@1100409079 : Text;										
HospitalityType@1100409077 : Record 10001212;										
Text321@1100409080 : TextConst 'ENU=Tips;ESP=Propinas';										
POSSlipTotAmt@1100409082 : Decimal;										
POSSlipSubTotAmt@1100409083 : Decimal;										
POSTransPeriodicDiscTEMP@1100409084 : TEMPORARY Record 99008943;										
TotalLCYInCurrency@1100409086 : Decimal;										
WebPrinting@1100409090 : Boolean;										
MailRecipients@1100409089 : Text;										
MailSubject@1100409088 : Text;										
PrintBufferExt@1100409091 : TEMPORARY Record 99008998;										
NodeName@1100409093 : ARRAY [32] OF Text[50];										
CurrentPrintID@1100409092 : Integer;										
Text322@1100409099 : TextConst 'ENU=ITEM DESC                            Qty;ESP=DESC PROD                           Cdad';										
Text323@1100409100 : TextConst 'ENU=Date Time Printed;ESP=Fecha Hora Impresi¢n';										
Text324@1100409101 : TextConst 'ENU=Receipt No.;ESP=No. Recibo';										
Text325@1100409102 : TextConst 'ENU=KOT No.;ESP=No. KOT';										
Text326@1100409103 : TextConst 'ENU=POS ID;ESP=ID TPV';										
Text327@1100409104 : TextConst 'ENU=Time Due;ESP=Hora Venc.';										
Text328@1100409105 : TextConst 'ENU=Station;ESP=Estaci¢n';										
Text329@1100409106 : TextConst 'ENU=Staff ID;ESP=ID Empleado';										
Text330@1100409107 : TextConst 'ENU=Staff Name;ESP=Nombre Empleado';										
Text331@1100409108 : TextConst 'ENU=Table;ESP=Tabla';										
Text332@1100409109 : TextConst 'ENU=Covers;ESP=Cubiertos';										
QRPath@1100409067 : Text[250];										
ActivePrinter@1100409112 : Record 99001790;										
"ActiveFontType@1100409113 : 'Normal,Bold,Wide,High,WideAndHight,Italic';"										
Text333@1100409127 : TextConst 'ENU=Order ID;ESP=ID Pedido';										
Text334@1100409027 : TextConst 'ENU=(Backup);ESP=No.Mesa';										
Text335@1100409029 : TextConst 'ENU=KOT Voided;ESP=KOT Anulado';										
Text336@1100409030 : TextConst 'ENU=Sales Type;ESP=Tipo venta';										
Text350@1100409110 : TextConst 'ENU=No Printer Found for print task %1 %2 in Hardware Profile %3;ESP=No se han encontrado Impresor	as	par	a	la	tarea de impresi¢n %1 %2 en el Perfil de Hardware %3';					
LastErrorText@1100409111 : Text;										
ActivePrintHeader@1100409114 : Record 99001787;										
ActivePrintLine@1100409056 : Record 99001788;										
Text351@1100409115 : TextConst 'ENU=Device Role %1 %2 not found;ESP=Rol Dispositivo %1 %2 no encontrado';										
ActivePrintEntryNo@1100409116 : Integer;										
Text352@1100409117 : TextConst 'ENU=No Email Recipients specified;ESP=No hay Recipientes Email especificados';										
Text353@1100409118 : TextConst 'ENU=Printing %1;ESP=Imprimiendo %1';										
DisplayOpen@1100409119 : Boolean;										
Text354@1100409120 : TextConst 'ENU=POS Printer %1 does not exist;ESP=Impresora TPV %1 no existe';										
Text355@1100409121 : TextConst 'ENU=Error on Insert into %1\%2. %3;ESP=Error al Insertar en %1\%2. %3';										
Text356@1100409122 : TextConst 'ENU=%1 [%2] is missing %3;ESP=%1 [%2] en falta %3';										
FiscalON@1100409123 : Boolean;										
OnlyFiscal@1100409124 : Boolean;										
OverrideWindowPrinterName@1100409126 : Text;										
NoPrint_BufferOnly@1100409028 : Boolean;										
RetailSetup@1000000000 : Record 10000700;										
PosPunto@1000000001 : Integer;										
Decimals@1000000003 : Integer;										
CentenaMillom@1000000004 : Integer;										
DecenaMilon@1000000005 : Integer;										
UdadMillon@1000000006 : Integer;										
CentenaMiles@1000000007 : Integer;										
DecenaMiles@1000000008 : Integer;										
UdadsMiles@1000000009 : Integer;										
Centenas@1000000010 : Integer;										
Decenas@1000000011 : Integer;										
Cantidades@1000000012 : Integer;										
NroDecimales@1000000013 : Integer;										
Recordar@1000000014 : Integer;										
Longitud@1000000015 : Integer;										
TextImporteCheque@1000000016 : Text[30];										
TextNRC@1000000017 : TextConst 'ENU=NRC';										
TextRNC@1000000018 : TextConst 'ENU=NIT';										
TextGIRO@1000000019 : TextConst 'ENU=GIRO';										
TextCorrelativo@1000000020 : TextConst 'ENU=Correlativo:';										
TextCodTienda@1000000021 : TextConst 'ENU=Cod.Tienda:';										
TextCaja@1000000022 : TextConst 'ENU=Caja:';										
TextAutorizacion@1000000023 : TextConst 'ENU=Autorizacion:';										
TextTicket@1000000024 : TextConst 'ENU=Ticket:';										
TextFecha@1000000025 : TextConst 'ENU=Fecha:';										
TextHora@1000000026 : TextConst 'ENU=Hora:';										
TextNIT@1000000027 : TextConst 'ENU=NIT';										
TextDUI@1000000028 : TextConst 'ENU=DUI';										
TextFirma@1000000029 : TextConst 'ENU=Firma:';										
TextUnidad@1000000030 : TextConst 'ENU=Cant.';										
TextCodigo@1000000031 : TextConst 'ENU=Articulo';										
TextValor@1000000032 : TextConst 'ENU=Precio';										
textTotal@1000000033 : TextConst 'ENU=SubTotal';										
TextDUINIT@1000000034 : TextConst 'ENU=DUI/NIT:';										
TextNombre@1000000035 : TextConst 'ENU=Nombre:';										
TextSGD16@1000000036 : TextConst 'ENU=Supervisor:';										
"Text10701@1000000037 : TextConst 'ENU=""MILLONES ""';"										
Text10702@1000000038 : TextConst 'ENU=UN MILLÍN';										
Text10703@1000000039 : TextConst 'ENU=MIL';										
Text10704@1000000040 : TextConst 'ENU=CIEN';										
Text10705@1000000041 : TextConst 'ENU=CIENTO';										
Text10706@1000000042 : TextConst 'ENU=DOSCIENTOS';										
Text10707@1000000043 : TextConst 'ENU=TRESCIENTOS';										
Text10708@1000000044 : TextConst 'ENU=CUATROCIENTOS';										
Text10709@1000000045 : TextConst 'ENU=QUINIENTOS';										
Text10710@1000000046 : TextConst 'ENU=SEISCIENTOS';										
Text10711@1000000047 : TextConst 'ENU=SETECIENTOS';										
Text10712@1000000048 : TextConst 'ENU=OCHOCIENTOS';										
Text10713@1000000049 : TextConst 'ENU=NOVECIENTOS';										
"Text10714@1000000050 : TextConst 'ENU=""DOSCIENTOS ""';"										
Text10715@1000000051 : TextConst 'ENU=TRESCIENTOS';										
Text10716@1000000052 : TextConst 'ENU=CUATROCIENTOS';										
Text10717@1000000053 : TextConst 'ENU=QUINIENTOS';										
"Text10718@1000000054 : TextConst 'ENU=""SEISCIENTOS ""';"										
Text10719@1000000055 : TextConst 'ENU=SETECIENTOS';										
Text10720@1000000056 : TextConst 'ENU=OCHOCIENTOS';										
Text10721@1000000057 : TextConst 'ENU=NOVECIENTOS';										
"Text10722@1000000058 : TextConst 'ENU=""DIEZ ""';"										
Text10723@1000000059 : TextConst 'ENU=ONCE';										
Text10724@1000000060 : TextConst 'ENU=DOCE';										
Text10725@1000000061 : TextConst 'ENU=TRECE';										
Text10726@1000000062 : TextConst 'ENU=CATORCE';										
Text10727@1000000063 : TextConst 'ENU=QUINCE';										
Text10728@1000000064 : TextConst 'ENU=DIECI';										
Text10729@1000000065 : TextConst 'ENU=VEINTE';										
Text10730@1000000066 : TextConst 'ENU=VEINTI';										
Text10731@1000000067 : TextConst 'ENU=TREINTA';										
Text10732@1000000068 : TextConst 'ENU=TREINTA Y';										
Text10733@1000000069 : TextConst 'ENU=CUARENTA';										
Text10734@1000000070 : TextConst 'ENU=CUARENTA Y';										
Text10735@1000000071 : TextConst 'ENU=CINCUENTA';										
Text10736@1000000072 : TextConst 'ENU=CINCUENTA Y';										
Text10737@1000000073 : TextConst 'ENU=SESENTA';										
Text10738@1000000074 : TextConst 'ENU=SESENTA Y';										
Text10739@1000000075 : TextConst 'ENU=SETENTA';										
Text10740@1000000076 : TextConst 'ENU=SETENTA Y';										
Text10741@1000000077 : TextConst 'ENU=OCHENTA';										
Text10742@1000000078 : TextConst 'ENU=OCHENTA Y';										
Text10743@1000000079 : TextConst 'ENU=NOVENTA';										
Text10744@1000000080 : TextConst 'ENU=NOVENTA Y';										
Text10745@1000000081 : TextConst 'ENU=UN';										
Text10746@1000000082 : TextConst 'ENU=UNO';										
Text10747@1000000083 : TextConst 'ENU=DOS';										
"Text10748@1000000084 : TextConst 'ENU=""TRES ""';"										
Text10749@1000000085 : TextConst 'ENU=CUATRO';										
Text10750@1000000086 : TextConst 'ENU=CINCO';										
"Text10751@1000000087 : TextConst 'ENU=""SEIS ""';"										
Text10752@1000000088 : TextConst 'ENU=SIETE';										
Text10753@1000000089 : TextConst 'ENU=OCHO';										
Text10754@1000000090 : TextConst 'ENU=NUEVE';										
Text10755@1000000091 : TextConst 'ENU=CêNTIMOS';										
Text10756@1000000092 : TextConst 'ENU=CêNTIMOS';										
Text10757@1000000093 : TextConst 'ENU=MILêSIMAS';										
Text10758@1000000094 : TextConst 'ENU=DIEZMILêSIMAS';										
Text10759@1000000095 : TextConst 'ENU=CêNTIMO';										
Text10760@1000000096 : TextConst 'ENU=CêNTIMO';										
Text10761@1000000097 : TextConst 'ENU=MILêSIMA';										
Text10762@1000000098 : TextConst 'ENU=DIEZMILêSIMA';										
TotalFactura@1000000100 : Decimal;										
Texto@1000000101 : ARRAY [2] OF Text[75];										
rTransaction@1000000102 : Record 99001472;										
PrintingCopy@1000000002 : Record 50002;										
PrintingCopyLastRecord@1000000103 : Integer;										
"CurrPrintType@1000000104 : ' ,X,Y,Z,YArqueo,ZZMensual';"										
CurrPrintNo@1000000105 : Code[10];										
PrintingCopyRollo@1000000109 : Record 50002;										
AuditorRoll_lrep@1000000108 : Report 50001;										
Fecha@1000000107 : Date;										
TotFac@1000000110 : Text[100];										
GeneraRollo@1000000111 : Page 50001;										
VZid@1000000112 : Code[20];										
iContador@1000000106 : Integer;										
jContador@1000000113 : Integer;										
rProductosTelefonicas@1000000099 : Record 50042;										
vProductoTelefonica1@1000000114 : Code[20];										
vProductoTelefonica2@1000000115 : Code[20];										
vProductoTelefonica3@1000000116 : Code[20];										
vProductoTelefonica4@1000000117 : Code[20];										
vDecimalesTextoFactura@1000000119 : Text[100];										
vEfectivoTotal@1000000120 : Decimal;										
vChequeTotal@1000000121 : Decimal;										
SalesEntry@1000000122 : Record 99001473;										
PosTrans@1000000123 : Codeunit 99001570;										
vTicketMayorCien@1000000124 : Boolean;										
vIVAS@1000000125 : Decimal;										
vCofreEfectivo@1000000126 : Decimal;										
vCofreCheque@1000000128 : Decimal;										
rTransSafeEntry@1000000127 : Record 99001630;										
rBarras@1000000129 : Record 99001451;										
rServidorGigaUno@1000000130 : Record 50047;										
vGigaUno@1000000131 : Boolean;										
										
PROCEDURE GetLastError@1100409058() retVal : Text;										
BEGIN										
//LS7.1-13										
retVal := LastErrorText;										
										
IF DisplayOpen THEN BEGIN										
POSGUI.ScreenDisplay('');										
DisplayOpen := FALSE;										
END;										
END;										
										
PROCEDURE IsPostPrintOK@1100409056(VAR pPosTrans@1100409000 : Record 99008980) : Boolean;										
BEGIN										
//LS7.1-13										
"IF (pPosTrans.""Transaction Type"" = pPosTrans.""Transaction Type""::Sales) THEN BEGIN"										
"IF pPosTrans.""Sale Is Return Sale"" THEN"										
EXIT(IsReturnPrinterReady)										
ELSE										
EXIT(IsSalesPrinterReady);										
END										
"ELSE IF pPosTrans.""Transaction Type"" = pPosTrans.""Transaction Type""::""Tender Decl."" THEN"										
EXIT(IsTenderDeclPrinterReady)										
"ELSE IF (pPosTrans.""Transaction Type"" = pPosTrans.""Transaction Type""::""Remove Tender"") OR"										
"(pPosTrans.""Transaction Type"" = pPosTrans.""Transaction Type""::""Float Entry"") THEN"										
EXIT(IsTenderAddRemovePrinterReady)										
ELSE										
EXIT(TRUE);										
"//ELSE IF pPosTrans.""Transaction Type"" = pPosTrans.""Transaction Type""::NegAdj THEN"										
END;										
										
PROCEDURE IsPrinterReady@1100409055(pRoleID@1100409001 : Code[10];pSubRoleID@1100409002 : Code[20]) : Boolean;										
VAR										
lDeviceID@1100409000 : Code[10];										
lPosPrinter@1100409003 : Record 99001790;										
BEGIN										
//LS7.1-13										
"//IF lRole.GET('PRINTER', pRoleID, pSubRoleID) THEN"										
"IF PosSetup.""Profile ID"" = '' THEN"										
PosSetup.GET(Globals.HardwareProfileID);										
										
"IF NOT PosSetup.GetDevice(0, pRoleID, pSubRoleID, 0, lDeviceID) THEN BEGIN"										
IF PosSetup.Printer = PosSetup.Printer::None THEN										
EXIT(TRUE)										
ELSE BEGIN										
"IF PosSetup.""OPOS Windows Printing"" THEN"										
EXIT(TRUE)										
ELSE										
"EXIT(POSGUI.CheckPrinterHealth('', 1, LastErrorText));"										
END;										
END										
ELSE BEGIN										
IF NOT lPosPrinter.GET(lDeviceID) THEN BEGIN										
"LastErrorText := STRSUBSTNO(Text354, lDeviceID);"										
EXIT(FALSE);										
END;										
										
"IF (lPosPrinter.Printer <> lPosPrinter.Printer::Virtual) AND (lPosPrinter.""Printer Device Name"" = '') THEN BEGIN"										
"LastErrorText := STRSUBSTNO(Text356, lPosPrinter.TABLECAPTION, lDeviceID, lPosPrinter.FIELDCAPTION(lPosPrinter.""Printer Device"	Na	"me"""	))	;						
EXIT(FALSE);										
END;										
										
IF lPosPrinter.Printer = lPosPrinter.Printer::Windows THEN										
EXIT(TRUE) //?? Maybe check spooler or ping printer somehow..										
ELSE										
"EXIT(POSGUI.CheckPrinterHealth(lDeviceID, 1, LastErrorText));"										
END;										
										
EXIT(TRUE);										
END;										
										
PROCEDURE IsVipPrinterReady@1000000031() : Boolean;										
BEGIN										
//CSLM200116										
"EXIT(IsPrinterReady('TENDER', 'PRINTVIP_TICKET'));"										
END;										
										
PROCEDURE IsSalesPrinterReady@1100409061() : Boolean;										
BEGIN										
//LS7.1-13										
"EXIT(IsPrinterReady('SALES', ''));"										
END;										
										
PROCEDURE IsReturnPrinterReady@1100409062() : Boolean;										
BEGIN										
//LS7.1-13										
"EXIT(IsPrinterReady('RETURN', ''));"										
END;										
										
PROCEDURE IsZReportPrinterReady@1100409063() : Boolean;										
BEGIN										
//LS7.1-13										
"EXIT(IsPrinterReady('TENDER', 'ZXREPORT'));"										
END;										
										
PROCEDURE IsTenderDeclPrinterReady@1100409065() : Boolean;										
BEGIN										
//LS7.1-13										
"EXIT(IsPrinterReady('TENDER', 'DECL'));"										
END;										
										
PROCEDURE IsTenderAddRemovePrinterReady@1100409066() : Boolean;										
BEGIN										
//LS7.1-13										
"EXIT(IsPrinterReady('TENDER', 'ADDREMOVE'));"										
END;										
										
PROCEDURE PrintSlips@41(Transaction@1000 : Record 99001472;VAR Phase@1100409001 : Integer) : Boolean;										
VAR										
PaymentEntry@1002 : Record 99001474;										
TransSalesEntry@1003 : Record 99001473;										
TransIncExpEntry@1004 : Record 99001475;										
TenderType@1005 : Record 99001462;										
WHRegistration@1100409000 : Record 99008977;										
MsgTxt@1006 : Text[50];										
PrintInvoice@1007 : Boolean;										
DestPhase@1008 : Integer;										
rPosTerminal@1000000000 : Record 99001471;										
Transac@1000000001 : Record 99001472;										
BEGIN										
//PrintSlips										
DestPhase := Phase;										
MsgTxt := '';										
PrintInvoice := FALSE;										
										
										
"//CONSISA para validar si la impresion es de NCF Valida para credito fiscal,"										
//la envio por el Slip.										
rPosTerminal.RESET;										
"rPosTerminal.SETRANGE(""No."",Transaction.""POS Terminal No."");"										
"rPosTerminal.SETRANGE(""Store No."",Transaction.""Store No."");"										
IF rPosTerminal.FINDFIRST THEN BEGIN										
"IF (Transaction.""No. Serie NCF"" = rPosTerminal.""No. Serie NCF Credito Fiscal"") OR"										
"(Transaction.""No. Serie NCF"" = rPosTerminal.""No. Serie NCF Cons. Final"") OR"										
"(Transaction.""No. Serie NCF"" = rPosTerminal.""No. Serie NCF Nota de Credito"") OR"										
"(Transaction.""No. Serie NCF"" = rPosTerminal.""No. Serie NCF Exportacion"") AND"										
"(rPosTerminal.""Imprime por Slip"" = TRUE) THEN BEGIN"										
										
PrintInvoice := TRUE;										
IsInvoice    := TRUE;										
										
END										
END;										
//CONSISA										
										
										
"PaymentEntry.SETRANGE(""Store No."",Transaction.""Store No."");"										
"PaymentEntry.SETRANGE(""POS Terminal No."",Transaction.""POS Terminal No."");"										
"PaymentEntry.SETRANGE(""Transaction No."",Transaction.""Transaction No."");"										
Phase := 1;										
"IF Transaction.""Entry Status"" = Transaction.""Entry Status""::Voided THEN BEGIN"										
//CSPNT010216  IF NOT PrintVoidSlip(Transaction) THEN										
//CSPNT010216    EXIT(FALSE);										
END										
ELSE BEGIN										
HospitalityType.RESET;										
"HospitalityType.SETRANGE(""Restaurant No."",Transaction.""Store No."");"										
"HospitalityType.SETRANGE(""Sales Type"",Transaction.""Sales Type"");"										
IF NOT HospitalityType.FINDFIRST THEN										
CLEAR(HospitalityType);										
"CASE Transaction.""Transaction Type"" OF"										
"Transaction.""Transaction Type""::Sales,Transaction.""Transaction Type""::Payment:"										
BEGIN										
IF Phase >= DestPhase THEN										
IF NOT PrintCardSlips(Transaction) THEN										
EXIT(FALSE);										
Phase := Phase + 1;										
IF Phase >= DestPhase THEN										
IF NOT PrintCardSlipsCustomerCopy(Transaction) THEN										
EXIT(FALSE);										
Phase := Phase + 1;										
"TransSalesEntry.SETRANGE(""Store No."",Transaction.""Store No."");"										
"TransSalesEntry.SETRANGE(""POS Terminal No."",Transaction.""POS Terminal No."");"										
"TransSalesEntry.SETRANGE(""Transaction No."",Transaction.""Transaction No."");"										
IF TransSalesEntry.FIND('-') THEN REPEAT										
Phase := Phase + 1;										
IF Phase >= DestPhase THEN										
IF NOT PrintExtraItem(TransSalesEntry) THEN										
EXIT(FALSE);										
UNTIL TransSalesEntry.NEXT = 0;										
										
"TransIncExpEntry.SETRANGE(""Store No."",Transaction.""Store No."");"										
"TransIncExpEntry.SETRANGE(""POS Terminal No."",Transaction.""POS Terminal No."");"										
"TransIncExpEntry.SETRANGE(""Transaction No."",Transaction.""Transaction No."");"										
IF TransIncExpEntry.FIND('-') THEN REPEAT										
Phase := Phase + 1;										
IF Phase >= DestPhase THEN										
IF NOT PrintExtraIncomeExpense(TransIncExpEntry) THEN										
EXIT(FALSE);										
UNTIL TransIncExpEntry.NEXT = 0;										
										
IF PaymentEntry.FIND('-') THEN REPEAT										
"IF TenderType.GET(PaymentEntry.""Store No."",PaymentEntry.""Tender Type"") THEN BEGIN"										
"IF (TenderType.""Function"" = TenderType.""Function""::Customer) AND (PaymentEntry.""Amount Tendered"" <> 0) THEN"										
IF Phase >= DestPhase THEN										
"IF NOT Transaction.""Post as Shipment"" THEN"										
IF NOT PrintCustomerSlip(PaymentEntry) THEN										
EXIT(FALSE);										
Phase := Phase + 1;										
"IF TenderType.""Front of Check"" THEN"										
IF Phase >= DestPhase THEN										
IF NOT PrintCheckFront(PaymentEntry) THEN										
EXIT(FALSE);										
Phase := Phase + 1;										
"IF TenderType.""Endorse Check"" THEN"										
IF Phase >= DestPhase THEN										
IF NOT PrintCheckBack(PaymentEntry) THEN										
EXIT(FALSE);										
Phase := Phase + 1;										
IF Phase >= DestPhase THEN										
IF NOT PrintExtraPayment(PaymentEntry) THEN										
EXIT(FALSE);										
IF Phase >= DestPhase THEN										
PrintVoucherRemainingAmt(PaymentEntry);										
Phase := Phase + 1;										
"IF TenderType.""Print Separate Invoice"" THEN BEGIN"										
"MsgTxt := TenderType.""Invoice in Printer"";"										
PrintInvoice := TRUE;										
END;										
END;										
UNTIL PaymentEntry.NEXT = 0;										
IF Phase >= DestPhase THEN										
IF NOT PrintAllIssuedCoupons(Transaction) THEN										
EXIT(FALSE);										
IF PrintInvoice THEN										
IF Phase >= DestPhase THEN										
"IF NOT PrintSalesInvoice(Transaction,MsgTxt) THEN"										
EXIT(FALSE);										
Phase := Phase + 1;										
"IF Transaction.""Sale Is Return Sale"" THEN"										
IF Phase >= DestPhase THEN										
IF NOT PrintReturnsSlip(Transaction) THEN										
EXIT(FALSE);										
Phase := Phase + 1;										
IF Phase >= DestPhase THEN BEGIN										
IF NOT IsInvoice THEN  // CSRM05042013										
IF NOT PrintSalesSlip(Transaction) THEN										
EXIT(FALSE);										
IF NOT PrintSpoOrderConfirm(Transaction) THEN										
EXIT(FALSE);										
END;										
"WHRegistration.SETRANGE(WHRegistration.""Transaction Type"",WHRegistration.""Transaction Type""::""Transaction Header"");"										
"WHRegistration.SETRANGE(""Store No."",Transaction.""Store No."");"										
"WHRegistration.SETRANGE(""POS Terminal No."",Transaction.""POS Terminal No."");"										
"WHRegistration.SETRANGE(""Transaction No."",Transaction.""Transaction No."");"										
IF WHRegistration.FINDFIRST THEN BEGIN										
Phase := Phase + 1;										
IF Phase >= DestPhase THEN										
IF NOT PrintWarrantyHotelSlip(WHRegistration) THEN										
EXIT(FALSE);										
END;										
END;										
										
"Transaction.""Transaction Type""::""Tender Decl."":"										
IF NOT PrintTenderDeclSlip(Transaction) THEN										
EXIT(FALSE);										
										
"Transaction.""Transaction Type""::""Float Entry"","										
"Transaction.""Transaction Type""::""Remove Tender"":"										
IF NOT PrintRemoveAddTenderSlip(Transaction) THEN										
EXIT(FALSE);										
"Transaction.""Transaction Type""::NegAdj:"										
IF NOT PrintNegAdjSlip(Transaction) THEN										
EXIT(FALSE);										
END;										
END;										
EXIT(TRUE);										
END;										
										
PROCEDURE PrintInvoice@45(Transaction@1000 : Record 99001472) : Boolean;										
BEGIN										
//PrintInvoice										
										
"IF NOT PrintSalesInvoice(Transaction,Text001) THEN"										
EXIT(FALSE);										
EXIT(TRUE);										
END;										
										
PROCEDURE PrintSalesSlip@1(VAR Transaction@1000 : Record 99001472) : Boolean;										
VAR										
POSTerminal@1001 : Record 99001471;										
bcWidth@1100409001 : Integer;										
bcHeight@1100409000 : Integer;										
bc@1100409002 : Text;										
rPosTerminal@1000000000 : Record 99001471;										
MembCard@1000000002 : Code[20];										
BEGIN										
//PrintSalesSlip										
CurrentPrintID := 100; //LS7.1-02										
										
"IF Transaction.""Transaction No."" = 0 THEN"										
EXIT(TRUE);										
										
WindowInitialize();										
"IF GenPosFunc.""Sales Slip Report ID"" <> 0 THEN BEGIN"										
"Transaction.SETRANGE(""Store No."",Transaction.""Store No."");"										
"Transaction.SETRANGE(""POS Terminal No."",Transaction.""POS Terminal No."");"										
"Transaction.SETRANGE(""Transaction No."",Transaction.""Transaction No."");"										
"REPORT.RUN(GenPosFunc.""Sales Slip Report ID"", FALSE, TRUE, Transaction);"										
END ELSE BEGIN										
										
"POSTerminal.GET(Transaction.""POS Terminal No."");"										
										
//LS7.1-13										
IF Transaction.GetPrintedCounter(1) > 0 THEN BEGIN										
"IF NOT OpenReceiptPrinter(2, 'SALES', 'COPY', Transaction.""Transaction No."", Transaction.""Receipt No."") THEN"										
EXIT(FALSE);										
END										
ELSE BEGIN										
"IF NOT OpenReceiptPrinter(2, 'SALES', '', Transaction.""Transaction No."", Transaction.""Receipt No."") THEN"										
EXIT(FALSE);										
END;										
//LS7.1-13+										
										
//LS7.1-13-										
IF FiscalON THEN BEGIN										
"IF NOT FiscalPrint(Transaction, PrintBuffer.FiscalLineType::Sale) THEN"										
EXIT(FALSE);										
										
IF OnlyFiscal THEN BEGIN										
IF ClosePrinter(2) THEN BEGIN										
bSecondPrintActive := FALSE;										
Transaction.IncPrintedCounter(1);										
COMMIT;										
EXIT(TRUE);										
END										
ELSE										
EXIT(FALSE);										
END;										
END;										
//LS7.1-13+										
										
rPosTerminal.RESET;										
"rPosTerminal.SETRANGE(""No."",Transaction.""POS Terminal No."");"										
"rPosTerminal.SETRANGE(""Store No."",Transaction.""Store No."");"										
IF rPosTerminal.FINDFIRST THEN BEGIN										
"IF (Transaction.""No. Serie NCF"" = rPosTerminal.""No. Serie NCF Credito Fiscal"") OR"										
"(Transaction.""No. Serie NCF"" = rPosTerminal.""No. Serie NCF Cons. Final"") OR"										
"(Transaction.""No. Serie NCF"" = rPosTerminal.""No. Serie NCF Nota de Credito"") OR"										
"(Transaction.""No. Serie NCF"" = rPosTerminal.""No. Serie NCF Exportacion"") THEN BEGIN"										
PrintLogo(2); //LS7.1-06										
"PrintHeader(Transaction,FALSE,2);"										
"PrintSubHeader(Transaction,2,Transaction.Date,Transaction.Time);"										
IF NOT ClosePrinter(2) THEN										
EXIT(FALSE);										
										
										
END										
ELSE										
BEGIN										
PrintLogo(2); //LS7.1-06										
"PrintHeader(Transaction,FALSE,2);"										
"PrintSubHeader(Transaction,2,Transaction.Date,Transaction.Time);"										
"PrintSalesInfo(Transaction,2);"										
"IF Transaction.""Member Card No."" <> '' THEN"										
"PrintLoyalty(Transaction,2);"										
										
"PrintFooter(Transaction,2);"										
"IF Transaction.""Post as Shipment"" THEN"										
PrintSignature('');										
										
"IF POSTerminal.""Receipt Barcode"" AND NOT Transaction.""Sale Is Return Sale"" THEN BEGIN"										
"IF POSTerminal.""Receipt Barcode Width"" > 0 THEN"										
"bcWidth := POSTerminal.""Receipt Barcode Width"""										
ELSE										
bcWidth := 8;//40; //LS7.1-01										
										
"IF POSTerminal.""Receipt Barcode Height"" > 0 THEN"										
"bcHeight := POSTerminal.""Receipt Barcode Height"""										
ELSE										
bcHeight := 40;//8 //LS7.1-01										
										
//LS7.1-01-										
"IF POSTerminal.""Receipt Barcode ID"" > 0 THEN BEGIN"										
"bc := 'T'+FORMAT(POSTerminal.""Receipt Barcode ID"", 4,'<Integer,4><Filler Character,0>')+"										
"FORMAT(Transaction.""Transaction No."", 9,'<Integer,9><Filler Character,0>');"										
"PrintBarcode(2,bc,bcWidth,bcHeight,FORMAT(POSTerminal.""Print Receipt BC Type""),2);"										
END										
ELSE										
//LS7.1-01+										
"PrintBarcode(2,'T'+Transaction.""Receipt No."",bcWidth,bcHeight,FORMAT(POSTerminal.""Print Receipt BC Type""),2);"										
										
"PrintSpoOrderBarcode(Transaction,2,TRUE);"										
END;										
IF NOT ClosePrinter(2) THEN										
EXIT(FALSE);										
										
"//CSLM210116 VALIDACION PARA IMPRESION DE COMPROBANTE VIP SI LA VENTA REALIZADA, LLEVA CLIENTE VIP"										
SalesEntry.RESET;										
"SalesEntry.SETRANGE(SalesEntry.""Receipt No."",Transaction.""Receipt No."");"										
										
IF SalesEntry.FINDFIRST THEN BEGIN										
"IF (Transaction.""Member Card No."" <> '') AND ((SalesEntry.""Item No."" = 'A7436') OR (SalesEntry.""Item No."" = 'A6454')) THEN BE"	GIN									
"MembCard := Transaction.""Member Card No."";"										
"PrintComprobanteVIP(MembCard,2,SalesEntry.""Receipt No."");"										
END;										
END;										
END;										
										
bSecondPrintActive := FALSE;										
Transaction.IncPrintedCounter(1);										
										
//CSPNT280116 doble mayor cien										
IF vTicketMayorCien THEN BEGIN										
"IF NOT OpenReceiptPrinter(2, 'SALES', 'COPY', Transaction.""Transaction No."", Transaction.""Receipt No."") THEN"										
EXIT(FALSE);										
"PrintSubHeader(Transaction,2,Transaction.Date,Transaction.Time);"										
"PrintSalesInfo(Transaction,2);"										
IF NOT ClosePrinter(2) THEN										
EXIT(FALSE);										
END;										
//CSPNT280116 doble copago										
SalesEntry.RESET;										
"SalesEntry.SETRANGE(SalesEntry.""Receipt No."",Transaction.""Receipt No."");"										
IF SalesEntry.FINDFIRST THEN BEGIN										
"IF (SalesEntry.""Item No."" = 'A1864') OR (SalesEntry.""Item No."" = 'A1871') THEN BEGIN"										
"IF NOT OpenReceiptPrinter(2, 'SALES', 'COPY', Transaction.""Transaction No."", Transaction.""Receipt No."") THEN"										
EXIT(FALSE);										
"PrintSubHeader(Transaction,2,Transaction.Date,Transaction.Time);"										
"PrintSalesInfo(Transaction,2);"										
IF NOT ClosePrinter(2) THEN										
EXIT(FALSE);										
END;										
END;										
										
//CSPNT060416 Vouchers tarjetas										
{rPosCardEntry.RESET;										
"rPosCardEntry.SETRANGE(""Receipt No."",Transaction.""Receipt No."");"										
IF rPosCardEntry.FINDFIRST THEN										
REPEAT										
"IF NOT OpenReceiptPrinter(2, 'TENDER', 'SALES', Transaction.""Transaction No."", Transaction.""Receipt No."") THEN"										
EXIT(FALSE);										
PrintCardVoucher(rPosCardEntry);										
IF NOT ClosePrinter(2) THEN										
EXIT(FALSE);										
"IF NOT OpenReceiptPrinter(2, 'SALES', 'COPY', Transaction.""Transaction No."", Transaction.""Receipt No."") THEN"										
EXIT(FALSE);										
PrintCardVoucherCopy(rPosCardEntry);										
IF NOT ClosePrinter(2) THEN										
EXIT(FALSE);										
UNTIL rPosCardEntry.NEXT = 0;}										
										
COMMIT;										
EXIT(TRUE);										
END;										
END;										
END;										
										
PROCEDURE PrintReturnsSlip@14(Transaction@1000 : Record 99001472) : Boolean;										
VAR										
POSTerminal@1001 : Record 99001471;										
DSTR1@1002 : Text[50];										
BEGIN										
//PrintReturnsSlip										
CurrentPrintID := 200; //LS7.1-02										
										
"IF Transaction.""Transaction No."" = 0 THEN"										
EXIT(TRUE);										
IF NOT POSTerminal.GET(Globals.TerminalNo) THEN										
EXIT(TRUE);										
"IF POSTerminal.""Slip if Return"" = POSTerminal.""Slip if Return""::None THEN"										
EXIT(TRUE);										
										
WindowInitialize();										
"IF GenPosFunc.""Return Slip Report ID"" <> 0 THEN BEGIN"										
"Transaction.SETRANGE(""Store No."",Transaction.""Store No."");"										
"Transaction.SETRANGE(""POS Terminal No."",Transaction.""POS Terminal No."");"										
"Transaction.SETRANGE(""Transaction No."",Transaction.""Transaction No."");"										
"REPORT.RUN(GenPosFunc.""Return Slip Report ID"", FALSE, TRUE, Transaction);"										
"IF GenPosFunc.""Return Slip Report ID"" = GenPosFunc.""Sales Slip Report ID"" THEN BEGIN"										
Transaction.IncPrintedCounter(1);										
COMMIT;										
END;										
END ELSE BEGIN										
//LS7.1-13-										
"IF NOT OpenReceiptPrinter(2, 'RETURN', '', Transaction.""Transaction No."", Transaction.""Receipt No."") THEN"										
EXIT(FALSE);										
										
IF FiscalON THEN BEGIN										
"IF NOT FiscalPrint(Transaction, PrintBuffer.FiscalLineType::Refund) THEN"										
EXIT(FALSE);										
										
IF OnlyFiscal THEN BEGIN										
EXIT(ClosePrinter(2));										
END;										
END;										
//LS7.1-13+										
										
PrintLogo(2); //LS7.1-06										
"PrintReturnHeader(Transaction,FALSE,2);"										
"PrintReturnSubHeader(Transaction,2,Transaction.Date,Transaction.Time);"										
"IF POSTerminal.""Slip if Return"" = POSTerminal.""Slip if Return""::""All Returns"" THEN BEGIN"										
"PrintSalesInfo(Transaction,2);"										
END										
"ELSE IF POSTerminal.""Slip if Return"" = POSTerminal.""Slip if Return""::""Total Value Only"" THEN BEGIN"										
DSTR1 := '#C##################';										
Value[1] := Text003;										
NodeName[1] := 'Description'; //LS7.1-02										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,TRUE,FALSE));"										
"AddPrintLine(200,1,NodeName,Value,DSTR1,FALSE,TRUE,TRUE,FALSE,2); //LS7.1-02"										
"PrintTotal(Transaction,2,3);"										
"PrintPaymInfo(Transaction,2);"										
END;										
										
PrintSignature('');										
IF NOT ClosePrinter(2) THEN										
EXIT(FALSE);										
END;										
EXIT(TRUE);										
END;										
										
PROCEDURE PrintCustomerSlip@7(PaymEntry@1000 : Record 99001474) : Boolean;										
VAR										
Transaction@1001 : Record 99001472;										
Customer@1002 : Record 18;										
Contact@1100409000 : Record 5050;										
Tendertype@1003 : Record 99001462;										
Payment@1004 : Text[30];										
i@1005 : Integer;										
DSTR1@1006 : Text[100];										
BEGIN										
//PrintCustomerSlip										
"IF PaymEntry.""Transaction No."" = 0 THEN"										
EXIT(TRUE);										
"IF NOT Transaction.GET(PaymEntry.""Store No."",PaymEntry.""POS Terminal No."",PaymEntry.""Transaction No."") THEN"										
EXIT(TRUE);										
"IF NOT Customer.GET(PaymEntry.""Card or Account"") THEN"										
EXIT(TRUE);										
"IF NOT Tendertype.GET(PaymEntry.""Store No."",PaymEntry.""Tender Type"") THEN"										
EXIT(TRUE);										
"IF NOT(Tendertype.""Function"" = Tendertype.""Function""::Customer) THEN"										
EXIT(TRUE);										
										
WindowInitialize();										
"IF GenPosFunc.""Customer Slip Report ID"" <> 0 THEN BEGIN"										
"Transaction.SETRANGE(""Store No."",Transaction.""Store No."");"										
"Transaction.SETRANGE(""POS Terminal No."",Transaction.""POS Terminal No."");"										
"Transaction.SETRANGE(""Transaction No."",Transaction.""Transaction No."");"										
"REPORT.RUN(GenPosFunc.""Customer Slip Report ID"", FALSE, TRUE, Transaction);"										
"IF GenPosFunc.""Customer Slip Report ID"" = GenPosFunc.""Sales Slip Report ID"" THEN BEGIN"										
Transaction.IncPrintedCounter(1);										
COMMIT;										
END;										
END ELSE BEGIN										
										
"IF NOT OpenReceiptPrinter(2, 'CUSTOMER', '', Transaction.""Transaction No."", Transaction.""Receipt No."") THEN"										
EXIT(FALSE);										
										
PrintLogo(2); //LS7.1-06										
"PrintHeader(Transaction,FALSE,2);"										
										
DSTR1 := '#C##################';										
"IF Transaction.""Sale Is Return Sale"" THEN BEGIN"										
Value[1] := Text003;										
NodeName[1] := 'Description'; //LS7.1-02										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,TRUE,FALSE));"										
"AddPrintLine(200,1,NodeName,Value,DSTR1,FALSE,TRUE,TRUE,FALSE,2); //LS7.1-02"										
PrintSeperator(2);										
END;										
"PrintSubHeader(Transaction,2,Transaction.Date,Transaction.Time);"										
"//CSPNT011015 Cliente credito, se quita el n£mero del cliente y se deja solo el nombre"										
"IF Transaction.""Customer No."" <> '' THEN BEGIN"										
"IF Customer.GET(Transaction.""Customer No."") THEN BEGIN"										
DSTR1 := '#C######################################';										
"Value[1] := COPYSTR(Customer.Name,1,MAXSTRLEN(Value[2]));"										
NodeName[1] := 'Customer Name'; //LS7.1-02										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
"AddPrintLine(200,2,NodeName,Value,DSTR1,FALSE,FALSE,FALSE,FALSE,2); //LS7.1-02"										
PrintSeperator(2);										
"PrintLine(2,'');"										
"PrintLine(2,'');"										
END;										
END;										
"IF Transaction.""Sell-to Contact No."" <> '' THEN BEGIN"										
"IF Contact.GET(Transaction.""Sell-to Contact No."") THEN BEGIN"										
DSTR1 := '#T############# #T######################';										
"Value[1] := Contact.""No."";"										
NodeName[1] := 'Contact No.'; //LS7.1-02										
"Value[2] := COPYSTR(Contact.Name,1,MAXSTRLEN(Value[2]));"										
NodeName[2] := 'Contact Name'; //LS7.1-02										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
"AddPrintLine(200,2,NodeName,Value,DSTR1,FALSE,FALSE,FALSE,FALSE,2); //LS7.1-02"										
PrintSeperator(2);										
"PrintLine(2,'');"										
"PrintLine(2,'');"										
END;										
END;										
										
DSTR1 := '#L##################### #R##############';										
										
"IF Transaction.""Sale Is Return Sale"" XOR"										
"(Transaction.""Transaction Type"" = Transaction.""Transaction Type""::Payment) THEN"										
Value[1] := Text006										
ELSE										
Value[1] := Text007;										
NodeName[1] := 'Account Text'; //LS7.1-02										
"Value[2] := PaymEntry.""Card or Account"";"										
NodeName[2] := 'Account No.'; //LS7.1-02										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
"AddPrintLine(200,2,NodeName,Value,DSTR1,FALSE,FALSE,FALSE,FALSE,2); //LS7.1-02"										
										
"PrintLine(2,'');"										
										
DSTR1 := '#L#############             #N##########';										
Value[1] := Text004;										
NodeName[1] := 'Total Text'; //LS7.1-02										
"IF Transaction.""Transaction Type"" = Transaction.""Transaction Type""::Payment THEN"										
"Value[2] := POSFunctions.FormatAmount(-PaymEntry.""Amount Tendered"")"										
ELSE										
"Value[2] := POSFunctions.FormatAmount(PaymEntry.""Amount Tendered"");"										
NodeName[2] := 'Total Amount'; //LS7.1-02										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
"AddPrintLine(800,2,NodeName,Value,DSTR1,FALSE,FALSE,FALSE,FALSE,2); //LS7.1-02"										
										
PrintSignature('');										
IF NOT ClosePrinter(2) THEN										
EXIT(FALSE);										
END;										
EXIT(TRUE);										
END;										
										
PROCEDURE PrintCardSlips@13(Transaction@1000 : Record 99001472) : Boolean;										
VAR										
POSCardEntry@1001 : Record 99008987;										
Tendertype@1002 : Record 99001462;										
Payment@1003 : Text[30];										
Negative@1004 : Boolean;										
i@1005 : Integer;										
DSTR1@1006 : Text[100];										
tmpStr@1007 : Text[30];										
BEGIN										
//PrintCardSlips										
"IF Transaction.""Transaction No."" = 0 THEN"										
EXIT(TRUE);										
										
CLEAR(POSCardEntry);										
"POSCardEntry.SETCURRENTKEY(""Store No."",""POS Terminal No."",""Transaction No."");"										
"POSCardEntry.SETRANGE(""Store No."",Transaction.""Store No."");"										
"POSCardEntry.SETRANGE(""POS Terminal No."",Transaction.""POS Terminal No."");"										
"POSCardEntry.SETRANGE(""Transaction No."",Transaction.""Transaction No."");"										
"POSCardEntry.SETRANGE(""Authorisation Ok"",TRUE);"										
										
WindowInitialize();										
"IF GenPosFunc.""Card Slip Report ID"" <> 0 THEN BEGIN"										
IF NOT POSCardEntry.FIND('-') THEN										
EXIT(TRUE);										
"Transaction.SETRANGE(""Store No."",Transaction.""Store No."");"										
"Transaction.SETRANGE(""POS Terminal No."",Transaction.""POS Terminal No."");"										
"Transaction.SETRANGE(""Transaction No."",Transaction.""Transaction No."");"										
"REPORT.RUN(GenPosFunc.""Card Slip Report ID"", FALSE, TRUE, Transaction);"										
"IF GenPosFunc.""Card Slip Report ID"" = GenPosFunc.""Sales Slip Report ID"" THEN BEGIN"										
Transaction.IncPrintedCounter(1);										
COMMIT;										
END;										
END ELSE BEGIN										
IF POSCardEntry.FIND('-') THEN REPEAT										
"Negative := (POSCardEntry.""Transaction Type"" = POSCardEntry.""Transaction Type""::Refund) OR"										
"(POSCardEntry.""Transaction Type"" = POSCardEntry.""Transaction Type""::""Void Sale"") OR"										
"(POSCardEntry.""Transaction Type"" = POSCardEntry.""Transaction Type""::""Void Offline"");"										
"IF NOT OpenReceiptPrinter(2, 'CARD', 'MERCHANT', Transaction.""Transaction No."", Transaction.""Receipt No."") THEN"										
EXIT(FALSE);										
										
PrintLogo(2); //LS7.1-06										
"PrintHeader(Transaction,FALSE,2);"										
"PrintSubHeader(Transaction,2,POSCardEntry.Date,POSCardEntry.Time);"										
										
DSTR1 := '#C##################';										
IF POSCardEntry.GetPrintedCounter > 1 THEN										
PrintCopyText(2);										
										
"IF Transaction.""Entry Status"" = Transaction.""Entry Status""::Training THEN"										
PrintTrainingText(2);										
										
"PrintLine(2,'');"										
										
DSTR1 := '#T######################################';										
"Value[1] := POSCardEntry.""Card Type Name"";"										
NodeName[1] := 'Card Name'; //LS7.1-02										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
"AddPrintLine(500,1,NodeName,Value,DSTR1,FALSE,TRUE,FALSE,FALSE,2); //LS7.1-02"										
										
DSTR1 := '#L###################### #R####### #R###';										
tmpStr := POSCardEntry.GetCardNo;										
IF Negative THEN										
FOR i:=1 TO STRLEN(tmpStr)-6 DO										
tmpStr[i] := '*';										
Value[1] :=										
"COPYSTR(tmpStr,1,4) + ' ' +"										
"COPYSTR(tmpStr,5,4) + ' ' +"										
"COPYSTR(tmpStr,9,4) + ' ' +"										
"COPYSTR(tmpStr,13,4) + ' ' +"										
"COPYSTR(tmpStr,17,4);"										
NodeName[1] := 'Card No.'; //LS7.1-02										
Value[2] := Text132;										
NodeName[2] := 'x'; //LS7.1-02										
"Value[3] := COPYSTR(POSCardEntry.""Expiry Date"",3,2) + '/' + COPYSTR(POSCardEntry.""Expiry Date"",1,2);"										
NodeName[3] := 'Expires'; //LS7.1-02										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
"AddPrintLine(500,3,NodeName,Value,DSTR1,FALSE,FALSE,FALSE,FALSE,2); //LS7.1-02"										
"PrintLine(2,'');"										
										
"IF POSCardEntry.""Transaction Type"" = POSCardEntry.""Transaction Type""::Refund THEN BEGIN"										
DSTR1 := '#C######################################';										
Value[1] := Text025;										
NodeName[1] := 'Card info Line'; //LS7.1-02										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
"AddPrintLine(510,1,NodeName,Value,DSTR1,FALSE,TRUE,FALSE,FALSE,2); //LS7.1-02"										
"PrintLine(2,'');"										
END;										
										
"IF (POSCardEntry.""Transaction Type"" = POSCardEntry.""Transaction Type""::""Void Sale"") OR"										
"(POSCardEntry.""Transaction Type"" = POSCardEntry.""Transaction Type""::""Void Refund"") OR"										
"(POSCardEntry.""Transaction Type"" = POSCardEntry.""Transaction Type""::""Void Offline"") THEN BEGIN"										
DSTR1 := '#C######################################';										
Value[1] := Text026;										
NodeName[1] := 'Card info Line'; //LS7.1-02										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
"AddPrintLine(510,1,NodeName,Value,DSTR1,FALSE,TRUE,FALSE,FALSE,2); //LS7.1-02"										
"IF POSCardEntry.""Transaction Type"" = POSCardEntry.""Transaction Type""::""Void Refund"" THEN BEGIN"										
DSTR1 := '#C######################################';										
Value[1] := Text025;										
NodeName[1] := 'Card info Line'; //LS7.1-02										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
"AddPrintLine(510,1,NodeName,Value,DSTR1,FALSE,TRUE,FALSE,FALSE,2); //LS7.1-02"										
END;										
"IF POSCardEntry.""Voided EFT Trans. No."" <> '' THEN BEGIN"										
DSTR1 := '#C######################################';										
"Value[1] := Text008 + POSCardEntry.""Voided EFT Trans. No."";"										
NodeName[1] := 'Card info Line'; //LS7.1-02										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
"AddPrintLine(510,1,NodeName,Value,DSTR1,FALSE,FALSE,FALSE,FALSE,2); //LS7.1-02"										
END;										
"PrintLine(2,'');"										
END;										
DSTR1 := '#L##################### #N##############';										
Value[1] := Text004;										
NodeName[1] := 'x'; //LS7.1-02										
Value[2] := POSFunctions.FormatAmount(POSCardEntry.Amount);										
NodeName[2] := 'Card Amount'; //LS7.1-02										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
"AddPrintLine(500,2,NodeName,Value,DSTR1,FALSE,TRUE,FALSE,FALSE,2); //LS7.1-02"										
"PrintLine(2,'');"										
DSTR1 := '#C######################################';										
IF NOT Negative THEN BEGIN										
"IF POSCardEntry.""Card Class"" = 'D' THEN"										
Value[1] := Text015										
ELSE										
Value[1] := Text016;										
END ELSE										
Value[1] := Text017;										
NodeName[1] := 'Card Amount Info'; //LS7.1-02										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
"AddPrintLine(500,1,NodeName,Value,DSTR1,FALSE,FALSE,FALSE,FALSE,2); //LS7.1-02"										
										
IF NOT Negative THEN										
PrintSignature(Text018)										
ELSE										
PrintSignature(Text019);										
										
"PrintLine(2,'');"										
DSTR1 := '#L##### #L###### #L##########  #Z## #Z##';										
"Value[1] := POSCardEntry.""EFT Batch No."";"										
NodeName[1] := 'EFT Batch No.'; //LS7.1-02										
"Value[2] := POSCardEntry.""EFT Terminal ID"";"										
NodeName[2] := 'EFT Terminal ID'; //LS7.1-02										
"Value[3] := POSCardEntry.""EFT Merchant No."";"										
NodeName[3] := 'EFT Merchant No.'; //LS7.1-02										
"Value[4] := POSCardEntry.""EFT Store No."";"										
NodeName[4] := 'EFT Store No.'; //LS7.1-02										
"Value[5] := POSCardEntry.""EFT POS Terminal No."";"										
NodeName[5] := 'EFT POS Terminal No.'; //LS7.1-02										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
"AddPrintLine(520,5,NodeName,Value,DSTR1,FALSE,FALSE,FALSE,FALSE,2); //LS7.1-02"										
										
DSTR1 := '#L #R######## #L##### #R######### #R####';										
"Value[1] := POSCardEntry.""Auth. Source Code"";"										
NodeName[1] := 'Auth. Source Code'; //LS7.1-02										
Value[2] := Text013;										
NodeName[2] := 'x'; //LS7.1-02										
"Value[3] := POSCardEntry.""EFT Trans. No."";"										
NodeName[3] := 'EFT Trans. No.'; //LS7.1-02										
Value[4] := Text014;										
NodeName[4] := 'x'; //LS7.1-02										
"Value[5] := POSCardEntry.""Auth.code"";"										
NodeName[5] := 'Auth. Code'; //LS7.1-02										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
"AddPrintLine(520,5,NodeName,Value,DSTR1,FALSE,FALSE,FALSE,FALSE,2); //LS7.1-02"										
										
"PrintLine(2,'');"										
DSTR1 := '#C######################################';										
IF NOT Negative THEN										
Value[1] := Text022										
ELSE										
Value[1] := Text023;										
NodeName[1] := 'Copy Info Line'; //LS7.1-02										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
"AddPrintLine(500,1,NodeName,Value,DSTR1,FALSE,FALSE,FALSE,FALSE,2); //LS7.1-02"										
										
IF NOT ClosePrinter(2) THEN										
EXIT(FALSE);										
										
POSCardEntry.IncPrintedCounter();										
COMMIT;										
UNTIL POSCardEntry.NEXT = 0;										
END;										
EXIT(TRUE);										
END;										
										
PROCEDURE PrintCardSlipsCustomerCopy@12(Transaction@1000 : Record 99001472) : Boolean;										
VAR										
POSCardEntry@1001 : Record 99008987;										
Tendertype@1002 : Record 99001462;										
Payment@1003 : Text[30];										
Negative@1004 : Boolean;										
i@1005 : Integer;										
DSTR1@1006 : Text[100];										
tmpStr@1007 : Text[30];										
BEGIN										
//PrintCardSlipCustomerCopy										
"IF Transaction.""Transaction No."" = 0 THEN"										
EXIT(TRUE);										
										
CLEAR(POSCardEntry);										
"POSCardEntry.SETCURRENTKEY(""Store No."",""POS Terminal No."",""Transaction No."");"										
"POSCardEntry.SETRANGE(""Store No."",Transaction.""Store No."");"										
"POSCardEntry.SETRANGE(""POS Terminal No."",Transaction.""POS Terminal No."");"										
"POSCardEntry.SETRANGE(""Transaction No."",Transaction.""Transaction No."");"										
"POSCardEntry.SETRANGE(""Authorisation Ok"",TRUE);"										
										
WindowInitialize();										
"IF GenPosFunc.""Card Slip Cust. Copy Report ID"" <> 0 THEN BEGIN"										
"IF GenPosFunc.""Card Slip Cust. Copy Report ID"" = GenPosFunc.""Sales Slip Report ID"" THEN"										
EXIT(TRUE);										
IF NOT POSCardEntry.FIND('-') THEN										
EXIT(TRUE);										
"Transaction.SETRANGE(""Store No."",Transaction.""Store No."");"										
"Transaction.SETRANGE(""POS Terminal No."",Transaction.""POS Terminal No."");"										
"Transaction.SETRANGE(""Transaction No."",Transaction.""Transaction No."");"										
"REPORT.RUN(GenPosFunc.""Card Slip Cust. Copy Report ID"", FALSE, TRUE, Transaction);"										
END ELSE BEGIN										
IF POSCardEntry.FIND('-') THEN REPEAT										
"Negative := (POSCardEntry.""Transaction Type"" = POSCardEntry.""Transaction Type""::Refund) OR"										
"(POSCardEntry.""Transaction Type"" = POSCardEntry.""Transaction Type""::""Void Sale"") OR"										
"(POSCardEntry.""Transaction Type"" = POSCardEntry.""Transaction Type""::""Void Offline"");"										
"IF NOT OpenReceiptPrinter(2, 'CARD', 'CUSTOMER', Transaction.""Transaction No."", Transaction.""Receipt No."") THEN"										
EXIT(FALSE);										
										
PrintLogo(2); //LS7.1-06										
"PrintHeader(Transaction,FALSE,2);"										
"PrintSubHeader(Transaction,2,POSCardEntry.Date,POSCardEntry.Time);"										
										
DSTR1 := '#C##################';										
IF POSCardEntry.GetPrintedCounter > 1 THEN										
PrintCopyText(2);										
										
"IF Transaction.""Entry Status"" = Transaction.""Entry Status""::Training THEN"										
PrintTrainingText(2);										
										
"PrintLine(2,'');"										
DSTR1 := '#T######################################';										
"Value[1] := POSCardEntry.""Card Type Name"";"										
NodeName[1] := 'Card Name'; //LS7.1-02										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
"AddPrintLine(500,1,NodeName,Value,DSTR1,FALSE,TRUE,FALSE,FALSE,2); //LS7.1-02"										
										
DSTR1 := '#L###################### #R####### #R###';										
tmpStr := POSCardEntry.GetCardNo;										
IF NOT Negative THEN										
FOR i:=1 TO STRLEN(tmpStr)-6 DO										
tmpStr[i] := '*';										
Value[1] :=										
"COPYSTR(tmpStr,1,4) + ' ' +"										
"COPYSTR(tmpStr,5,4) + ' ' +"										
"COPYSTR(tmpStr,9,4) + ' ' +"										
"COPYSTR(tmpStr,13,4) + ' ' +"										
"COPYSTR(tmpStr,17,4);"										
NodeName[1] := 'Card No.'; //LS7.1-02										
Value[2] := Text132;										
NodeName[2] := 'x'; //LS7.1-02										
"Value[3] := COPYSTR(POSCardEntry.""Expiry Date"",3,2) + '/' + COPYSTR(POSCardEntry.""Expiry Date"",1,2);"										
NodeName[3] := 'Expires'; //LS7.1-02										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
"AddPrintLine(500,3,NodeName,Value,DSTR1,FALSE,FALSE,FALSE,FALSE,2); //LS7.1-02"										
"PrintLine(2,'');"										
										
"IF POSCardEntry.""Transaction Type"" = POSCardEntry.""Transaction Type""::Refund THEN BEGIN"										
DSTR1 := '#C######################################';										
Value[1] := Text025;										
NodeName[1] := 'Card info Line'; //LS7.1-02										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
"AddPrintLine(510,1,NodeName,Value,DSTR1,FALSE,TRUE,FALSE,FALSE,2); //LS7.1-02"										
"PrintLine(2,'');"										
END;										
										
"IF (POSCardEntry.""Transaction Type"" = POSCardEntry.""Transaction Type""::""Void Sale"") OR"										
"(POSCardEntry.""Transaction Type"" = POSCardEntry.""Transaction Type""::""Void Refund"") OR"										
"(POSCardEntry.""Transaction Type"" = POSCardEntry.""Transaction Type""::""Void Offline"") THEN BEGIN"										
DSTR1 := '#C######################################';										
Value[1] := Text026;										
NodeName[1] := 'Card info Line'; //LS7.1-02										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
"AddPrintLine(510,1,NodeName,Value,DSTR1,FALSE,TRUE,FALSE,FALSE,2); //LS7.1-02"										
"IF POSCardEntry.""Transaction Type"" = POSCardEntry.""Transaction Type""::""Void Refund"" THEN BEGIN"										
DSTR1 := '#C######################################';										
Value[1] := Text025;										
NodeName[1] := 'Card info Line'; //LS7.1-02										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
"AddPrintLine(510,1,NodeName,Value,DSTR1,FALSE,TRUE,FALSE,FALSE,2); //LS7.1-02"										
END;										
"IF POSCardEntry.""Voided EFT Trans. No."" <> '' THEN BEGIN"										
DSTR1 := '#C######################################';										
"Value[1] := Text008 + POSCardEntry.""Voided EFT Trans. No."";"										
NodeName[1] := 'Card info Line'; //LS7.1-02										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
"AddPrintLine(510,1,NodeName,Value,DSTR1,FALSE,FALSE,FALSE,FALSE,2); //LS7.1-02"										
END;										
"PrintLine(2,'');"										
END;										
										
DSTR1 := '#L##################### #N##############';										
Value[1] := Text004;										
NodeName[1] := 'x'; //LS7.1-02										
Value[2] := POSFunctions.FormatAmount(POSCardEntry.Amount);										
NodeName[2] := 'Card Amount'; //LS7.1-02										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
"AddPrintLine(500,2,NodeName,Value,DSTR1,FALSE,TRUE,FALSE,FALSE,2); //LS7.1-02"										
"PrintLine(2,'');"										
DSTR1 := '#C######################################';										
IF NOT Negative THEN BEGIN										
"IF POSCardEntry.""Card Class"" = 'D' THEN"										
Value[1] := Text015										
ELSE										
Value[1] := Text016;										
END ELSE										
Value[1] := Text017;										
NodeName[1] := 'Card Amount Info'; //LS7.1-02										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
"AddPrintLine(500,1,NodeName,Value,DSTR1,FALSE,FALSE,FALSE,FALSE,2); //LS7.1-02"										
"PrintLine(2,'');"										
										
DSTR1 := '#L##### #L###### #L##########  #Z## #Z##';										
"Value[1] := POSCardEntry.""EFT Batch No."";"										
NodeName[1] := 'EFT Batch No.'; //LS7.1-02										
"Value[2] := POSCardEntry.""EFT Terminal ID"";"										
NodeName[2] := 'EFT Terminal ID'; //LS7.1-02										
"Value[3] := POSCardEntry.""EFT Merchant No."";"										
NodeName[3] := 'EFT Merchant No.'; //LS7.1-02										
"Value[4] := POSCardEntry.""EFT Store No."";"										
NodeName[4] := 'EFT Store No.'; //LS7.1-02										
"Value[5] := POSCardEntry.""EFT POS Terminal No."";"										
NodeName[5] := 'EFT POS Terminal No.'; //LS7.1-02										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
"AddPrintLine(520,5,NodeName,Value,DSTR1,FALSE,FALSE,FALSE,FALSE,2); //LS7.1-02"										
										
DSTR1 := '#L #R######## #L##### #R######### #R####';										
"Value[1] := POSCardEntry.""Auth. Source Code"";"										
NodeName[1] := 'Auth. Source Code'; //LS7.1-02										
Value[2] := Text013;										
NodeName[2] := 'x'; //LS7.1-02										
"Value[3] := POSCardEntry.""EFT Trans. No."";"										
NodeName[3] := 'EFT Trans. No.'; //LS7.1-02										
Value[4] := Text014;										
NodeName[4] := 'x'; //LS7.1-02										
"Value[5] := POSCardEntry.""Auth.code"";"										
NodeName[5] := 'Auth. Code'; //LS7.1-02										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
"AddPrintLine(520,5,NodeName,Value,DSTR1,FALSE,FALSE,FALSE,FALSE,2); //LS7.1-02"										
										
"PrintLine(2,'');"										
DSTR1 := '#C######################################';										
IF Negative THEN										
Value[1] := Text022										
ELSE										
Value[1] := Text023;										
NodeName[1] := 'Copy Info Line'; //LS7.1-02										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
"AddPrintLine(500,1,NodeName,Value,DSTR1,FALSE,FALSE,FALSE,FALSE,2); //LS7.1-02"										
										
IF NOT ClosePrinter(2) THEN										
EXIT(FALSE);										
										
POSCardEntry.IncPrintedCounter();										
COMMIT;										
UNTIL POSCardEntry.NEXT = 0;										
END;										
EXIT(TRUE);										
END;										
										
PROCEDURE PrintCardRejectedSlips@1200070004(POSTrans@1200070003 : Record 99008980;POSCardEntry@1000 : Record 99008987) : Boolean;										
VAR										
Tendertype@1002 : Record 99001462;										
Transaction@1200070002 : Record 99001472;										
i@1005 : Integer;										
DSTR1@1006 : Text[100];										
tmpStr@1007 : Text[30];										
BEGIN										
//PrintCardRejectedSlips										
//Slip on card rejection										
"IF NOT OpenReceiptPrinter(2, 'CARD', 'REJECTED', Transaction.""Transaction No."", Transaction.""Receipt No."") THEN"										
EXIT(FALSE);										
										
CLEAR(Transaction);										
"Transaction.""POS Terminal No."" := Globals.TerminalNo;"										
"Transaction.Date := POSTrans.""Original Date"";"										
"Transaction.Time := POSTrans.""Trans Time"";"										
"Transaction.""Receipt No."" := POSTrans.""Receipt No."";"										
"Transaction.""Staff ID"" := POSTrans.""Staff ID"";"										
PrintLogo(2); //LS7.1-06										
"PrintHeader(Transaction,FALSE,2);"										
"PrintSubHeader(Transaction,2,Transaction.Date,Transaction.Time);"										
										
"IF POSTrans.""Entry Status"" = POSTrans.""Entry Status""::Training THEN"										
PrintTrainingText(2);										
										
"PrintLine(2,'');"										
DSTR1 := '#T######################################';										
"Value[1] := POSCardEntry.""Card Type Name"";"										
NodeName[1] := 'Card Name';										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
"AddPrintLine(500,1,NodeName,Value,DSTR1,FALSE,TRUE,FALSE,FALSE,2); //LS7.1-02"										
										
DSTR1 := '#L###################### #R####### #R###';										
tmpStr := POSCardEntry.GetCardNo;										
FOR i:=1 TO STRLEN(tmpStr)-6 DO										
tmpStr[i] := '*';										
Value[1] :=										
"COPYSTR(tmpStr,1,4) + ' ' +"										
"COPYSTR(tmpStr,5,4) + ' ' +"										
"COPYSTR(tmpStr,9,4) + ' ' +"										
"COPYSTR(tmpStr,13,4) + ' ' +"										
"COPYSTR(tmpStr,17,4);"										
NodeName[1] := 'Card No.'; //LS7.1-02										
Value[2] := Text132;										
NodeName[2] := 'x'; //LS7.1-02										
"Value[3] := COPYSTR(POSCardEntry.""Expiry Date"",3,2) + '/' + COPYSTR(POSCardEntry.""Expiry Date"",1,2);"										
NodeName[3] := 'Expires'; //LS7.1-02										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
"PrintLine(2,'');"										
										
DSTR1 := '#C##################';										
Value[1] := Text142;										
NodeName[1] := 'Card Amount Info'; //LS7.1-02										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),TRUE,TRUE,TRUE,FALSE));"										
"AddPrintLine(500,1,NodeName,Value,DSTR1,FALSE,FALSE,FALSE,FALSE,2); //LS7.1-02"										
										
"PrintLine(2,'');"										
DSTR1 := '#L##### #L###### #L##########  #Z## #Z##';										
"Value[1] := POSCardEntry.""EFT Batch No."";"										
NodeName[1] := 'EFT Batch No.'; //LS7.1-02										
"Value[2] := POSCardEntry.""EFT Terminal ID"";"										
NodeName[2] := 'EFT Terminal ID'; //LS7.1-02										
"Value[3] := POSCardEntry.""EFT Merchant No."";"										
NodeName[3] := 'EFT Merchant No.'; //LS7.1-02										
"Value[4] := POSCardEntry.""EFT Store No."";"										
NodeName[4] := 'EFT Store No.'; //LS7.1-02										
"Value[5] := POSCardEntry.""EFT POS Terminal No."";"										
NodeName[5] := 'EFT POS Terminal No.'; //LS7.1-02										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
"AddPrintLine(520,5,NodeName,Value,DSTR1,FALSE,FALSE,FALSE,FALSE,2); //LS7.1-02"										
										
DSTR1 := '#L #R######## #L##### #R######### #R####';										
"Value[1] := POSCardEntry.""Auth. Source Code"";"										
NodeName[1] := 'Auth. Source Code'; //LS7.1-02										
Value[2] := Text013;										
NodeName[2] := 'x'; //LS7.1-02										
"Value[3] := POSCardEntry.""EFT Trans. No."";"										
NodeName[3] := 'EFT Trans. No.'; //LS7.1-02										
Value[4] := Text014;										
NodeName[4] := 'x'; //LS7.1-02										
"Value[5] := POSCardEntry.""Auth.code"";"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
"AddPrintLine(520,5,NodeName,Value,DSTR1,FALSE,FALSE,FALSE,FALSE,2); //LS7.1-02"										
										
IF NOT ClosePrinter(2) THEN										
EXIT(FALSE);										
										
EXIT(TRUE);										
END;										
										
PROCEDURE PrintSalesInvoice@8(VAR Transaction@1000 : Record 99001472;MsgTxt@1001 : Text[50]) : Boolean;										
VAR										
MembCard@1000000000 : Code[20];										
BEGIN										
//PrintSalesInvoice										
"IF Transaction.""Transaction No."" = 0 THEN"										
EXIT(TRUE);										
										
IsInvoice := TRUE;										
										
//CSPNT260916										
rServidorGigaUno.RESET;										
"rServidorGigaUno.SETRANGE(""Store No."", Transaction.""Store No."");"										
IF rServidorGigaUno.FINDFIRST THEN BEGIN										
"IF rServidorGigaUno.""Facturas GigaUno"" THEN"										
vGigaUno := TRUE										
ELSE										
vGigaUno := FALSE;										
END										
ELSE										
vGigaUno:= FALSE;										
										
IF NOT vGigaUno THEN BEGIN										
"IF NOT OpenReceiptPrinter(4, 'INVOICE', '', Transaction.""Transaction No."", Transaction.""Receipt No."") THEN"										
EXIT(FALSE);										
//CSPNT280916										
IsInvoice := TRUE;										
InsertPage(MsgTxt);										
//PrintReferencia();										
"PrintHeader(Transaction,FALSE,4);"										
"PrintSubHeader(Transaction,4,Transaction.Date,Transaction.Time);"										
"PrintSalesInfo(Transaction,4);"										
"PrintFooter(Transaction,4);"										
IF NOT ClosePrinter(4) THEN										
EXIT(FALSE);										
END										
ELSE										
"WSGenerarFactura(Transaction,4);"										
										
EXIT(TRUE);										
										
Transaction.IncPrintedCounter(1);										
COMMIT;										
										
//CSLM210116 VALIDACION DE VENTA POR FACTURA DE UN ARTICULO VIP										
SalesEntry.RESET;										
"SalesEntry.SETRANGE(SalesEntry.""Receipt No."",Transaction.""Receipt No."");"										
IF SalesEntry.FINDFIRST THEN BEGIN										
//CSPNT250616										
"IF (Transaction.""Member Card No."" <> '') AND ((SalesEntry.""Item No."" = 'A7436') OR (SalesEntry.""Item No."" = 'A6454')) THEN BE"	GIN									
"MembCard := Transaction.""Member Card No."";"										
"PrintComprobanteVIP(MembCard,2,SalesEntry.""Receipt No."");"										
END;										
END;										
										
										
//										
IsInvoice := TRUE;										
END;										
										
PROCEDURE PrintCheckFront@22(PaymEntry@1000 : Record 99001474) : Boolean;										
VAR										
Transaction@1001 : Record 99001472;										
TenderType@1002 : Record 99001462;										
DSTR1@1003 : Text[50];										
BEGIN										
//PrintCheckFront										
CurrentPrintID := 0; //LS7.1-02										
										
"IF PaymEntry.""Transaction No."" = 0 THEN"										
EXIT(TRUE);										
"IF NOT Transaction.GET(PaymEntry.""Store No."",PaymEntry.""POS Terminal No."",PaymEntry.""Transaction No."") THEN"										
EXIT(TRUE);										
"IF NOT TenderType.GET(Transaction.""Store No."",PaymEntry.""Tender Type"") THEN"										
EXIT(TRUE);										
										
"IF NOT OpenReceiptPrinter(4, 'CHECK', 'FRONT', Transaction.""Transaction No."", Transaction.""Receipt No."") THEN"										
EXIT(FALSE);										
										
"InsertPage(TenderType.""Slip Front in Printer"");"										
										
DSTR1 := '                                 #N#########';										
"Value[1] := POSFunctions.FormatAmount(PaymEntry.""Amount Tendered"");"										
"PrintLine(4,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
"PrintLine(4,'');"										
										
DSTR1 := '    #T######################################';										
"Value[1] := TenderType.""Check Payee"";"										
"PrintLine(4,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
"PrintLine(4,'');"										
										
DSTR1 := '    #T######################################';										
"Value[1] := VerboseAmount(PaymEntry.""Amount Tendered"",50);"										
"PrintLine(4,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
"PrintLine(4,'');"										
										
DSTR1 := '                                 #N#########';										
"Value[1] := FORMAT(PaymEntry.Date,5);"										
"PrintLine(4,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
"PrintLine(4,'');"										
										
IF NOT ClosePrinter(4) THEN										
EXIT(FALSE);										
EXIT(TRUE)										
END;										
										
PROCEDURE PrintCheckBack@23(PaymEntry@1000 : Record 99001474) : Boolean;										
VAR										
Transaction@1001 : Record 99001472;										
TenderType@1002 : Record 99001462;										
DSTR1@1003 : Text[50];										
BEGIN										
//PrintCheckBack										
										
//CSPNT280916 4 cambiados por 2										
										
CurrentPrintID := 0; //LS7.1-02										
										
"IF PaymEntry.""Transaction No."" = 0 THEN"										
EXIT(TRUE);										
"IF NOT Transaction.GET(PaymEntry.""Store No."",PaymEntry.""POS Terminal No."",PaymEntry.""Transaction No."") THEN"										
EXIT(TRUE);										
"IF NOT TenderType.GET(Transaction.""Store No."",PaymEntry.""Tender Type"") THEN"										
EXIT(TRUE);										
										
"IF NOT OpenReceiptPrinter(2, 'CHECK', 'BACK', Transaction.""Transaction No."", Transaction.""Receipt No."") THEN"										
EXIT(FALSE);										
										
"InsertPage(TenderType.""Slip Back in Printer"");"										
//CSPNT171115										
//CSPNT280916DSTR1 := '#L### #L####################### #L##### #L########';										
DSTR1 := '#L### #L#######################';										
Value[1] := Text020 + ':';										
"Value[2] := Transaction.""Receipt No."";"										
//CSPNT280916										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
Value[1] := Text021 + ':';										
"Value[2] := FORMAT(Transaction.""Transaction No."");"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
"PrintLine(2,'');"										
										
DSTR1 := '#T######################################';										
"Value[1] := TenderType.""Endorsement Line 1"";"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
"Value[1] := TenderType.""Endorsement Line 2"";"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
"PrintLine(2,'');"										
										
DSTR1 := '#L############             #N###########';										
Value[1] :=Text004 + ':';										
"Value[2] := POSFunctions.FormatAmount(PaymEntry.""Amount Tendered"");"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
"IF TenderType.""Card/Account No."" AND (PaymEntry.""Card or Account"" <> '') THEN BEGIN"										
DSTR1 := '#T######################################';										
"Value[1] := TenderType.""Ask for Card/Account"" + ' ' + PaymEntry.""Card or Account"";"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
"PrintLine(2,'');"										
										
IF NOT ClosePrinter(2) THEN										
EXIT(FALSE);										
EXIT(TRUE);										
END;										
										
PROCEDURE PrintSuspendSlip@25(POSTrans@1000 : Record 99008980;GrAmount@2009 : Decimal;VAR tmpPosItemTransLines@1200070001 : TEMPORAR	Y R	eco	rd	99	008981) : Boolean;					
VAR										
POSTerminal@1001 : Record 99001471;										
SalesType@1200070000 : Record 10001439;										
DSTR1@1002 : Text[50];										
Transaction@1003 : Record 99001472;										
Customer@1200070002 : Record 18;										
ItemTranslate@1200070003 : Record 30;										
bcWidth@1100409000 : Integer;										
bcHeight@1100409001 : Integer;										
bc@1100409002 : Text;										
BEGIN										
//PrintSuspendSlip										
IF NOT POSTerminal.GET(Globals.TerminalNo) THEN										
EXIT(TRUE);										
										
"IF NOT OpenReceiptPrinter(2, 'SUSPEND', '', 0, POSTrans.""Receipt No."") THEN"										
EXIT(FALSE);										
										
CLEAR(Transaction);										
"Transaction.""POS Terminal No."" := Globals.TerminalNo;"										
"Transaction.Date := POSTrans.""Original Date"";"										
"Transaction.Time := POSTrans.""Trans Time"";"										
"Transaction.""Receipt No."" := POSTrans.""Receipt No."";"										
"Transaction.""Staff ID"" := POSTrans.""Staff ID"";"										
PrintLogo(2); //LS7.1-06										
"PrintHeader(Transaction,FALSE,2);"										
"PrintSubHeader(Transaction,2,Transaction.Date,Transaction.Time);"										
										
DSTR1 := '#C##################';										
"IF (POSTrans.""Sales Type"" <> '') AND SalesType.GET(POSTrans.""Sales Type"") AND (SalesType.Description <> '') THEN"										
Value[1] := SalesType.Description										
ELSE										
Value[1] := Text033;										
NodeName[1] := 'Description'; //LS7.1-02										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),TRUE,TRUE,TRUE,FALSE));"										
"AddPrintLine(200,1,NodeName,Value,DSTR1,TRUE,TRUE,TRUE,FALSE,2); //LS7.1-02"										
PrintSeperator(2);										
"PrintLine(2,'');"										
										
"tmpPosItemTransLines.SETRANGE(""Entry Type"",tmpPosItemTransLines.""Entry Type""::Item);"										
"tmpPosItemTransLines.SETRANGE(""Entry Status"",tmpPosItemTransLines.""Entry Status""::"" "");"										
IF tmpPosItemTransLines.FIND('-') THEN BEGIN										
DSTR1 := '#L###################### #L#############';										
Value[1] := Text071;										
Value[2] := Text143;										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
PrintSeperator(2);										
REPEAT										
"IF tmpPosItemTransLines.""Unit of Measure"" = '' THEN"										
"tmpPosItemTransLines.""Unit of Measure"" :=  Text131;"										
"Value[1] := RetailHelper.Trim(tmpPosItemTransLines.Description,50);"										
										
"IF Customer.GET(POSTrans.""Customer No."") THEN"										
"IF Customer.""Language Code"" <> '' THEN"										
"IF ItemTranslate.GET(tmpPosItemTransLines.Number,"										
"tmpPosItemTransLines.""Variant Code"","										
"Customer.""Language Code"") THEN"										
IF ItemTranslate.Description <> '' THEN										
Value[1] := ItemTranslate.Description;										
										
"Value[2] := POSFunctions.FormatQty(tmpPosItemTransLines.Quantity) + ' ' + LOWERCASE(tmpPosItemTransLines.""Unit of Measure"");"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
//LS7.1-02 -										
Value[2] := Value[1];										
Value[1] := tmpPosItemTransLines.Number;										
NodeName[1] := 'Item No.';										
NodeName[2] := 'Item Description';										
"Value[3] := tmpPosItemTransLines.""Unit of Measure"";"										
NodeName[3] := 'UOM ID';										
Value[4] := POSFunctions.FormatQty(tmpPosItemTransLines.Quantity);										
NodeName[4] := 'Quantity';										
"AddPrintLine(300,4,NodeName,Value,DSTR1,FALSE,FALSE,FALSE,FALSE,2);"										
//LS7.1-02 +										
UNTIL tmpPosItemTransLines.NEXT = 0;										
PrintSeperator(2);										
END;										
										
DSTR1 := '#L################# #R##################';										
Value[1] := Text005;										
NodeName[1] := 'Total Text'; //LS7.1-02										
Value[2] := POSFunctions.FormatAmount(GrAmount);										
NodeName[2] := 'Total Amount'; //LS7.1-02										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
"AddPrintLine(800,2,NodeName,Value,DSTR1,FALSE,TRUE,FALSE,FALSE,2); //LS7.1-02"										
PrintSeperator(2);										
										
"tmpPosItemTransLines.SETRANGE(""Entry Type"",tmpPosItemTransLines.""Entry Type""::IncomeExpense);"										
"tmpPosItemTransLines.SETRANGE(""Entry Status"",tmpPosItemTransLines.""Entry Status""::"" "");"										
IF tmpPosItemTransLines.FIND('-') THEN BEGIN										
DSTR1 := '#L#################### #N###############';										
REPEAT										
GrAmount += tmpPosItemTransLines.Amount;										
"Value[1] := RetailHelper.Trim(tmpPosItemTransLines.Description,50);"										
NodeName[1] := 'Total Text'; //LS7.1-02										
Value[2] := POSFunctions.FormatAmount(-tmpPosItemTransLines.Amount);										
NodeName[2] := 'Total Amount'; //LS7.1-02										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
"AddPrintLine(800,2,NodeName,Value,DSTR1,FALSE,FALSE,FALSE,FALSE,2); //LS7.1-02"										
UNTIL tmpPosItemTransLines.NEXT = 0;										
"POSTrans.CALCFIELDS(""Gross Amount"",""Income/Exp. Amount"");"										
"IF (POSTrans.""Income/Exp. Amount"" <> 0)"										
"AND (POSTrans.""Gross Amount"" - GrAmount + POSTrans.""Income/Exp. Amount"" <> 0) THEN BEGIN"										
Value[1] := Text218;										
NodeName[1] := 'Total Text'; //LS7.1-02										
"Value[2] := POSFunctions.FormatAmount(GrAmount - POSTrans.""Gross Amount"" - POSTrans.""Income/Exp. Amount"");"										
NodeName[2] := 'Total Amount'; //LS7.1-02										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
"AddPrintLine(800,2,NodeName,Value,DSTR1,FALSE,FALSE,FALSE,FALSE,2); //LS7.1-02"										
"GrAmount := POSTrans.""Gross Amount"" + POSTrans.""Income/Exp. Amount"";"										
END;										
										
PrintSeperator(2);										
"PrintLine(2,'');"										
DSTR1 := '#L################# #R##################';										
Value[1] := Text144;										
NodeName[1] := 'Total Text'; //LS7.1-02										
Value[2] := POSFunctions.FormatAmount(GrAmount);										
NodeName[2] := 'Total Amount'; //LS7.1-02										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
"AddPrintLine(800,2,NodeName,Value,DSTR1,FALSE,TRUE,FALSE,FALSE,2); //LS7.1-02"										
PrintSeperator(2);										
END;										
										
"PrintFooter(Transaction,2);"										
										
"POSTerminal.GET(Transaction.""POS Terminal No."");"										
"IF POSTerminal.""Receipt Barcode"" THEN BEGIN"										
"IF POSTerminal.""Receipt Barcode Width"" > 0 THEN"										
"bcWidth := POSTerminal.""Receipt Barcode Width"""										
ELSE										
bcWidth := 8; //40; //LS7.1-01										
										
"IF POSTerminal.""Receipt Barcode Height"" > 0 THEN"										
"bcHeight := POSTerminal.""Receipt Barcode Height"""										
ELSE										
bcHeight := 40;  //8;  //LS7.1-01										
										
//LS7.1-01-										
"IF POSTerminal.""Receipt Barcode ID"" > 0 THEN BEGIN"										
"bc := 'P'+FORMAT(POSTerminal.""Receipt Barcode ID"", 4,'<Integer,4><Filler Character,0>')+"										
"COPYSTR(Transaction.""Receipt No."",11);"										
"PrintBarcode(2,bc,bcWidth,bcHeight,FORMAT(POSTerminal.""Print Receipt BC Type""),2);"										
END										
ELSE										
//LS7.1-01+										
"PrintBarcode(2,'P'+Transaction.""Receipt No."",bcWidth,bcHeight,FORMAT(POSTerminal.""Print Receipt BC Type""),2);"										
END;										
IF NOT ClosePrinter(2) THEN										
EXIT(FALSE);										
EXIT(TRUE);										
END;										
										
PROCEDURE PrintVoidSlip@3(Transaction@1000 : Record 99001472) : Boolean;										
VAR										
POSTerminal@1001 : Record 99001471;										
DSTR1@1002 : Text[50];										
POSTrans@1003 : Record 99008990;										
BEGIN										
//PrintVoidSlip										
IF NOT POSTerminal.GET(Globals.TerminalNo) THEN										
EXIT(TRUE);										
										
"IF NOT OpenReceiptPrinter(2, 'VOID', '', Transaction.""Transaction No."", Transaction.""Receipt No."") THEN"										
EXIT(FALSE);										
										
DSTR1 := '#C##################';										
Value[1] := Text036;										
NodeName[1] := 'Description'; //LS7.1-02										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,TRUE,FALSE));"										
"AddPrintLine(200,1,NodeName,Value,DSTR1,FALSE,TRUE,TRUE,FALSE,2); //LS7.1-02"										
PrintSeperator(2);										
"PrintLine(2,'');"										
										
DSTR1 := '#L################# #R##################';										
Value[1] := Text005;										
NodeName[1] := 'Total Text'; //LS7.1-02										
"POSTrans.GET(Transaction.""Receipt No."");"										
"POSTrans.CALCFIELDS(""Gross Amount"",""Total Discount"");"										
"Value[2] := POSFunctions.FormatAmount(POSTrans.""Gross Amount"" + POSTrans.""Total Discount"");"										
NodeName[2] := 'Total Amount'; //LS7.1-02										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
"AddPrintLine(800,2,NodeName,Value,DSTR1,FALSE,TRUE,FALSE,FALSE,2); //LS7.1-02"										
PrintSeperator(2);										
										
"PrintVoidFooter(Transaction,2);"										
IF NOT ClosePrinter(2) THEN										
EXIT(FALSE);										
Transaction.IncPrintedCounter(1);										
COMMIT;										
EXIT(TRUE);										
END;										
										
PROCEDURE NumTenderDeclSlips@1100409048(Transaction@1100409002 : Record 99001472) : Integer;										
VAR										
TransSafeEntry@1100409001 : Record 99001630;										
NumberOfSlips@1100409000 : Integer;										
BEGIN										
NumberOfSlips :=0;										
										
TransSafeEntry.RESET;										
"TransSafeEntry.SETCURRENTKEY(""Transaction Type"",""Safe Type"");"										
"TransSafeEntry.SETRANGE(""Safe Type"",TransSafeEntry.""Safe Type""::Safe);"										
"TransSafeEntry.SETRANGE(""Store No."",Transaction.""Store No."");"										
"TransSafeEntry.SETRANGE(""POS Terminal No."",Transaction.""POS Terminal No."");"										
"TransSafeEntry.SETRANGE(""Transaction No."",Transaction.""Transaction No."");"										
IF TransSafeEntry.FIND('-') THEN										
NumberOfSlips +=1;										
										
TransSafeEntry.RESET;										
"TransSafeEntry.SETCURRENTKEY(""Transaction Type"",""Safe Type"");"										
"TransSafeEntry.SETRANGE(""Safe Type"",TransSafeEntry.""Safe Type""::Bank);"										
"TransSafeEntry.SETRANGE(""Store No."",Transaction.""Store No."");"										
"TransSafeEntry.SETRANGE(""POS Terminal No."",Transaction.""POS Terminal No."");"										
"TransSafeEntry.SETRANGE(""Transaction No."",Transaction.""Transaction No."");"										
IF TransSafeEntry.FIND('-') THEN										
NumberOfSlips +=1;										
										
IF NumberOfSlips < 2 THEN										
NumberOfSlips := 2										
ELSE										
NumberOfSlips := 3;										
										
EXIT(NumberOfSlips);										
END;										
										
PROCEDURE PrintTenderDeclSlip@16(Transaction@1000 : Record 99001472) : Boolean;										
VAR										
POSTerminal@1001 : Record 99001471;										
Qty@1002 : Integer;										
DSTR1@1100409000 : Text[50];										
NumPrintSlips@1100409001 : Integer;										
BEGIN										
//PrintTenderDeclSlip										
"IF Transaction.""Transaction Type""<> Transaction.""Transaction Type""::""Tender Decl."" THEN"										
EXIT(FALSE);										
										
IF NOT POSTerminal.GET(Globals.TerminalNo) THEN										
EXIT(TRUE);										
										
"TendDeclEntry.SETCURRENTKEY(""Store No."",""POS Terminal No."",""Transaction No."");"										
Qty := 0;										
NumPrintSlips := NumTenderDeclSlips(Transaction);										
REPEAT										
"IF NOT OpenReceiptPrinter(2, 'TENDER', 'DECL', Transaction.""Transaction No."", Transaction.""Receipt No."") THEN"										
EXIT(FALSE);										
										
//LS7.1-13-										
IF FiscalON THEN BEGIN										
"IF NOT FiscalPrint(Transaction, PrintBuffer.FiscalLineType::TenderDecl) THEN"										
EXIT(FALSE);										
										
IF OnlyFiscal THEN BEGIN										
IF ClosePrinter(2) THEN BEGIN										
bSecondPrintActive := FALSE;										
Transaction.IncPrintedCounter(1);										
COMMIT;										
EXIT(TRUE);										
END										
ELSE										
EXIT(FALSE);										
END;										
END;										
//LS7.1-13+										
										
PrintLogo(2); //LS7.1-06										
"PrintHeader(Transaction,FALSE,2);"										
"PrintSubHeader(Transaction,2,Transaction.Date,Transaction.Time);"										
IF Transaction.GetPrintedCounter(1) > 0 THEN										
PrintCopyText(2);										
										
"IF Transaction.""Entry Status"" = Transaction.""Entry Status""::Training THEN"										
PrintTrainingText(2);										
										
"PrintTransType(Transaction,2);"										
										
CLEAR(TendDeclEntry);										
LocalTotal := 0;										
"TendDeclEntry.SETRANGE(""Store No."",Transaction.""Store No."");"										
"TendDeclEntry.SETRANGE(""POS Terminal No."",Transaction.""POS Terminal No."");"										
"TendDeclEntry.SETRANGE(""Transaction No."",Transaction.""Transaction No."");"										
BufferTendDeclEntry;										
										
"TempTendDeclEntry.SETFILTER(""Currency Code"",'=%1','');"										
PrintTenderDeclLines;										
IF TempTendDeclEntry.COUNT > 1 THEN BEGIN										
DSTR1 := '#L#################    #R###############';										
Value[1] := Text005 + ' ' + Globals.GetValue('CURRSYM');										
NodeName[1] := 'Total Text'; //LS7.1-02										
Value[2] := POSFunctions.FormatAmount(LocalTotal);										
NodeName[2] := 'Total Amount'; //LS7.1-02										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
"AddPrintLine(800,2,NodeName,Value,DSTR1,FALSE,TRUE,FALSE,FALSE,2); //LS7.1-02"										
"PrintLine(2,'');"										
END;										
										
"TempTendDeclEntry.SETFILTER(""Currency Code"",'<>%1','');"										
PrintTenderDeclLines;										
PrintCashDeclaration(Transaction);										
PrintSignature('');										
IF NOT ClosePrinter(2) THEN										
EXIT(FALSE);										
Qty := Qty + 1										
UNTIL Qty = NumPrintSlips;										
										
Transaction.IncPrintedCounter(1);										
COMMIT;										
EXIT(TRUE);										
END;										
										
PROCEDURE PrintTenderDeclLines@46();										
VAR										
DSTR1@1001 : Text[50];										
Payment@1002 : Text[30];										
TenderType@1003 : Record 99001462;										
TenderCard@1004 : Record 99001464;										
TransInfoCode@1005 : Record 99001478;										
Currency@1006 : Record 4;										
TransDiffEntry@1100409000 : Record 99001700;										
BEGIN										
//PrintTenderDeclLines										
DSTR1 := '#L######## #R### #R######## #R##########';										
										
IF TempTendDeclEntry.FIND('-') THEN										
REPEAT										
"LocalTotal := LocalTotal + TempTendDeclEntry.""Amount Tendered"";"										
"Payment := TempTendDeclEntry.""Tender Type"";"										
"IF TenderType.GET(TempTendDeclEntry.""Store No."",TempTendDeclEntry.""Tender Type"") THEN"										
Payment := TenderType.Description										
ELSE										
CLEAR(TenderType);										
										
CLEAR(Value);										
"IF TenderType.""Foreign Currency"" THEN BEGIN"										
"Value[1] := TempTendDeclEntry.""Currency Code"";"										
//LS7.1-02 -										
NodeName[1] := 'Currency Code';										
NodeName[2] := 'x';										
NodeName[3] := 'x';										
//LS7.1-02 +										
"IF TenderType.""Multiply in Tender Operations"" THEN BEGIN"										
Value[2] := POSFunctions.FormatQty(TempTendDeclEntry.Quantity);										
NodeName[2] := 'Quantity'; //LS7.1-02										
"Value[3] := POSFunctions.FormatAmount(TempTendDeclEntry.""Amount in Currency"" / TempTendDeclEntry.Quantity);"										
NodeName[3] := 'Tender Unit Value'; //LS7.1-02										
END;										
"Value[4] := POSFunctions.FormatCurrency(TempTendDeclEntry.""Amount in Currency"",Value[1]);"										
NodeName[4] := 'Amount In Currency'; //LS7.1-02										
END ELSE BEGIN										
Value[1] := Payment;										
"IF (TenderType.""Function"" = TenderType.""Function""::Card) THEN"										
"IF TenderCard.GET(TempTendDeclEntry.""Store No."",TempTendDeclEntry.""Tender Type"",TempTendDeclEntry.""Card No."") THEN"										
IF TenderCard.Description <> '' THEN										
Value[1] := TenderCard.Description;										
//LS7.1-02 -										
NodeName[1] := 'Tender Description';										
NodeName[2] := 'x';										
NodeName[3] := 'x';										
//LS7.1-02 +										
"IF TenderType.""Multiply in Tender Operations"" THEN BEGIN"										
Value[2] := POSFunctions.FormatQty(TempTendDeclEntry.Quantity);										
NodeName[2] := 'Quantity'; //LS7.1-02										
"Value[3] := POSFunctions.FormatAmount(TempTendDeclEntry.""Amount Tendered"" / TempTendDeclEntry.Quantity);"										
NodeName[3] := 'Tender Unit Value'; //LS7.1-02										
END;										
"Value[4] := POSFunctions.FormatAmount(TempTendDeclEntry.""Amount Tendered"");"										
NodeName[4] := 'Amount In Tender'; //LS7.1-02										
END;										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
"AddPrintLine(700,4,NodeName,Value,DSTR1,FALSE,FALSE,FALSE,FALSE,2); //LS7.1-02"										
"TransDiffEntry.SETRANGE(""Store No."",TempTendDeclEntry.""Store No."");"										
"TransDiffEntry.SETRANGE(""POS Terminal No."",TempTendDeclEntry.""POS Terminal No."");"										
"TransDiffEntry.SETRANGE(""Transaction No."",TempTendDeclEntry.""Transaction No."");"										
"TransDiffEntry.SETRANGE(""Tender Type"",TempTendDeclEntry.""Tender Type"");"										
"TransDiffEntry.SETRANGE(""Currency Code"",TempTendDeclEntry.""Currency Code"");"										
										
IF TransDiffEntry.FINDFIRST THEN BEGIN										
Value[1] := DiffText;										
//LS7.1-02 -										
NodeName[1] := 'Tender Description';										
NodeName[2] := 'x';										
NodeName[3] := 'x';										
//LS7.1-02 +										
Value[4] := POSFunctions.FormatAmount(TransDiffEntry.Amount);										
NodeName[4] := 'Amount In Tender'; //LS7.1-02										
										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
"AddPrintLine(700,4,NodeName,Value,DSTR1,FALSE,FALSE,FALSE,FALSE,2); //LS7.1-02"										
END;										
"TempTransInfoCode.SETCURRENTKEY(""Replication Counter"");"										
"TempTransInfoCode.SETRANGE(""Replication Counter"",TempTendDeclEntry.""Line No."");"										
IF TempTransInfoCode.FINDSET THEN										
REPEAT										
TransInfoCode.GET(										
"TempTransInfoCode.""Store No."",TempTransInfoCode.""POS Terminal No."",TempTransInfoCode.""Transaction No."","										
"TempTransInfoCode.""Transaction Type"",TempTransInfoCode.""Line No."","										
"TempTransInfoCode.Infocode,TempTransInfoCode.""Entry Line No."");"										
"PrintTransInfoCode(TransInfoCode,2,FALSE);"										
UNTIL TempTransInfoCode.NEXT = 0;										
UNTIL TempTendDeclEntry.NEXT = 0;										
END;										
										
PROCEDURE PrintRemoveAddTenderSlip@44(Transaction@1000 : Record 99001472) : Boolean;										
VAR										
POSTerminal@1001 : Record 99001471;										
DSTR1@1002 : Text[50];										
Qty@1003 : Integer;										
TenderType@1004 : Record 99001462;										
Payment@1005 : Text[30];										
TenderCard@1006 : Record 99001464;										
TransInfoCode@1007 : Record 99001478;										
Currency@1008 : Record 4;										
NoOfCopies@1009 : Integer;										
FiscalOption@1100409000 : Integer;										
BEGIN										
//PrintAddRemoveTenderSlip										
"IF (Transaction.""Transaction Type"" <> Transaction.""Transaction Type""::""Float Entry"") AND"										
"(Transaction.""Transaction Type"" <> Transaction.""Transaction Type""::""Remove Tender"") THEN"										
EXIT(FALSE);										
										
"IF Transaction.""Transaction Type""=Transaction.""Transaction Type""::""Remove Tender"" THEN BEGIN"										
NoOfCopies :=  NumTenderDeclSlips(Transaction);										
Sign := -1;										
FiscalOption := PrintBuffer.FiscalLineType::RemoveTender; //LS7.1-13										
END ELSE BEGIN										
NoOfCopies := 1;										
Sign := 1;										
FiscalOption := PrintBuffer.FiscalLineType::FloatTender; //LS7.1-13										
END;										
										
IF NOT POSTerminal.GET(Globals.TerminalNo) THEN										
EXIT(TRUE);										
										
Qty := 0;										
REPEAT										
"IF NOT OpenReceiptPrinter(2, 'TENDER', 'ADDREMOVE', Transaction.""Transaction No."", Transaction.""Receipt No."") THEN"										
EXIT(FALSE);										
										
//LS7.1-13-										
IF FiscalON THEN BEGIN										
"IF NOT FiscalPrint(Transaction, FiscalOption) THEN"										
EXIT(FALSE);										
										
IF OnlyFiscal THEN BEGIN										
IF ClosePrinter(2) THEN BEGIN										
bSecondPrintActive := FALSE;										
Transaction.IncPrintedCounter(1);										
COMMIT;										
EXIT(TRUE);										
END										
ELSE										
EXIT(FALSE);										
END;										
END;										
//LS7.1-13+										
										
										
PrintLogo(2); //LS7.1-06										
"PrintHeader(Transaction,FALSE,2);"										
"PrintSubHeader(Transaction,2,Transaction.Date,Transaction.Time);"										
IF Transaction.GetPrintedCounter(1) > 0 THEN										
PrintCopyText(2);										
										
"IF Transaction.""Entry Status"" = Transaction.""Entry Status""::Training THEN"										
PrintTrainingText(2);										
										
"PrintTransType(Transaction,2);"										
										
CLEAR(PaymEntry);										
LocalTotal := 0;										
"PaymEntry.SETRANGE(""Store No."",Transaction.""Store No."");"										
"PaymEntry.SETRANGE(""POS Terminal No."",Transaction.""POS Terminal No."");"										
"PaymEntry.SETRANGE(""Transaction No."",Transaction.""Transaction No."");"										
"PaymEntry.SETFILTER(""Currency Code"",'=%1','');"										
PrintRemoveAddTenderLines(Transaction);										
"Transaction.""Gross Amount"" := -LocalTotal*Sign;"										
"PrintTotal(Transaction,2,0);"										
"PrintLine(2,'');"										
"PaymEntry.SETFILTER(""Currency Code"",'<>%1','');"										
PrintRemoveAddTenderLines(Transaction);										
										
PrintCashDeclaration(Transaction);										
										
PrintSignature('');										
										
"IF Transaction.""Transaction Type""=Transaction.""Transaction Type""::""Remove Tender"" THEN BEGIN"										
"PrintLine(2,'');"										
DSTR1 := '#L##################';										
IF Qty=1 THEN										
Value[1] := Text039										
ELSE										
Value[1] := Text040;										
NodeName[1] := 'Description'; //LS7.1-02										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
"AddPrintLine(200,1,NodeName,Value,DSTR1,FALSE,TRUE,FALSE,FALSE,2); //LS7.1-02"										
END;										
										
IF NOT ClosePrinter(2) THEN										
EXIT(FALSE);										
Qty := Qty + 1;										
UNTIL Qty = NoOfCopies;										
										
Transaction.IncPrintedCounter(1);										
COMMIT;										
EXIT(TRUE);										
END;										
										
PROCEDURE PrintRemoveAddTenderLines@50(Transaction@1000 : Record 99001472);										
VAR										
DSTR1@1001 : Text[50];										
Payment@1002 : Text[30];										
TenderType@1003 : Record 99001462;										
TenderCard@1004 : Record 99001464;										
TransInfoCode@1005 : Record 99001478;										
Currency@1006 : Record 4;										
BEGIN										
//PrintRemoveAddTender										
DSTR1 := '#L######## #R### #R######## #R##########';										
IF PaymEntry.FIND('-') THEN										
REPEAT										
"Payment := PaymEntry.""Tender Type"";"										
"IF TenderType.GET(PaymEntry.""Store No."",PaymEntry.""Tender Type"") THEN"										
Payment := TenderType.Description										
ELSE										
CLEAR(TenderType);										
CLEAR(Value);										
"IF TenderType.""Function"" <> TenderType.""Function""::""Tender Remove/Float"" THEN BEGIN"										
"LocalTotal := LocalTotal + PaymEntry.""Amount Tendered"";"										
"IF TenderType.""Foreign Currency"" THEN BEGIN"										
"Value[1] := PaymEntry.""Currency Code"";"										
//LS7.1-02 -										
NodeName[1] := 'Currency Code';										
NodeName[2] := 'x';										
NodeName[3] := 'x';										
//LS7.1-02 +										
"IF TenderType.""Multiply in Tender Operations"" THEN BEGIN"										
Value[2] := POSFunctions.FormatQty(PaymEntry.Quantity);										
NodeName[2] := 'Quantity'; //LS7.1-02										
"Value[3] := POSFunctions.FormatAmount(Sign * PaymEntry.""Amount in Currency"" / PaymEntry.Quantity);"										
NodeName[3] := 'Tender Unit Value'; //LS7.1-02										
END;										
"Value[4] := POSFunctions.FormatCurrency(Sign * PaymEntry.""Amount in Currency"",PaymEntry.""Currency Code"");"										
NodeName[4] := 'Amount In Currency'; //LS7.1-02										
END ELSE BEGIN										
Value[1] := Payment;										
"IF (TenderType.""Function"" = TenderType.""Function""::Card) THEN"										
"IF TenderCard.GET(PaymEntry.""Store No."",PaymEntry.""Tender Type"",PaymEntry.""Card No."") THEN"										
IF TenderCard.Description <> '' THEN										
Value[1] := TenderCard.Description;										
//LS7.1-02 -										
NodeName[1] := 'Tender Description';										
NodeName[2] := 'x';										
NodeName[3] := 'x';										
//LS7.1-02 +										
"IF TenderType.""Multiply in Tender Operations"" THEN BEGIN"										
Value[2] := POSFunctions.FormatQty(PaymEntry.Quantity);										
NodeName[2] := 'Quantity'; //LS7.1-02										
"Value[3] := POSFunctions.FormatAmount(Sign * PaymEntry.""Amount Tendered"" / PaymEntry.Quantity);"										
NodeName[3] := 'Tender Unit Value'; //LS7.1-02										
END;										
"Value[4] := POSFunctions.FormatAmount(Sign * PaymEntry.""Amount Tendered"");"										
NodeName[4] := 'Amount In Tender'; //LS7.1-02										
END;										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
"AddPrintLine(700,4,NodeName,Value,DSTR1,FALSE,TRUE,FALSE,FALSE,2); //LS7.1-02"										
"TransInfoCode.SETRANGE(""Store No."",Transaction.""Store No."");"										
"TransInfoCode.SETRANGE(""POS Terminal No."",Transaction.""POS Terminal No."");"										
"TransInfoCode.SETRANGE(""Transaction No."",Transaction.""Transaction No."");"										
"TransInfoCode.SETRANGE(""Transaction Type"",TransInfoCode.""Transaction Type""::""Payment Entry"");"										
"TransInfoCode.SETRANGE(""Line No."",PaymEntry.""Line No."");"										
"PrintTransInfoCode(TransInfoCode,2,FALSE);"										
END;										
UNTIL PaymEntry.NEXT = 0;										
END;										
										
PROCEDURE PrintPOSSlip@60(VAR POSTrans@1000 : Record 99008980) : Boolean;										
VAR										
Transaction@1010 : Record 99001472;										
BEGIN										
//PrintPOSSlip										
"IF NOT OpenReceiptPrinter(2, 'PREPOST', '', 0, POSTrans.""Receipt No."") THEN"										
EXIT(FALSE);										
										
PrintLogo(2); //LS7.1-06										
"POSTrans.CALCFIELDS(""Gross Amount"",""Total Discount"",""Income/Exp. Amount"");"										
"PrintPOSHeader(POSTrans,2,0);"										
"PrintPOSSubHeader(POSTrans,2,POSTrans.""Original Date"",POSTrans.""Trans Time"");"										
										
// CSAC Ticket Call center										
"{PrintPosSalesInfo(POSTrans,2,0);}"										
"PrintDriverSalesInfo(POSTrans, 2, 0);"										
"{PrintPOSTotal(POSTrans,2,3);"										
										
"PrintTipLines(POSTrans,2);"										
"PrintVATInfo(POSTrans,2,0);}"										
										
"PrintPOSFooter(POSTrans,2);"										
IF NOT ClosePrinter(2) THEN										
EXIT(FALSE);										
										
EXIT(TRUE);										
END;										
										
PROCEDURE PrintTipLines@10012002(PosTrans@10012000 : Record 99008980;Tray@10012004 : Integer);										
VAR										
TipsPanel@1100409000 : Record 99008912;										
InputCtrl@1100409001 : Record 99008915;										
DSTR1@10012003 : Text[50];										
HospType@10012001 : Record 10001212;										
Seq@10012002 : Integer;										
TipsPrinted@10012006 : Boolean;										
BEGIN										
//PrintTipLines										
										
TipsPrinted := FALSE;										
										
"IF HospType.GET(PosTrans.""Store No."",PosTrans.""Hosp. Type Sequence"",PosTrans.""Sales Type"") THEN BEGIN"										
"IF NOT Globals.GetPosPanelRec(HospType.""Tips Panel ID"",TipsPanel) THEN"										
EXIT;										
InputCtrl.RESET;										
"IF Globals.GetPosInputCtrlRecInPanel(TipsPanel,Globals.HoTipsAmt1InputID,InputCtrl) THEN BEGIN"										
DSTR1 := '#L################## #R#################';										
"Value[1] := InputCtrl.""Prompt Text"";"										
Value[2] := '________________';										
"PrintLine(Tray,'');"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
TipsPrinted := TRUE;										
END;										
InputCtrl.RESET;										
"IF Globals.GetPosInputCtrlRecInPanel(TipsPanel,Globals.HoTipsAmt2InputID,InputCtrl) THEN BEGIN"										
"Value[1] := InputCtrl.""Prompt Text"";"										
Value[2] := '________________';										
"PrintLine(Tray,'');"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
TipsPrinted := TRUE;										
END;										
InputCtrl.RESET;										
"IF Globals.GetPosInputCtrlRecInPanel(TipsPanel,Globals.HoTipsTotalInputID,InputCtrl) THEN BEGIN"										
"Value[1] := InputCtrl.""Prompt Text"";"										
Value[2] := '________________';										
"PrintLine(Tray,'');"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
TipsPrinted := TRUE;										
END;										
IF TipsPrinted THEN										
PrintSeperator(Tray);										
END;										
END;										
										
PROCEDURE PrintVATInfo@1100409044(POSTransaction@1100409000 : Record 99008980;Tray@1100409013 : Integer;SplitNumber@1100409001 : Int	ege	r);								
VAR										
POSSalesEntry@1100409004 : Record 99008981;										
VATSetup@1100409002 : Record 99001560;										
SalesAmountVAT@1100409012 : ARRAY [5] OF Decimal;										
VATPerc@1100409011 : ARRAY [5] OF Decimal;										
VATAmount@1100409010 : ARRAY [5] OF Decimal;										
VATCode@1100409009 : ARRAY [5] OF Code[10];										
i@1100409007 : Integer;										
j@1100409006 : Integer;										
VATPrinted@1100409003 : Boolean;										
DSTR1@1100409014 : Text[100];										
CompInfo@1100409008 : Record 79;										
TransIncomeExpenseEntry@1100409005 : Record 99001475;										
BEGIN										
CLEAR(VATCode);										
CLEAR(VATPerc);										
CLEAR(VATAmount);										
CLEAR(SalesAmountVAT);										
CLEAR(Value);										
										
"POSSalesEntry.SETRANGE(""Receipt No."",POSTransaction.""Receipt No."");"										
"POSSalesEntry.SETFILTER(""Entry Type"",'%1|%2',POSSalesEntry.""Entry Type""::Item,"										
"POSSalesEntry.""Entry Type""::IncomeExpense);"										
"POSSalesEntry.SETRANGE(""Entry Status"",POSSalesEntry.""Entry Status""::"" "");"										
										
IF SplitNumber <> 0 THEN BEGIN										
IF SplitNumber <> 1 THEN										
"POSSalesEntry.SETRANGE(POSSalesEntry.""Guest/Seat No."",SplitNumber - 1)"										
ELSE										
"POSSalesEntry.SETRANGE(POSSalesEntry.""Guest/Seat No."",0);"										
END;										
										
IF POSSalesEntry.FIND('-') THEN BEGIN										
REPEAT										
i := 0;										
j := 0;										
"IF VATSetup.GET(POSSalesEntry.""VAT Code"") THEN BEGIN"										
REPEAT										
i := i + 1;										
IF j = 0 THEN										
IF VATCode[i] = '' THEN										
j := i;										
"UNTIL (VATCode[i] = VATSetup.""VAT Code"") OR (i >= 5);"										
"IF VATCode[i] <> VATSetup.""VAT Code"" THEN BEGIN"										
i := j;										
"VATPerc[i] := VATSetup.""VAT %"";"										
"VATCode[i] := VATSetup.""VAT Code"";"										
END;										
"VATAmount[i] := VATAmount[i] + POSSalesEntry.""VAT Amount"";"										
"SalesAmountVAT[i] := SalesAmountVAT[i] + POSSalesEntry.""Net Amount"" + POSSalesEntry.""VAT Amount"";"										
END;										
UNTIL POSSalesEntry.NEXT = 0;										
END;										
										
VATPrinted := FALSE;										
"IF NOT GenPosFunc.""Skip VAT on Receipt"" AND NOT POSTransaction.""Post as Shipment"" THEN BEGIN"										
FOR i := 1 TO 5 DO BEGIN										
IF VATCode[i] <> '' THEN BEGIN										
IF i = 1 THEN BEGIN										
DSTR1 := '#R####% #R######## #R######## #R########';										
Value[1] := Text063;										
Value[2] := Text063_2;										
Value[3] := Text063;										
Value[4] := Text004;										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
DSTR1 := '#L #N## #N######## #N######## #N########';										
VATPrinted := TRUE;										
Value[1] := VATCode[i];										
NodeName[1] := 'VAT Code'; //LS7.1-02										
Value[2] := FORMAT(VATPerc[i]);										
NodeName[2] := 'VAT %'; //LS7.1-02										
Value[3] := POSFunctions.FormatAmount(SalesAmountVAT[i] - VATAmount[i]);										
NodeName[3] := 'Net Amount'; //LS7.1-02										
Value[4] := POSFunctions.FormatAmount(VATAmount[i]);										
NodeName[4] := 'VAT Amount'; //LS7.1-02										
Value[5] := POSFunctions.FormatAmount(SalesAmountVAT[i]);										
NodeName[5] := 'Amount'; //LS7.1-02										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
"AddPrintLine(900,5,NodeName,Value,DSTR1,FALSE,FALSE,FALSE,FALSE,Tray); //LS7.1-02"										
END;										
END;										
										
IF CompInfo.GET THEN										
"IF (CompInfo.""VAT Registration No."" <> '') AND (GenPosFunc.""VAT Reg.No. on Receipt"") THEN BEGIN"										
"PrintLine(Tray,'');"										
Value[1] := Text133;										
NodeName[1] := 'x'; //LS7.1-02										
"Value[2] := CompInfo.""VAT Registration No."";"										
NodeName[2] := 'VAT Registration No.'; //LS7.1-02										
DSTR1 := '#L########### #L########################';										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
"AddPrintLine(200,2,NodeName,Value,DSTR1,FALSE,FALSE,FALSE,FALSE,Tray); //LS7.1-02"										
END;										
END;										
										
IF VATPrinted THEN										
PrintSeperator(Tray);										
END;										
										
PROCEDURE PrintTransType@47(Transaction@1000 : Record 99001472;Tray@1001 : Integer) : Boolean;										
VAR										
DSTR1@1002 : Text[50];										
BEGIN										
//PrintTransType										
DSTR1 := '#C##################';										
"tmpCode := FORMAT(Transaction.""Transaction Type"");"										
Value[1] := tmpCode;										
NodeName[1] := 'Print Info'; //LS7.1-02										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,TRUE,FALSE));"										
"AddPrintLine(250,1,NodeName,Value,DSTR1,FALSE,TRUE,TRUE,FALSE,Tray); //LS7.1-02"										
PrintSeperator(Tray);										
"PrintLine(Tray,'');"										
END;										
										
PROCEDURE PrintTotal@54(Transaction@1000 : Record 99001472;Tray@1001 : Integer;RightIndent@1002 : Integer) : Boolean;										
VAR										
DSTR1@1003 : Text[50];										
SecTotal@1004 : Decimal;										
CurrencyExchRate@1006 : Record 330;										
Total@1007 : Decimal;										
TotalAmtForSummary@1100409000 : Decimal;										
gltesttotal@1100409001 : TextConst 'ENU=gl total;ESP=total gl';										
SecSubTotal@1100409002 : Decimal;										
BEGIN										
//PrintTotal										
CLEAR(Value);										
CLEAR(Currency);										
										
"Total := -Transaction.""Gross Amount"" - Transaction.""Income/Exp. Amount"" + totSPOAmount;"										
										
"IF GenPosFunc.""Display Secondary Total Curr"" AND (GenPosFunc.""Secondary Total Currency"" <> '') THEN BEGIN"										
"IF NOT Currency.GET(GenPosFunc.""Secondary Total Currency"") THEN"										
CLEAR(Currency);										
"SecTotal := ROUND(CurrencyExchRate.ExchangeAmtFCYToFCY(Transaction.Date,Transaction.""Trans. Currency"",Currency.Code,"										
"Total),Currency.""Amount Rounding Precision"");"										
END;										
{//LS7.1-12 -										
"IF (GenPosFunc.""Print Disc/Cpn Info on Slip"" ="										
"GenPosFunc.""Print Disc/Cpn Info on Slip""::""Summary information below Sub-total"") OR"										
"(GenPosFunc.""Print Disc/Cpn Info on Slip"" ="										
"GenPosFunc.""Print Disc/Cpn Info on Slip""::""Detail information for each line"") THEN BEGIN"										
}//LS7.1-12 +										
//LS7.1-12 -										
"IF (GenPosFunc.""Print Disc/Cpn Info on Slip"" ="										
"GenPosFunc.""Print Disc/Cpn Info on Slip""::""Summary information below Sub-total"") OR"										
"(GenPosFunc.""Print Disc/Cpn Info on Slip"" ="										
"GenPosFunc.""Print Disc/Cpn Info on Slip""::""Detail for each line and Sub-total"") OR"										
"(GenPosFunc.""Print Disc/Cpn Info on Slip"" ="										
"GenPosFunc.""Print Disc/Cpn Info on Slip""::""Detail information for each line"") THEN BEGIN"										
//LS7.1-12 +										
PeriodicDiscountInfoTEMP.RESET;										
"PeriodicDiscountInfoTEMP.SETCURRENTKEY(Status,Type);"										
//CSPNT071215 Solo imprime descuentos de tipo tender type										
"PeriodicDiscountInfoTEMP.SETRANGE(""Offer Type"",PeriodicDiscountInfoTEMP.""Offer Type""::""Tender Type"");"										
//LS7.1-02 -										
NodeName[1] := 'Total Text';										
NodeName[2] := 'Total Amount';										
//LS7.1-02 +										
IF PeriodicDiscountInfoTEMP.FINDSET THEN BEGIN										
//CSPNT071215    DSTR1 := '#L################# #R##################';										
//CSPNT051215    Value[1] := Text042 + ' ' + Globals.GetValue('CURRSYM');										
//CSPNT071215    Value[2] := POSFunctions.FormatAmount(-Subtotal + TipsAmount1 + TipsAmount2);										
"{    PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
"AddPrintLine(800,2,NodeName,Value,DSTR1,FALSE,FALSE,FALSE,FALSE,Tray); //LS7.1-02"										
}										
//CSPNT07121  Imprimir Linea en blanco...										
"DSTR1 :=     COPYSTR('                     ',1);"										
Value[1] := '';										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
TotalAmtForSummary := Subtotal;										
REPEAT										
//LS7.1-12 -										
"IF (GenPosFunc.""Print Disc/Cpn Info on Slip"" ="										
"GenPosFunc.""Print Disc/Cpn Info on Slip""::""Detail for each line and Sub-total"") AND"										
(PeriodicDiscountInfoTEMP.Description <> Text024) THEN										
"PeriodicDiscountInfoTEMP.""Discount Amount Value"" := 0;"										
//LS7.1-12 +										
"IF PeriodicDiscountInfoTEMP.""Discount Amount Value"" <> 0 THEN BEGIN"										
DSTR1 := '#L################# #R##################';										
Value[1] := PeriodicDiscountInfoTEMP.Description;										
"Value[2] := POSFunctions.FormatAmount(-PeriodicDiscountInfoTEMP.""Discount Amount Value"");"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
"AddPrintLine(800,2,NodeName,Value,DSTR1,FALSE,FALSE,FALSE,FALSE,Tray); //LS7.1-02"										
"TotalAmtForSummary := TotalAmtForSummary + PeriodicDiscountInfoTEMP.""Discount Amount Value"";"										
END;										
"IF PeriodicDiscountInfoTEMP.""Discount % Value"" <> 0 THEN BEGIN   //Points"										
DSTR1 := '#L################# #R##################';										
Value[1] := PeriodicDiscountInfoTEMP.Description;										
"Value[2] := POSFunctions.FormatAmount(PeriodicDiscountInfoTEMP.""Discount % Value"") + ' ' + Text232;"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
"AddPrintLine(800,2,NodeName,Value,DSTR1,FALSE,FALSE,FALSE,FALSE,Tray); //LS7.1-02"										
END;										
UNTIL PeriodicDiscountInfoTEMP.NEXT = 0;										
//CSPNT051215    DSTR1 := '#L################# #R##################';										
{    Value[1] := Text005 + ' ' + Globals.GetValue('CURRSYM');										
Value[2] := POSFunctions.FormatAmount(-TotalAmtForSummary + TipsAmount1 + TipsAmount2 + totSPOAmount);										
//LS7.1-16 -										
"IF GenPosFunc.""Display Secondary Total Curr"" AND (GenPosFunc.""Secondary Total Currency"" <> '') AND (SecTotal <> 0) THEN BEGIN"										
DSTR1 :=  '#L######## #R########## #R##############';										
Value[1] := Text005 + ' ' + Globals.GetValue('CURRSYM');										
"Value[2] := Currency.Code + FORMAT(SecTotal,0,ApplMan.AutoFormatTranslate(1,Currency.Code));"										
Value[3] := POSFunctions.FormatAmount(-TotalAmtForSummary + TipsAmount1 + TipsAmount2 + totSPOAmount);										
NodeName[2] := 'Sec.Curr';										
NodeName[3] := 'Total Amount';										
END;										
//LS7.1-16 +										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
"AddPrintLine(800,2,NodeName,Value,DSTR1,FALSE,FALSE,FALSE,FALSE,Tray); //LS7.1-02"										
}										
IF TipsAmount1 <> 0 THEN BEGIN										
DSTR1 := '#L################# #R##################';										
Value[1] := TipsText1 + ' ' + Globals.GetValue('CURRSYM');										
Value[2] := POSFunctions.FormatAmount(-TipsAmount1);										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
"AddPrintLine(800,2,NodeName,Value,DSTR1,FALSE,FALSE,FALSE,FALSE,Tray); //LS7.1-02"										
END;										
IF TipsAmount2 <> 0 THEN BEGIN										
DSTR1 := '#L################# #R##################';										
Value[1] := TipsText2 + ' ' + Globals.GetValue('CURRSYM');										
Value[2] := POSFunctions.FormatAmount(-TipsAmount2);										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
"AddPrintLine(800,2,NodeName,Value,DSTR1,FALSE,FALSE,FALSE,FALSE,Tray); //LS7.1-02"										
END;										
END										
ELSE BEGIN										
//CSPNT051215    DSTR1 := '#L################# #R##################';										
{    Value[1] := Text005 + ' ' + Globals.GetValue('CURRSYM');										
"//LS7.1-12    IF GenPosFunc.""Print Disc/Cpn Info on Slip"" ="										
"//LS7.1-12        GenPosFunc.""Print Disc/Cpn Info on Slip""::""Summary information below Sub-total"" THEN"										
//LS7.1-12 -										
"IF GenPosFunc.""Print Disc/Cpn Info on Slip"" IN"										
"[GenPosFunc.""Print Disc/Cpn Info on Slip""::""Detail for each line and Sub-total"","										
"GenPosFunc.""Print Disc/Cpn Info on Slip""::""Summary information below Sub-total""] THEN BEGIN"										
//LS7.1-12 +										
Value[2] := POSFunctions.FormatAmount(-Subtotal + TipsAmount1 + TipsAmount2 + totSPOAmount);										
//LS7.1-16 -										
"IF GenPosFunc.""Display Secondary Total Curr"" AND (GenPosFunc.""Secondary Total Currency"" <> '') AND (SecTotal <> 0) THEN BEGI"	N									
"SecSubTotal := ROUND(CurrencyExchRate.ExchangeAmtFCYToFCY(Transaction.Date,Transaction.""Trans. Currency"",Currency.Code,"										
"Total),Currency.""Amount Rounding Precision"");"										
DSTR1 :=  '#L######## #R########## #R##############';										
Value[1] := Text005 + ' ' + Globals.GetValue('CURRSYM');										
"Value[2] := Currency.Code + FORMAT(SecSubTotal,0,ApplMan.AutoFormatTranslate(1,Currency.Code));"										
Value[3] := POSFunctions.FormatAmount(-Subtotal + TipsAmount1 + TipsAmount2 + totSPOAmount);										
NodeName[2] := 'Sec.Curr';										
NodeName[3] := 'Total Amount';										
END;										
//LS7.1-16 +										
END										
ELSE BEGIN										
Value[2] := POSFunctions.FormatAmount(-TotalAmt + TipsAmount1 + TipsAmount2 + totSPOAmount);										
//LS7.1-16 -										
"IF GenPosFunc.""Display Secondary Total Curr"" AND (GenPosFunc.""Secondary Total Currency"" <> '') AND (SecTotal <> 0) THEN BEGI"	N									
DSTR1 :=  '#L######## #R########## #R##############';										
Value[1] := Text005 + ' ' + Globals.GetValue('CURRSYM');										
"Value[2] := Currency.Code + FORMAT(SecTotal,0,ApplMan.AutoFormatTranslate(1,Currency.Code));"										
Value[3] := POSFunctions.FormatAmount(-TotalAmt + TipsAmount1 + TipsAmount2 + totSPOAmount);										
NodeName[2] := 'Sec.Curr';										
NodeName[3] := 'Total Amount';										
END;										
//LS7.1-16 +										
END;										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
"AddPrintLine(800,2,NodeName,Value,DSTR1,FALSE,FALSE,FALSE,FALSE,Tray); //LS7.1-02"										
IF TipsAmount1 <> 0 THEN BEGIN										
DSTR1 := '#L################# #R##################';										
Value[1] := TipsText1 + ' ' + Globals.GetValue('CURRSYM');										
Value[2] := POSFunctions.FormatAmount(-TipsAmount1);										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
"AddPrintLine(800,2,NodeName,Value,DSTR1,FALSE,FALSE,FALSE,FALSE,Tray); //LS7.1-02"										
END;										
IF TipsAmount2 <> 0 THEN BEGIN										
DSTR1 := '#L################# #R##################';										
Value[1] := TipsText2 + ' ' + Globals.GetValue('CURRSYM');										
Value[2] := POSFunctions.FormatAmount(-TipsAmount2);										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
"AddPrintLine(800,2,NodeName,Value,DSTR1,FALSE,FALSE,FALSE,FALSE,Tray); //LS7.1-02"										
END;										
}										
END;										
END										
ELSE BEGIN										
//LS7.1-02 -										
//CSPNT051215  NodeName[1] := 'Total Text';										
{  NodeName[2] := 'Total Amount';										
//LS7.1-02 +										
DSTR1 := '#L################# #R##################';										
Value[1] := Text005 + ' ' + Globals.GetValue('CURRSYM');										
Value[2] := POSFunctions.FormatAmount(-TotalAmt + TipsAmount1 + TipsAmount2 + totSPOAmount);										
//LS7.1-16 -										
"IF GenPosFunc.""Display Secondary Total Curr"" AND (GenPosFunc.""Secondary Total Currency"" <> '') AND (SecTotal <> 0) THEN BEGIN"										
DSTR1 :=  '#L######## #R########## #R##############';										
Value[1] := Text005 + ' ' + Globals.GetValue('CURRSYM');										
"Value[2] := Currency.Code + FORMAT(SecTotal,0,ApplMan.AutoFormatTranslate(1,Currency.Code));"										
Value[3] := POSFunctions.FormatAmount(-TotalAmt + TipsAmount1 + TipsAmount2 + totSPOAmount);										
NodeName[2] := 'Sec.Curr';										
NodeName[3] := 'Total Amount';										
END;										
//LS7.1-16 +										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
"AddPrintLine(800,2,NodeName,Value,DSTR1,FALSE,FALSE,FALSE,FALSE,Tray); //LS7.1-02"										
IF TipsAmount1 <> 0 THEN BEGIN										
DSTR1 := '#L################# #R##################';										
Value[1] := TipsText1 + ' ' + Globals.GetValue('CURRSYM');										
Value[2] := POSFunctions.FormatAmount(-TipsAmount1);										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
"AddPrintLine(800,2,NodeName,Value,DSTR1,FALSE,FALSE,FALSE,FALSE,Tray); //LS7.1-02"										
END;										
IF TipsAmount2 <> 0 THEN BEGIN										
DSTR1 := '#L################# #R##################';										
Value[1] := TipsText2 + ' ' + Globals.GetValue('CURRSYM');										
Value[2] := POSFunctions.FormatAmount(-TipsAmount2);										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
"AddPrintLine(800,2,NodeName,Value,DSTR1,FALSE,FALSE,FALSE,FALSE,Tray); //LS7.1-02"										
END;										
}										
END;										
END;										
										
PROCEDURE PrintPOSTotal@1100409039(POSTrans@1000 : Record 99008980;Tray@1001 : Integer;RightIndent@1002 : Integer) : Boolean;										
VAR										
DSTR1@1003 : Text[50];										
SecTotal@1004 : Decimal;										
CurrencyExchRate@1006 : Record 330;										
Total@1007 : Decimal;										
BEGIN										
//PrintPOSTotal										
EXIT;										
										
CLEAR(Value);										
CLEAR(Currency);										
										
POSTrans.CALCFIELDS(Payment);										
"Total := POSTrans.""Gross Amount"" + POSTrans.""Service Charge"" + POSTrans.""Income/Exp. Amount"" + totSPOAmount - POSTrans.Payment;"										
										
"IF GenPosFunc.""Display Secondary Total Curr"" AND (GenPosFunc.""Secondary Total Currency"" <> '') THEN BEGIN"										
"IF NOT Currency.GET(GenPosFunc.""Secondary Total Currency"") THEN"										
CLEAR(Currency);										
"SecTotal := ROUND(CurrencyExchRate.ExchangeAmtFCYToFCY(POSTrans.""Original Date"",POSTrans.""Trans. Currency Code"",Currency.Code,"										
"Total),Currency.""Amount Rounding Precision"");"										
END;										
										
//LS7.1-02 -										
NodeName[1] := 'Total Text';										
NodeName[2] := 'Total Amount';										
//LS7.1-02 +										
DSTR1 := '#L########## #R######### #R#############';										
"DSTR1 := COPYSTR(DSTR1,1,STRLEN(DSTR1) - RightIndent);"										
"IF POSTrans.""Total Discount"" <> 0 THEN BEGIN"										
Value[1] := Text042;										
"Value[2] := POSFunctions.FormatAmount(-POSTrans.""Gross Amount"" + POSTrans.""Total Discount"");"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
"AddPrintLine(800,2,NodeName,Value,DSTR1,FALSE,FALSE,FALSE,FALSE,Tray); //LS7.1-02"										
Value[1] := Text043;										
"Value[2] := POSFunctions.FormatAmount(-POSTrans.""Total Discount"");"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
"AddPrintLine(800,2,NodeName,Value,DSTR1,FALSE,FALSE,FALSE,FALSE,Tray); //LS7.1-02"										
END;										
										
Value[1] := Text005 + ' ' +  Globals.GetValue('CURRSYM');										
Value[2] := '';										
"IF GenPosFunc.""Display Secondary Total Curr"" AND (GenPosFunc.""Secondary Total Currency"" <> '') AND (SecTotal <> 0) THEN"										
"Value[2] := Currency.Code + FORMAT(SecTotal,0,ApplMan.AutoFormatTranslate(1,Currency.Code));"										
NodeName[2] := 'x'; //LS7.1-02										
Value[3] := POSFunctions.FormatAmount(Total);										
NodeName[3] := 'Total Amount'; //LS7.1-02										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
"AddPrintLine(800,3,NodeName,Value,DSTR1,FALSE,FALSE,FALSE,FALSE,Tray); //LS7.1-02"										
END;										
										
PROCEDURE PrintCopyText@48(Tray@1000 : Integer) : Boolean;										
VAR										
DSTR1@1001 : Text[50];										
Payment@1002 : Text[30];										
BEGIN										
//PrintCopyText										
DSTR1 := '#C##################';										
Value[1] := Text046;										
NodeName[1] := 'Print Info'; //LS7.1-02										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),TRUE,FALSE,TRUE,FALSE));"										
"AddPrintLine(250,1,NodeName,Value,DSTR1,TRUE,FALSE,TRUE,FALSE,Tray); //LS7.1-02"										
PrintSeperator(Tray);										
END;										
										
PROCEDURE PrintTrainingText@59(Tray@1000 : Integer) : Boolean;										
VAR										
DSTR1@1001 : Text[50];										
Payment@1002 : Text[30];										
BEGIN										
//PrintTrainingText										
DSTR1 := '#C##################';										
Value[1] := Text047;										
NodeName[1] := 'Print Info'; //LS7.1-02										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),TRUE,FALSE,TRUE,FALSE));"										
"AddPrintLine(250,1,NodeName,Value,DSTR1,TRUE,FALSE,TRUE,FALSE,Tray); //LS7.1-02"										
PrintSeperator(Tray);										
END;										
										
PROCEDURE PrintExtraItem@28(TransSalesEntry@1000 : Record 99001473) : Boolean;										
VAR										
Transaction@1001 : Record 99001472;										
ApplEntry@1002 : Record 99001558;										
Item@1003 : Record 27;										
TabSpec@1004 : Record 99001552;										
Header@1005 : Record 99001550;										
InfoNumber@1006 : Text[30];										
DoIt@1007 : Boolean;										
QtyLeft@1008 : Decimal;										
QtyOne@1009 : Decimal;										
BEGIN										
//PrintExtraItem										
"Transaction.GET(TransSalesEntry.""Store No."",TransSalesEntry.""POS Terminal No."",TransSalesEntry.""Transaction No."");"										
"ApplEntry.SETCURRENTKEY(""Created by Receipt No."",""Created by Line No."");"										
"ApplEntry.SETRANGE(""Created by Receipt No."",TransSalesEntry.""Receipt No."");"										
"ApplEntry.SETRANGE(""Created by Line No."",TransSalesEntry.""Line No."");"										
IF ApplEntry.FIND('-') THEN										
"InfoNumber := ApplEntry.""Entry Code"";"										
"IF NOT Item.GET(TransSalesEntry.""Item No."") THEN"										
EXIT(TRUE);										
										
"TabSpec.SETRANGE(TabSpec.""Table No."",DATABASE::Item);"										
"TabSpec.SETRANGE(TabSpec.Key,Item.""No."");"										
IF TabSpec.FIND('-') THEN REPEAT										
"IF Header.GET(TabSpec.""Setup ID"") THEN BEGIN"										
DoIt := TRUE;										
"IF (TabSpec.""When Required"" = TabSpec.""When Required""::Negative) AND"										
(TransSalesEntry.Quantity > 0)										
THEN										
DoIt := FALSE;										
"IF (TabSpec.""When Required"" = TabSpec.""When Required""::Positive) AND"										
(TransSalesEntry.Quantity < 0)										
THEN										
DoIt := FALSE;										
"IF TabSpec.""When Required"" = TabSpec.""When Required""::""Voucher Re-Issue"" THEN"										
DoIt := FALSE;										
										
IF DoIt THEN BEGIN										
"IF Header.""Print For Each Unit"" THEN BEGIN"										
IF TransSalesEntry.Quantity < 0 THEN										
QtyOne := -1										
ELSE										
QtyOne := 1;										
QtyLeft := QtyOne * TransSalesEntry.Quantity;										
WHILE QtyLeft > 0 DO BEGIN										
"IF NOT PrintExtra(Transaction,Header,TransSalesEntry.""Net Amount"" + TransSalesEntry.""VAT Amount"","										
"TransSalesEntry.Price,QtyOne,TransSalesEntry.""Item No."","										
"Item.Description,InfoNumber,"										
"1,TransSalesEntry.""Line No."",ApplEntry.""Entry Type"","										
"'','','','')"										
THEN										
EXIT(FALSE);										
QtyLeft := QtyLeft - 1;										
END;										
END ELSE BEGIN										
"IF NOT PrintExtra(Transaction,Header,TransSalesEntry.""Net Amount"" + TransSalesEntry.""VAT Amount"","										
"TransSalesEntry.Price,TransSalesEntry.Quantity,"										
"TransSalesEntry.""Item No."",Item.Description,InfoNumber,"										
"1,TransSalesEntry.""Line No."",ApplEntry.""Entry Type"","										
"'','','','')"										
THEN										
EXIT(FALSE);										
END;										
END;										
END;										
UNTIL TabSpec.NEXT = 0;										
EXIT(TRUE);										
END;										
										
PROCEDURE PrintExtraIncomeExpense@49(TransIncExpEntry@1000 : Record 99001475) : Boolean;										
VAR										
Transaction@1001 : Record 99001472;										
ApplEntry@1002 : Record 99001558;										
IncomeExpense@1003 : Record 99001476;										
TabSpec@1004 : Record 99001552;										
Header@1005 : Record 99001550;										
InfoNumber@1006 : Text[120];										
Skip@1007 : Boolean;										
TransInfocodeEntry@1100409000 : Record 99001478;										
InfocodeRec@1100409001 : Record 99001482;										
PrintAmt@1200040000 : Decimal;										
BEGIN										
//PrintExtraIncomeExpense										
										
"Transaction.GET(TransIncExpEntry.""Store No."",TransIncExpEntry.""POS Terminal No."",TransIncExpEntry.""Transaction No."");"										
"ApplEntry.SETCURRENTKEY(""Created by Receipt No."",""Created by Line No."");"										
"ApplEntry.SETRANGE(""Created by Receipt No."",TransIncExpEntry.""Receipt  No."");"										
"ApplEntry.SETRANGE(""Created by Line No."",TransIncExpEntry.""Line No."");"										
IF ApplEntry.FIND('-') THEN										
"InfoNumber := ApplEntry.""Entry Code"";"										
										
VoidedVoucher := FALSE;										
"IF (Transaction.""Sale Is Return Sale"") AND (InfoNumber = '') THEN BEGIN"										
TransInfocodeEntry.RESET;										
"TransInfocodeEntry.SETRANGE(""Store No."",TransIncExpEntry.""Store No."");"										
"TransInfocodeEntry.SETRANGE(""POS Terminal No."",TransIncExpEntry.""POS Terminal No."");"										
"TransInfocodeEntry.SETRANGE(""Transaction No."",TransIncExpEntry.""Transaction No."");"										
"TransInfocodeEntry.SETRANGE(""Transaction Type"",TransInfocodeEntry.""Transaction Type""::""Income/Expense Entry"");"										
"TransInfocodeEntry.SETRANGE(""Line No."",TransIncExpEntry.""Line No."");"										
IF TransInfocodeEntry.FIND('-') THEN REPEAT										
IF InfocodeRec.GET(TransInfocodeEntry.Infocode) THEN										
"IF InfocodeRec.Type = InfocodeRec.Type::""Create Data Entry"" THEN BEGIN"										
InfoNumber := Text145 + ' ' + TransInfocodeEntry.Information;										
VoidedVoucher := TRUE;										
END;										
UNTIL (TransInfocodeEntry.NEXT = 0) OR (InfoNumber = '');										
END;										
										
"IF NOT IncomeExpense.GET(TransIncExpEntry.""Store No."",TransIncExpEntry.""No."") THEN"										
EXIT(TRUE);										
										
"TabSpec.SETRANGE(TabSpec.""Table No."",DATABASE::""Income/Expense Account"");"										
"TabSpec.SETRANGE(TabSpec.Key,IncomeExpense.""Primary Key"");"										
IF TabSpec.FIND('-') THEN REPEAT										
"IF Header.GET(TabSpec.""Setup ID"") THEN BEGIN"										
Skip := FALSE;										
IF TransIncExpEntry.Amount > 0 THEN BEGIN										
"IF (TabSpec.""When Required"" = TabSpec.""When Required""::"" "")"										
"OR (TabSpec.""When Required"" = TabSpec.""When Required""::Negative)"										
"OR (TabSpec.""When Required"" = TabSpec.""When Required""::""Voucher Re-Issue"")"										
THEN										
Skip := TRUE;										
END ELSE										
"IF (TabSpec.""When Required"" = TabSpec.""When Required""::"" "")"										
"OR (TabSpec.""When Required"" = TabSpec.""When Required""::Positive)"										
"OR (TabSpec.""When Required"" = TabSpec.""When Required""::""Voucher Re-Issue"")"										
THEN										
Skip := TRUE;										
IF NOT Skip THEN BEGIN										
PrintAmt := TransIncExpEntry.Amount;										
IF VoidedVoucher THEN										
PrintAmt := -TransIncExpEntry.Amount;										
"Header.GET(TabSpec.""Setup ID"");"										
"IF NOT PrintExtra(Transaction,Header,PrintAmt,0,0"										
",IncomeExpense.""No."",IncomeExpense.Description,InfoNumber,"										
"3,TransIncExpEntry.""Line No."",ApplEntry.""Entry Type"",'','','','') THEN"										
EXIT(FALSE);										
END;										
END;										
UNTIL TabSpec.NEXT = 0;										
EXIT(TRUE);										
END;										
										
PROCEDURE PrintExtraPayment@30(PaymentLine@1000 : Record 99001474) : Boolean;										
VAR										
Transaction@1001 : Record 99001472;										
TenderType@1002 : Record 99001462;										
TabSpec@1003 : Record 99001552;										
Header@1004 : Record 99001550;										
ApplEntry@1005 : Record 99001558;										
Skip@1006 : Boolean;										
InfoNumber@1007 : Text[30];										
BEGIN										
//PrintExtraPayment										
"ApplEntry.SETCURRENTKEY(""Created by Receipt No."",""Created by Line No."");"										
"ApplEntry.SETRANGE(""Created by Receipt No."",PaymentLine.""Receipt No."");"										
"ApplEntry.SETRANGE(""Created by Line No."",PaymentLine.""Line No."");"										
IF ApplEntry.FIND('-') THEN										
"InfoNumber := ApplEntry.""Entry Code"";"										
"IF NOT TenderType.GET(Globals.StoreNo,PaymentLine.""Tender Type"") THEN"										
EXIT(TRUE);										
"Transaction.GET(PaymentLine.""Store No."",PaymentLine.""POS Terminal No."",PaymentLine.""Transaction No."");"										
"TabSpec.SETRANGE(TabSpec.""Table No."",DATABASE::""Tender Type"");"										
"TabSpec.SETRANGE(TabSpec.Key,TenderType.""Primary Key"");"										
IF TabSpec.FIND('-') THEN REPEAT										
"IF Header.GET(TabSpec.""Setup ID"") THEN BEGIN"										
Skip := FALSE;										
"IF PaymentLine.""Amount Tendered"" > 0 THEN BEGIN"										
"IF (TabSpec.""When Required"" = TabSpec.""When Required""::"" "")"										
"OR (TabSpec.""When Required"" = TabSpec.""When Required""::Negative)"										
"OR (TabSpec.""When Required"" = TabSpec.""When Required""::""Voucher Re-Issue"")"										
THEN										
Skip := TRUE;										
END ELSE										
"IF (TabSpec.""When Required"" = TabSpec.""When Required""::"" "")"										
"OR (TabSpec.""When Required"" = TabSpec.""When Required""::Positive)"										
"OR (TabSpec.""When Required"" = TabSpec.""When Required""::""Voucher Re-Issue"")"										
THEN										
Skip := TRUE;										
IF NOT Skip THEN BEGIN										
"Header.GET(TabSpec.""Setup ID"");"										
"IF NOT PrintExtra(Transaction,Header,PaymentLine.""Amount Tendered"",0,0"										
",TenderType.Code,TenderType.Description,InfoNumber,"										
"2,PaymentLine.""Line No."",ApplEntry.""Entry Type"",'','','','') THEN"										
EXIT(FALSE);										
END;										
END;										
UNTIL TabSpec.NEXT = 0;										
EXIT(TRUE);										
END;										
										
PROCEDURE PrintExtra@34(Transaction@1000 : Record 99001472;Header@1001 : Record 99001550;Amount@1002 : Decimal;Price@1003 : Decimal;	Qty	@10	4	:	Decimal;Code@1005 : Code[20];Descr@1006 : Text[50];InfoNumber@1007 : Text[30];LineType@1008 : Integer;LineNo@1009 : Integer;DataEntryTypeCode@1023 : Code[10];ValidFrom@1100409004 : Text[30];ValidTo@1100409003 : Text[30];Descr2@1100409002 : Text[50];Descr3@1100409001 : Text[50]) : Boolean;					
VAR										
CopyCount@1100409000 : Integer;										
BEGIN										
//PrintExtra										
IF NOT PrintExtraSlip(										
"Transaction,Header,Amount,Price,Qty,Code,Descr,InfoNumber,LineType,LineNo,DataEntryTypeCode,FALSE,"										
"ValidFrom,ValidTo,Descr2,Descr3)"										
THEN										
EXIT(FALSE);										
"IF Header.""No. of Extra Prints"" > 0 THEN BEGIN"										
CopyCount := 0;										
"WHILE CopyCount < Header.""No. of Extra Prints"" DO BEGIN"										
IF NOT PrintExtraSlip(										
"Transaction,Header,Amount,Price,Qty,Code,Descr,InfoNumber,LineType,LineNo,DataEntryTypeCode,TRUE,"										
"ValidFrom,ValidTo,Descr2,Descr3)"										
THEN										
EXIT(FALSE);										
CopyCount := CopyCount + 1;										
END;										
END;										
EXIT(TRUE);										
END;										
										
PROCEDURE PrintExtraSlip@1100409012(Transaction@1000 : Record 99001472;Header@1001 : Record 99001550;Amount@1002 : Decimal;Price@100	3:00	De	ci	mal	;Qty@1004 : Decimal;Code@1005 : Code[20];Descr@1006 : Text[50];InfoNumber@1007 : Text[30];LineType@1008 : Integer;LineNo@1009 : Integer;DataEntryTypeCode@1023 : Code[10];PrintIsCopy@1100409001 : Boolean;ValidFrom@1100409005 : Text[30];ValidTo@1100409004 : Text[30];Descr2@1100409003 : Text[50];Descr3@1100409002 : Text[50]) : Boolean;					
VAR										
Line@1010 : Record 99001551;										
DataEntry@1011 : Record 99001558;										
TransInfoEntry@1012 : Record 99001478;										
BarcMask@1021 : Record 99001459;										
DataEntryType@1022 : Record 99001557;										
Tray@1013 : Integer;										
DSTR@1014 : Text[100];										
FieldName@1015 : ARRAY [20] OF Text[2];										
FieldValue@1016 : ARRAY [20] OF Text[50];										
Len@1017 : Integer;										
Pos@1018 : Integer;										
i@1019 : Integer;										
TmpStr@1020 : Text[100];										
DSTR1@1100409000 : Text[100];										
BEGIN										
//PrintExtraSlip										
IF (Amount < 0) AND (NOT VoidedVoucher) THEN										
Amount := - Amount;										
"IF Header.""Print Type"" = Header.""Print Type""::""Document print"" THEN BEGIN"										
Tray := 4;										
"IF NOT OpenReceiptPrinter(Tray, 'EXTRA', Header.""Setup ID"", Transaction.""Transaction No."", Transaction.""Receipt No."") THEN"										
EXIT(FALSE);										
"InsertPage(Header.""Document In Printer"");"										
										
Len := InvLineLen;										
END										
"ELSE IF Header.""Print Type"" = Header.""Print Type""::""Slip print"" THEN BEGIN"										
Tray := 2;										
"IF NOT OpenReceiptPrinter(Tray, 'EXTRA', Header.""Setup ID"", Transaction.""Transaction No."", Transaction.""Receipt No."") THEN"										
EXIT(FALSE);										
Len := LineLen;										
END;										
										
										
PrintBuffer.INIT;										
"//LS7.1-13 PrintBuffer.""Transaction No."" := PrintBufferTransNo;"										
"PrintBuffer.""Buffer Index"" := PrintBufferIndex;"										
"PrintBuffer.""Station No."" := Tray;"										
"PrintBuffer.""Page No."" := PageNo;"										
"PrintBuffer.""Printed Line No."" := LinesPrinted;"										
PrintBuffer.LineType := PrintBuffer.LineType::Rotation;										
PrintBuffer.Width := Header.Rotation; //NOTE Use Width for Rotation value										
PrintBuffer.INSERT;										
//SavePrinterBufferRecord(PrintBuffer);  //LS7.1-35										
PrintBufferIndex += 1;										
										
"IF Header.""Print Header"" THEN BEGIN"										
"PrintHeader(Transaction,FALSE,Tray);"										
"PrintSubHeader(Transaction,Tray,Transaction.Date,Transaction.Time);"										
END;										
										
"IF Header.""Print COPY text on Copies"" THEN"										
IF (Transaction.GetPrintedCounter(1) > 0) OR PrintIsCopy THEN										
PrintCopyText(Tray);										
										
"IF Transaction.""Entry Status"" = Transaction.""Entry Status""::Training THEN"										
PrintTrainingText(Tray);										
										
IF VoidedVoucher THEN BEGIN										
DSTR1 := '#C##################';										
Value[1] := Text145;										
NodeName[1] := 'Description'; //LS7.1-02										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),TRUE,FALSE,TRUE,FALSE));"										
"AddPrintLine(200,1,NodeName,Value,DSTR1,TRUE,FALSE,TRUE,FALSE,Tray); //LS7.1-02"										
VoidedVoucher := FALSE;										
END;										
										
FieldName[1] := 'NO';										
FieldValue[1] := Code;										
FieldName[2] := 'DC';										
FieldValue[2] := Descr;										
FieldName[3] := 'AM';										
FieldValue[3] := POSFunctions.FormatAmount(Amount);										
FieldName[4] := 'AT';										
"FieldValue[4] := VerboseAmount(Amount,40);"										
FieldName[5] := 'PR';										
FieldValue[5] := POSFunctions.FormatPrice(Price);										
FieldName[6] := 'AC';										
FieldValue[6] := InfoNumber;										
FieldName[7] := 'XP';										
FieldValue[7] := '';										
FieldName[8] := 'DT';										
FieldValue[8] := FORMAT(Transaction.Date);										
FieldName[9] := 'QT';										
FieldValue[9] := FORMAT(Qty);										
FieldName[10] := 'H1';										
FieldValue[10] := '';										
FieldName[11] := 'H2';										
FieldValue[11] := '';										
FieldName[12] := 'TA';										
"FieldValue[12] := POSFunctions.FormatAmount(-Transaction.""Gross Amount"");"										
FieldName[13] := 'TD';										
"FieldValue[13] := POSFunctions.FormatAmount(Transaction.""Discount Amount"");"										
FieldName[14] := 'CU';										
"FieldValue[14] := Transaction.""Customer No."";"										
FieldName[15] := 'VF'; //Valid From										
FieldValue[15] := ValidFrom;										
FieldName[16] := 'VT'; //Valid To										
FieldValue[16] := ValidTo;										
FieldName[17] := 'D2'; //Description 2										
FieldValue[17] := Descr2;										
FieldName[18] := 'D3'; //Description 3										
FieldValue[18] := Descr3;										
										
"Line.SETRANGE(""Setup ID"",Header.""Setup ID"");"										
IF Line.FIND('-') THEN REPEAT										
CASE Line.Align OF										
Line.Align::Left:										
IF Line.Wide THEN										
"DSTR := '#L' + StringPad('#',ROUND(Len / 2,1,'<') - 2)"										
ELSE										
"DSTR := '#L' + StringPad('#',Len - 2);"										
Line.Align::Center:										
IF Line.Wide THEN										
"DSTR := '#C' + StringPad('#',ROUND(Len / 2,1,'<') - 2)"										
ELSE										
"DSTR := '#C' + StringPad('#',Len - 2);"										
Line.Align::Right:										
IF Line.Wide THEN										
"DSTR := '#R' + StringPad('#',ROUND(Len / 2,1,'<') - 2)"										
ELSE										
"DSTR := '#R' + StringPad('#',Len - 2);"										
END;										
TmpStr := Line.Text;										
FOR i := 1 TO 18 DO BEGIN										
"Pos := STRPOS(TmpStr,'%' + FieldName[i]);"										
IF Pos <> 0 THEN BEGIN										
IF Pos = 1 THEN										
"TmpStr := FieldValue[i] + COPYSTR(TmpStr,Pos + 3)"										
ELSE										
"TmpStr := COPYSTR(TmpStr,1,Pos - 1) + FieldValue[i] + COPYSTR(TmpStr,Pos + 3);"										
IF (FieldName[i] = 'AC') AND (CpnPrinting) AND										
(Line.Align = Line.Align::Barcode) AND (FieldValue[i] <> '') THEN BEGIN										
"PrintBarcode(Tray,FieldValue[i],100,40,CpnBarcodeMaskSymbology,2);"										
CpnPrinting := FALSE;										
END;										
END;										
END;										
IF Line.Align <> Line.Align::Barcode THEN BEGIN										
Value[1] := TmpStr;										
NodeName[1] := 'Print Info'; //LS7.1-02										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR),Line.Wide,Line.Bold,Line.High,Line.Italic));"										
"AddPrintLine(250,1,NodeName,Value,DSTR1,Line.Wide,Line.Bold,Line.High,Line.Italic,Tray); //LS7.1-02"										
END										
ELSE										
IF CouponPrinting THEN										
"PrintCouponBarcode(Tray,Code,Amount)"										
ELSE										
"PrintApplEntryBarcode(Tray,DataEntryTypeCode,TmpStr);"										
UNTIL Line.NEXT = 0;										
										
"IF Header.""Print Infocodes"" THEN BEGIN"										
"TransInfoEntry.SETRANGE(""Store No."",Transaction.""Store No."");"										
"TransInfoEntry.SETRANGE(""POS Terminal No."",Transaction.""POS Terminal No."");"										
"TransInfoEntry.SETRANGE(""Transaction No."",Transaction.""Transaction No."");"										
"TransInfoEntry.SETRANGE(""Transaction Type"",LineType);"										
"TransInfoEntry.SETRANGE(""Line No."",LineNo);"										
"PrintTransInfoCode(TransInfoEntry,Tray,TRUE);"										
END;										
										
"IF Header.""Print Footer"" THEN"										
"PrintFooter(Transaction,Tray);"										
										
PrintBuffer.INIT;										
"//LS7.1-13 PrintBuffer.""Transaction No."" := PrintBufferTransNo;"										
"PrintBuffer.""Buffer Index"" := PrintBufferIndex;"										
"PrintBuffer.""Station No."" := Tray;"										
"PrintBuffer.""Page No."" := PageNo;"										
"PrintBuffer.""Printed Line No."" := LinesPrinted;"										
PrintBuffer.LineType := PrintBuffer.LineType::Rotation;										
"PrintBuffer.Width := Header.Rotation::"" ""; //NOTE Use Width for Rotation value"										
PrintBuffer.INSERT;										
//SavePrinterBufferRecord(PrintBuffer);  //LS7.1-35										
PrintBufferIndex += 1;										
										
IF NOT ClosePrinter(Tray) THEN										
EXIT(FALSE);										
EXIT(TRUE);										
END;										
										
PROCEDURE PrintHeader@19(Transaction@10012003 : Record 99001472;PreReceipt@1100409000 : Boolean;Tray@1000 : Integer);										
VAR										
POSText@1001 : Record 99001492;										
DSTR1@1002 : Text[100];										
LineLength@1003 : Integer;										
Terminal@1004 : Record 99001471;										
ReceiptHeader@10012000 : Record 99001498;										
RetailUtil@10012002 : Codeunit 99001462;										
ReceiptNo@10012001 : Code[20];										
SeatNo@1100409002 : Integer;										
PosTrGuestInfo@1100409001 : Record 10012117;										
BEGIN										
//PrintHeader										
IF Tray = 2 THEN										
LineLength := LineLen										
ELSE IF Tray = 4 THEN										
LineLength := InvLineLen;										
										
Terminal.GET(Globals.TerminalNo);										
										
CLEAR(ReceiptNo);										
ReceiptHeader.RESET;										
ReceiptHeader.SETCURRENTKEY(Priority);										
										
"ReceiptHeader.SETRANGE(""Receipt Setup Location"",Terminal.""Receipt Setup Location"");"										
										
IF ReceiptHeader.FINDLAST THEN BEGIN										
REPEAT										
"IF RetailUtil.DiscValPerValid(ReceiptHeader.""Validation Period ID"",Transaction.Date,Transaction.Time) THEN BEGIN"										
"ReceiptNo := ReceiptHeader.""No."";"										
END;										
UNTIL (ReceiptHeader.NEXT(-1) = 0) OR (ReceiptNo <> '');										
END;										
										
CLEAR(POSText);										
										
IF (ReceiptNo <> '') THEN										
"POSText.SETRANGE(""No."",ReceiptNo)"										
ELSE										
"POSText.SETRANGE(""No."",'');"										
										
"IF Terminal.""Receipt Setup Location"" = Terminal.""Receipt Setup Location""::Terminal THEN BEGIN"										
"POSText.SETRANGE(Relation,POSText.Relation::Terminal);"										
"POSText.SETRANGE(Number,Globals.TerminalNo);"										
END										
ELSE BEGIN										
"POSText.SETRANGE(Relation,POSText.Relation::Store);"										
"POSText.SETRANGE(Number,Globals.StoreNo);"										
END;										
"POSText.SETRANGE(Type,POSText.Type::Top);"										
										
IF NOT POSText.FINDFIRST THEN										
"POSText.SETRANGE(""No."",'');"										
										
IF POSText.FINDSET THEN BEGIN										
REPEAT										
CASE POSText.Align OF										
POSText.Align::Left   :										
"DSTR1 := COPYSTR('#L################################################',1,LineLength);"										
POSText.Align::Center :										
"DSTR1 := COPYSTR('#C################################################',1,LineLength);"										
POSText.Align::Right  :										
"DSTR1 := COPYSTR('#R################################################',1,LineLength);"										
END;										
IF POSText.Wide THEN										
"DSTR1 := COPYSTR(DSTR1,1,ROUND(STRLEN(DSTR1) / 2,1,'>'));"										
"Value[1] := POSText.""Receipt Text"";"										
NodeName[1] := 'Header Line'; //LS7.1-02										
										
"//CSPNT240915  Quitar encabezado y separador PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),POSText.Wide,POSText.Bold,POSTex"	t.H	igh	",P"	OST	ext.Italic));					
"AddPrintLine(100,1,NodeName,Value,DSTR1,POSText.Wide,POSText.Bold,POSText.High,POSText.Italic,Tray) //LS7.1-02"										
UNTIL POSText.NEXT = 0;										
// CSPNT240915  PrintSeperator(Tray);										
END;										
										
IF PreReceipt THEN BEGIN										
Value[1] := Text217;										
NodeName[1] := 'Description'; //LS7.1-02										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),POSText.Wide,POSText.Bold,POSText.High,POSText.Italic));"										
"AddPrintLine(200,1,NodeName,Value,DSTR1,POSText.Wide,POSText.Bold,POSText.High,POSText.Italic,Tray); //LS7.1-02"										
PrintSeperator(Tray);										
END;										
END;										
										
PROCEDURE PrintPOSHeader@1100409040(VAR POSTrans@10012003 : Record 99008980;Tray@1000 : Integer;SplittNumber@1100409000 : Integer);										
VAR										
POSText@1001 : Record 99001492;										
DSTR1@1002 : Text[100];										
LineLength@1003 : Integer;										
Terminal@1004 : Record 99001471;										
ReceiptHeader@10012000 : Record 99001498;										
RetailUtil@10012002 : Codeunit 99001462;										
ReceiptNo@10012001 : Code[20];										
SeatNo@1100409001 : Integer;										
PosTrGuestInfo@1100409002 : Record 10012117;										
BEGIN										
//PrintPOSHeader										
IF Tray = 2 THEN										
LineLength := LineLen										
ELSE IF Tray = 4 THEN										
LineLength := InvLineLen;										
										
Terminal.GET(Globals.TerminalNo);										
										
CLEAR(ReceiptNo);										
ReceiptHeader.RESET;										
ReceiptHeader.SETCURRENTKEY(Priority);										
										
"ReceiptHeader.SETRANGE(""Receipt Setup Location"",Terminal.""Receipt Setup Location"");"										
										
IF ReceiptHeader.FINDLAST THEN BEGIN										
REPEAT										
"IF RetailUtil.DiscValPerValid(ReceiptHeader.""Validation Period ID"",POSTrans.""Original Date"",POSTrans.""Trans Time"") THEN"										
BEGIN										
"ReceiptNo := ReceiptHeader.""No."";"										
END;										
UNTIL (ReceiptHeader.NEXT(-1) = 0) OR (ReceiptNo <> '');										
END;										
										
CLEAR(POSText);										
										
IF (ReceiptNo <> '') THEN										
"POSText.SETRANGE(""No."",ReceiptNo)"										
ELSE										
"POSText.SETRANGE(""No."",'');"										
										
"IF Terminal.""Receipt Setup Location"" = Terminal.""Receipt Setup Location""::Terminal THEN BEGIN"										
"POSText.SETRANGE(Relation,POSText.Relation::Terminal);"										
"POSText.SETRANGE(Number,Globals.TerminalNo);"										
END										
ELSE BEGIN										
"POSText.SETRANGE(Relation,POSText.Relation::Store);"										
"POSText.SETRANGE(Number,Globals.StoreNo);"										
END;										
"POSText.SETRANGE(Type,POSText.Type::Top);"										
										
IF NOT POSText.FINDFIRST THEN										
"POSText.SETRANGE(""No."",'');"										
										
IF POSText.FINDSET THEN BEGIN										
REPEAT										
CASE POSText.Align OF										
POSText.Align::Left   :										
"DSTR1 := COPYSTR('#L################################################',1,LineLength);"										
POSText.Align::Center :										
"DSTR1 := COPYSTR('#C################################################',1,LineLength);"										
POSText.Align::Right  :										
"DSTR1 := COPYSTR('#R################################################',1,LineLength);"										
END;										
IF POSText.Wide THEN										
"DSTR1 := COPYSTR(DSTR1,1,ROUND(STRLEN(DSTR1) / 2,1,'>'));"										
"Value[1] := POSText.""Receipt Text"";"										
NodeName[1] := 'Header Line'; //LS7.1-02										
										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),POSText.Wide,POSText.Bold,POSText.High,POSText.Italic));"										
"AddPrintLine(100,1,NodeName,Value,DSTR1,POSText.Wide,POSText.Bold,POSText.High,POSText.Italic,Tray); //LS7.1-02"										
UNTIL POSText.NEXT = 0;										
PrintSeperator(Tray);										
END;										
										
CLEAR(PosTrGuestInfo);										
										
IF SplittNumber > 0 THEN										
SeatNo := SplittNumber - 1										
ELSE										
SeatNo := SplittNumber;										
										
IF SplittNumber = 0 THEN BEGIN										
"PosTrGuestInfo.SETRANGE(""Receipt No."",POSTrans.""Receipt No."");"										
IF PosTrGuestInfo.FIND('-') THEN										
REPEAT										
"PosTrGuestInfo.""Pre-receipt Counter"" += 1;"										
PosTrGuestInfo.MODIFY;										
UNTIL PosTrGuestInfo.NEXT = 0;										
END ELSE BEGIN										
"IF PosTrGuestInfo.GET(POSTrans.""Receipt No."",SeatNo) THEN BEGIN"										
"PosTrGuestInfo.""Pre-receipt Counter"" += 1;"										
PosTrGuestInfo.MODIFY;										
END;										
END;										
										
"IF PosTrGuestInfo.""Pre-receipt Counter"" <= 1 THEN"										
Value[1] := Text217										
ELSE										
"Value[1] := STRSUBSTNO(Text239,PosTrGuestInfo.""Pre-receipt Counter"" - 1);"										
NodeName[1] := 'Description'; //LS7.1-02										
										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),POSText.Wide,POSText.Bold,POSText.High,POSText.Italic));"										
"AddPrintLine(200,1,NodeName,Value,DSTR1,POSText.Wide,POSText.Bold,POSText.High,POSText.Italic,Tray); //LS7.1-02"										
										
// CSAC IMprimiendo lineas en blanco para que motorista escriba hora de entrega										
DSTR1 := '#C######################################';										
Value[1] := '';										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
"AddPrintLine(200,2,NodeName,Value,DSTR1,FALSE,TRUE,FALSE,FALSE,Tray); //LS7.1-02"										
DSTR1 := '#C######################################';										
Value[1] := '';										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
"AddPrintLine(200,2,NodeName,Value,DSTR1,FALSE,TRUE,FALSE,FALSE,Tray); //LS7.1-02"										
DSTR1 := '#C######################################';										
Value[1] := '';										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
"AddPrintLine(200,2,NodeName,Value,DSTR1,FALSE,TRUE,FALSE,FALSE,Tray); //LS7.1-02"										
// CSAC Fin de impresion lineas en blanco										
										
PrintSeperator(Tray);										
END;										
										
PROCEDURE PrintReturnHeader@1100409035(Transaction@10012003 : Record 99001472;PreReceipt@1100409000 : Boolean;Tray@1000 : Integer);										
VAR										
POSText@1001 : Record 99001492;										
DSTR1@1002 : Text[100];										
LineLength@1003 : Integer;										
Terminal@1004 : Record 99001471;										
ReceiptHeader@10012000 : Record 99001498;										
RetailUtil@10012002 : Codeunit 99001462;										
ReceiptNo@10012001 : Code[20];										
BEGIN										
//PrintHeader										
IF Tray = 2 THEN										
LineLength := LineLen										
ELSE IF Tray = 4 THEN										
LineLength := InvLineLen;										
										
Terminal.GET(Globals.TerminalNo);										
										
CLEAR(ReceiptNo);										
ReceiptHeader.RESET;										
ReceiptHeader.SETCURRENTKEY(Priority);										
										
"ReceiptHeader.SETRANGE(""Receipt Setup Location"",Terminal.""Receipt Setup Location"");"										
										
IF ReceiptHeader.FINDLAST THEN BEGIN										
REPEAT										
"IF RetailUtil.DiscValPerValid(ReceiptHeader.""Validation Period ID"",Transaction.Date,Transaction.Time) THEN BEGIN"										
"ReceiptNo := ReceiptHeader.""No."";"										
END;										
UNTIL (ReceiptHeader.NEXT(-1) = 0) OR (ReceiptNo <> '');										
END;										
										
CLEAR(POSText);										
										
IF (ReceiptNo <> '') THEN										
"POSText.SETRANGE(""No."",ReceiptNo)"										
ELSE										
"POSText.SETRANGE(""No."",'');"										
										
"IF Terminal.""Receipt Setup Location"" = Terminal.""Receipt Setup Location""::Terminal THEN BEGIN"										
"POSText.SETRANGE(Relation,POSText.Relation::Terminal);"										
"POSText.SETRANGE(Number,Globals.TerminalNo);"										
END										
ELSE BEGIN										
"POSText.SETRANGE(Relation,POSText.Relation::Store);"										
"POSText.SETRANGE(Number,Globals.StoreNo);"										
END;										
"POSText.SETRANGE(Type,POSText.Type::Top);"										
										
IF NOT POSText.FINDFIRST THEN										
"POSText.SETRANGE(""No."",'');"										
										
IF POSText.FINDSET THEN BEGIN										
REPEAT										
CASE POSText.Align OF										
POSText.Align::Left   :										
"DSTR1 := COPYSTR('#L################################################',1,LineLength);"										
POSText.Align::Center :										
"DSTR1 := COPYSTR('#C################################################',1,LineLength);"										
POSText.Align::Right  :										
"DSTR1 := COPYSTR('#R################################################',1,LineLength);"										
END;										
IF POSText.Wide THEN										
"DSTR1 := COPYSTR(DSTR1,1,ROUND(STRLEN(DSTR1) / 2,1,'>'));"										
"Value[1] := POSText.""Receipt Text"";"										
NodeName[1] := 'Header Line'; //LS7.1-02										
										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),POSText.Wide,POSText.Bold,POSText.High,POSText.Italic));"										
"AddPrintLine(100,1,NodeName,Value,DSTR1,POSText.Wide,POSText.Bold,POSText.High,POSText.Italic,Tray); //LS7.1-02"										
UNTIL POSText.NEXT = 0;										
PrintSeperator(Tray);										
END;										
IF PreReceipt THEN BEGIN										
Value[1] := Text217;										
NodeName[1] := 'Description'; //LS7.1-02										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),POSText.Wide,POSText.Bold,POSText.High,POSText.Italic));"										
"AddPrintLine(200,1,NodeName,Value,DSTR1,POSText.Wide,POSText.Bold,POSText.High,POSText.Italic,Tray); //LS7.1-02"										
PrintSeperator(Tray);										
END;										
END;										
										
PROCEDURE PrintSubHeader@24(VAR Transaction@1000 : Record 99001472;Tray@1001 : Integer;PrDate@1002 : Date;PrTime@1003 : Time);										
VAR										
Staff@1004 : Record 99001461;										
DSTR1@1005 : Text[100];										
StaffName@1006 : Text[30];										
blankStr@1007 : Text[30];										
rNoSeries@1000000000 : Record 308;										
rNoSeriesLn@1000000001 : Record 309;										
rCust@1000000002 : Record 18;										
rCompanyInfo@1000000003 : Record 79;										
rCountry@1000000004 : Record 9;										
rPosTerminal@1000000005 : Record 99001471;										
rPostCode@1000000006 : Record 225;										
Correlativo@1000000007 : Code[20];										
cNoSeriesMgt@1000000008 : Codeunit 396;										
Transaccion@1000000009 : Integer;										
k@1000000010 : Integer;										
rTenderType@1000000011 : Record 99001462;										
rTransPaymEntry@1000000012 : Record 99001474;										
CantPagos@1000000013 : Integer;										
TextNRC@1000000014 : TextConst 'ENU=NRC:';										
TextRNC@1000000015 : TextConst 'ENU=NIT:';										
TextGIRO@1000000016 : TextConst 'ENU=GIRO:';										
TextCorrelativo@1000000017 : TextConst 'ENU=CORRELATIVO:';										
TextCodTienda@1000000018 : TextConst 'ENU=COD. TIENDA:';										
TextCaja@1000000019 : TextConst 'ENU=CAJA:';										
TextAutorizacion@1000000020 : TextConst 'ENU=AUTORIZACION:';										
TextTicket@1000000021 : TextConst 'ENU=TICKET';										
TextFecha@1000000022 : TextConst 'ENU=FECHA:';										
TextHora@1000000023 : TextConst 'ENU=HORA:';										
TextNIT@1000000024 : TextConst 'ENU=NIT:';										
TextDUI@1000000025 : TextConst 'ENU=DUI:';										
TextFirma@1000000026 : TextConst 'ENU=FIRMA:';										
TextUnidad@1000000027 : TextConst 'ENU=CANT.';										
TextCodigo@1000000028 : TextConst 'ENU=ARTICULO';										
TextValor@1000000029 : TextConst 'ENU=PRECIO';										
textTotal@1000000030 : TextConst 'ENU=SUBTOTAL';										
TextDUINIT@1000000031 : TextConst 'ENU=DUI/NIT:';										
TextNombre@1000000032 : TextConst 'ENU=NOMBRE:';										
rTransactionAfectada@1000000033 : Record 99001472;										
rStore@1000000034 : Record 99001470;										
xTransInfo@1000000035 : Record 99001478;										
vDireccionCompleta@1000000036 : Text[200];										
vDireccionParte1@1000000037 : Text[100];										
vDireccionParte2@1000000038 : Text[100];										
vDireccionCortada@1000000039 : Boolean;										
"TextCodCliente@1000000040 : TextConst 'ENU=""COD. CLIENTE: ""';"										
BEGIN										
//PrintSubHeader										
IF Tray = 2 THEN										
"blankStr := StringPad(' ',LineLen - 38)"										
ELSE IF Tray = 4 THEN										
"blankStr := StringPad(' ',InvLineLen - 38);"										
										
CLEAR(Value);										
										
IF Tray = 2 THEN BEGIN										
										
//CONSISA-Imprimir Nombre de la empresa...										
rCompanyInfo.GET();										
"DSTR1 :=     COPYSTR('#C######################################',1);"										
Value[1] := rCompanyInfo.Name;										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//CONSISA-Imprimir Codigo Tipo Contribuyente y  No. Reg. Contribuyente de la empresa...										
rCompanyInfo.GET();										
"DSTR1 :=     COPYSTR('#C######################################',1);"										
"Value[1] := rCompanyInfo.""Tipo de Contibuyente"" + ' ' + TextNRC + ':' + rCompanyInfo.NRC;"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//CONSISA-Imprimir NIT de la empresa...										
rCompanyInfo.GET();										
"DSTR1 :=     COPYSTR('#C######################################',1);"										
"Value[1] := TextRNC + ':' + rCompanyInfo.""VAT Registration No."";"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//CONSISA-Imprimir Giro de la empresa...										
rCompanyInfo.GET();										
//CSPNT191115										
"DSTR1 :=     COPYSTR('#L################################################',1);"										
Value[1] := TextGIRO + ':' + rCompanyInfo.Giro;										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//Imprimir Linea en blanco...										
"DSTR1 :=     COPYSTR('                     ',1);"										
Value[1] := '';										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//CONSISA-Texto Devolucion										
"IF Transaction.""Sale Is Return Sale"" THEN BEGIN"										
"DSTR1 :=     COPYSTR('        #C#########',1);"										
Value[1] := 'DEVOLUCION';										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,TRUE,FALSE));"										
										
//Imprimir Linea en blanco...										
"DSTR1 :=     COPYSTR('                     ',1);"										
Value[1] := '';										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
										
//CONSISA-Imprimir Nombre de la tienda.										
"DSTR1 := COPYSTR('#L######################################',1);"										
Value[1] := Store.Name;										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//CONSISA-Imprimir 1era. direccion de la tienda.										
"DSTR1 := COPYSTR('#L######################################',1);"										
Value[1] := Store.Address;										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//CONSISA-Imprimir 2da. direccion de la tienda.										
//CSPNT011015 Imprimir direcci¢n solo si existe										
"IF Store.""Address 2"" <> '' THEN BEGIN"										
"DSTR1 := COPYSTR('#L######################################',1);"										
"Value[1] := Store.""Address 2"";"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
										
//CSPNT011015										
//CONSISA-Imprimir Municipio de la tienda										
"DSTR1 := COPYSTR('#L######################################',1);"										
Value[1] := Store.County;										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//CSPNT011015 Imprimir ciudad de la tienda										
"DSTR1 := COPYSTR('#L######################################',1);"										
Value[1] := Store.City;										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//CONSISA-Imprimir telefono de la tienda.										
"DSTR1 := COPYSTR('#L## #L#################################',1);"										
Value[1] := 'TEL:';										
"Value[2] := Store.""Phone No."";"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//CONSISA-Imprimir el Correlativo..										
//CSRM19092013										
"//Correlativo := Transaction.""Transaction No."";"										
"DSTR1 := COPYSTR('#L######################################',1);"										
"Value[1] := 'Trans.:' + ' ' + FORMAT(Transaction.""Receipt No."");"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//CONSISA-Imprimir el No. de la Caja..										
"DSTR1 := COPYSTR('#L#################      #R#############',1);"										
"Value[1] := TextCodTienda + Store.""No."";"										
"Value[2] := TextCaja + ' ' + Transaction.""POS Terminal No."";"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//CONSISA-Imprimir Autorizacion...										
rNoSeries.RESET;										
"IF rNoSeries.GET(Transaction.""No. Serie NCF"") THEN BEGIN"										
rNoSeriesLn.RESET;										
"rNoSeriesLn.SETRANGE(""Series Code"",rNoSeries.Code);"										
//CSPNT010616										
//CSPNT130716										
"IF (Transaction.""Receipt No."" = PosTrans.GetReceiptNo) THEN BEGIN"										
"rNoSeriesLn.SETRANGE(Open,TRUE);"										
END										
ELSE BEGIN										
"rNoSeriesLn.SETFILTER(""Starting Date"",'<=%1',Transaction.""Original Date"");"										
"rNoSeriesLn.SETFILTER(rNoSeriesLn.""Last Date Used"",'>=%1',Transaction.""Original Date"");"										
END;										
										
IF rNoSeriesLn.FINDFIRST THEN BEGIN										
"DSTR1 := COPYSTR('#L######################################',1);"										
Value[1] := TextAutorizacion + ' ' + UPPERCASE(rNoSeriesLn.Autorizacion);										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//CONSISA-Imprimir el rango de ticket..										
"DSTR1 := COPYSTR('#L##########################',1);"										
"Value[1] := 'Del ' + rNoSeriesLn.""Starting No."";"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
"DSTR1 := COPYSTR('#L##########################',1);"										
"Value[1] := 'al  ' + rNoSeriesLn.""Ending No."";"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
END;										
										
										
"IF (Transaction.""Manager ID"" <> '') THEN BEGIN"										
//CSPNT231015										
DSTR1 := '#L######### #L################';										
Staff.RESET;										
"Staff.SETRANGE(Staff.ID,Transaction.""Manager ID"");"										
IF Staff.FIND('-') THEN BEGIN										
"StaffName := Staff.""Name on Receipt"";"										
Value[1] := TextSGD16;										
Value[2] := StaffName;										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
END;										
END;										
										
rPosTerminal.RESET;										
"rPosTerminal.SETRANGE(""No."",Transaction.""POS Terminal No."");"										
"rPosTerminal.SETRANGE(""Store No."",Transaction.""Store No."");"										
IF rPosTerminal.FINDFIRST THEN BEGIN										
"IF (Transaction.""No. Serie NCF"" = rPosTerminal.""No. Serie NCF Ticket"") THEN BEGIN"										
//CONSISA-Imprimir No. Ticket.										
"DSTR1 := COPYSTR('#L################################',1);"										
										
Value[1] := TextTicket + ' ' + Transaction.NCF;										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
END;										
										
//CONSISA-Rereferencia Ticket para la devolucion..										
"IF Transaction.""Sale Is Return Sale"" THEN BEGIN"										
"IF Transaction.""No. Serie NCF"" = rPosTerminal.""No. Serie Documento Devolucion"" THEN BEGIN"										
DSTR1 := '#L############### #L####### #L##########';										
Value[1] := 'DEVOL. REF.: ';										
Value[2] := 'FCF.';										
"//CSPNT171115      Value[3] := Transaction.""NCF Afectado"";"										
rTransactionAfectada.RESET;										
"rTransactionAfectada.SETRANGE(""Receipt No."",Transaction.""Retrieved from Receipt No."");"										
rTransactionAfectada.FINDFIRST;										
"Value[3] := rTransactionAfectada.""Correlativo Facturas"";"										
										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
DSTR1 := '#L############### #L#######';										
Value[1] := 'DOC. DEVO: ';										
Value[2] := Transaction.NCF;										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END										
										
										
ELSE BEGIN										
										
DSTR1 := '#L############### #L##################';										
Value[1] := 'DEVOL. REF.:TICK.';										
"Value[2] := Transaction.""NCF Afectado"";"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
										
END;										
END;										
										
//CONSISA-Imprimir Hora y Fecha.										
CLEAR(Value);										
DSTR1 := '#L##### #L######### #R###### #R#########';										
//Value[1] := Text048 + ':'; ESL										
Value[1] := TextFecha;										
"Value[2] := FORMAT(PrDate,0,'<Day,2>/<Month,2>/<Year4>');"										
Value[3] := FORMAT(TextHora);										
"Value[4] := FORMAT(TIME,0,'<Hours12>:<Minutes,2> <AM/PM>');"										
//Value[5] := 'CF';										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//Imprimir Linea en blanco...										
"DSTR1 :=     COPYSTR('                     ',1);"										
Value[1] := '';										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//CSRM14102013										
//CSPNT261115										
"IF Transaction.""Customer No."" ='' THEN BEGIN"										
"IF Transaction.""Razon Social"" <> '' THEN BEGIN"										
"DSTR1 := COPYSTR('#L######################################',1);"										
"Value[1] := Transaction.""Razon Social"";"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
IF Transaction.DUI <> '' THEN BEGIN										
"DSTR1 := COPYSTR('#L######################################',1);"										
Value[1] := TextDUI + ' ' + Transaction.DUI;										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
IF Transaction.NIT <> '' THEN BEGIN										
"DSTR1 := COPYSTR('#L######################################',1);"										
Value[1] := TextNIT + ' ' + Transaction.NIT;										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
END;										
//CSRM14102013										
										
//CONSISA-Imprimir informacion del cliente.										
rCust.RESET;										
"IF rCust.GET(Transaction.""Customer No."") THEN BEGIN"										
//CSPNT200116										
"DSTR1 := COPYSTR('#L######################################',1);"										
"Value[1] := TextCodCliente + rCust.""No."";"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
"DSTR1 := COPYSTR('#L######################################',1);"										
Value[1] := rCust.Name;										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
{										
//CONSISA-Imprimir direccion del cliente										
"DSTR1 := COPYSTR('#L######################################',1);"										
Value[1] := rCust.Address;										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//CONSISA-Imprimir direccion 2 del cliente										
"IF rCust.""Address 2""<>'' THEN BEGIN"										
"DSTR1 := COPYSTR('#L######################################',1);"										
"Value[1] := rCust.""Address 2"";"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
										
//CONSISA-Imprimir codigo de ciudad del cliente										
"IF rCountry.GET(rCust.""Country/Region Code"") THEN BEGIN"										
"DSTR1 := COPYSTR('#L######################################',1);"										
Value[1] := rCountry.Name;										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
}										
										
//CONSISA-Imprimir codigo de NIT y DUI del cliente										
"DSTR1 := COPYSTR('#L######################################',1);"										
"Value[1] := TextNIT + ' ' + rCust.""VAT Registration No."";"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//CSPNT191116IF rCust.NRC = '' THEN BEGIN										
"DSTR1 := COPYSTR('#L######################################',1);"										
Value[1] := TextDUI + ' ' + rCust.DUI;										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
//END										
//ELSE BEGIN										
"{DSTR1 := COPYSTR('#L######################################',1);"										
Value[1] := TextNRC + ' ' + rCust.NRC;										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));}"										
//END;										
										
//CSPNT011015 Imprimir Linea en blanco...										
"DSTR1 :=     COPYSTR('                     ',1);"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
										
//CSPNT011015										
{  //Imprimir Linea en blanco...										
"DSTR1 :=     COPYSTR('                     ',1);"										
Value[1] := '';										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));}"										
										
//CSPNT280116 se agrego impresi¢n de firma para ventas >= a 100										
"IF Transaction.""Sale Is Return Sale"" OR (Transaction.""Gross Amount""<=-100) THEN BEGIN"										
rPosTerminal.RESET;										
"rPosTerminal.SETRANGE(""No."",Transaction.""POS Terminal No."");"										
"rPosTerminal.SETRANGE(""Store No."",Transaction.""Store No."");"										
IF rPosTerminal.FINDFIRST THEN BEGIN										
//CSPNT250216										
"IF (Transaction.""No. Serie NCF"" = rPosTerminal.""No. Serie NCF Ticket"") OR (Transaction.""No. Serie NCF"" = rPosTerminal.""No. S"	eri	e D	oc	ume	"nto Devolucion"") THEN BEGIN"					
//CONSISA-Imprimir Firma										
"DSTR1 := COPYSTR('#L####### #L############################',1);"										
Value[1] := TextFirma;										
Value[2] := '________________________________________';										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
//CSPNT011015 Imprimir Linea en blanco...										
"DSTR1 :=     COPYSTR('                     ',1);"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
//CSPNT280116										
"IF (Transaction.""Gross Amount""<=-100) AND NOT vTicketMayorCien THEN"										
vTicketMayorCien := TRUE;										
END;										
END;										
END;										
END										
ELSE										
										
IF Tray = 4 THEN BEGIN										
										
RetailSetup.GET();										
rCompanyInfo.GET();										
//CSPNT240915  Se quita la descripcion de la transaccion										
{										
"IF RetailSetup.""Ancho Columnas""<>RetailSetup.""Ancho Columnas""::""48"" THEN"										
"DSTR1 := COPYSTR('                                                      #C################################',1)"										
ELSE										
"DSTR1 := COPYSTR('             #R################################',1);"										
										
rNoSeries.RESET;										
"IF rNoSeries.GET(Transaction.""No. Serie NCF"") THEN BEGIN"										
Value[1] := rNoSeries.Description;										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
}										
										
//CONSISA-No. de Correlativo Facturas.										
//CSPNT240915  Se quita el correlativo que ya va en la factura										
{										
"IF RetailSetup.""Ancho Columnas""<>RetailSetup.""Ancho Columnas""::""48"" THEN"										
"DSTR1 := COPYSTR('                                                       #R###############',1)"										
ELSE										
"DSTR1 := COPYSTR('                             #R###############',1);"										
										
Value[1] := FORMAT(Transaction.NCF);										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
}										
//CONSISA-Rereferencia Ticket para la devolucion.										
//CSPNT071015 Se quita el correlativo que ya va en la nota de credito										
"{IF Transaction.""Sale Is Return Sale"" THEN BEGIN"										
"IF RetailSetup.""Ancho Columnas""<>RetailSetup.""Ancho Columnas""::""48"" THEN"										
DSTR1 := '                                        #L############## #L### #L##############'										
ELSE										
DSTR1 := '                   #L############# #L# #L######';										
										
"IF RetailSetup.""Ancho Columnas""=RetailSetup.""Ancho Columnas""::""48"" THEN"										
Value[1] := 'DEVOLUCION REF:'										
ELSE										
Value[1] := '                              DEVOLUCION REF:';										
										
rPosTerminal.RESET;										
"rPosTerminal.SETRANGE(""No."",Transaction.""POS Terminal No."");"										
IF rPosTerminal.FINDFIRST THEN BEGIN										
rTransaction.RESET;										
"rTransaction.SETRANGE(""Transaction Type"",Transaction.""Transaction Type""::Sales);"										
"rTransaction.SETRANGE(NCF,Transaction.""NCF Afectado"");"										
IF rTransaction.FINDFIRST THEN BEGIN										
"IF rTransaction.""No. Serie NCF""=rPosTerminal.""No. Serie NCF Credito Fiscal"" THEN BEGIN"										
Value[2] := 'CCF.';										
END										
"ELSE IF rTransaction.""No. Serie NCF""=rPosTerminal.""No. Serie NCF Cons. Final"" THEN BEGIN"										
Value[2] := 'FACT.';										
END										
"ELSE IF rTransaction.""No. Serie NCF""=rPosTerminal.""No. Serie NCF Exportacion"" THEN BEGIN"										
Value[2] := 'FEX.';										
END										
END;										
END;										
"Value[3] := Transaction.""NCF Afectado"";"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;}										
										
"//espacios iniciales 7/6, 4/3"										
//CSPNT021015  Se agregan 5 lineas en blanco para bajar el nombre del cliente										
"//CSPNT171115 Se dejan 6 lineas para factura y nota de credito, 7 para credito fiscal"										
"//CSPNT150116 Se dejan 6 lineas para factura, 7 para credito fiscal y 7 para nota de credito"										
//CSPNT010216 Se dejan 7 lineas para factura y 7 para credito fiscal										
rPosTerminal.RESET;										
"rPosTerminal.SETRANGE(""Store No."",Transaction.""Store No."");"										
"rPosTerminal.SETRANGE(""No."",Transaction.""POS Terminal No."");"										
rPosTerminal.FINDFIRST;										
//CSPNT150116										
"IF (Transaction.""No. Serie NCF"" = rPosTerminal.""No. Serie NCF Cons. Final"") THEN BEGIN"										
FOR iContador := 1 TO 7 DO BEGIN										
"DSTR1 := COPYSTR('                                                  ',1);"										
Value[1] := '';										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
END										
"ELSE IF (Transaction.""No. Serie NCF"" = rPosTerminal.""No. Serie NCF Credito Fiscal"") THEN BEGIN"										
FOR iContador := 1 TO 7 DO BEGIN										
"DSTR1 := COPYSTR('                                                  ',1);"										
Value[1] := '';										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
END										
ELSE BEGIN										
FOR iContador := 1 TO 7										
DO BEGIN										
"DSTR1 := COPYSTR('                                                  ',1);"										
Value[1] := '';										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
END;										
										
//CONSISA-Codigo de la Tienda..										
//CSPNT240915  Se quita la informacion de la tienda y el recibo										
{										
"IF RetailSetup.""Ancho Columnas""<>RetailSetup.""Ancho Columnas""::""48"" THEN"										
"DSTR1 := COPYSTR('                                  #L###################        #L###           #R#####',1)"										
ELSE										
"DSTR1 := COPYSTR('#L############################ #R#######',1);"										
										
"IF RetailSetup.""Ancho Columnas""<>RetailSetup.""Ancho Columnas""::""48"" THEN"										
BEGIN										
Value[1] := Store.Name;										
"Value[2] := Store.""No."";"										
"Value[3] := Transaction.""POS Terminal No."";"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END										
ELSE										
BEGIN										
Value[1] := 'TIENDA:' + Store.Name;										
"Value[2] := 'CAJA:' + Transaction.""POS Terminal No."";"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
										
//CONSISA-Imprime el numero de Recibo de la transaccion..										
"IF RetailSetup.""Ancho Columnas""<>RetailSetup.""Ancho Columnas""::""48"" THEN"										
"DSTR1 := COPYSTR('                                  #L######### #R##################',1)"										
ELSE										
"DSTR1 := COPYSTR('#L#############################',1);"										
										
"IF RetailSetup.""Ancho Columnas""<>RetailSetup.""Ancho Columnas""::""48"" THEN"										
BEGIN										
Value[1] := Store.Name;										
"Value[2] := Store.""No."";"										
"Value[3] := Transaction.""POS Terminal No."";"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END										
ELSE										
BEGIN										
"Value[1] := 'RECIBO No: ' + Transaction.""Receipt No."";"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
}										
										
"IF rCust.GET(Transaction.""Customer No."") THEN BEGIN"										
"IF RetailSetup.""Ancho Columnas""<>RetailSetup.""Ancho Columnas""::""48"" THEN"										
"DSTR1 := COPYSTR('     #L###############################',1)"										
ELSE										
//CSPNT240915										
"DSTR1 := COPYSTR('              #L##################################',1);"										
										
// CONSISA FASANI Creditos Padre Hijo										
// Impresion de encabezado para Clientes Credito Padre Hijo										
IF rCust.SolicitarBeneficiario THEN BEGIN										
CLEAR(xTransInfo);										
"xTransInfo.SETFILTER(""Transaction No."", '%1', Transaction.""Transaction No."");"										
"xTransInfo.SETFILTER(NotaRemision, '%1', 'ENERGETICAS');"										
IF xTransInfo.FIND('-') THEN BEGIN										
REPEAT										
"DSTR1 := COPYSTR('     #L################################################',1);"										
"Value[1] := COPYSTR(xTransInfo.Information, 1, 40);"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
UNTIL xTransInfo.NEXT = 0;										
//CSPNT010616										
"DSTR1 := COPYSTR('               #L########### #L######## #L############ #L########',1);"										
"IF (Transaction.""No. Serie NCF"" = rPosTerminal.""No. Serie NCF Cons. Final"") THEN BEGIN"										
"rNoSeries.GET(Transaction.""No. Serie NCF"");"										
rNoSeriesLn.RESET;										
"rNoSeriesLn.SETRANGE(""Series Code"",rNoSeries.Code);"										
//CSPNT130716										
"IF (Transaction.""Receipt No."" = PosTrans.GetReceiptNo) THEN BEGIN"										
"rNoSeriesLn.SETRANGE(Open,TRUE);"										
END										
ELSE BEGIN										
"rNoSeriesLn.SETFILTER(""Starting Date"",'<=%1',Transaction.""Original Date"");"										
"rNoSeriesLn.SETFILTER(rNoSeriesLn.""Last Date Used"",'>=%1',Transaction.""Original Date"");"										
END;										
										
rNoSeriesLn.FINDFIRST;										
Value[1] := 'FC ' + rNoSeriesLn.Autorizacion;										
Value[2] := Transaction.NCF;										
END;										
"Value[3] := FORMAT(PrDate,0,'<Day,2>/<Month,2>/<Year4>');"										
"Value[4] := FORMAT(PrTime,0,'<Hours12>:<Minutes,2> <AM/PM>');"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
//CSPNT260216										
END										
ELSE BEGIN										
FOR iContador := 1 TO 2 DO BEGIN										
DSTR1 := '     ';										
Value[1] := '';										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
END;										
END ELSE BEGIN										
Value[1] := rCust.Name;										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//CONSISA-Imprimir direccion del cliente										
"IF RetailSetup.""Ancho Columnas""<>RetailSetup.""Ancho Columnas""::""48"" THEN"										
"DSTR1 := COPYSTR('     #L################################                              #L###### #T#####',1)"										
ELSE BEGIN										
//CSPNT240915										
//CSPNT091015										
rPosTerminal.RESET;										
"rPosTerminal.SETRANGE(""Store No."",Transaction.""Store No."");"										
"rPosTerminal.SETRANGE(""No."",Transaction.""POS Terminal No."");"										
rPosTerminal.FINDFIRST;										
"IF (Transaction.""No. Serie NCF"" = rPosTerminal.""No. Serie NCF Nota de Credito"") THEN"										
//CSPNT150116										
//CSPNT180116										
//CSPNT280116										
"DSTR1 := COPYSTR('       #L####################################           #L    #L############ #L########',1)"										
"ELSE IF (Transaction.""No. Serie NCF"" = rPosTerminal.""No. Serie NCF Credito Fiscal"") THEN"										
//CSPNT180116										
"DSTR1 := COPYSTR('                #L#######################################',1)"										
ELSE										
//CSPNT180116										
"DSTR1 := COPYSTR('     #L###############################################',1);"										
END;										
//CSPNT240915      Value[1] := 'DIRECCION:' + rCust.Address;										
//CSPNT150116      Value[1] := rCust.Address;										
vDireccionCompleta := rCust.Address;										
Longitud := STRLEN(vDireccionCompleta);										
vDireccionCortada := FALSE;										
IF Longitud > 36 THEN BEGIN										
"vDireccionParte1 := COPYSTR(vDireccionCompleta,1,36);"										
Value[1] := vDireccionParte1;										
"vDireccionParte2 := COPYSTR(vDireccionCompleta,37,Longitud);"										
vDireccionCortada := TRUE;										
END										
ELSE BEGIN										
Value[1] := vDireccionCompleta;										
END;										
										
//CSPNT081015 nota de credito casilla credito										
rPosTerminal.RESET;										
"rPosTerminal.SETRANGE(""Store No."",Transaction.""Store No."");"										
"rPosTerminal.SETRANGE(""No."",Transaction.""POS Terminal No."");"										
IF rPosTerminal.FINDFIRST THEN BEGIN										
rTransPaymEntry.RESET;										
"rTransPaymEntry.SETRANGE(""Store No."",Transaction.""Store No."");"										
"rTransPaymEntry.SETRANGE(""POS Terminal No."",Transaction.""POS Terminal No."");"										
"rTransPaymEntry.SETRANGE(""Transaction No."",Transaction.""Transaction No."");"										
"rTransPaymEntry.SETRANGE(""Receipt No."",Transaction.""Receipt No."");"										
"rTransPaymEntry.SETRANGE(""Change Line"",FALSE);"										
IF rTransPaymEntry.FINDFIRST THEN BEGIN										
rTenderType.RESET;										
"rTenderType.SETRANGE(""Store No."",rTransPaymEntry.""Store No."");"										
"rTenderType.SETRANGE(Code,rTransPaymEntry.""Tender Type"");"										
IF rTenderType.FINDFIRST THEN BEGIN										
"IF (Transaction.""No. Serie NCF"" = rPosTerminal.""No. Serie NCF Nota de Credito"") AND (rTenderType.Code = '4') THEN"										
//CSPNT280116										
Value[2] := 'X'										
ELSE										
Value[2] := '';										
END;										
END;										
END;										
										
"IF RetailSetup.""Ancho Columnas""<>RetailSetup.""Ancho Columnas""::""48"" THEN"										
BEGIN										
Value[2] := FORMAT(PrDate);										
"Value[3] := FORMAT(PrTime,5);"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
										
//CSPNT280116										
"IF (Transaction.""No. Serie NCF"" = rPosTerminal.""No. Serie NCF Nota de Credito"") THEN BEGIN"										
"Value[3] := FORMAT(PrDate,0,'<Day,2>/<Month,2>/<Year4>');"										
"Value[4] := FORMAT(PrTime,0,'<Hours12>:<Minutes,2> <AM/PM>');"										
END;										
										
"IF RetailSetup.""Ancho Columnas""=RetailSetup.""Ancho Columnas""::""48"" THEN"										
BEGIN										
//Imprimo la direccion										
"//CSPNT240915  Address 2, City y a fecha se imprime en una sola linea, hora se quito"										
//CSPNT250915  fecha se movio a la siguiente linea (linea NRC) y se agrego la hora debajo de esa linea										
{										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
"DSTR1 := COPYSTR('#L########################################',1);"										
"Value[1] := rCust.""Address 2"";"										
										
"IF rCust.""Address 2"" <>'' THEN"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
"DSTR1 := COPYSTR('#L###########################################',1);"										
Value[1] := 'DEPARTAMENTO:' + rCust.City;										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
CLEAR(Value);										
"DSTR1 := COPYSTR('#L############ #T#####',1);"										
Value[1] := 'FECHA:' + FORMAT(PrDate);										
"Value[2] := FORMAT(PrTime,5);"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
}										
										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//CSPNT091015										
rPosTerminal.RESET;										
"rPosTerminal.SETRANGE(""Store No."",Transaction.""Store No."");"										
"rPosTerminal.SETRANGE(""No."",Transaction.""POS Terminal No."");"										
rPosTerminal.FINDFIRST;										
"IF (Transaction.""No. Serie NCF"" = rPosTerminal.""No. Serie NCF Nota de Credito"") THEN"										
"DSTR1 := COPYSTR('     #L######################## #L#############         #L',1)"										
//CSPNT260116										
"ELSE IF (Transaction.""No. Serie NCF"" = rPosTerminal.""No. Serie NCF Cons. Final"") THEN"										
//CSPNT280116										
"DSTR1 := COPYSTR('     #L######################## #L#############      #L############ #L########',1)"										
ELSE										
"DSTR1 := COPYSTR('     #L######################## #L#############',1);"										
										
"//CSPNT150116          Value[1] := rCust.""Address 2"";"										
//CSPNT280116										
IF vDireccionCortada THEN BEGIN										
Value[1] := vDireccionParte2;										
Value[2] := rCust.City;										
END										
ELSE BEGIN										
Value[1] := rCust.City;										
Value[2] := '';										
END;										
										
//CSPNT071015 se bajo xcontado										
"{        IF (Transaction.""No. Serie NCF"" = rPosTerminal.""No. Serie NCF Nota de Credito"") AND"										
((rTenderType.Code = '1') OR (rTenderType.Code = '2') OR(rTenderType.Code = '3') ) THEN										
Value[3] := 'X';                                                         }										
//CSPNT260116										
"IF (Transaction.""No. Serie NCF"" = rPosTerminal.""No. Serie NCF Cons. Final"") THEN BEGIN"										
//CSPNT280116										
"Value[3] := FORMAT(PrDate,0,'<Day,2>/<Month,2>/<Year4>');"										
"Value[4] := FORMAT(PrTime,0,'<Hours12>:<Minutes,2> <AM/PM>');"										
END;										
										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
										
CLEAR(Value);										
										
"IF RetailSetup.""Ancho Columnas""<>RetailSetup.""Ancho Columnas""::""48"" THEN BEGIN"										
"DSTR1 := COPYSTR('#L###########################################',1);"										
Value[1] := 'DEPARTAMENTO:' + rCust.City;										
										
CLEAR(Value);										
"DSTR1 := COPYSTR('#L########### #T#####',1);"										
Value[1] := 'FECHA:' + FORMAT(PrDate);										
"Value[2] := FORMAT(PrTime,5);"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
END;										
										
"IF RetailSetup.""Ancho Columnas""=RetailSetup.""Ancho Columnas""::""48"" THEN BEGIN"										
rPosTerminal.RESET;										
"rPosTerminal.SETRANGE(""Store No."",Transaction.""Store No."");"										
"rPosTerminal.SETRANGE(""No."",Transaction.""POS Terminal No."");"										
IF rPosTerminal.FINDFIRST THEN										
BEGIN										
"IF (Transaction.""No. Serie NCF"" = rPosTerminal.""No. Serie NCF Credito Fiscal"")"										
"OR (Transaction.""No. Serie NCF"" = rPosTerminal.""No. Serie NCF Nota de Credito"") THEN"										
BEGIN										
// CSPNT240915										
{										
"DSTR1 := COPYSTR('#L#############################',1);"										
Value[1] := 'NRC: '  + rCust.NRC;										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
"DSTR1 := COPYSTR('#L#########################################',1);"										
Value[1] := 'GIRO: ' + rCust.GIRO;										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
}										
//CSPNT021015										
//CSPNT071015										
//CSPNT091015										
"IF (Transaction.""No. Serie NCF"" = rPosTerminal.""No. Serie NCF Nota de Credito"") THEN BEGIN"										
"//CSPNT150116                DSTR1 := COPYSTR('                                                        #L',1);"										
"DSTR1 := COPYSTR('                                                        #L   #L#############',1);"										
"IF (Transaction.""No. Serie NCF"" = rPosTerminal.""No. Serie NCF Nota de Credito"") AND"										
//CSPNT150116										
((rTenderType.Code = '1') OR (rTenderType.Code = '2') OR(rTenderType.Code = '3') ) THEN BEGIN										
Value[1] := 'X';										
//CSPNT150116										
"Value[2] := rCust.""Bill-to Customer No."";"										
END;										
END										
ELSE BEGIN										
"DSTR1 := COPYSTR('           #L##############################                      #R######',1);"										
"Value[1] := rCust.""VAT Registration No."";"										
Value[2] := FORMAT(PrDate);										
END;										
										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
// CSPNT250915 Imprimir NRC + hora comprobante credito fiscal (CCF)										
//CSPNT021015										
//CSPNT071015 Si es nota de credito (NC) se imprime giro y ccf ajustado										
//CSPNT091015										
//CSPNT150116										
"IF (Transaction.""No. Serie NCF"" = rPosTerminal.""No. Serie NCF Nota de Credito"") THEN BEGIN"										
"//CSPNT150116                DSTR1 := COPYSTR('               #L######     #L######             #L############# #L##########',1);"										
"DSTR1 := COPYSTR('               #L######     #L######             #L#######################',1);"										
Value[1] := rCust.NRC;										
"Value[2] := rCust.""VAT Registration No."";"										
										
rTransactionAfectada.RESET;										
"rTransactionAfectada.SETRANGE(""Receipt No."",Transaction.""Retrieved from Receipt No."");"										
rTransactionAfectada.FINDFIRST;										
rStore.RESET;										
"rStore.SETRANGE(""No."",rTransactionAfectada.""Store No."");"										
rStore.FINDFIRST;										
										
Value[3] := rStore.Name;										
//CSPNT171115										
"//CSPNT150116   Value[4] := rCust.""Bill-to Customer No."";"										
END										
ELSE BEGIN										
"DSTR1 := COPYSTR('                #L############                                   #R########',1);"										
Value[1] := rCust.NRC;										
"Value[2] := FORMAT(TIME,0,'<Hours12>:<Minutes,2> <AM/PM>');"										
END;										
										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//CSPNT071015										
//CSPNT091015										
"IF (Transaction.""No. Serie NCF"" = rPosTerminal.""No. Serie NCF Nota de Credito"") THEN BEGIN"										
"//CSPNT260116                DSTR1 := COPYSTR('          #L#######################                #L#######################',1);"										
//CSPNT280116										
//CSPNT100316										
"DSTR1 := COPYSTR('          #L############################        #L######## #L########## #L########',1);"										
//CSPNT260116                Value[1] := rCust.GIRO;										
"Value[1]:= COPYSTR(rCust.GIRO,1,80);"										
"//CSPNT171115                Value[2] := Transaction.""Retrieved from Receipt No."";"										
rTransactionAfectada.RESET;										
"rTransactionAfectada.SETRANGE(""Receipt No."",Transaction.""Retrieved from Receipt No."");"										
rTransactionAfectada.FINDFIRST;										
"Value[2] := rTransactionAfectada.""Correlativo Facturas"";"										
//CSPNT260116										
"rNoSeries.GET(Transaction.""No. Serie NCF"");"										
rNoSeriesLn.RESET;										
"rNoSeriesLn.SETRANGE(""Series Code"",rNoSeries.Code);"										
//CSPNT010616										
//CSPNT130716										
"IF (Transaction.""Receipt No."" = PosTrans.GetReceiptNo) THEN BEGIN"										
"rNoSeriesLn.SETRANGE(Open,TRUE);"										
END										
ELSE BEGIN										
"rNoSeriesLn.SETFILTER(""Starting Date"",'<=%1',Transaction.""Original Date"");"										
"rNoSeriesLn.SETFILTER(rNoSeriesLn.""Last Date Used"",'>=%1',Transaction.""Original Date"");"										
END;										
										
rNoSeriesLn.FINDFIRST;										
//CSPNT280116										
Value[3] := 'NC ' + rNoSeriesLn.Autorizacion;										
//CSPNT100316										
//CSPNT110416										
Value[4] := Transaction.NCF;										
END										
//CSPNT260116										
"ELSE IF (Transaction.""No. Serie NCF"" = rPosTerminal.""No. Serie NCF Credito Fiscal"") THEN BEGIN"										
//CSPNT100316										
"DSTR1 := COPYSTR('           #L#################################     #L########## #L######',1);"										
//CSPNT260116                Value[1] := rCust.GIRO;										
"rNoSeries.GET(Transaction.""No. Serie NCF"");"										
rNoSeriesLn.RESET;										
"rNoSeriesLn.SETRANGE(""Series Code"",rNoSeries.Code);"										
//CSPNT010616										
//CSPNT130716										
"IF (Transaction.""Receipt No."" = PosTrans.GetReceiptNo) THEN BEGIN"										
"rNoSeriesLn.SETRANGE(Open,TRUE);"										
END										
ELSE BEGIN										
"rNoSeriesLn.SETFILTER(""Starting Date"",'<=%1',Transaction.""Original Date"");"										
"rNoSeriesLn.SETFILTER(rNoSeriesLn.""Last Date Used"",'>=%1',Transaction.""Original Date"");"										
END;										
										
rNoSeriesLn.FINDFIRST;										
"Value[1] := COPYSTR(rCust.GIRO,1,80);"										
//CSPNT280116										
Value[2] := 'CCF ' + rNoSeriesLn.Autorizacion;										
//CSPNT100316										
//CSPNT110416										
Value[3] := Transaction.NCF;										
END										
ELSE BEGIN										
"DSTR1 := COPYSTR('           #L#######################################',1);"										
//CSPNT021015										
Value[1] := rCust.GIRO;										
END;										
										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
//CSPNT150116 VTA. A CUENTA DE:										
END										
"ELSE IF (Transaction.""No. Serie NCF"" = rPosTerminal.""No. Serie NCF Cons. Final"")"										
"OR (Transaction.""No. Serie NCF"" = rPosTerminal.""No. Serie NCF Exportacion"")  THEN"										
BEGIN										
IF rCust.SolicitarBeneficiario THEN BEGIN										
//CSPNT091015 Imprimir Linea en blanco...										
"DSTR1 :=     COPYSTR('                     ',1);"										
Value[1] := '';										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END ELSE BEGIN										
//CSPNT280116										
//CSPNT100316										
"DSTR1 := COPYSTR('     #L########################                   #L########### #L########',1);"										
Value[1] := 'DUI: '  + rCust.DUI;										
//CSPNT280116										
"rNoSeries.GET(Transaction.""No. Serie NCF"");"										
rNoSeriesLn.RESET;										
"rNoSeriesLn.SETRANGE(""Series Code"",rNoSeries.Code);"										
//CSPNT010616										
//CSPNT130716										
"IF (Transaction.""Receipt No."" = PosTrans.GetReceiptNo) THEN BEGIN"										
"rNoSeriesLn.SETRANGE(Open,TRUE);"										
END										
ELSE BEGIN										
"rNoSeriesLn.SETFILTER(""Starting Date"",'<=%1',Transaction.""Original Date"");"										
"rNoSeriesLn.SETFILTER(rNoSeriesLn.""Last Date Used"",'>=%1',Transaction.""Original Date"");"										
END;										
										
rNoSeriesLn.FINDFIRST;										
Value[2] := 'FC ' + rNoSeriesLn.Autorizacion;										
//CSPNT100316										
//CSPNT110416										
Value[3] := Transaction.NCF;										
										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
//CSPNT181115										
//CSPNT071116IF rCust.NRC = '' THEN BEGIN										
"DSTR1 := COPYSTR('     #L#########################################',1);"										
"Value[1] := 'NIT: ' + rCust.""VAT Registration No."";"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
//END										
//ELSE BEGIN										
"DSTR1 := COPYSTR('     #L#########################################',1);"										
Value[1] := 'NRC: ' + rCust.NRC;										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
//END;										
END;										
										
//CSPNT091015 Imprimir Linea en blanco...										
"DSTR1 :=     COPYSTR('                     ',1);"										
Value[1] := '';										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
END										
END;										
										
//CSPNT021015  Se agregan 3 lineas en blanco m†s para bajar las lineas de articulos										
										
//Imprimir Linea en blanco...										
"DSTR1 :=     COPYSTR('                     ',1);"										
Value[1] := '';										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
//Imprimir Linea en blanco...										
"DSTR1 :=     COPYSTR('                     ',1);"										
Value[1] := '';										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
//CSPNT150116 1 lineas m†s										
//Imprimir Linea en blanco...										
"DSTR1 :=     COPYSTR('                     ',1);"										
Value[1] := '';										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//CSPNT150116										
{  //Imprimir Linea en blanco...										
//CSPNT171115										
rPosTerminal.RESET;										
"rPosTerminal.SETRANGE(""Store No."",Transaction.""Store No."");"										
"rPosTerminal.SETRANGE(""No."",Transaction.""POS Terminal No."");"										
rPosTerminal.FINDFIRST;										
"IF NOT (Transaction.""No. Serie NCF"" = rPosTerminal.""No. Serie NCF Credito Fiscal"") THEN BEGIN"										
"DSTR1 :=     COPYSTR('                     ',1);"										
Value[1] := '';										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
}										
END;										
										
END										
										
"ELSE IF Transaction.""Customer No."" = '' THEN BEGIN"										
"IF RetailSetup.""Ancho Columnas""<>RetailSetup.""Ancho Columnas""::""48"" THEN"										
"DSTR1 := COPYSTR('     #L###############################',1)"										
ELSE										
"DSTR1 := COPYSTR('#L###############################',1);"										
"Value[1] := 'CLIENTE:' + Transaction.""Razon Social"";"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//CONSISA-Imprimir direccion del cliente										
"IF RetailSetup.""Ancho Columnas""<>RetailSetup.""Ancho Columnas""::""48"" THEN"										
"DSTR1 := COPYSTR('     #L################################                              #L###### #T#####',1)"										
ELSE										
"DSTR1 := COPYSTR('#L################################ #L###### #T#####',1);"										
										
Value[1] := 'DIRECCION: ' + Transaction.Direccion;										
Value[2] := FORMAT(PrDate);										
"Value[3] := FORMAT(PrTime,5);"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
CLEAR(Value);										
										
//CONSISA-Imprimir codigo de ciudad del cliente										
"IF RetailSetup.""Ancho Columnas""<>RetailSetup.""Ancho Columnas""::""48"" THEN"										
"DSTR1 := COPYSTR('     #L#######################',1)"										
ELSE										
"DSTR1 := COPYSTR('#L#######################',1);"										
										
Value[1] := 'DEPARTAMENTO:' + ' ';										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//CONSISA-Imprimir codigo de NIT y DUI del cliente										
"IF RetailSetup.""Ancho Columnas""<>RetailSetup.""Ancho Columnas""::""48"" THEN"										
"DSTR1 := COPYSTR('     #L#######################',1)"										
ELSE										
"DSTR1 := COPYSTR('#L#######################',1);"										
										
Value[1] := 'NIT:' + Transaction.NIT;										
//Value[2] := 'Venta a cuenta de:' + rCompanyInfo.Name;										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
END;										
										
										
//CONSISA Imprimir Texto forma de pago...										
rTransPaymEntry.RESET;										
"rTransPaymEntry.SETRANGE(""Store No."",Transaction.""Store No."");"										
"rTransPaymEntry.SETRANGE(""POS Terminal No."",Transaction.""POS Terminal No."");"										
"rTransPaymEntry.SETRANGE(""Transaction No."",Transaction.""Transaction No."");"										
"rTransPaymEntry.SETRANGE(""Receipt No."",Transaction.""Receipt No."");"										
"rTransPaymEntry.SETRANGE(""Change Line"",FALSE);"										
IF rTransPaymEntry.FINDFIRST THEN										
//MEDIO PAGO										
rTenderType.RESET;										
"rTenderType.SETRANGE(""Store No."",rTransPaymEntry.""Store No."");"										
"rTenderType.SETRANGE(Code,rTransPaymEntry.""Tender Type"");"										
//CSPNT240915  se quita la forma de pago										
{										
IF rTenderType.FINDFIRST THEN										
BEGIN										
DSTR1 :=  '#L######################################';										
Value[1] := 'F. Pago: ' + rTenderType.Description;										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
}										
										
//SODICO SUBHEADER										
										
"FOR k := 1 TO RetailSetup.""No Lineas SubHeader"" DO"										
										
BEGIN										
//Imprimir Linea en blanco...										
"DSTR1 :=     COPYSTR('                     ',1);"										
Value[1] := '';										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
END;										
										
END;										
END;										
										
PROCEDURE PrintPOSSubHeader@1100409032(VAR POSTrans@1000 : Record 99008980;Tray@1001 : Integer;PrDate@1002 : Date;PrTime@1003 : Time	);									
VAR										
Staff@1004 : Record 99001461;										
DSTR1@1005 : Text[100];										
StaffName@1006 : Text[30];										
blankStr@1007 : Text[30];										
HoraEntrega@1000000000 : Time;										
BEGIN										
//PrintPOSSubHeader										
IF Tray = 2 THEN										
"blankStr := StringPad(' ',LineLen - 38)"										
ELSE IF Tray = 4 THEN										
"blankStr := StringPad(' ',InvLineLen - 38);"										
										
"HoraEntrega := POSTrans.""Trans Time"" + (30 * (60 * 1000));"										
										
CLEAR(Value);										
DSTR1 := '#C######################################';										
Value[1] := 'Hora Entrega';										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
"AddPrintLine(200,2,NodeName,Value,DSTR1,FALSE,FALSE,FALSE,FALSE,Tray); //LS7.1-02"										
DSTR1 := '#C######################################';										
Value[1] := '';										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
"AddPrintLine(200,2,NodeName,Value,DSTR1,FALSE,FALSE,FALSE,FALSE,Tray); //LS7.1-02"										
DSTR1 := '#C######################################';										
"Value[1] := '***** HORA SUGERIDA:' + FORMAT(HoraEntrega, 0, '<Hours12>:<Minutes,2>:<Seconds,2><Second dec.> <AM/PM>') + ' *****';"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
"AddPrintLine(200,2,NodeName,Value,DSTR1,FALSE,FALSE,FALSE,FALSE,Tray); //LS7.1-02"										
										
// CSAC Comentado pra acomodar ticket Call Center FASANI										
{										
CLEAR(Value);										
DSTR1 := '#L### #N##################';										
Value[1] := Text020 + ':';										
NodeName[1] := 'x'; //LS7.1-02										
"Value[2] := POSTrans.""Receipt No."";"										
NodeName[2] := 'Receipt No.'; //LS7.1-02										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
"AddPrintLine(200,2,NodeName,Value,DSTR1,FALSE,TRUE,FALSE,FALSE,Tray); //LS7.1-02"										
DSTR1 := '#L#### #L############' + blankStr + '#L#### #N########';										
"StaffName := POSTrans.""Staff ID"";"										
IF Staff.GET(StaffName) THEN										
"StaffName := Staff.""Name on Receipt"";"										
Value[1] := Text051 + ':';										
NodeName[1] := 'x'; //LS7.1-02										
Value[2] := StaffName;										
NodeName[2] := 'x'; //LS7.1-02										
Value[3] := '';										
NodeName[3] := 'x'; //LS7.1-02										
Value[4] := '';										
NodeName[4] := 'x'; //LS7.1-02										
//LS7.1-02 -										
"Value[5] := POSTrans.""Staff ID"";"										
NodeName[5] := 'Staff ID';										
//LS7.1-02 +										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
"AddPrintLine(200,5,NodeName,Value,DSTR1,FALSE,TRUE,FALSE,FALSE,Tray); //LS7.1-02"										
										
CLEAR(Value);										
DSTR1 := '#L#### #T###### #T###' + blankStr + '#L### #N#########';										
Value[1] := Text048 + ':';										
NodeName[1] := 'x'; //LS7.1-02										
Value[2] := FORMAT(PrDate);										
NodeName[2] := 'Trans. Date'; //LS7.1-02										
"Value[3] := FORMAT(PrTime,5);"										
NodeName[3] := 'Trans. Time'; //LS7.1-02										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
"AddPrintLine(200,3,NodeName,Value,DSTR1,FALSE,TRUE,FALSE,FALSE,Tray); //LS7.1-02"										
"IF POSTrans.""Table No."" <> 0 THEN BEGIN"										
CLEAR(Value);										
Value[1] := Text500 + ':';										
NodeName[1] := 'x'; //LS7.1-02										
"Value[2] := FORMAT(POSTrans.""Table No."");"										
NodeName[2] := 'Table No.'; //LS7.1-02										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
"AddPrintLine(200,2,NodeName,Value,DSTR1,FALSE,TRUE,FALSE,FALSE,Tray); //LS7.1-02"										
END;										
}										
PrintSeperator(Tray);										
END;										
										
PROCEDURE PrintReturnSubHeader@1100409036(VAR Transaction@1000 : Record 99001472;Tray@1001 : Integer;PrDate@1002 : Date;PrTime@1003	: T	ime	);							
VAR										
Staff@1004 : Record 99001461;										
DSTR1@1005 : Text[100];										
StaffName@1006 : Text[30];										
blankStr@1007 : Text[30];										
BEGIN										
//PrintSubHeader										
IF Tray = 2 THEN										
"blankStr := StringPad(' ',LineLen - 38)"										
ELSE IF Tray = 4 THEN										
"blankStr := StringPad(' ',InvLineLen - 38);"										
										
CLEAR(Value);										
DSTR1 := '#L### #N##################';										
Value[1] := Text020 + ':';										
NodeName[1] := 'x'; //LS7.1-02										
"Value[2] := Transaction.""Receipt No."";"										
NodeName[2] := 'Receipt No.'; //LS7.1-02										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
"AddPrintLine(200,2,NodeName,Value,DSTR1,FALSE,TRUE,FALSE,FALSE,Tray); //LS7.1-02"										
DSTR1 := '#L#### #L############' + blankStr + '#L#### #N########';										
"StaffName := Transaction.""Staff ID"";"										
"IF Staff.GET(Transaction.""Staff ID"") THEN"										
"StaffName := Staff.""Name on Receipt"";"										
Value[1] := Text051 + ':';										
NodeName[1] := 'x'; //LS7.1-02										
Value[2] := StaffName;										
NodeName[2] := 'x'; //LS7.1-02										
Value[3] := Text052 +':';										
NodeName[3] := 'x'; //LS7.1-02										
"Value[4] := FORMAT(Transaction.""Transaction No."");"										
NodeName[4] := 'Transaction No.'; //LS7.1-02										
"IF Transaction.""Transaction No."" = 0 THEN BEGIN"										
Value[3] := '';										
NodeName[3] := 'x'; //LS7.1-02										
Value[4] := '';										
NodeName[4] := 'x'; //LS7.1-02										
END;										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
"AddPrintLine(200,4,NodeName,Value,DSTR1,FALSE,TRUE,FALSE,FALSE,Tray); //LS7.1-02"										
CLEAR(Value);										
DSTR1 := '#L#### #T###### #T###' + blankStr + '#L### #N#########';										
Value[1] := Text048 + ':';										
NodeName[1] := 'x'; //LS7.1-02										
Value[2] := FORMAT(PrDate);										
NodeName[2] := 'Trans. Date'; //LS7.1-02										
"Value[3] := FORMAT(PrTime,5);"										
NodeName[3] := 'Trans. Time'; //LS7.1-02										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
"AddPrintLine(200,3,NodeName,Value,DSTR1,FALSE,TRUE,FALSE,FALSE,Tray); //LS7.1-02"										
"IF Transaction.""Table No."" <> 0 THEN BEGIN"										
CLEAR(Value);										
Value[1] := Text500 + ':';										
NodeName[1] := 'x'; //LS7.1-02										
"Value[2] := FORMAT(Transaction.""Table No."");"										
NodeName[2] := 'Table No.'; //LS7.1-02										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
"AddPrintLine(200,2,NodeName,Value,DSTR1,FALSE,TRUE,FALSE,FALSE,Tray); //LS7.1-02"										
END;										
PrintSeperator(Tray);										
END;										
										
PROCEDURE PrintSalesInfo@37(VAR Transaction@1000 : Record 99001472;Tray@1001 : Integer);										
VAR										
TransInfoCode@1002 : Record 99001478;										
Customer@1003 : Record 18;										
SalesEntry@1004 : Record 99001473;										
Item@1005 : Record 27;										
VATSetup@1006 : Record 99001560;										
MixMatchEntry@1008 : Record 99001496;										
PeriodicDiscount@1010 : Record 99001453;										
TransInfoEntry@1011 : Record 99001478;										
POSTerminal@1012 : Record 99001471;										
ItemPosTextHeader@1013 : Record 99001534;										
ItemPosTextLine@1014 : Record 99001535;										
IncExpEntry@1015 : Record 99001475;										
IncExpAcc@1016 : Record 99001476;										
CompInfo@1046 : Record 79;										
ItemVariant@1200070002 : Record 5401;										
Contact@1100409010 : Record 5050;										
ItemName@1017 : Text[50];										
SalesLineAmount@1018 : Decimal;										
SalesAmountVAT@1019 : ARRAY [5] OF Decimal;										
VATPerc@1020 : ARRAY [5] OF Decimal;										
VATAmount@1021 : ARRAY [5] OF Decimal;										
VATCode@1022 : ARRAY [5] OF Code[10];										
TmpVATPerc@1023 : Decimal;										
i@1024 : Integer;										
j@1025 : Integer;										
PrintItemNo@1026 : Integer;										
VATPrinted@1027 : Boolean;										
discText@1028 : Text[30];										
discountSection@1029 : Boolean;										
totalCustItemDisc@1030 : Decimal;										
maxCounter@1034 : Integer;										
PerDiscOffArr@1038 : ARRAY [250] OF Code[20];										
PerDiscOffAmtArr@1039 : ARRAY [250] OF Decimal;										
PerDiscOffArrCount@1040 : Integer;										
DSTR1@1041 : Text[100];										
qtyTxt@1042 : Text[15];										
LineArr@1043 : ARRAY [10] OF Text[50];										
OrderByDepartment@1200070001 : Boolean;										
LastDepartment@1200070000 : Code[10];										
PrintItem@1100409000 : Boolean;										
ItemTranslate@1200070003 : Record 30;										
ItemUnitOfMeasure@1100409001 : Record 5404;										
totalNumberOfItems@1100409002 : Decimal;										
totalSavings@1100409006 : Decimal;										
SalesEntry2@1100409003 : Record 99001473;										
LinkedItems@1100409004 : Record 99001452;										
CountItemOk@1100409005 : Boolean;										
TransactionOrderEntry@1100409007 : Record 10012704;										
OptTypeValueEntry@1100409008 : Record 10012713;										
LineCount@1100409009 : Integer;										
TransDiscountEntry@1100409012 : Record 99001642;										
CouponHeader@1100409015 : Record 99001621;										
DSTR2@1100409013 : Text[100];										
DiscountText@1100409014 : Text[80];										
OfferCode@1100409017 : Code[20];										
TotalAmtForSummary@1100409019 : Decimal;										
DiscountOnBlockPrintOffers@1100409020 : Decimal;										
ParentItemLine@1100409022 : Record 99001473;										
ParentItem@1100409025 : Record 27;										
RecipeBufferTEMP@1100409023 : TEMPORARY Record 99001473;										
RecipeBufferTEMP2@1100409024 : TEMPORARY Record 99001473;										
RecipeBufferDetailTEMP_l@1100409027 : TEMPORARY Record 99001642;										
DiscountOnLine@1100409011 : Decimal;										
IncomeExpenseAccount@1100409016 : Record 99001476;										
ThisIsATipsLine@1100409018 : Boolean;										
TmpValue@1100409021 : Text[100];										
StringLenBeforeSplitLine@1100409026 : Integer;										
rImpuestos@1000000000 : Record 50005;										
TotalVentG@1000000001 : Decimal;										
TotalVentE@1000000002 : Decimal;										
TotalNoSuj@1000000003 : Decimal;										
Descuento@1000000004 : Decimal;										
CantLinFact@1000000005 : Integer;										
rVATPostingSetup@1000000006 : Record 325;										
Impuesto@1000000007 : Decimal;										
Precio@1000000008 : Decimal;										
TotalIVA@1000000009 : Decimal;										
SubtotalLinea@1000000010 : Decimal;										
TotalPercepcion@1000000011 : Decimal;										
TotalRetencion@1000000012 : Decimal;										
TotalLetras@1000000013 : Text[100];										
Texto1@1000000014 : Text[44];										
Texto2@1000000015 : Text[44];										
TextGravado@1000000016 : TextConst 'ENU=G';										
TextNSujeto@1000000017 : TextConst 'ENU=NS';										
TextExento@1000000018 : TextConst 'ENU=E';										
TextAtencion@1000000019 : TextConst 'ENU=Atendio:';										
"TextTotVentasG@1000000020 : TextConst 'ENU=""G=Ventas Gravadas:""';"										
"TextTotVentasE@1000000021 : TextConst 'ENU=""E=Ventas Exentas:""';"										
TextVentNoSuj@1000000022 : TextConst 'ENU=Ventas No Sujetas:';										
TextSubTotal@1000000023 : TextConst 'ENU=Sub-Total:';										
TextDescuento@1000000024 : TextConst 'ENU=Ahorro Total:';										
TextTotal@1000000025 : TextConst 'ENU=TOTAL:';										
TextToRetencion@1000000026 : TextConst 'ENU=(-) IVA Retenido';										
TextToPercepcion@1000000027 : TextConst 'ENU=(-) IVA Percibido';										
rSalesPerson@1000000028 : Record 13;										
rStaff1@1000000029 : Record 99001461;										
rPosTerminal@1000000030 : Record 99001471;										
vSalesPersonNo@1000000031 : ARRAY [30] OF Text[100];										
vAgregarSalesPersonNo@1000000032 : Integer;										
vIncomeExpense@1000000033 : Boolean;										
rRecargasElectronicas@1000000034 : Record 50040;										
vVendedor@1000000035 : Text[90];										
vMediosPago@1000000036 : ARRAY [30] OF Text[90];										
rRemisionLine@1000000037 : Record 50053;										
vMontoRemision@1000000038 : Decimal;										
vMontoIvaRemision@1000000039 : Decimal;										
vMontoTotalRemision@1000000040 : Decimal;										
LineCountRemision@1000000041 : Integer;										
vInfoAmountTotal@1000000042 : Decimal;										
vCESC@1000000043 : Decimal;										
vTelefono@1000000044 : Text[10];										
EsRemision@1000000045 : Boolean;										
OriginalTrans@1000000046 : Record 99001472;										
BEGIN										
//PrintSalesInfo										
StringLenBeforeSplitLine := 11;										
										
// CSALX20170309 Determinar si es una transaccion de Nota de Remision										
IF Transaction.NotaRemision THEN										
EsRemision := TRUE										
ELSE										
"IF Transaction.""Retrieved from Receipt No."" = '' THEN"										
EsRemision := FALSE										
ELSE BEGIN										
// Chequear si la transaccion original era de Remision										
CLEAR(OriginalTrans);										
"OriginalTrans.SETRANGE(""Receipt No."", Transaction.""Retrieved from Receipt No."");"										
IF OriginalTrans.FIND('-') THEN										
EsRemision := OriginalTrans.NotaRemision										
ELSE										
EsRemision := FALSE;										
END;										
"IF GenPosFunc.""Multiple Items Symbol""='' THEN"										
"GenPosFunc.""Multiple Items Symbol"" := ' x ';"										
										
"TransInfoCode.SETRANGE(""Store No."",Transaction.""Store No."");"										
"TransInfoCode.SETRANGE(""POS Terminal No."",Transaction.""POS Terminal No."");"										
"TransInfoCode.SETRANGE(""Transaction No."",Transaction.""Transaction No."");"										
"TransInfoCode.SETRANGE(""Transaction Type"",TransInfoCode.""Transaction Type""::Header);"										
//CSPNT011015 transinfocode										
"//PrintTransInfoCode(TransInfoCode,Tray,TRUE);"										
										
{										
DSTR1 := '#T######################################';										
"IF Transaction.""Customer No."" <> '' THEN BEGIN"										
"IF Transaction.""Post as Shipment"" THEN BEGIN"										
Value[1] := Text_DelNot;										
NodeName[1] := 'Print Info'; //LS7.1-02										
"PrintLine(Tray,FormatLine(FormatStr(Value,'#C##################'),TRUE,TRUE,TRUE,FALSE));"										
"AddPrintLine(250,1,NodeName,Value,'#C##################',TRUE,TRUE,TRUE,FALSE,Tray); //LS7.1-02"										
"PrintLine(Tray,'');"										
END;										
										
//CSRM16102014 No se Tiene que imprimir porque ya va en la factura										
"IF Customer.GET(Transaction.""Customer No."") THEN BEGIN"										
"Value[1] := COPYSTR(Customer.""No."" + ' ' + Customer.Name,1,MAXSTRLEN(Value[1]));"										
NodeName[1] := 'x'; //LS7.1-02										
//LS7.1-02 -										
"Value[2] := Customer.""No."";"										
NodeName[2] := 'Customer No.'; //LS7.1-02										
Value[3] := Customer.Name;										
NodeName[3] := 'Customer Name'; //LS7.1-02										
//LS7.1-02 -										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
"AddPrintLine(200,3,NodeName,Value,DSTR1,FALSE,FALSE,FALSE,FALSE,Tray); //LS7.1-02"										
PrintSeperator(Tray);										
END;										
//CSRM16102014										
END;										
										
"IF Transaction.""Sell-to Contact No."" <> '' THEN BEGIN"										
"IF Contact.GET(Transaction.""Sell-to Contact No."") THEN BEGIN"										
"Value[1] := COPYSTR(Contact.""No."" + ' ' + Contact.Name,1,MAXSTRLEN(Value[1]));"										
NodeName[1] := 'x'; //LS7.1-02										
//LS7.1-02 -										
"Value[2] := Contact.""No."";"										
NodeName[2] := 'Contact No.'; //LS7.1-02										
Value[3] := Contact.Name;										
NodeName[3] := 'Contact Name'; //LS7.1-02										
//LS7.1-02 -										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
"AddPrintLine(200,3,NodeName,Value,DSTR1,FALSE,FALSE,FALSE,FALSE,Tray); //LS7.1-02"										
PrintSeperator(Tray);										
END;										
END;										
"IF Transaction.""Sale Is Return Sale"" THEN BEGIN"										
Value[1] := Text003;										
NodeName[1] := 'Description'; //LS7.1-02										
"PrintLine(Tray,FormatLine(FormatStr(Value,'#C##################'),FALSE,TRUE,TRUE,FALSE));"										
"AddPrintLine(200,1,NodeName,Value,DSTR1,FALSE,FALSE,FALSE,FALSE,Tray); //LS7.1-02"										
PrintSeperator(Tray);										
END;										
}										
										
IF NOT IsInvoice THEN BEGIN										
IF Transaction.GetPrintedCounter(1) > 0 THEN										
PrintCopyText(Tray)										
ELSE IF bSecondPrintActive THEN BEGIN										
DSTR1 := '#C##################';										
Value[1] := Text046;										
"DSTR1 := '#C' + StringPad('#',LineLen - 2);"										
"Value[1] := StringPad('-',LineLen);"										
END;										
END;										
										
"IF Transaction.""Entry Status"" = Transaction.""Entry Status""::Training THEN"										
PrintTrainingText(Tray);										
										
PerDiscOffArrCount := 0;										
totalCustItemDisc := 0;										
										
CLEAR(totalNumberOfItems);										
CLEAR(totalSavings);										
										
LineCount := 0;										
CLEAR(VATCode);										
CLEAR(VATPerc);										
CLEAR(VATAmount);										
CLEAR(SalesAmountVAT);										
CLEAR(SalesEntry);										
CLEAR(Value);										
tmpDeal.DELETEALL;										
TmpPrintedSalesEntry.DELETEALL;										
TmpPrintedDealPOSTransLine.DELETEALL;										
"//LS7.1-12 IF GenPosFunc.""Print Disc/Cpn Info on Slip"" ="										
"//LS7.1-12   GenPosFunc.""Print Disc/Cpn Info on Slip""::""Summary information below Sub-total"" THEN BEGIN"										
//LS7.1-12 -										
"IF GenPosFunc.""Print Disc/Cpn Info on Slip"" IN"										
"[GenPosFunc.""Print Disc/Cpn Info on Slip""::""Detail for each line and Sub-total"","										
"GenPosFunc.""Print Disc/Cpn Info on Slip""::""Summary information below Sub-total""] THEN BEGIN"										
//LS7.1-12 +										
PeriodicDiscountInfoTEMP.RESET;										
PeriodicDiscountInfoTEMP.DELETEALL;										
Subtotal := 0;										
END;										
TotalAmt := 0;										
TipsAmount1 := 0;										
TipsText1 := '';										
TipsAmount2 := 0;										
TipsText2 := '';										
glTrans := Transaction;										
"SalesEntry.SETRANGE(""Store No."",Transaction.""Store No."");"										
"SalesEntry.SETRANGE(""POS Terminal No."",Transaction.""POS Terminal No."");"										
"SalesEntry.SETRANGE(""Transaction No."",Transaction.""Transaction No."");"										
"OrderByDepartment := GenPosFunc.""Receipt Printing by Category"";"										
IF OrderByDepartment THEN										
"SalesEntry.SETCURRENTKEY(""Item Category Code"");"										
IF SalesEntry.FIND('-') THEN BEGIN										
{										
DSTR1 := '#L############### #R#################   ';										
Value[1] := Text071;										
Value[2] := Text004;										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
PrintSeperator(Tray);										
}										
										
PrintItemNo := 0;										
"IF POSTerminal.GET(SalesEntry.""POS Terminal No."") THEN"										
"IF POSTerminal.""Receipt Setup Location"" = POSTerminal.""Receipt Setup Location""::Store THEN BEGIN"										
"CASE Store.""Item No. on Receipt"" OF"										
"Store.""Item No. on Receipt""::""Item Number"" :"										
PrintItemNo := 1;										
"Store.""Item No. on Receipt""::""Barcode/Item Number"" :"										
PrintItemNo := 2;										
END;										
END ELSE BEGIN										
"CASE POSTerminal.""Item No. on Receipt"" OF"										
"POSTerminal.""Item No. on Receipt"" :: ""Item Number"":"										
PrintItemNo := 1;										
"POSTerminal.""Item No. on Receipt"" :: ""Barcode/Item Number"":"										
PrintItemNo := 2;										
END;										
END;										
										
LastDepartment := '';										
RecipeBufferTEMP.RESET;										
RecipeBufferTEMP.DELETEALL;										
//LS7.1-07 -										
RecipeBufferDetailTEMP_l.RESET;										
RecipeBufferDetailTEMP_l.DELETEALL;										
//LS7.1-07 +										
										
IF NOT IsInvoice THEN BEGIN										
//CSPNT051015 Se agreg¢ cabecera detalle										
PrintSeperator(Tray);										
rPosTerminal.RESET;										
"rPosTerminal.SETRANGE(""No."",Transaction.""POS Terminal No."");"										
"rPosTerminal.SETRANGE(""Store No."",Transaction.""Store No."");"										
IF rPosTerminal.FINDFIRST THEN BEGIN										
"IF (Transaction.""No. Serie NCF"" = rPosTerminal.""No. Serie NCF Ticket"") OR"										
//CSPNT031015 cabecera devolucion										
"(Transaction.""No. Serie NCF"" = rPosTerminal.""No. Serie Documento Devolucion"") THEN BEGIN"										
//Imprimir cabecera del detalle										
//CSPNT011015										
"DSTR1 := COPYSTR('#L##    #L######        #R#### #R#######',1);"										
Value[1] := TextUnidad;										
Value[2] := TextCodigo;										
Value[3] := TextValor;										
Value[4] := TextTotal;										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
END;										
										
"IF Transaction.""Table No."" <> 0 THEN BEGIN"										
CLEAR(Value);										
Value[1] := Text500 + ':';										
"Value[2] := FORMAT(Transaction.""Table No."");"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
										
PrintSeperator(Tray);										
END										
//CSPNT cabecera detalle factura										
ELSE IF IsInvoice THEN BEGIN										
//CSPNT171115										
"{DSTR1 := COPYSTR('     #L###  #L#########################    #R#####  #R####  #R###  #R######  #R######  ',1);"										
Value[1] := 'CANT.';										
Value[2] := 'D E S C R I P C I O N';										
Value[3] := 'PrecioU';										
Value[4] := 'Desc';										
Value[5] := 'VeNoSu';										
Value[6] := 'VeEx';										
Value[7] := 'VeGr';										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));}"										
END;										
										
//CSPNT300816										
//CSPNT070116										
//CSPNT301116										
REPEAT										
"IF Item.GET(SalesEntry.""Item No."") THEN BEGIN"										
rProductosTelefonicas.RESET;										
"rProductosTelefonicas.SETRANGE(ID,'1');"										
IF rProductosTelefonicas.FINDFIRST THEN										
"vProductoTelefonica1 := rProductosTelefonicas.""No. Producto"";"										
rProductosTelefonicas.RESET;										
"rProductosTelefonicas.SETRANGE(ID,'2');"										
IF rProductosTelefonicas.FINDFIRST THEN										
"vProductoTelefonica2 := rProductosTelefonicas.""No. Producto"";"										
rProductosTelefonicas.RESET;										
"rProductosTelefonicas.SETRANGE(ID,'3');"										
IF rProductosTelefonicas.FINDFIRST THEN										
"vProductoTelefonica3 := rProductosTelefonicas.""No. Producto"";"										
rProductosTelefonicas.RESET;										
"rProductosTelefonicas.SETRANGE(ID,'4');"										
IF rProductosTelefonicas.FINDFIRST THEN										
"vProductoTelefonica4 := rProductosTelefonicas.""No. Producto"";"										
"IF Item.GET(SalesEntry.""Item No."") THEN BEGIN"										
"IF (Item.""No."" = vProductoTelefonica1) OR (Item.""No."" = vProductoTelefonica2)"										
"OR (Item.""No."" = vProductoTelefonica3) OR (Item.""No."" = vProductoTelefonica4) THEN BEGIN"										
rRecargasElectronicas.RESET;										
//CSPNT280916										
"IF NOT Transaction.""Sale Is Return Sale"" THEN"										
"rRecargasElectronicas.SETRANGE(""Receipt No."",Transaction.""Receipt No."")"										
ELSE										
"rRecargasElectronicas.SETRANGE(""Receipt No."",Transaction.""Retrieved from Receipt No."");"										
IF rRecargasElectronicas.FINDFIRST THEN										
vCESC := rRecargasElectronicas.CESC;										
END;										
END;										
END;										
UNTIL SalesEntry.NEXT = 0;										
										
//CSPNT030916										
vInfoAmountTotal := 0;										
										
//CSPNT301116										
CLEAR(SalesEntry);										
"SalesEntry.SETRANGE(""Store No."",Transaction.""Store No."");"										
"SalesEntry.SETRANGE(""POS Terminal No."",Transaction.""POS Terminal No."");"										
"SalesEntry.SETRANGE(""Transaction No."",Transaction.""Transaction No."");"										
IF OrderByDepartment THEN										
"SalesEntry.SETCURRENTKEY(""Item Category Code"");"										
IF SalesEntry.FIND('-') THEN										
										
REPEAT										
"IF Item.GET(SalesEntry.""Item No."") THEN BEGIN"										
"//CSPNT180316      IF (SalesEntry.""Variant Code"" <> '') AND (ItemVariant.GET(SalesEntry.""Item No."",SalesEntry.""Variant Code"""	))	THE	N							
"IF (SalesEntry.""Barcode No."" <> '') THEN BEGIN"										
"IF rBarras.GET(SalesEntry.""Barcode No."") THEN"										
"//CSPNT260116        ItemName := COPYSTR(ItemVariant.Description,1,20)"										
"ItemName := COPYSTR(rBarras.Description,1,35)"										
ELSE										
"ItemName := COPYSTR(Item.Description,1,35);"										
END										
ELSE BEGIN										
"//CSPNT260116        ItemName := COPYSTR(Item.Description,1,20);"										
"ItemName := COPYSTR(Item.Description,1,35);"										
END;										
END ELSE										
"ItemName := SalesEntry.""Item No."";"										
										
"IF SalesEntry.""Parent Line No."" = 0 THEN BEGIN"										
ParentItem := Item;										
ParentItemLine := SalesEntry;										
END;										
										
"IF (ParentItem.""Skip Compression When Printed"" = FALSE) AND"										
"(NOT SalesEntry.""Deal Line"")"										
THEN										
"InsertIntoRecipeBuffer(SalesEntry,RecipeBufferTEMP,ParentItemLine,RecipeBufferDetailTEMP_l);"										
										
"POSTerminal.GET(Transaction.""POS Terminal No."");"										
"IF POSTerminal.""Print Total Savings"" THEN BEGIN"										
"totalSavings := totalSavings + SalesEntry.""Discount Amount"";"										
END;										
										
"IF POSTerminal.""Print Number of Items"" THEN BEGIN"										
IF (SalesEntry.Quantity < 0) THEN BEGIN										
CountItemOk := TRUE;										
"IF SalesEntry.""Linked No. not Orig."" THEN BEGIN"										
SalesEntry2.RESET;										
SalesEntry2.COPYFILTERS(SalesEntry);										
IF SalesEntry2.FIND('-') THEN BEGIN										
REPEAT										
"IF (SalesEntry2.""Item No."" <> SalesEntry.""Item No."") AND SalesEntry2.""Orig. of a Linked Item List"" THEN BEGIN"										
LinkedItems.RESET;										
"LinkedItems.SETRANGE(""Item No."",SalesEntry2.""Item No."");"										
"LinkedItems.SETRANGE(""Linked Item No."",SalesEntry.""Item No."");"										
"LinkedItems.SETFILTER(""Sales Type"",'%1|%2','',Transaction.""Sales Type"");"										
IF LinkedItems.FINDFIRST THEN BEGIN										
"IF LinkedItems.""Deposit Item"" THEN"										
CountItemOk := FALSE;										
END;										
END;										
UNTIL (SalesEntry2.NEXT = 0) OR NOT CountItemOk;										
END;										
END;										
										
IF CountItemOk THEN BEGIN										
"//IF ItemUnitOfMeasure.GET(SalesEntry.""Item No."",SalesEntry.""Unit of Measure"") THEN BEGIN"										
"//  IF ItemUnitOfMeasure.""Count as 1 on Receipt"" THEN"										
//totalNumberOfItems := totalNumberOfItems + 1										
//    totalNumberOfItems := totalNumberOfItems + ABS(SalesEntry.Quantity)										
//  ELSE										
//    totalNumberOfItems := totalNumberOfItems + ABS(SalesEntry.Quantity);										
//END ELSE										
"IF SalesEntry.""UOM Quantity"" <> 0 THEN"										
"totalNumberOfItems := totalNumberOfItems + ABS(SalesEntry.""UOM Quantity"")"										
ELSE										
totalNumberOfItems := totalNumberOfItems + ABS(SalesEntry.Quantity);										
										
END;										
										
END;										
END;										
										
"IF Customer.GET(Transaction.""Customer No."") THEN"										
"IF Customer.""Language Code"" <> '' THEN"										
"IF ItemTranslate.GET(SalesEntry.""Item No."",SalesEntry.""Variant Code"",Customer.""Language Code"") THEN"										
IF ItemTranslate.Description <> '' THEN										
ItemName := ItemTranslate.Description;										
										
"IF SalesEntry.""Deal Line"" THEN BEGIN"										
"PrintDeal(SalesEntry,Tray,PrintItemNo);"										
"CollectDiscInfo(SalesEntry,Tray,TotalAmt,Subtotal,PeriodicDiscountInfoTEMP);"										
"IF GenPosFunc.""Print Disc/Cpn Info on Slip"" ="										
"GenPosFunc.""Print Disc/Cpn Info on Slip""::""No printing"""										
THEN										
"SalesLineAmount := SalesEntry.""Net Amount"" + SalesEntry.""VAT Amount"""										
ELSE										
SalesLineAmount :=										
"SalesEntry.""Net Amount"" + SalesEntry.""VAT Amount"""										
"- SalesEntry.""Discount Amount"";"										
"IF GenPosFunc.""Print Disc/Cpn Info on Slip"" ="										
"GenPosFunc.""Print Disc/Cpn Info on Slip""::""Detail information for each line"""										
THEN										
TotalAmt := TotalAmt + SalesLineAmount										
ELSE										
"IF GenPosFunc.""Print Disc/Cpn Info on Slip"" ="										
"GenPosFunc.""Print Disc/Cpn Info on Slip""::""No printing"""										
THEN										
TotalAmt := TotalAmt + SalesLineAmount;										
"//*************** normal line, not deal line"										
END ELSE BEGIN										
"IF GenPosFunc.""Print Disc/Cpn Info on Slip"" ="										
"GenPosFunc.""Print Disc/Cpn Info on Slip""::""No printing"""										
THEN										
"SalesLineAmount := SalesEntry.""Net Amount"" + SalesEntry.""VAT Amount"""										
ELSE										
SalesLineAmount :=										
"SalesEntry.""Net Amount"" + SalesEntry.""VAT Amount"""										
"- SalesEntry.""Discount Amount"";"										
DiscountOnBlockPrintOffers := ReturnDiscountBlockPrinting(SalesEntry);										
"IF GenPosFunc.""Print Disc/Cpn Info on Slip"" IN"										
"[GenPosFunc.""Print Disc/Cpn Info on Slip""::""Detail information for each line"","										
"GenPosFunc.""Print Disc/Cpn Info on Slip""::""No printing""]"										
THEN										
TotalAmt := TotalAmt + SalesLineAmount;										
										
"IF GenPosFunc.""Print Disc/Cpn Info on Slip"" IN"										
"[GenPosFunc.""Print Disc/Cpn Info on Slip""::""Detail information for each line"","										
"GenPosFunc.""Print Disc/Cpn Info on Slip""::""Detail for each line and Sub-total"", //LS7.1-12"										
"GenPosFunc.""Print Disc/Cpn Info on Slip""::""Summary information below Sub-total""]"										
THEN										
SalesLineAmount := SalesLineAmount + DiscountOnBlockPrintOffers;										
										
//********************** Quantity <> 1										
IF (ABS(SalesEntry.Quantity) <> 1) OR										
"((SalesEntry.""UOM Quantity"" <> 0) AND (ABS(SalesEntry.""UOM Quantity"") <> 1)) OR"										
"SalesEntry.""Scale Item"" OR"										
"SalesEntry.""Price in Barcode"""										
THEN BEGIN										
DSTR1 := '#L######################################';										
{										
Value[1] := ItemName;										
NodeName[1] := 'Item Description'; //LS7.1-02										
//LS7.1-02 -										
"Value[2] := FORMAT(SalesEntry.""Line No."");"										
NodeName[2] := 'Line No.';										
"Value[3] := SalesEntry.""Item No."";"										
NodeName[3] := 'Item No.';										
"Value[4] := SalesEntry.""Variant Code"";"										
NodeName[4] := 'Variant Code';										
}										
//LS7.1-02 +										
"IF ParentItem.""Skip Compression When Printed"" THEN"										
"//LS7.1-02 PrintLineHospitality(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE),SalesEntry);"										
"PrintLineHospitality(Tray,300,4,NodeName,Value,DSTR1,FALSE,FALSE,FALSE,FALSE,SalesEntry); //LS7.1-02"										
CLEAR(Value);										
DSTR1 := '   #L################### #N########## #R';										
"IF SalesEntry.""Scale Item"" OR SalesEntry.""Price in Barcode"" THEN BEGIN"										
"IF SalesEntry.""Weight Manually Entered"" THEN"										
DSTR1 := 'MAN #L################## #N########## #R';										
"Value[1] := Value[1] + POSFunctions.FormatWeight(-SalesEntry.Quantity,SalesEntry.""Unit of Measure"") +"										
"' ' + GenPosFunc.""Multiple Items Symbol"" + ' ';"										
"Value[1] := Value[1] + POSFunctions.FormatPricePrUnit(SalesEntry.Price,SalesEntry.""Unit of Measure"");"										
END ELSE BEGIN										
"IF SalesEntry.""Unit of Measure"" = '' THEN"										
"SalesEntry.""Unit of Measure"" :=  Text131;"										
"IF (SalesEntry.""UOM Quantity"" <> 0) THEN BEGIN"										
"SalesEntry.Quantity := SalesEntry.""UOM Quantity"";"										
"SalesEntry.Price := SalesEntry.""UOM Price"";"										
END;										
Value[1] :=										
"POSFunctions.FormatQty(-SalesEntry.Quantity) + ' ' + LOWERCASE(SalesEntry.""Unit of Measure"") +"										
"' ' + GenPosFunc.""Multiple Items Symbol"" + ' ';"										
Value[1] := Value[1] + POSFunctions.FormatPrice(SalesEntry.Price);										
END;										
{										
NodeName[1] := 'x'; //LS7.1-02										
Value[2] := POSFunctions.FormatAmount(-SalesLineAmount);										
NodeName[2] := 'Amount'; //LS7.1-02										
"Value[3] := SalesEntry.""VAT Code"";"										
NodeName[3] := 'VAT Code'; //LS7.1-02										
//LS7.1-02 -										
"Value[4] := SalesEntry.""Unit of Measure"";"										
NodeName[4] := 'UOM ID';										
Value[4] := POSFunctions.FormatQty(-SalesEntry.Quantity);										
NodeName[4] := 'Quantity';										
"Value[5] := FORMAT(SalesEntry.""Line No."");"										
NodeName[5] := 'Line No.';										
Value[6] := POSFunctions.FormatPrice(SalesEntry.Price);										
NodeName[6] := 'Price'; //LS7.1-02										
}										
//LS7.1-02 +										
"IF ParentItem.""Skip Compression When Printed"" THEN"										
{//LS7.1-02										
"PrintLineHospitality(Tray,"										
"FormatLine(FormatStr(Value,DSTR1),FALSE,(SalesEntry.""Periodic Discount"" <> 0),FALSE,FALSE),SalesEntry);"										
}//LS7.1-02										
//LS7.1-02 -										
"PrintLineHospitality(Tray,300,6,NodeName,Value,DSTR1,"										
"FALSE,(SalesEntry.""Periodic Discount"" <> 0),FALSE,FALSE,SalesEntry);"										
//LS7.1-02 +										
//************* quantity = 1										
END ELSE BEGIN										
DSTR1 := '#L###################### #N########## #R';										
{										
Value[1] := ItemName;										
NodeName[1] := 'Item Description'; //LS7.1-02										
"IF SalesEntry.""Unit of Measure"" <> '' THEN"										
"Value[1] := Value[1] + ' ' + LOWERCASE(SalesEntry.""Unit of Measure"");"										
Value[2] := POSFunctions.FormatAmount(-SalesLineAmount);										
NodeName[2] := 'Amount'; //LS7.1-02										
"Value[3] := SalesEntry.""VAT Code"";"										
NodeName[3] := 'VAT Code'; //LS7.1-02										
}										
//LS7.1-02 -										
{										
Value[4] := ItemName;										
NodeName[4] := 'Item Description';										
"Value[5] := SalesEntry.""Unit of Measure"";"										
NodeName[5] := 'UOM ID';										
"Value[6] := FORMAT(SalesEntry.""Line No."");"										
NodeName[6] := 'Line No.';										
Value[7] := POSFunctions.FormatPrice(SalesEntry.Price);										
NodeName[7] := 'Price'; //LS7.1-02										
"Value[8] := SalesEntry.""Item No."";"										
NodeName[8] := 'Item No.';										
"Value[9] := SalesEntry.""Variant Code"";"										
NodeName[9] := 'Variant Code';										
}										
//LS7.1-02 +										
"IF ParentItem.""Skip Compression When Printed"" THEN"										
{//LS7.1-02										
"PrintLineHospitality(Tray,"										
"FormatLine(FormatStr(Value,DSTR1),FALSE,(SalesEntry.""Periodic Discount"" <> 0),FALSE,FALSE),SalesEntry);"										
}//LS7.1-02										
//LS7.1-02 -										
"PrintLineHospitality(Tray,300,9,NodeName,Value,DSTR1,"										
"FALSE,(SalesEntry.""Periodic Discount"" <> 0),FALSE,FALSE,SalesEntry);"										
//LS7.1-02 +										
END;										
										
"IF GenPosFunc.""Print Free Text on Receipt"" THEN"										
"PrintFreeTextLines(SalesEntry,Tray,FALSE);         //GEG Check when prints                 //GEG should print if sales lin"	e p	rin	te	d						
"CollectDiscInfo(SalesEntry,Tray,TotalAmt,Subtotal,PeriodicDiscountInfoTEMP);"										
										
IF ItemPosTextHeader.GET(										
"SalesEntry.""Item No."",ItemPosTextHeader.""Text Type""::""Receipt Text"",Store.""Language Code"")"										
THEN BEGIN										
"ItemPosTextLine.SETRANGE(""Item No."",SalesEntry.""Item No."");"										
"ItemPosTextLine.SETRANGE(""Text Type"",ItemPosTextHeader.""Text Type""::""Receipt Text"");"										
"ItemPosTextLine.SETRANGE(""Language Code"",Store.""Language Code"");"										
IF ItemPosTextLine.FIND('-') THEN REPEAT										
//LS7.1-02 -										
"Value[1] := FORMAT(SalesEntry.""Line No."");"										
NodeName[1] := 'Line No.';										
Value[2] := ItemPosTextLine.Text;										
NodeName[2] := 'Extra Info Line';										
//LS7.1-02 -										
"PrintLine(Tray,ItemPosTextLine.Text);                                                         //GEG Should print if sale"	s l	ine	p	rin	ted					
"AddPrintLine(350,2,NodeName,Value,DSTR1,FALSE,FALSE,FALSE,FALSE,Tray); //LS7.1-02"										
UNTIL ItemPosTextLine.NEXT = 0;										
END;										
										
"TransInfoEntry.SETRANGE(""Store No."",Transaction.""Store No."");                                      //GEG should print if sal"	es	lin	e	pri	nted					
"TransInfoEntry.SETRANGE(""POS Terminal No."",Transaction.""POS Terminal No."");"										
"TransInfoEntry.SETRANGE(""Transaction No."",Transaction.""Transaction No."");"										
"TransInfoEntry.SETRANGE(""Transaction Type"",TransInfoEntry.""Transaction Type""::""Sales Entry"");"										
"TransInfoEntry.SETRANGE(""Line No."",SalesEntry.""Line No."");"										
IF TransInfoEntry.FIND('-') THEN BEGIN										
IF (Transaction.NotaRemision) AND (TransInfoEntry.Information <> '') THEN BEGIN										
"IF (Transaction.""No. Serie NCF"" = POSTerminal.""No. Serie NCF Cons. Final"") THEN BEGIN"										
"PrintLineRemision(Tray,FALSE,TransInfoEntry.Information,TransInfoEntry.""Info. Amt."");"										
//CSPNT030916										
"vInfoAmountTotal := vInfoAmountTotal + TransInfoEntry.""Info. Amt."";"										
END ELSE BEGIN										
//CSPNT150816										
//CSPNT030916										
"IF Transaction.""Customer No."" = 'C000002' THEN BEGIN"										
"PrintLineRemision(Tray,FALSE,TransInfoEntry.Information,TransInfoEntry.Amount);"										
vInfoAmountTotal := vInfoAmountTotal + TransInfoEntry.Amount;										
END										
ELSE BEGIN										
//CSPNT030916										
"IF (Transaction.""No. Serie NCF"" = POSTerminal.""No. Serie NCF Cons. Final"") THEN BEGIN"										
"PrintLineRemision(Tray,FALSE,TransInfoEntry.Information,ROUND(TransInfoEntry.""Info. Amt."",0.01));"										
"vInfoAmountTotal := vInfoAmountTotal + ROUND(TransInfoEntry.""Info. Amt."",0.01);"										
END										
ELSE BEGIN										
"PrintLineRemision(Tray,FALSE,TransInfoEntry.Information,ROUND(TransInfoEntry.""Info. Amt.""/1.13,0.01));"										
"vInfoAmountTotal := vInfoAmountTotal + ROUND(TransInfoEntry.""Info. Amt.""/1.13,0.01);"										
END;										
END;										
END;										
END ELSE BEGIN										
"PrintTransInfoCode(TransInfoEntry,Tray,FALSE);"										
END;										
//CSPNT070716										
LineCountRemision := LineCountRemision + 1;										
END;										
END;										
"//*************** normal line, not deal line END"										
										
"totalCustItemDisc := totalCustItemDisc + SalesEntry.""Infocode Discount"";"										
										
IF NOT IsInvoice THEN BEGIN										
//CSRM09102013										
//CSRM09102013										
										
//CONSISA Imprimir Informacion relacionada de la linea...										
//CSPNT011015										
//CSPNT260116      DSTR1 := '#L##### #L############# #R#### #R#######';      //CSRG15102013										
DSTR1 := '#L## #L#################################';										
										
Value[1] := POSFunctions.FormatQty(-SalesEntry.Quantity);										
Value[2] :=ItemName;										
										
//CSPNT260116										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
DSTR1 := '                        #R#### #R#######';										
										
"//CSPNT300816IF (SalesEntry.Quantity <> 1) AND (SalesEntry.""Discount Amount"" <> 0) THEN"										
"IF (Item.""No."" = vProductoTelefonica1) OR (Item.""No."" = vProductoTelefonica2)"										
"OR (Item.""No."" = vProductoTelefonica3) OR (Item.""No."" = vProductoTelefonica4) THEN"										
//CSPNT260116										
//CSPNT300816Value[1] := POSFunctions.FormatAmount(SalesEntry.Price)										
"Value[1] := FORMAT(ROUND(ROUND(SalesEntry.Price/1.18,0.0001)+ROUND(ROUND(SalesEntry.Price/1.18,0.0001)*0.13,0.0001),0.0001"	))									
ELSE										
//CSPNT260116										
Value[1] := POSFunctions.FormatAmount(SalesEntry.Price);										
"IF NOT Transaction.""Sale Is Return Sale"" THEN"										
BEGIN										
rImpuestos.RESET;										
"rImpuestos.SETRANGE(""VAT Bus. Posting Group"",SalesEntry.""VAT Bus. Posting Group"");"										
"rImpuestos.SETRANGE(""VAT Prod. Posting Group"",SalesEntry.""VAT Prod. Posting Group"");"										
IF rImpuestos.FINDFIRST THEN										
BEGIN										
IF rImpuestos.Impuesto=rImpuestos.Impuesto::Gravado THEN										
BEGIN										
//CSPNT131015										
//CSPNT191015										
//CSPNT260116										
//CSPNT300816										
"IF (Item.""No."" = vProductoTelefonica1) OR (Item.""No."" = vProductoTelefonica2)"										
"OR (Item.""No."" = vProductoTelefonica3) OR (Item.""No."" = vProductoTelefonica4) THEN"										
Value[2] :=POSFunctions.FormatAmount(-((SalesEntry.Price * SalesEntry.Quantity) + vCESC)) + TextGravado										
ELSE										
Value[2] :=POSFunctions.FormatAmount(-(SalesEntry.Price * SalesEntry.Quantity)) + TextGravado;										
"TotalVentG += ABS(SalesEntry.""Net Amount"" + SalesEntry.""VAT Amount"");"										
END										
ELSE										
BEGIN										
"IF rImpuestos.Impuesto=rImpuestos.Impuesto::""No Sujeto"" THEN"										
BEGIN										
//CSPNT131015										
//CSPNT260116										
Value[2] :=POSFunctions.FormatAmount(-(SalesEntry.Price * SalesEntry.Quantity)) +										
TextNSujeto;										
"TotalNoSuj += ABS(SalesEntry.""Net Amount"" + SalesEntry.""VAT Amount"");"										
END										
ELSE										
BEGIN										
//CSPNT131015										
//CSPNT260116										
Value[2] :=POSFunctions.FormatAmount(-(SalesEntry.Price * SalesEntry.Quantity))										
+ TextExento;										
"TotalVentE += ABS(SalesEntry.""Net Amount"" + SalesEntry.""VAT Amount"");"										
END;										
END;										
END;										
END										
ELSE										
BEGIN										
rImpuestos.RESET;										
"rImpuestos.SETRANGE(""VAT Bus. Posting Group"",SalesEntry.""VAT Bus. Posting Group"");"										
"rImpuestos.SETRANGE(""VAT Prod. Posting Group"",SalesEntry.""VAT Prod. Posting Group"");"										
IF rImpuestos.FINDFIRST THEN										
BEGIN										
IF rImpuestos.Impuesto=rImpuestos.Impuesto::Gravado THEN										
BEGIN										
//CSPNT131015										
//CSPNT260116										
//CSPNT300816										
"IF (Item.""No."" = vProductoTelefonica1) OR (Item.""No."" = vProductoTelefonica2)"										
"OR (Item.""No."" = vProductoTelefonica3) OR (Item.""No."" = vProductoTelefonica4) THEN"										
//CSPNT280916										
Value[2] :=POSFunctions.FormatAmount(-((SalesEntry.Price * SalesEntry.Quantity) - vCESC)) + TextGravado										
ELSE										
Value[2] :=POSFunctions.FormatAmount(-(SalesEntry.Price * SalesEntry.Quantity)) + TextGravado;										
"TotalVentG += ABS(SalesEntry.""Net Amount"" + SalesEntry.""VAT Amount"");"										
END										
ELSE										
BEGIN										
"IF rImpuestos.Impuesto=rImpuestos.Impuesto::""No Sujeto"" THEN"										
BEGIN										
//CSPNT131015										
//CSPNT260116										
Value[2] :=POSFunctions.FormatAmount(-(SalesEntry.Price * SalesEntry.Quantity)) +										
TextNSujeto;										
"TotalNoSuj += ABS(SalesEntry.""Net Amount"" + SalesEntry.""VAT Amount"");"										
										
"TotalNoSuj += ABS(SalesEntry.""Net Amount"" + SalesEntry.""VAT Amount"");"										
END										
ELSE										
BEGIN										
//CSPNT131015										
//CSPNT260116										
Value[2] :=POSFunctions.FormatAmount(-(SalesEntry.Price * SalesEntry.Quantity))										
+ TextExento;										
"TotalVentE += ABS(SalesEntry.""Net Amount"" + SalesEntry.""VAT Amount"");"										
END;										
END;										
END;										
										
END;										
										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
"IF   SalesEntry.""Variant Code""<>'' THEN BEGIN"										
DSTR1 := '#L####################';      //CSRG15102013										
"Value[1] := SalesEntry.""Variant Code"";"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
										
//CSRM09102013										
"IF (SalesEntry.""Discount Amount"" <> 0) OR"										
"(SalesEntry.""Discount Amt. For Printing"" <> 0) OR"										
"(SalesEntry.""Line Discount"" <> 0) OR"										
"(SalesEntry.""Coupon Amt. For Printing"" <> 0) THEN BEGIN"										
										
//CSPNT121015										
//CSPNT231015										
//CSPNT261015										
//CSPNT260116        DSTR1 := '        #L#############        #R#######';										
DSTR1 := '        #L#################### #R#######';										
"IF ((SalesEntry.""Periodic Discount"" <> 0) OR"										
"(SalesEntry.""Discount Amt. For Printing"" <> 0)) AND"										
"(SalesEntry.""Customer Discount"" = 0) THEN BEGIN"										
"IF (SalesEntry.""Periodic Disc. Type"" <> SalesEntry.""Periodic Disc. Type""::"" "") THEN BEGIN"										
"IF SalesEntry.""Periodic Disc. Type"" = SalesEntry.""Periodic Disc. Type""::""Mix&Match"" THEN"										
BufferDiscount(										
"PerDiscOffArr,PerDiscOffAmtArr,PerDiscOffArrCount,"										
"SalesEntry.""Periodic Disc. Group"",SalesEntry.""Discount Amt. For Printing"")"										
ELSE										
BufferDiscount(										
"PerDiscOffArr,PerDiscOffAmtArr,PerDiscOffArrCount,"										
"SalesEntry.""Periodic Disc. Group"",SalesEntry.""Periodic Discount"");"										
"IF PeriodicDiscount.GET(SalesEntry.""Periodic Disc. Group"") THEN"										
discText := PeriodicDiscount.Description										
ELSE										
discText := FORMAT(PeriodicDiscount.Type);										
END;										
										
"IF SalesEntry.""Discount Amt. For Printing"" <> 0 THEN BEGIN"										
Value[1] := discText;										
										
"IF Transaction.""Sale Is Return Sale"" THEN BEGIN"										
"Value[2] := POSFunctions.FormatAmount(ROUND(SalesEntry.""Discount Amt. For Printing"",0.01));"										
END ELSE BEGIN										
"Value[2] := POSFunctions.FormatAmount(ROUND(-SalesEntry.""Discount Amt. For Printing"",0.01));"										
END;										
//CSPNT261015										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END										
"ELSE IF SalesEntry.""Periodic Disc. Type"" = SalesEntry.""Periodic Disc. Type""::""Disc. Offer"" THEN BEGIN"										
Value[1] := discText;										
"Value[2] := POSFunctions.FormatAmount(-SalesEntry.""Periodic Discount"");"										
//CSPNT261015										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
END										
//CSMQ050116*************************************************************************										
"//Este es para que si no es Periodic Discount, muestre el descuento por medio de pago"										
"ELSE IF SalesEntry.""Discount Amount"" <> 0 THEN BEGIN"										
Value[1] := PeriodicDiscountInfoTEMP.Description;										
"Value[2] := POSFunctions.FormatAmount(-SalesEntry.""Discount Amount"");"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
//************************************************************************************										
"IF SalesEntry.""Line Discount"" <> 0 THEN BEGIN"										
Value[1] := Text084;										
"Value[2] := POSFunctions.FormatAmount(-SalesEntry.""Line Discount"");"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
										
"IF SalesEntry.""Coupon Amt. For Printing"" <> 0 THEN BEGIN"										
Value[1] := Text165;										
"Value[2] := POSFunctions.FormatAmount(-SalesEntry.""Coupon Amt. For Printing"");"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
										
END;										
										
//CSRM09102013										
										
"totalCustItemDisc := totalCustItemDisc + SalesEntry.""Infocode Discount"";"										
										
"Descuento += SalesEntry.""Discount Amount"";"										
										
END										
ELSE IF IsInvoice THEN BEGIN										
//CONSISA cuento la cantidad de lineas en el formato de facturas.										
//SODICO FACTURA										
CantLinFact += 1;										
RetailSetup.GET();										
//CSPNT121015										
Value[1] := '';										
Value[2] := '';										
Value[3] := '';										
Value[4] := '';										
Value[5] := '';										
Value[6] := '';										
Value[7] := '';										
										
rVATPostingSetup.RESET;										
"rVATPostingSetup.SETRANGE(rVATPostingSetup.""VAT Bus. Posting Group"",SalesEntry.""VAT Bus. Posting Group"");"										
"rVATPostingSetup.SETRANGE(rVATPostingSetup.""VAT Prod. Posting Group"",SalesEntry.""VAT Code"");"										
IF rVATPostingSetup.FINDFIRST THEN										
"Impuesto:=rVATPostingSetup.""VAT %"";"										
										
rImpuestos.RESET;										
"rImpuestos.SETRANGE(""VAT Bus. Posting Group"",SalesEntry.""VAT Bus. Posting Group"");"										
"rImpuestos.SETRANGE(""VAT Prod. Posting Group"",SalesEntry.""VAT Prod. Posting Group"");"										
IF rImpuestos.FINDFIRST THEN BEGIN										
"//CSPNT240915  impuesto gravado, se dejo una sola linea, con la cantidad, descripci¢n, precio unitario y ventas gravadas"										
IF rImpuestos.Impuesto=rImpuestos.Impuesto::Gravado THEN BEGIN										
"IF RetailSetup.""Ancho Columnas""=RetailSetup.""Ancho Columnas""::""48"" THEN BEGIN"										
//CSPNT021015										
//CSPNT150116										
DSTR1 := '      #L###  #L#########################    #R#####  #R####                     #R######';										
END;										
										
"IF Transaction.""Sale Is Return Sale"" AND"										
"(Transaction.""No. Serie NCF"" = POSTerminal.""No. Serie NCF Nota de Credito"") THEN BEGIN"										
//CSPNT071015 + X										
//CSPNT250116 - X										
Value[1] := POSFunctions.FormatQty(SalesEntry.Quantity);										
END										
ELSE BEGIN										
"IF RetailSetup.""Ancho Columnas""=RetailSetup.""Ancho Columnas""::""48"" THEN"										
//CSPNT250116 - X										
Value[1] := POSFunctions.FormatQty(-SalesEntry.Quantity)										
ELSE										
Value[1] := POSFunctions.FormatQty(-SalesEntry.Quantity);										
END;										
										
//CSPNT240915										
Value[2] := Item.Description;										
										
"IF RetailSetup.""Ancho Columnas""=RetailSetup.""Ancho Columnas""::""48"" THEN BEGIN"										
"IF Transaction.""No. Serie NCF"" = POSTerminal.""No. Serie NCF Credito Fiscal"" THEN BEGIN"										
//CSPNT290916										
"IF (Item.""No."" = vProductoTelefonica1) OR (Item.""No."" = vProductoTelefonica2)"										
"OR (Item.""No."" = vProductoTelefonica3) OR (Item.""No."" = vProductoTelefonica4) THEN BEGIN"										
"Precio := ROUND(SalesEntry.Price / (1 + (Impuesto / 100)),0.0001);"										
Value[3]:=FORMAT(Precio);										
"PosPunto:=STRPOS(Value[3],'.');"										
IF (PosPunto=0) THEN										
Value[3]:= Value[3] + '.00';										
"Value[5]:=POSFunctions.FormatAmount((ROUND((SalesEntry.Price / (1 + (Impuesto / 100))),0.0001))*ABS(SalesEntry.Qua"	nti	ty)	)+	'G'	;					
END										
ELSE BEGIN										
"Precio:=ROUND((SalesEntry.Price / (1 + (Impuesto / 100))),0.0001);"										
Value[3]:=FORMAT(Precio);										
"PosPunto:=STRPOS(Value[3],'.');"										
IF (PosPunto=0) THEN										
Value[3]:= Value[3] + '.00';										
"Value[5]:=POSFunctions.FormatAmount((ROUND((SalesEntry.Price / (1 + (Impuesto / 100))),0.0001))*ABS(SalesEntry.Qua"	nti	ty)	)+	'G'	;					
END;										
END										
"ELSE IF Transaction.""No. Serie NCF"" = POSTerminal.""No. Serie NCF Cons. Final"" THEN BEGIN"										
//CSPNT290916										
"IF (Item.""No."" = vProductoTelefonica1) OR (Item.""No."" = vProductoTelefonica2)"										
"OR (Item.""No."" = vProductoTelefonica3) OR (Item.""No."" = vProductoTelefonica4) THEN BEGIN"										
"Value[3] := FORMAT(ROUND(ROUND(SalesEntry.Price/1.18,0.0001)+ROUND(ROUND(SalesEntry.Price/1.18,0.0001)*0.13,0.0001"	"),0"	0	1	));						
Value[5] := POSFunctions.FormatAmount(ROUND(-(SalesEntry.Price * SalesEntry.Quantity)-vCESC)) + 'G';										
END										
ELSE BEGIN										
Value[3] := POSFunctions.FormatAmount(ABS(SalesEntry.Price));										
Value[5] := POSFunctions.FormatAmount(ROUND(-(SalesEntry.Price * SalesEntry.Quantity)))+'G';										
END;										
END										
//CSRM01102013										
"ELSE IF Transaction.""No. Serie NCF"" = POSTerminal.""No. Serie NCF Exportacion"" THEN BEGIN"										
"Value[3] := POSFunctions.FormatAmount(-(SalesEntry.""Net Amount"" + SalesEntry.""VAT Amount"") / ABS(SalesEntry.Quantity"	));									
Value[5] := POSFunctions.FormatAmount(-(SalesEntry.Price * SalesEntry.Quantity))+'G';										
END										
//CSRM01102013										
//CSRM25092013										
"ELSE IF Transaction.""Sale Is Return Sale"" AND"										
"(Transaction.""No. Serie NCF"" = POSTerminal.""No. Serie NCF Nota de Credito"") THEN BEGIN"										
//CSPNT290916										
"IF (Item.""No."" = vProductoTelefonica1) OR (Item.""No."" = vProductoTelefonica2)"										
"OR (Item.""No."" = vProductoTelefonica3) OR (Item.""No."" = vProductoTelefonica4) THEN BEGIN"										
"Precio := ROUND((SalesEntry.Price / (1 + (Impuesto / 100))),0.0001);"										
Value[3]:=FORMAT(Precio);										
"PosPunto:=STRPOS(Value[3],'.');"										
IF (PosPunto=0) THEN										
Value[3]:= Value[3] + '.00';										
"Value[5] := POSFunctions.FormatAmount((ROUND((SalesEntry.Price / (1 + (Impuesto / 100))),0.0001))*ABS(SalesEntry.Q"	uan	tit	y)	)+'	G';					
END										
ELSE BEGIN										
"Precio:=ROUND((SalesEntry.Price / (1 + (Impuesto / 100))),0.0001);"										
Value[3]:=FORMAT(Precio);										
"PosPunto:=STRPOS(Value[3],'.');"										
IF (PosPunto=0) THEN										
Value[3]:= Value[3] + '.00';										
"Value[5] := POSFunctions.FormatAmount((ROUND((SalesEntry.Price / (1 + (Impuesto / 100))),0.0001))*ABS(SalesEntry.Q"	uan	tit	y)	)+'	G';					
END;										
END										
"ELSE IF Transaction.""Sale Is Return Sale"" AND"										
"(Transaction.""No. Serie NCF"" = POSTerminal.""No. Serie NCF Cons. Final"") THEN BEGIN"										
//CSPNT240915										
"Value[3] := POSFunctions.FormatAmount(-(SalesEntry.""Net Amount"") / ABS(SalesEntry.Quantity));"										
//CSPNT131015										
Value[5] := POSFunctions.FormatAmount(-(SalesEntry.Price * SalesEntry.Quantity))+'G';										
END										
//CSRM02102013										
"ELSE IF Transaction.""Sale Is Return Sale"" AND"										
"(Transaction.""No. Serie NCF"" = POSTerminal.""No. Serie NCF Exportacion"") THEN BEGIN"										
//CSPNT240915										
"Value[3] := POSFunctions.FormatAmount(-(SalesEntry.""Net Amount"") / ABS(SalesEntry.Quantity));"										
//CSPNT131015										
Value[5] := POSFunctions.FormatAmount(-(SalesEntry.Price * SalesEntry.Quantity))+'G';										
END;										
END										
//RETAIL SETUP <> 48										
ELSE BEGIN										
"IF Transaction.""No. Serie NCF"" = POSTerminal.""No. Serie NCF Credito Fiscal"" THEN BEGIN"										
"Precio:=ROUND((SalesEntry.Price / (1 + (Impuesto / 100))),0.01);"										
										
Value[5]:=FORMAT(Precio);										
"PosPunto:=STRPOS(Value[5],'.');"										
IF (PosPunto=0) THEN										
Value[5]:= Value[5] + '.00000';										
										
"Value[5] := POSFunctions.FormatAmount((ROUND((SalesEntry.Price / (1 + (Impuesto / 100))),0.01))"										
*ABS(SalesEntry.Quantity));										
END										
"ELSE IF Transaction.""No. Serie NCF"" = POSTerminal.""No. Serie NCF Cons. Final"" THEN BEGIN"										
"Value[5] := POSFunctions.FormatAmount(-(SalesEntry.""Net Amount"" + SalesEntry.""VAT Amount"") / ABS(SalesEntry.Quantity"	));									
Value[6] := POSFunctions.FormatAmount(-(SalesEntry.Price * SalesEntry.Quantity));										
END										
//CSRM01102013										
"ELSE IF Transaction.""No. Serie NCF"" = POSTerminal.""No. Serie NCF Exportacion"" THEN BEGIN"										
"Value[5] := POSFunctions.FormatAmount(-(SalesEntry.""Net Amount"" + SalesEntry.""VAT Amount"") / ABS(SalesEntry.Quantity"	));									
Value[6] := POSFunctions.FormatAmount(-(SalesEntry.Price * SalesEntry.Quantity));										
END										
//CSRM01102013										
//CSRM25092013										
"ELSE IF Transaction.""Sale Is Return Sale"" AND"										
"(Transaction.""No. Serie NCF"" = POSTerminal.""No. Serie NCF Nota de Credito"") THEN BEGIN"										
"Value[5] := POSFunctions.FormatAmount((SalesEntry.""Net Amount"") / ABS(SalesEntry.Quantity));"										
Value[6] := POSFunctions.FormatAmount(-(SalesEntry.Price * SalesEntry.Quantity));										
END										
"ELSE IF Transaction.""Sale Is Return Sale"" AND"										
"(Transaction.""No. Serie NCF"" = POSTerminal.""No. Serie NCF Cons. Final"") THEN BEGIN"										
"Value[5] := POSFunctions.FormatAmount(-(SalesEntry.""Net Amount"") / ABS(SalesEntry.Quantity));"										
Value[6] := POSFunctions.FormatAmount(-(SalesEntry.Price * SalesEntry.Quantity));										
END										
//CSRM02102013										
"ELSE IF Transaction.""Sale Is Return Sale"" AND"										
"(Transaction.""No. Serie NCF"" = POSTerminal.""No. Serie NCF Exportacion"") THEN BEGIN"										
"Value[5] := POSFunctions.FormatAmount(-(SalesEntry.""Net Amount"") / ABS(SalesEntry.Quantity));"										
Value[6] := POSFunctions.FormatAmount(-(SalesEntry.Price * SalesEntry.Quantity));										
END;										
//CSRM02102013										
//CSRM25092013										
END;										
//CSPNT201015										
"// CONSISA FASANI Para que solo imprima los resumenes, no el detalle"										
IF NOT (Transaction.NotaRemision) THEN										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
//CSRM21102013										
//CSPNT121015 Descuento impuesto gravado										
//CSRM21102013										
"IF (SalesEntry.""Discount Amount"" <> 0) OR"										
"(SalesEntry.""Discount Amt. For Printing"" <> 0) OR"										
"(SalesEntry.""Line Discount"" <> 0) OR"										
"(SalesEntry.""Coupon Amt. For Printing"" <> 0) THEN BEGIN"										
//CSPNT201015										
"IF RetailSetup.""Ancho Columnas""=RetailSetup.""Ancho Columnas""::""48"" THEN"										
//CSPNT231015										
//CSPNT261015										
//CSPNT180116										
DSTR1 := '             #L#########################             #R####                     #R######'										
ELSE										
DSTR1 := '#L##################### #R#######';										
										
"IF ((SalesEntry.""Periodic Discount"" <> 0) OR"										
"(SalesEntry.""Discount Amt. For Printing"" <> 0)) AND"										
"(SalesEntry.""Customer Discount"" = 0) THEN BEGIN"										
"IF (SalesEntry.""Periodic Disc. Type"" <> SalesEntry.""Periodic Disc. Type""::"" "") THEN BEGIN"										
"IF SalesEntry.""Periodic Disc. Type"" = SalesEntry.""Periodic Disc. Type""::""Mix&Match"" THEN"										
"BufferDiscount(PerDiscOffArr,PerDiscOffAmtArr,PerDiscOffArrCount,SalesEntry.""Periodic Disc. Group"",SalesEntry.""D"	isc	oun	t	Amt	". For Printing"")"					
//CSPNT201015										
"{ELSE IF SalesEntry.""Periodic Disc. Type"" = SalesEntry.""Periodic Disc. Type""::""Multibuy"" THEN"										
"BufferDiscount(PerDiscOffArr,PerDiscOffAmtArr,PerDiscOffArrCount,SalesEntry.""Periodic Disc. Group"",SalesEntry.""D"	isc	oun	t	Amt	". For Printing"")}"					
ELSE										
"BufferDiscount(PerDiscOffArr,PerDiscOffAmtArr,PerDiscOffArrCount,SalesEntry.""Periodic Disc. Group"",SalesEntry.""P"	eri	odi	c	Dis	"count"");"					
"IF PeriodicDiscount.GET(SalesEntry.""Periodic Disc. Group"") THEN"										
discText := PeriodicDiscount.Description										
ELSE										
discText := FORMAT(PeriodicDiscount.Type);										
END;										
"IF SalesEntry.""Discount Amt. For Printing"" <> 0 THEN BEGIN"										
//CSPNT201015										
Value[1] := discText;										
"IF Transaction.""Sale Is Return Sale"" THEN BEGIN"										
//CSPNT261015										
"IF (Transaction.""No. Serie NCF"" = POSTerminal.""No. Serie NCF Nota de Credito"") THEN BEGIN"										
"Value[2] := POSFunctions.FormatAmount((ROUND(-(SalesEntry.""Discount Amt. For Printing"" / (1 + (Impuesto / 100)"	")),"	0	1)	));						
"Value[3] := POSFunctions.FormatAmount((ROUND(-(SalesEntry.""Discount Amt. For Printing"" / (1 + (Impuesto / 100)"	")),"	0	1)	));						
END										
ELSE BEGIN										
//CSPNT201015										
"Value[2] := POSFunctions.FormatAmount(SalesEntry.""Discount Amt. For Printing"");"										
"Value[3] := POSFunctions.FormatAmount(SalesEntry.""Discount Amt. For Printing"");"										
END;										
END										
ELSE BEGIN										
//CSPNT191015 Descuento Multibuy										
"IF (Transaction.""No. Serie NCF"" = POSTerminal.""No. Serie NCF Cons. Final"") THEN BEGIN"										
//CSPNT201015										
"Value[2] := POSFunctions.FormatAmount((ROUND(-(SalesEntry.""Discount Amt. For Printing""),0.01)));"										
"Value[3] := POSFunctions.FormatAmount((ROUND(-(SalesEntry.""Discount Amt. For Printing""),0.01)));"										
END										
ELSE BEGIN										
//CSPNT201015										
"Value[2] := POSFunctions.FormatAmount((ROUND(-(SalesEntry.""Discount Amt. For Printing"" / (1 + (Impuesto / 100)"	")),"	0	1)	));						
"Value[3] := POSFunctions.FormatAmount((ROUND(-(SalesEntry.""Discount Amt. For Printing"" / (1 + (Impuesto / 100)"	")),"	0	1)	));						
END;										
END;										
//CSPNT261015										
//CSPNT070716										
IF NOT (Transaction.NotaRemision) THEN										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
//CSPNT261015 LineCount aumentado al imprimir linea de descuento										
LineCount := LineCount + 1;										
END										
"ELSE IF SalesEntry.""Periodic Disc. Type"" = SalesEntry.""Periodic Disc. Type""::""Disc. Offer"" THEN BEGIN"										
Value[1] := discText;										
"IF (Transaction.""No. Serie NCF"" = POSTerminal.""No. Serie NCF Credito Fiscal"") THEN BEGIN"										
//CSPNT201015										
"Value[2] := POSFunctions.FormatAmount((ROUND(-(SalesEntry.""Periodic Discount"" / (1 + (Impuesto / 100))),0.01)));"										
"Value[3] := POSFunctions.FormatAmount((ROUND(-(SalesEntry.""Periodic Discount"" / (1 + (Impuesto / 100))),0.01)));"										
END										
"ELSE IF (Transaction.""No. Serie NCF"" = POSTerminal.""No. Serie NCF Nota de Credito"") THEN BEGIN"										
//CSPNT201015										
"Value[2] := POSFunctions.FormatAmount((ROUND((SalesEntry.""Periodic Discount"" / (1 + (Impuesto / 100))),0.01)));"										
"Value[3] := POSFunctions.FormatAmount((ROUND((SalesEntry.""Periodic Discount"" / (1 + (Impuesto / 100))),0.01)));"										
END										
ELSE BEGIN										
//CSPNT191015										
"Value[2] := POSFunctions.FormatAmount((ROUND(-(SalesEntry.""Periodic Discount""),0.00001)));"										
"Value[3] := POSFunctions.FormatAmount((ROUND(-(SalesEntry.""Periodic Discount""),0.00001)));"										
END;										
//CSPNT070716										
IF NOT (Transaction.NotaRemision) THEN										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
//CSPNT261015 LineCount aumentado al imprimir linea de descuento										
LineCount := LineCount + 1;										
END;										
END;										
										
"IF SalesEntry.""Line Discount"" <> 0 THEN BEGIN"										
Value[1] := Text084;										
"IF (Transaction.""No. Serie NCF"" = POSTerminal.""No. Serie NCF Credito Fiscal"") THEN BEGIN"										
"Value[2] := POSFunctions.FormatAmount((ROUND(-(SalesEntry.""Line Discount"" / (1 + (Impuesto / 100))),0.01)));"										
"Value[3] := POSFunctions.FormatAmount((ROUND(-(SalesEntry.""Line Discount"" / (1 + (Impuesto / 100))),0.01)));"										
END										
ELSE BEGIN										
"Value[2] := POSFunctions.FormatAmount(-SalesEntry.""Line Discount"");"										
"Value[3] := POSFunctions.FormatAmount(-SalesEntry.""Line Discount"");"										
END;										
//CSPNT070716										
IF NOT (Transaction.NotaRemision) THEN										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
//CSPNT261015 LineCount aumentado al imprimir linea de descuento										
LineCount := LineCount + 1;										
END;										
										
"IF SalesEntry.""Coupon Amt. For Printing"" <> 0 THEN BEGIN"										
Value[1] := Text165;										
"IF (Transaction.""No. Serie NCF"" = POSTerminal.""No. Serie NCF Credito Fiscal"") THEN BEGIN"										
"Value[2] := POSFunctions.FormatAmount((ROUND(-(SalesEntry.""Coupon Amt. For Printing"" / (1 + (Impuesto / 100))),0.0"	1))	);								
"Value[3] := POSFunctions.FormatAmount((ROUND(-(SalesEntry.""Coupon Amt. For Printing"" / (1 + (Impuesto / 100))),0.0"	1))	);								
END										
ELSE BEGIN										
"Value[2] := POSFunctions.FormatAmount(-SalesEntry.""Coupon Amt. For Printing"");"										
"Value[3] := POSFunctions.FormatAmount(-SalesEntry.""Coupon Amt. For Printing"");"										
END;										
//CSPNT070716										
IF NOT (Transaction.NotaRemision) THEN										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
//CSPNT261015 LineCount aumentado al imprimir linea de descuento										
LineCount := LineCount + 1;										
END;										
END;										
										
//CSPNT190116 Descuento de cliente										
"IF (SalesEntry.""Customer Discount"" <> 0) THEN BEGIN"										
DSTR1 := '             #L#########################             #R####                     #R######';										
"IF (SalesEntry.""Periodic Disc. Type"" = SalesEntry.""Periodic Disc. Type""::"" "") THEN BEGIN"										
Value[1] := Text085;										
"IF (Transaction.""No. Serie NCF"" = POSTerminal.""No. Serie NCF Cons. Final"") THEN BEGIN"										
"Value[2] := POSFunctions.FormatAmount((ROUND(-(SalesEntry.""Customer Discount""),0.01)));"										
END										
ELSE BEGIN										
"Value[2] := POSFunctions.FormatAmount((ROUND(-(SalesEntry.""Customer Discount"" / (1 + (Impuesto / 100))),0.01))"	);									
END;										
Value[3] := Value[2];										
//CSPNT070716										
IF NOT (Transaction.NotaRemision) THEN										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
LineCount := LineCount + 1;										
END;										
END;										
										
"//CSPNT201015PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
"IF Transaction.""No. Serie NCF"" = POSTerminal.""No. Serie NCF Credito Fiscal"" THEN BEGIN"										
// CSALX091216										
IF EsRemision THEN BEGIN										
"TotalVentG  += (SalesEntry.""Net Amount"");"										
"TotalIVA     += (SalesEntry.""VAT Amount"");"										
END ELSE BEGIN										
//CSPNT290916										
"IF (Item.""No."" = vProductoTelefonica1) OR (Item.""No."" = vProductoTelefonica2)"										
"OR (Item.""No."" = vProductoTelefonica3) OR (Item.""No."" = vProductoTelefonica4) THEN BEGIN"										
"TotalVentG   += ABS(SalesEntry.""Net Amount"");"										
"TotalIVA     += ABS(SalesEntry.""VAT Amount"" + vCESC);"										
END										
ELSE BEGIN										
"TotalVentG   += ABS(SalesEntry.""Net Amount"");"										
"TotalIVA     += ABS(SalesEntry.""VAT Amount"");"										
END;										
END;										
END										
"ELSE IF Transaction.""No. Serie NCF"" = POSTerminal.""No. Serie NCF Cons. Final"" THEN BEGIN"										
// CSALX091216										
IF EsRemision THEN BEGIN										
"TotalVentG   += (SalesEntry.""Net Amount"") + (SalesEntry.""VAT Amount"");"										
END ELSE BEGIN										
//CSPNT290916										
"IF (Item.""No."" = vProductoTelefonica1) OR (Item.""No."" = vProductoTelefonica2)"										
"OR (Item.""No."" = vProductoTelefonica3) OR (Item.""No."" = vProductoTelefonica4) THEN"										
"TotalVentG   += ABS(SalesEntry.""Net Amount"") + ABS(SalesEntry.""VAT Amount"")"										
ELSE										
"TotalVentG   += ABS(SalesEntry.""Net Amount"") + ABS(SalesEntry.""VAT Amount"");"										
END;										
END										
//CSRM02102013										
"ELSE IF Transaction.""No. Serie NCF"" = POSTerminal.""No. Serie NCF Exportacion"" THEN BEGIN"										
// CSALX091216										
IF EsRemision THEN										
"TotalVentG   += ABS(SalesEntry.""Net Amount"") + ABS(SalesEntry.""VAT Amount"")"										
ELSE										
"TotalVentG   += ABS(SalesEntry.""Net Amount"") + ABS(SalesEntry.""VAT Amount"");"										
END										
//CSRM02102013										
//CSRM25092013										
"ELSE IF Transaction.""Sale Is Return Sale"" AND"										
"(Transaction.""No. Serie NCF"" = POSTerminal.""No. Serie NCF Nota de Credito"") THEN BEGIN"										
// CSALX091216										
IF EsRemision THEN BEGIN										
"TotalVentG   += (SalesEntry.""Net Amount"");"										
"TotalIVA     += (SalesEntry.""VAT Amount"");"										
END ELSE BEGIN										
//CSPNT290916										
"IF (Item.""No."" = vProductoTelefonica1) OR (Item.""No."" = vProductoTelefonica2)"										
"OR (Item.""No."" = vProductoTelefonica3) OR (Item.""No."" = vProductoTelefonica4) THEN BEGIN"										
"TotalVentG   += ABS(SalesEntry.""Net Amount"");"										
"TotalIVA     += ABS(SalesEntry.""VAT Amount"" - vCESC);"										
END										
ELSE BEGIN										
"TotalVentG   += ABS(SalesEntry.""Net Amount"");"										
"TotalIVA     += ABS(SalesEntry.""VAT Amount"");"										
END;										
END;										
END										
"ELSE IF Transaction.""Sale Is Return Sale"" AND"										
"(Transaction.""No. Serie NCF"" = POSTerminal.""No. Serie NCF Cons. Final"") THEN BEGIN"										
// CSALX091216										
IF EsRemision THEN										
TotalVentG   += (SalesEntry.Price)										
ELSE										
TotalVentG   += ABS(SalesEntry.Price);										
END										
//CSRM02102013										
"ELSE IF Transaction.""Sale Is Return Sale"" AND"										
"(Transaction.""No. Serie NCF"" = POSTerminal.""No. Serie NCF Exportacion"") THEN BEGIN"										
// CSALX091216										
IF EsRemision THEN										
"TotalVentG   += (SalesEntry.""Net Amount"")"										
ELSE										
"TotalVentG   += ABS(SalesEntry.""Net Amount"");"										
END;										
//CSRM02102013										
//CSRM25092013										
END										
"//CSPNT240915  impuesto exento, se dejo una sola linea, con la cantidad, descripci¢n, precio unitario y ventas gravadas"										
//ELSE IF rVATProdPostGrp.Exento THEN										
ELSE IF rImpuestos.Impuesto=rImpuestos.Impuesto::Exento THEN BEGIN										
//CSPNT240915										
"IF RetailSetup.""Ancho Columnas""=RetailSetup.""Ancho Columnas""::""48"" THEN BEGIN"										
"//CSPNT240915                PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
//CSPNT021015										
//CSPNT180116										
DSTR1 := '      #L###  #L#########################    #R#####  #R####          #R######           ';										
END;										
										
"IF RetailSetup.""Ancho Columnas""=RetailSetup.""Ancho Columnas""::""48"" THEN BEGIN"										
"IF Transaction.""Sale Is Return Sale"" AND"										
"(Transaction.""No. Serie NCF"" = POSTerminal.""No. Serie NCF Nota de Credito"") THEN BEGIN"										
//CSPNT250116 - X										
Value[1] := POSFunctions.FormatQty(SalesEntry.Quantity);										
END										
ELSE BEGIN										
//CSPNT250116 - X										
Value[1] := POSFunctions.FormatQty(-SalesEntry.Quantity);										
END;										
"//FORMAT(SalesEntry.""Net Price"",0,'<Precision,4:4><Standard format,0>');"										
//CSPNT240915										
Value[2] := Item.Description;										
										
"IF (Transaction.""Sale Is Return Sale"" AND"										
"(Transaction.""No. Serie NCF"" = POSTerminal.""No. Serie NCF Nota de Credito""))"										
"OR ((Transaction.""No. Serie NCF"" = POSTerminal.""No. Serie NCF Credito Fiscal"")) THEN BEGIN"										
"Precio:=ROUND(SalesEntry.""Net Price"",0.01);"										
//CSPNT240915										
Value[3]:=FORMAT(Precio);										
"PosPunto:=STRPOS(Value[3],'.');"										
IF (PosPunto=0) THEN										
Value[3]:= Value[3] + '.00';										
END										
ELSE BEGIN										
"Value[3] := POSFunctions.FormatAmount(SalesEntry.""Net Price"");"										
END;										
										
"//Value[2] :=FORMAT(SalesEntry.""Net Price"",0,'<Precision,2:4><Standard format,0>');"										
"//Value[2] := POSFunctions.FormatAmount(SalesEntry.""Net Price"");"										
"IF Transaction.""Sale Is Return Sale"" AND"										
"(Transaction.""No. Serie NCF"" = POSTerminal.""No. Serie NCF Nota de Credito"") THEN BEGIN"										
//CSPNT240915										
//CSPNT131015										
//CSPNT211015										
Value[5] := POSFunctions.FormatAmount((SalesEntry.Price * SalesEntry.Quantity))+ 'E' ;										
END										
ELSE BEGIN										
//CSPNT240915										
//CSPNT131015										
//CSPNT211015										
Value[5] := POSFunctions.FormatAmount(-(SalesEntry.Price * SalesEntry.Quantity))+ 'E' ;										
END;										
END										
ELSE BEGIN										
"IF Transaction.""Sale Is Return Sale"" AND"										
"(Transaction.""No. Serie NCF"" = POSTerminal.""No. Serie NCF Nota de Credito"") THEN BEGIN"										
Value[3] := POSFunctions.FormatQty(SalesEntry.Quantity);										
END										
ELSE BEGIN										
//CSPNT240915										
Value[5] := POSFunctions.FormatQty(-SalesEntry.Quantity);										
END;										
"Value[5] := '$' + POSFunctions.FormatAmount(SalesEntry.""Net Price"");"										
"IF Transaction.""Sale Is Return Sale"" AND"										
"(Transaction.""No. Serie NCF"" = POSTerminal.""No. Serie NCF Nota de Credito"") THEN BEGIN"										
Value[6] := '$' + POSFunctions.FormatAmount(-(SalesEntry.Price * SalesEntry.Quantity)) ;										
END										
ELSE BEGIN										
Value[6] := '$' + POSFunctions.FormatAmount(-(SalesEntry.Price * SalesEntry.Quantity)) ;										
END;										
END;										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
//CSRM21102013										
//CSPNT121015 Descuento impuesto exento										
"IF (SalesEntry.""Discount Amount"" <> 0) OR"										
"(SalesEntry.""Discount Amt. For Printing"" <> 0) OR"										
"(SalesEntry.""Line Discount"" <> 0) OR"										
"(SalesEntry.""Coupon Amt. For Printing"" <> 0) THEN BEGIN"										
"IF RetailSetup.""Ancho Columnas""=RetailSetup.""Ancho Columnas""::""48"" THEN"										
//CSPNT211015										
//CSPNT051215										
//CSPNT180116										
DSTR1 := '             #L#########################             #R####        #R######            '										
ELSE										
DSTR1 := '     #L#####################                                                   #R#######';										
										
"IF ((SalesEntry.""Periodic Discount"" <> 0) OR"										
"(SalesEntry.""Discount Amt. For Printing"" <> 0)) AND"										
"(SalesEntry.""Customer Discount"" = 0) THEN BEGIN"										
"IF (SalesEntry.""Periodic Disc. Type"" <> SalesEntry.""Periodic Disc. Type""::"" "") THEN BEGIN"										
"IF SalesEntry.""Periodic Disc. Type"" = SalesEntry.""Periodic Disc. Type""::""Mix&Match"" THEN"										
"BufferDiscount(PerDiscOffArr,PerDiscOffAmtArr,PerDiscOffArrCount,SalesEntry.""Periodic Disc. Group"",SalesEntry."	"""Di"	sco	un	t A	"mt. For Printing"")"					
ELSE										
"BufferDiscount(PerDiscOffArr,PerDiscOffAmtArr,PerDiscOffArrCount,SalesEntry.""Periodic Disc. Group"",SalesEntry."	"""Pe"	rio	di	c D	"iscount"");"					
"IF PeriodicDiscount.GET(SalesEntry.""Periodic Disc. Group"") THEN"										
discText := PeriodicDiscount.Description										
ELSE										
discText := FORMAT(PeriodicDiscount.Type);										
END;										
										
"IF SalesEntry.""Discount Amt. For Printing"" <> 0 THEN BEGIN"										
//CSPNT211015										
Value[1] := discText;										
"IF Transaction.""Sale Is Return Sale"" THEN BEGIN"										
"Value[2] := POSFunctions.FormatAmount(SalesEntry.""Discount Amt. For Printing"");"										
"Value[3] := POSFunctions.FormatAmount(SalesEntry.""Discount Amt. For Printing"");"										
END ELSE BEGIN										
"Value[2] := POSFunctions.FormatAmount(-SalesEntry.""Discount Amt. For Printing"");"										
"Value[3] := POSFunctions.FormatAmount(-SalesEntry.""Discount Amt. For Printing"");"										
END;										
//CSPNT211015										
//CSPNT261015										
//CSPNT070716										
IF NOT (Transaction.NotaRemision) THEN										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
//CSPNT261015 LineCount aumentado al imprimir linea de descuento										
LineCount := LineCount + 1;										
END										
"ELSE IF SalesEntry.""Periodic Disc. Type"" = SalesEntry.""Periodic Disc. Type""::""Disc. Offer"" THEN BEGIN"										
//CSPNT211015										
Value[1] := discText;										
"Value[2] := POSFunctions.FormatAmount((ROUND(-(SalesEntry.""Periodic Discount"" / (1 + (Impuesto / 100))),0.01)));"										
"//CSPNT260216                  Value[2] := POSFunctions.FormatAmount((ROUND(-(SalesEntry.""Periodic Discount"" - (SalesEntry.""Period"	ic	Dis	co	unt	""" * (Impuesto / 100))),0.01)));"					
"Value[3] := POSFunctions.FormatAmount((ROUND(-(SalesEntry.""Periodic Discount"" / (1 + (Impuesto / 100))),0.01)));"										
"//CSPNT260216                  Value[3] := POSFunctions.FormatAmount((ROUND(-(SalesEntry.""Periodic Discount"" - (SalesEntry.""Period"	ic	Dis	co	unt	""" * (Impuesto / 100))),0.01)));"					
"//Value[2] := POSFunctions.FormatAmount(-SalesEntry.""Periodic Discount"");"										
//CSPNT261015										
//CSPNT070716										
IF NOT (Transaction.NotaRemision) THEN										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
//CSPNT261015 LineCount aumentado al imprimir linea de descuento										
LineCount := LineCount + 1;										
END;										
END;										
										
"IF SalesEntry.""Line Discount"" <> 0 THEN BEGIN"										
//CSPNT211015										
Value[1] := Text084;										
"Value[2] := POSFunctions.FormatAmount((ROUND(-(SalesEntry.""Line Discount"" / (1 + (Impuesto / 100))),0.01)));"										
"//CSPNT260216                Value[2] := POSFunctions.FormatAmount((ROUND(-(SalesEntry.""Line Discount"" - (SalesEntry.""Line Discoun"	"t"""	* (	Im	pue	"sto / 100))),0.01)));"					
"Value[3] := POSFunctions.FormatAmount((ROUND(-(SalesEntry.""Line Discount"" / (1 + (Impuesto / 100))),0.01)));"										
"//CSPNT260216                Value[3] := POSFunctions.FormatAmount((ROUND(-(SalesEntry.""Line Discount"" - (SalesEntry.""Line Discoun"	"t"""	* (	Im	pue	"sto / 100))),0.01)));"					
"//Value[2] := POSFunctions.FormatAmount(-SalesEntry.""Line Discount"");"										
//CSPNT070716										
IF NOT (Transaction.NotaRemision) THEN										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
//CSPNT261015 LineCount aumentado al imprimir linea de descuento										
LineCount := LineCount + 1;										
END;										
										
"IF SalesEntry.""Coupon Amt. For Printing"" <> 0 THEN BEGIN"										
//CSPNT211015										
Value[1] := Text165;										
"Value[2] := POSFunctions.FormatAmount(-SalesEntry.""Coupon Amt. For Printing"");"										
"Value[3] := POSFunctions.FormatAmount(-SalesEntry.""Coupon Amt. For Printing"");"										
//CSPNT070716										
IF NOT (Transaction.NotaRemision) THEN										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
//CSPNT261015 LineCount aumentado al imprimir linea de descuento										
LineCount := LineCount + 1;										
END;										
END;										
										
//CSPNT190116 Descuento de cliente										
"IF (SalesEntry.""Customer Discount"" <> 0) THEN BEGIN"										
DSTR1 := '             #L#########################             #R####                     #R######';										
"IF (SalesEntry.""Periodic Disc. Type"" = SalesEntry.""Periodic Disc. Type""::"" "") THEN BEGIN"										
Value[1] := Text085;										
"IF (Transaction.""No. Serie NCF"" = POSTerminal.""No. Serie NCF Cons. Final"") THEN BEGIN"										
"Value[2] := POSFunctions.FormatAmount((ROUND(-(SalesEntry.""Customer Discount""),0.01)));"										
END										
ELSE BEGIN										
"Value[2] := POSFunctions.FormatAmount((ROUND(-(SalesEntry.""Customer Discount"" / (1 + (Impuesto / 100))),0.01)));"										
"//CSPNT260216                  Value[2] := POSFunctions.FormatAmount((ROUND(-(SalesEntry.""Customer Discount"" - (SalesEntry.""Custom"	er	Dis	co	unt	""" * (Impuesto / 100))),0.01)));"					
END;										
Value[3] := Value[2];										
//CSPNT070716										
IF NOT (Transaction.NotaRemision) THEN										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
LineCount := LineCount + 1;										
END;										
END;										
										
"//CSPNT261015          PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
"TotalVentE += ABS(SalesEntry.""Net Amount"");"										
END										
"//ELSE IF rVATProdPostGrp.""No Sujeto"" THEN"										
"ELSE IF rImpuestos.Impuesto=rImpuestos.Impuesto::""No Sujeto"" THEN BEGIN"										
"IF RetailSetup.""Ancho Columnas""=RetailSetup.""Ancho Columnas""::""48"" THEN"										
DSTR1 := '#L#######  #L##################################'										
ELSE										
DSTR1 := '   #L############ #L###############    #L##    #L#####   #L#######';										
										
"Value[1] := Item.""No."";"										
Value[2] := Item.Description;										
										
"IF RetailSetup.""Ancho Columnas""=RetailSetup.""Ancho Columnas""::""48"" THEN BEGIN"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
DSTR1 := '#L#####   #R#######                #R#######';										
END;										
										
"IF RetailSetup.""Ancho Columnas""=RetailSetup.""Ancho Columnas""::""48"" THEN BEGIN"										
"IF Transaction.""Sale Is Return Sale"" AND"										
"(Transaction.""No. Serie NCF"" = POSTerminal.""No. Serie NCF Nota de Credito"") THEN"										
//CSPNT250116 - X										
Value[1] := POSFunctions.FormatQty(SalesEntry.Quantity)										
ELSE										
//CSPNT250116 - X										
Value[1] := POSFunctions.FormatQty(-SalesEntry.Quantity);										
										
"//Precio:=ROUND(SalesEntry.""Net Price"",0.00001);"										
"SubtotalLinea:=ROUND(SalesEntry.Price * SalesEntry.Quantity,0.01);"										
"Precio:= ROUND((SubtotalLinea/SalesEntry.Quantity),0.01);"										
										
Value[2]:=FORMAT(Precio);										
"PosPunto:=STRPOS(Value[2],'.');"										
IF (PosPunto=0) THEN										
Value[2]:= Value[2] + '.00000';										
"//Value[2] := POSFunctions.FormatAmount(SalesEntry.""Net Price"");"										
"IF Transaction.""Sale Is Return Sale"" AND"										
"(Transaction.""No. Serie NCF"" = POSTerminal.""No. Serie NCF Nota de Credito"") THEN BEGIN"										
Value[3] := POSFunctions.FormatAmount(-(SalesEntry.Price * SalesEntry.Quantity))+'G';										
END										
ELSE BEGIN										
Value[3] := POSFunctions.FormatAmount(-(SalesEntry.Price * SalesEntry.Quantity))+'G';										
END;										
END										
ELSE BEGIN										
"IF Transaction.""Sale Is Return Sale"" AND"										
"(Transaction.""No. Serie NCF"" = POSTerminal.""No. Serie NCF Nota de Credito"") THEN BEGIN"										
Value[3] := POSFunctions.FormatQty(SalesEntry.Quantity);										
END										
ELSE BEGIN										
Value[3] := POSFunctions.FormatQty(-SalesEntry.Quantity);										
END;										
										
"Value[4] := '$' + POSFunctions.FormatAmount(SalesEntry.""Net Price"");"										
"IF Transaction.""Sale Is Return Sale"" AND"										
"(Transaction.""No. Serie NCF"" = POSTerminal.""No. Serie NCF Nota de Credito"") THEN BEGIN"										
Value[5] := '$' + POSFunctions.FormatAmount(-(SalesEntry.Price * SalesEntry.Quantity));										
END										
ELSE BEGIN										
Value[5] := '$' + POSFunctions.FormatAmount(-(SalesEntry.Price * SalesEntry.Quantity));										
END;										
END;										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
//CSRM21102013										
										
"IF (SalesEntry.""Discount Amount"" <> 0) OR"										
"(SalesEntry.""Discount Amt. For Printing"" <> 0) OR"										
"(SalesEntry.""Line Discount"" <> 0) OR"										
"(SalesEntry.""Coupon Amt. For Printing"" <> 0) THEN BEGIN"										
//DSTR1 := '  #L################## #N############   ';										
"IF RetailSetup.""Ancho Columnas""=RetailSetup.""Ancho Columnas""::""48"" THEN"										
//CSPNT261015										
//CSPNT250116										
DSTR1 := '             #L#########################             #R####                    #R######'										
ELSE										
DSTR1 := '     #L#####################                                                   #R#######';										
										
"IF ((SalesEntry.""Periodic Discount"" <> 0) OR"										
"(SalesEntry.""Discount Amt. For Printing"" <> 0)) AND"										
"(SalesEntry.""Customer Discount"" = 0) THEN BEGIN"										
"IF (SalesEntry.""Periodic Disc. Type"" <> SalesEntry.""Periodic Disc. Type""::"" "") THEN BEGIN"										
"IF SalesEntry.""Periodic Disc. Type"" = SalesEntry.""Periodic Disc. Type""::""Mix&Match"" THEN"										
"BufferDiscount(PerDiscOffArr,PerDiscOffAmtArr,PerDiscOffArrCount,SalesEntry.""Periodic Disc. Group"",SalesEntry.""D"	isc	oun	t	Amt	". For Printing"")"					
ELSE										
"BufferDiscount(PerDiscOffArr,PerDiscOffAmtArr,PerDiscOffArrCount,SalesEntry.""Periodic Disc. Group"",SalesEntry.""P"	eri	odi	c	Dis	"count"");"					
"IF PeriodicDiscount.GET(SalesEntry.""Periodic Disc. Group"") THEN"										
discText := PeriodicDiscount.Description										
ELSE										
discText := FORMAT(PeriodicDiscount.Type);										
END;										
										
"IF SalesEntry.""Discount Amt. For Printing"" <> 0 THEN BEGIN"										
Value[1] := discText;										
"IF Transaction.""Sale Is Return Sale"" THEN BEGIN"										
"Value[2] := POSFunctions.FormatAmount(SalesEntry.""Discount Amt. For Printing"");"										
END										
ELSE BEGIN										
"Value[2] := POSFunctions.FormatAmount(-SalesEntry.""Discount Amt. For Printing"");"										
END;										
//CSPNT261015										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END										
"ELSE IF SalesEntry.""Periodic Disc. Type"" = SalesEntry.""Periodic Disc. Type""::""Disc. Offer"" THEN BEGIN"										
Value[1] := discText;										
"Value[2] := POSFunctions.FormatAmount((ROUND(-(SalesEntry.""Periodic Discount"" / (1 + (Impuesto / 100))),0.01)));"										
"//CSPNT260216              Value[2] := POSFunctions.FormatAmount((ROUND(-(SalesEntry.""Periodic Discount"" - (SalesEntry.""Periodic D"	isc	oun	"t"""	*	"(Impuesto / 100))),0.01)));"					
"//Value[2] := POSFunctions.FormatAmount(-SalesEntry.""Periodic Discount"");"										
//CSPNT261015										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
END;										
										
"IF SalesEntry.""Line Discount"" <> 0 THEN BEGIN"										
Value[1] := Text084;										
"Value[2] := POSFunctions.FormatAmount((ROUND(-(SalesEntry.""Line Discount"" / (1 + (Impuesto / 100))),0.01)));"										
"//CSPNT260216            Value[2] := POSFunctions.FormatAmount((ROUND(-(SalesEntry.""Line Discount"" - (SalesEntry.""Line Discount"" *"	(I	mpu	es	to	"/ 100))),0.01)));"					
"//Value[2] := POSFunctions.FormatAmount(-SalesEntry.""Line Discount"");"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
										
"IF SalesEntry.""Coupon Amt. For Printing"" <> 0 THEN BEGIN"										
Value[1] := Text165;										
"Value[2] := POSFunctions.FormatAmount(-SalesEntry.""Coupon Amt. For Printing"");"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
END;										
										
//CSPNT190116 Descuento de cliente										
"IF (SalesEntry.""Customer Discount"" <> 0) THEN BEGIN"										
DSTR1 := '             #L#########################             #R####                     #R######';										
"IF (SalesEntry.""Periodic Disc. Type"" = SalesEntry.""Periodic Disc. Type""::"" "") THEN BEGIN"										
Value[1] := Text085;										
"IF (Transaction.""No. Serie NCF"" = POSTerminal.""No. Serie NCF Cons. Final"") THEN BEGIN"										
"Value[2] := POSFunctions.FormatAmount((ROUND(-(SalesEntry.""Customer Discount""),0.01)));"										
END										
ELSE BEGIN										
"Value[2] := POSFunctions.FormatAmount((ROUND(-(SalesEntry.""Customer Discount"" / (1 + (Impuesto / 100))),0.01)));"										
"//CSPNT260216                  Value[2] := POSFunctions.FormatAmount((ROUND(-(SalesEntry.""Customer Discount"" - (SalesEntry.""Custom"	er	Dis	co	unt	""" * (Impuesto / 100))),0.01)));"					
END;										
Value[3] := Value[2];										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
LineCount := LineCount + 1;										
END;										
END;										
										
//CSRM21102013										
"TotalNoSuj += ABS(SalesEntry.""Net Amount"");"										
END;										
END;										
END;										
LineCount := LineCount + 1;										
UNTIL SalesEntry.NEXT = 0;										
										
//CSPNT300816										
//CSPNT301116										
CLEAR(SalesEntry);										
"SalesEntry.SETRANGE(""Store No."",Transaction.""Store No."");"										
"SalesEntry.SETRANGE(""POS Terminal No."",Transaction.""POS Terminal No."");"										
"SalesEntry.SETRANGE(""Transaction No."",Transaction.""Transaction No."");"										
IF OrderByDepartment THEN										
"SalesEntry.SETCURRENTKEY(""Item Category Code"");"										
IF SalesEntry.FIND('-') THEN										
REPEAT										
"IF Item.GET(SalesEntry.""Item No."") THEN BEGIN"										
										
"IF (Item.""No."" = vProductoTelefonica1) OR (Item.""No."" = vProductoTelefonica2)"										
"OR (Item.""No."" = vProductoTelefonica3) OR (Item.""No."" = vProductoTelefonica4) THEN BEGIN"										
DSTR1 := '#C######################################';										
Value[1] := '';										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
DSTR1 := '    #L##############  #L################  ';										
Value[1] := 'Trans. Operador:';										
rRecargasElectronicas.RESET;										
//CSPNT280916										
"IF NOT Transaction.""Sale Is Return Sale"" THEN"										
"rRecargasElectronicas.SETRANGE(""Receipt No."",Transaction.""Receipt No."")"										
ELSE										
"rRecargasElectronicas.SETRANGE(""Receipt No."",Transaction.""Retrieved from Receipt No."");"										
IF rRecargasElectronicas.FINDFIRST THEN BEGIN										
"Value[2] := rRecargasElectronicas.""Transaccion Operador"";"										
"vTelefono := rRecargasElectronicas.""Numero Telefono"";"										
END										
ELSE BEGIN										
Value[2] := 'NO TRANS OPERADOR';										
vTelefono := '';										
END;										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
//CSPNT270216										
DSTR1 := '    #L##############  #L################  ';										
Value[1] := 'Telefono:';										
//CSPNT280916										
Value[2] := vTelefono;										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
//CSPNT250416										
LineCount := LineCount + 3;										
END;										
END;										
UNTIL SalesEntry.NEXT = 0;										
										
//CSPNT071215 Imprimir descuento tender type al final de las lineas de productos										
IF NOT IsInvoice THEN BEGIN										
"//CSPNT200116   PrintTotal(Transaction,Tray,3);"										
END										
ELSE BEGIN										
PeriodicDiscountInfoTEMP.RESET;										
"PeriodicDiscountInfoTEMP.SETCURRENTKEY(Status,Type);"										
//CSPNT051215										
"PeriodicDiscountInfoTEMP.SETRANGE(""Offer Type"",PeriodicDiscountInfoTEMP.""Offer Type""::""Tender Type"");"										
NodeName[1] := 'Total Text';										
NodeName[2] := 'Total Amount';										
IF PeriodicDiscountInfoTEMP.FINDSET THEN BEGIN										
//CSPNT071215 Imprimir Linea en blanco...										
"DSTR1 :=     COPYSTR('                     ',1);"										
Value[1] := '';										
//CSPNT070716										
IF NOT (Transaction.NotaRemision) THEN										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
LineCount := LineCount + 1;										
										
TotalAmtForSummary := Subtotal;										
REPEAT										
"IF (GenPosFunc.""Print Disc/Cpn Info on Slip"" ="										
"GenPosFunc.""Print Disc/Cpn Info on Slip""::""Detail for each line and Sub-total"") AND"										
(PeriodicDiscountInfoTEMP.Description <> Text024) THEN										
"PeriodicDiscountInfoTEMP.""Discount Amount Value"" := 0;"										
"IF PeriodicDiscountInfoTEMP.""Discount Amount Value"" <> 0 THEN BEGIN"										
//CSPNT051215										
DSTR1 := '             #L#########################            #R####                             ';										
Value[1] := PeriodicDiscountInfoTEMP.Description;										
//CSPNT030316										
"IF (Transaction.""No. Serie NCF"" = POSTerminal.""No. Serie NCF Credito Fiscal"") OR"										
"(Transaction.""No. Serie NCF"" = POSTerminal.""No. Serie NCF Nota de Credito"") THEN BEGIN"										
"Value[2] := POSFunctions.FormatAmount(ROUND(-PeriodicDiscountInfoTEMP.""Discount Amount Value"" / (1 + (Impuesto / 100))"	",0."	01)	);							
"Value[3] := POSFunctions.FormatAmount(ROUND(-PeriodicDiscountInfoTEMP.""Discount Amount Value"" / (1 + (Impuesto / 100))"	",0."	01)	);							
END										
ELSE BEGIN										
"Value[2] := POSFunctions.FormatAmount(-PeriodicDiscountInfoTEMP.""Discount Amount Value"");"										
"Value[3] := POSFunctions.FormatAmount(-PeriodicDiscountInfoTEMP.""Discount Amount Value"");"										
END;										
//CSPNT070716										
IF NOT (Transaction.NotaRemision) THEN										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
"AddPrintLine(800,2,NodeName,Value,DSTR1,FALSE,FALSE,FALSE,FALSE,Tray); //LS7.1-02"										
"TotalAmtForSummary := TotalAmtForSummary + PeriodicDiscountInfoTEMP.""Discount Amount Value"";"										
END;										
LineCount := LineCount + 1;										
UNTIL PeriodicDiscountInfoTEMP.NEXT = 0;										
END;										
END;										
										
END;										
										
"LineCount := LineCount + PrintSPOSalesInfo(Transaction, Tray);"										
"// CSPNT250915 Separador despues de lineas de productos, se le quito a la factura (se agrego 2 espacios en blanco en cambio)."										
IF NOT IsInvoice THEN BEGIN										
IF LineCount > 0 THEN										
PrintSeperator(Tray);										
END										
ELSE BEGIN										
"//CSPNT250915  FOR, teniendo el numero de LineCount, se imprime el resto de lineas en blanco"										
//para que las SUMA se impriman donde se debe										
//CSPNT010216 31-Linecount										
//CSPNT070716										
IF (Transaction.NotaRemision) THEN										
//CSPNT260716										
LineCount := LineCountRemision + 2;										
FOR iContador := 1 TO (28-LineCount) DO BEGIN										
DSTR1 := '     ';										
Value[1] := '';										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
END;										
//CSPNT010216										
rPosTerminal.RESET;										
"rPosTerminal.SETRANGE(""Store No."",Transaction.""Store No."");"										
"rPosTerminal.SETRANGE(""No."",Transaction.""POS Terminal No."");"										
rPosTerminal.FINDFIRST;										
"IF (Transaction.""No. Serie NCF"" = rPosTerminal.""No. Serie NCF Nota de Credito"") THEN BEGIN"										
"DSTR1 := COPYSTR('                                                  ',1);"										
Value[1] := '';										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
//CSPNT260216										
"IF (Transaction.""No. Serie NCF"" = rPosTerminal.""No. Serie NCF Credito Fiscal"") THEN BEGIN"										
//CSPNT210416										
FOR iContador := 1 TO 1 DO BEGIN										
DSTR1 := '     ';										
Value[1] := '';										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
END;										
										
//CSPNTTEST Lineas de factura totales										
{DSTR1 := '#L########################';										
Value[1] := POSFunctions.FormatAmount(LineCount);										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));}"										
										
//CSPNT301015										
"IncExpEntry.SETRANGE(""Store No."",Transaction.""Store No."");"										
"IncExpEntry.SETRANGE(""POS Terminal No."",Transaction.""POS Terminal No."");"										
"IncExpEntry.SETRANGE(""Transaction No."",Transaction.""Transaction No."");"										
IF IncExpEntry.FIND('-') THEN										
vIncomeExpense := TRUE										
ELSE										
vIncomeExpense := FALSE;										
										
//Sub-Total										
//CSPNT301015										
//CSPNT201115IF NOT IsInvoice AND NOT vIncomeExpense THEN BEGIN										
"IF NOT IsInvoice AND (Transaction.Ticket OR Transaction.""Doc. Devolucion"") AND NOT vIncomeExpense THEN BEGIN"										
DSTR1 := '#L################## #R#################';    //CSRG15102013										
Value[1] := TextSubTotal;										
"IF NOT Transaction.""Sale Is Return Sale"" THEN BEGIN"										
//CSPNT300816										
"IF (Item.""No."" = vProductoTelefonica1) OR (Item.""No."" = vProductoTelefonica2)"										
"OR (Item.""No."" = vProductoTelefonica3) OR (Item.""No."" = vProductoTelefonica4) THEN"										
"Value[2] := '$' + POSFunctions.FormatAmount(-Transaction.""Gross Amount"" + Transaction.""Total Discount"" - vCESC)"										
ELSE										
//CSPNT301116										
"Value[2] := '$' + POSFunctions.FormatAmount(-Transaction.""Gross Amount"" + Transaction.""Total Discount"" - vCESC);"										
"//Value[2] := '$' + FORMAT(TotalVentG + TotalVentE + TotalNoSuj,0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END										
"ELSE IF Transaction.""Sale Is Return Sale"" AND"										
"(Transaction.""No. Serie NCF"" = POSTerminal.""No. Serie NCF Nota de Credito"") THEN BEGIN"										
"Value[2] := '$' + POSFunctions.FormatAmount(-Transaction.""Gross Amount"" + Transaction.""Total Discount"");"										
"//Value[2] := '$' + FORMAT(TotalVentG + TotalVentE + TotalNoSuj,0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END										
ELSE BEGIN										
"//Value[2] := '('+'$'+ POSFunctions.FormatAmount(-Transaction.""Gross Amount"" + Transaction.""Total Discount"")+ ')';//CSRG151020"	13									
//CSPNT300816										
"IF (Item.""No."" = vProductoTelefonica1) OR (Item.""No."" = vProductoTelefonica2)"										
"OR (Item.""No."" = vProductoTelefonica3) OR (Item.""No."" = vProductoTelefonica4) THEN"										
//CSPNT280916										
"Value[2] := '(' + '$' + POSFunctions.FormatAmount(Transaction.""Gross Amount"" - Transaction.""Total Discount"" - vCESC)+ ')'"										
ELSE										
//CSPNT301116										
"Value[2] := '(' + '$' + POSFunctions.FormatAmount(Transaction.""Gross Amount"" - Transaction.""Total Discount"" - vCESC)+ ')';//"	CSR	G15	10	201	3					
"//Value[2] := '(' + '$' + FORMAT(TotalVentG + TotalVentE + TotalNoSuj,0,'<Integer Thousand><Decimals,3>') + ')';"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
END;										
CLEAR(Value);										
										
//CSPNT300816										
//CSPNT301116										
CLEAR(SalesEntry);										
"SalesEntry.SETRANGE(""Store No."",Transaction.""Store No."");"										
"SalesEntry.SETRANGE(""POS Terminal No."",Transaction.""POS Terminal No."");"										
"SalesEntry.SETRANGE(""Transaction No."",Transaction.""Transaction No."");"										
IF OrderByDepartment THEN										
"SalesEntry.SETCURRENTKEY(""Item Category Code"");"										
IF SalesEntry.FIND('-') THEN										
REPEAT										
"IF Item.GET(SalesEntry.""Item No."") THEN BEGIN"										
"IF (Item.""No."" = vProductoTelefonica1) OR (Item.""No."" = vProductoTelefonica2)"										
"OR (Item.""No."" = vProductoTelefonica3) OR (Item.""No."" = vProductoTelefonica4) THEN BEGIN"										
"IF NOT IsInvoice AND (Transaction.Ticket OR Transaction.""Doc. Devolucion"") AND NOT vIncomeExpense THEN BEGIN"										
DSTR1 := '#L################## #R#################';										
Value[1] := 'Impuesto CESC:';										
"IF NOT Transaction.""Sale Is Return Sale"" THEN BEGIN"										
Value[2] := '$' + POSFunctions.FormatAmount(vCESC);										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END										
ELSE BEGIN										
Value[2] := '(' + '$' + POSFunctions.FormatAmount(vCESC)+ ')';										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
END;										
CLEAR(Value);										
END;										
END;										
UNTIL SalesEntry.NEXT = 0;										
										
//CSPNT301015										
//CSPNT201115IF NOT IsInvoice AND NOT vIncomeExpense THEN BEGIN										
"IF NOT IsInvoice AND (Transaction.Ticket OR Transaction.""Doc. Devolucion"") AND NOT vIncomeExpense THEN BEGIN"										
DSTR1 := '#L################          #R#########';     //CSRG15102013										
"IF Transaction.""Total Discount"" <> 0 THEN BEGIN"										
Value[1] := Text043;										
"Value[2] := POSFunctions.FormatAmount(-Transaction.""Total Discount"");"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
END;										
END;										
CLEAR(Value);										
										
//Imprime Linea de Descuento total										
IF IsInvoice THEN BEGIN										
"IF RetailSetup.""Ancho Columnas""=RetailSetup.""Ancho Columnas""::""48"" THEN"										
DSTR1 := '             #L################   #R#######'										
ELSE										
DSTR1 := '                                                    #L################     #R#######';										
										
"IF Transaction.""Total Discount"" <> 0 THEN BEGIN"										
Value[1] := 'Total Disc:';										
"IF (Transaction.""No. Serie NCF"" = POSTerminal.""No. Serie NCF Nota de Credito"")  THEN"										
"Value[2] := '$'+POSFunctions.FormatAmount(-1*(Transaction.""Total Discount""/ (1 + (Impuesto / 100))))"										
"//CSPNT260216      Value[2] := '$'+POSFunctions.FormatAmount(-1*(Transaction.""Total Discount"" - (Transaction.""Total Discount"" * (I"	mpu	est	o	/ 1	00))))					
"ELSE IF (Transaction.""No. Serie NCF"" = POSTerminal.""No. Serie NCF Credito Fiscal"") THEN"										
"Value[2] := '$'+POSFunctions.FormatAmount(-Transaction.""Total Discount""/ (1 + (Impuesto / 100)))"										
"//CSPNT260216      Value[2] := '$'+POSFunctions.FormatAmount(-Transaction.""Total Discount"" + (Transaction.""Total Discount"" * (Impu"	est	o /	1	00)	))					
ELSE										
"Value[2] := '$'+POSFunctions.FormatAmount(-Transaction.""Total Discount"");"										
										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
END;										
END;										
CLEAR(Value);										
										
//CSPNT301015										
//CSPNT201115IF NOT IsInvoice AND NOT vIncomeExpense THEN BEGIN										
"IF NOT IsInvoice AND (Transaction.Ticket OR Transaction.""Doc. Devolucion"") AND NOT vIncomeExpense THEN BEGIN"										
//Ventas Gravadas										
DSTR1 := '#L################## #R#################';       //CSRG15102013										
Value[1] := TextTotVentasG;										
"IF NOT Transaction.""Sale Is Return Sale"" THEN BEGIN"										
"Value[2] := '$' + FORMAT(TotalVentG,0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END										
"ELSE IF Transaction.""Sale Is Return Sale"" THEN BEGIN"										
"Value[2] := '(' + '$' + FORMAT(TotalVentG,0,'<Integer Thousand><Decimals,3>') + ')';"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
END										
ELSE IF IsInvoice THEN BEGIN										
"//CSPNT250915 SUMAS, mostras las sumas de ventas exentas y gravadas en una sola linea"										
{										
//Ventas Gravadas										
"IF RetailSetup.""Ancho Columnas""=RetailSetup.""Ancho Columnas""::""48"" THEN"										
DSTR1 := '             #L################   #R#######'										
ELSE										
DSTR1 := '                                                    #L################     #R#######';										
										
Value[1] := TextTotVentasG;										
"IF NOT Transaction.""Sale Is Return Sale"" THEN BEGIN"										
"Value[2] := '$' + FORMAT(TotalVentG,0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END										
//CSRM25092013										
ELSE										
"IF (Transaction.""Sale Is Return Sale"") AND"										
"(Transaction.""No. Serie NCF"" = POSTerminal.""No. Serie NCF Nota de Credito"") THEN BEGIN"										
"Value[2] := '$' + FORMAT(TotalVentG,0,'<Integer Thousand><Decimals,3>') ;"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END										
ELSE										
BEGIN										
"Value[2] := '(' + '$' + FORMAT(TotalVentG,0,'<Integer Thousand><Decimals,3>') + ')';"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
//CSRM25092013										
}										
										
//CSPNT280916										
//CSPNT290916										
//CSPNT301116										
CLEAR(SalesEntry);										
"SalesEntry.SETRANGE(""Store No."",Transaction.""Store No."");"										
"SalesEntry.SETRANGE(""POS Terminal No."",Transaction.""POS Terminal No."");"										
"SalesEntry.SETRANGE(""Transaction No."",Transaction.""Transaction No."");"										
IF OrderByDepartment THEN										
"SalesEntry.SETCURRENTKEY(""Item Category Code"");"										
IF SalesEntry.FIND('-') THEN										
REPEAT										
"IF Item.GET(SalesEntry.""Item No."") THEN BEGIN"										
"IF (Item.""No."" = vProductoTelefonica1) OR (Item.""No."" = vProductoTelefonica2)"										
"OR (Item.""No."" = vProductoTelefonica3) OR (Item.""No."" = vProductoTelefonica4) THEN BEGIN"										
DSTR1 := '                                                                  #R######## #R########';										
Value[1] := 'CESC:';										
Value[2] := '$' + FORMAT(vCESC);										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
END;										
UNTIL SalesEntry.NEXT = 0;										
										
//CSPNT021015										
//FOOTER1										
"IF RetailSetup.""Ancho Columnas""=RetailSetup.""Ancho Columnas""::""48"" THEN"										
//CSPNT190116    DSTR1 := '                                                                    #R######   #R######';										
//CSPNT280416										
DSTR1 := '      #L######################################                    #R######## #R########';										
//CSPNT190116										
Value[1] := Store.Name;										
										
"IF NOT Transaction.""Sale Is Return Sale"" THEN BEGIN"										
//CSPNT190116										
//CSPNT010716										
//CSPNT150816										
"Value[2] := '$' + FORMAT(TotalVentE,0,'<Integer Thousand><Decimals,3>');"										
IF (Transaction.NotaRemision) THEN BEGIN										
rRemisionLine.RESET;										
"rRemisionLine.SETRANGE(""Receipt No."", Transaction.""Receipt No."");"										
IF rRemisionLine.FINDSET THEN BEGIN										
"rRemisionLine.CALCSUMS(Amount,""Amount Including VAT"");"										
"vMontoRemision := ROUND(rRemisionLine.Amount,0.01);"										
"vMontoIvaRemision := ROUND(rRemisionLine.""Amount Including VAT""-rRemisionLine.Amount,0.01);"										
"vMontoTotalRemision := ROUND(rRemisionLine.""Amount Including VAT"",0.01);"										
END;										
//CSPNT150816										
"IF Transaction.""Customer No."" = 'C000002' THEN BEGIN"										
"//CSPNT030916Value[3] := '$' + FORMAT(vMontoRemision,0,'<Integer Thousand><Decimals,3>');"										
"Value[3] := '$' + FORMAT(ROUND(vInfoAmountTotal,0.01),0,'<Integer Thousand><Decimals,3>');"										
END										
ELSE BEGIN										
"IF (Transaction.""No. Serie NCF"" = POSTerminal.""No. Serie NCF Cons. Final"") THEN"										
//CSPNT030916										
"Value[3] := '$' + FORMAT(ROUND(-vInfoAmountTotal,0.01),0,'<Integer Thousand><Decimals,3>')"										
ELSE										
"//CSPNT030916Value[3] := '$' + FORMAT(ROUND(-TransInfoEntry.""Info. Amt.""/1.13,0.01),0,'<Integer Thousand><Decimals,3>');"										
"Value[3] := '$' + FORMAT(ROUND(-vInfoAmountTotal,0.01),0,'<Integer Thousand><Decimals,3>');"										
END;										
END										
ELSE BEGIN										
"Value[3] := '$' + FORMAT(TotalVentG,0,'<Integer Thousand><Decimals,3>');"										
END;										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END										
//CSRM25092013										
"ELSE IF (Transaction.""Sale Is Return Sale"") AND"										
"(Transaction.""No. Serie NCF"" = POSTerminal.""No. Serie NCF Nota de Credito"") THEN BEGIN"										
"//CSPNT071015    Value[2] := '$' + FORMAT(TotalVentG,0,'<Integer Thousand><Decimals,3>') ;"										
//CSPNT190116										
"Value[2] := '$' + FORMAT(TotalVentE,0,'<Integer Thousand><Decimals,3>');"										
"Value[3] := '$' + FORMAT(TotalVentG,0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END										
ELSE  BEGIN										
//CSPNT190116										
"Value[3] := '(' + '$' + FORMAT(TotalVentG,0,'<Integer Thousand><Decimals,3>') + ')';"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
END;										
										
//TOTAL IVA PARA LAS FACTURAS DE CREDITO FISCAL										
//FOOTER2										
//CSPNT021015 se agrega las ventas no sujetas para facturas de consumidor final										
"IF (Transaction.""No. Serie NCF"" = POSTerminal.""No. Serie NCF Credito Fiscal"") OR"										
"(Transaction.""No. Serie NCF"" = POSTerminal.""No. Serie NCF Nota de Credito"") OR"										
//CSPNT021015										
"(Transaction.""No. Serie NCF"" = POSTerminal.""No. Serie NCF Cons. Final"") THEN BEGIN"										
IF IsInvoice THEN BEGIN										
"IF RetailSetup.""Ancho Columnas""=RetailSetup.""Ancho Columnas""::""48"" THEN"										
//CSPNT180116      DSTR1 := '                                                                               #R######'										
//CSPNT280416										
DSTR1 := '      #L######################################                               #R########'										
ELSE										
DSTR1 := '                                                   #L################     #R#######';										
										
"Value[1] :=  TextCaja + Transaction.""POS Terminal No."";"										
										
//CSPNT260915    Value[1] := 'TOTAL IVA:';										
"IF NOT Transaction.""Sale Is Return Sale"" AND (Transaction.""No. Serie NCF"" = POSTerminal.""No. Serie NCF Cons. Final"") THEN BEGI"	N									
//CSPNT180116										
"Value[2] := '$' + FORMAT(TotalNoSuj,0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END										
"ELSE IF NOT Transaction.""Sale Is Return Sale"" THEN BEGIN"										
//CSPNT180116										
//CSPNT010716										
IF (Transaction.NotaRemision) THEN BEGIN										
//CSPNT150816										
"IF Transaction.""Customer No."" = 'C000002' THEN"										
"//CSPNT030916Value[2] := '$' + FORMAT(vMontoIvaRemision,0,'<Integer Thousand><Decimals,3>')"										
"Value[2] := '$' + FORMAT(ROUND(-vInfoAmountTotal*0.13,0.01),0,'<Integer Thousand><Decimals,3>')"										
ELSE										
"//CSPNT030916Value[2] := '$' + FORMAT(ROUND((-TransInfoEntry.""Info. Amt.""/1.13)*0.13,0.01),0,'<Integer Thousand><Decimal"	"s,3"	>')	;							
"Value[2] := '$' + FORMAT(ROUND(-vInfoAmountTotal*0.13,0.01),0,'<Integer Thousand><Decimals,3>');"										
END										
ELSE BEGIN										
"Value[2] := '$' + FORMAT(TotalIVA,0,'<Integer Thousand><Decimals,3>');"										
//Value[2] := '$' + FORMAT(TotalIVA);										
END;										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END										
										
//CSRM25092013										
"ELSE IF (Transaction.""Sale Is Return Sale"") AND"										
"((Transaction.""No. Serie NCF"" = POSTerminal.""No. Serie NCF Nota de Credito"")) THEN BEGIN"										
//CSPNT180116										
"Value[2] := '$' + FORMAT(TotalIVA,0,'<Integer Thousand><Decimals,3>') ;"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
//CSRM25092013										
END;										
END;										
										
//Sub-Total										
//FOOTER3										
IF IsInvoice THEN BEGIN										
"IF RetailSetup.""Ancho Columnas""=RetailSetup.""Ancho Columnas""::""48"" THEN"										
//CSPNT180116    DSTR1 := '                                                                               #R######'										
DSTR1 := '      #L######################################                               #R########'										
ELSE										
DSTR1 := '                                                    #L################     #R#######';										
										
//CSPNT190116 Imprimir nombre de vendedor(es)										
"SalesEntry.SETRANGE(""Transaction No."",Transaction.""Transaction No."");"										
IF SalesEntry.FIND('-') THEN										
jContador := 1;										
REPEAT										
vAgregarSalesPersonNo := 0;										
FOR iContador := 1 TO 30 DO BEGIN										
"IF SalesEntry.""Sales Staff"" = vSalesPersonNo[iContador] THEN"										
vAgregarSalesPersonNo += 1;										
END;										
IF vAgregarSalesPersonNo=0 THEN BEGIN										
"vSalesPersonNo[jContador] := SalesEntry.""Sales Staff"";"										
jContador += 1;										
rStaff1.RESET;										
"rStaff1.SETRANGE(ID,SalesEntry.""Sales Staff"");"										
IF rStaff1.FIND('-') THEN BEGIN										
rSalesPerson.RESET;										
"rSalesPerson.SETRANGE(Code,rStaff1.""Sales Person"");"										
rSalesPerson.FIND('-');										
REPEAT										
vVendedor := vVendedor + rStaff1.ID + ' ';										
UNTIL rSalesPerson.NEXT=0;										
END;										
END;										
UNTIL SalesEntry.NEXT = 0;										
										
//CSPNT180116										
//CSPNT220116										
"Value[1] := 'Cajero: ' + Transaction.""Staff ID"" + '  Vendedor: ' + vVendedor;"										
										
//CSPNT260915  Value[1] := TextSubTotal;										
//CSPNT021015 Se agrega ventas exentas para factura de consumidor final										
"IF NOT Transaction.""Sale Is Return Sale"" AND (Transaction.""No. Serie NCF"" = POSTerminal.""No. Serie NCF Cons. Final"") THEN BEGIN"										
//CSPNT180116    DSTR1 := '                                                                    #R######           ';										
//CSPNT280416										
DSTR1 := '      #L######################################                     #R########          ';										
//CSPNT220116										
"Value[1] := 'Cajero: ' + Transaction.""Staff ID"" + '  Vendedor: ' + vVendedor;"										
"Value[2] := '$' + FORMAT(TotalVentE,0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END										
"ELSE IF NOT Transaction.""Sale Is Return Sale"" THEN BEGIN"										
//CSPNT180116										
//CSPNT290916										
"IF (Item.""No."" = vProductoTelefonica1) OR (Item.""No."" = vProductoTelefonica2)"										
"OR (Item.""No."" = vProductoTelefonica3) OR (Item.""No."" = vProductoTelefonica4) THEN"										
"Value[2] := '$' + FORMAT(TotalVentG + TotalIVA + vCESC,0,'<Integer Thousand><Decimals,3>')"										
ELSE										
//CSPNT301116										
"Value[2] := '$' + FORMAT(TotalVentG + TotalIVA + vCESC,0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END										
//CSRM25092013										
"ELSE IF Transaction.""Sale Is Return Sale"" AND"										
"(Transaction.""No. Serie NCF"" = POSTerminal.""No. Serie NCF Nota de Credito"") THEN BEGIN"										
//CSPNT180116										
//CSPNT290916										
"IF (Item.""No."" = vProductoTelefonica1) OR (Item.""No."" = vProductoTelefonica2)"										
"OR (Item.""No."" = vProductoTelefonica3) OR (Item.""No."" = vProductoTelefonica4) THEN"										
"Value[2] :='$' + FORMAT(TotalVentG + TotalIVA - vCESC,0,'<Integer Thousand><Decimals,3>')"										
ELSE										
//CSPNT301116										
"Value[2] :='$' + FORMAT(TotalVentG + TotalIVA - vCESC,0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END										
ELSE BEGIN										
//CSPNT180116										
"Value[2] := '(' + '$' + FORMAT(TotalVentG + TotalIVA,0,'<Integer Thousand><Decimals,3>') + ')';"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END										
//CSRM25092013										
END;										
										
CLEAR(TotalPercepcion);										
CLEAR(TotalRetencion);										
//CSPNT180116										
"TotalPercepcion:= ABS(Transaction.""Percepcion Amount"");"										
"TotalRetencion:= ABS(Transaction.""Retencion Amount"");"										
										
//CSRM07102013										
"IF (Transaction.""No. Serie NCF"" = POSTerminal.""No. Serie NCF Credito Fiscal"") THEN BEGIN"										
"//CSPNT180116  IF ABS(Transaction.""Percepcion Amount"") > 0 THEN BEGIN"										
"{    TotalPercepcion:= ABS(Transaction.""Percepcion Amount"");"										
"IF RetailSetup.""Ancho Columnas""=RetailSetup.""Ancho Columnas""::""48"" THEN"										
DSTR1 := '             #L################   #R#######'										
ELSE										
DSTR1 := '                                                    #L################     #R#######';										
										
Value[1] := TextToPercepcion;										
"Value[2] := '$' + FORMAT(TotalPercepcion,0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END										
"ELSE IF ABS(Transaction.""Retencion Amount"") > 0 THEN BEGIN"										
"TotalRetencion:= ABS(Transaction.""Retencion Amount"");"										
"IF RetailSetup.""Ancho Columnas""=RetailSetup.""Ancho Columnas""::""48"" THEN"										
DSTR1 := '             #L################   #R#######'										
ELSE										
DSTR1 := '                                                    #L################     #R#######';										
										
Value[1] := TextToRetencion;										
"IF Transaction.""Sale Is Return Sale"" THEN"										
"Value[2] := '('+'$' + FORMAT(TotalRetencion,0,'<Integer Thousand><Decimals,3>')+')'"										
ELSE										
"Value[2] := '$' + FORMAT(TotalRetencion,0,'<Integer Thousand><Decimals,3>');"										
										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END										
}										
END										
"ELSE IF (Transaction.""No. Serie NCF"" = POSTerminal.""No. Serie NCF Cons. Final"") THEN BEGIN"										
//CSPNT021015 iva retenido se movio a footer 6										
"{    TotalRetencion:= ABS(Transaction.""Retencion Amount"");"										
"IF RetailSetup.""Ancho Columnas""=RetailSetup.""Ancho Columnas""::""48"" THEN"										
DSTR1 := '             #L################   #R#######'										
ELSE										
DSTR1 := '                                                    #L################     #R#######';										
										
Value[1] := ''+TextToRetencion;										
"IF Transaction.""Sale Is Return Sale"" THEN"										
"Value[2] := '('+'$' + FORMAT(TotalRetencion,0,'<Integer Thousand><Decimals,3>')+')'"										
ELSE										
"Value[2] := '$' + FORMAT(TotalRetencion,0,'<Integer Thousand><Decimals,3>');"										
										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));}"										
END										
"ELSE IF (Transaction.""No. Serie NCF"" = POSTerminal.""No. Serie NCF Nota de Credito"") THEN BEGIN"										
"TotalPercepcion:= ABS(Transaction.""Percepcion Amount"");"										
"IF RetailSetup.""Ancho Columnas""=RetailSetup.""Ancho Columnas""::""48"" THEN"										
//CSPNT071015										
//CSPNT280416										
DSTR1 := '                                                                             #R########'										
ELSE										
DSTR1 := '                                                    #L################     #R#######';										
										
//    Value[1] := TextToPercepcion;										
"Value[1] := '$' + FORMAT(TotalPercepcion,0,'<Integer Thousand><Decimals,3>');"										
"//CSPNT271015  PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
//CSRM07102013										
										
//Ventas Exentas										
//CSPNT301015										
//CSPNT201115IF NOT IsInvoice AND NOT vIncomeExpense THEN BEGIN										
"IF NOT IsInvoice AND (Transaction.Ticket OR Transaction.""Doc. Devolucion"") AND NOT vIncomeExpense THEN BEGIN"										
DSTR1 := '#L################## #R#################';       //CSRG15102013										
Value[1] := TextTotVentasE;										
"IF NOT Transaction.""Sale Is Return Sale"" THEN BEGIN"										
"Value[2] := '$' + FORMAT(TotalVentE,0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END										
"ELSE IF Transaction.""Sale Is Return Sale"" THEN BEGIN"										
"Value[2] := '(' + '$' + FORMAT(TotalVentE,0,'<Integer Thousand><Decimals,3>') + ')';"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
END										
ELSE IF IsInvoice THEN BEGIN										
"//CSPNT250915 ventas exentas, impresi¢n se mueve junto a ventas gravadas"										
"//CSPNT260915 ventas exentas, impresi¢n se agrega tambien despues de ventas no sujetas"										
"{  IF RetailSetup.""Ancho Columnas""=RetailSetup.""Ancho Columnas""::""48"" THEN"										
DSTR1 := '             #L################   #R#######'										
ELSE										
DSTR1 := '                                                    #L################     #R#######';										
										
Value[1] := TextTotVentasE;										
"IF NOT Transaction.""Sale Is Return Sale"" THEN BEGIN"										
"Value[2] := '$' + FORMAT(TotalVentE,0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END										
ELSE										
"IF Transaction.""Sale Is Return Sale"" AND"										
"(Transaction.""No. Serie NCF"" = POSTerminal.""No. Serie NCF Nota de Credito"") THEN BEGIN"										
"Value[2] := '$' + FORMAT(TotalVentE,0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END										
ELSE										
BEGIN										
"Value[2] := '(' + '$' + FORMAT(TotalVentE,0,'<Integer Thousand><Decimals,3>') + ')';"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
END;}										
//FOOTER4										
//CSPNT021015 ventas afectas agregadas para factura de consumidor final										
"IF RetailSetup.""Ancho Columnas""=RetailSetup.""Ancho Columnas""::""48"" THEN"										
//CSPNT130116										
//CSPNT150116										
//CSPNT280416										
DSTR1 := '      #L######################################                               #R########'										
ELSE										
DSTR1 := '                                                    #L################     #R#######';										
										
//CSPNT260915 total el letras se quita										
//CSPNT130116 total letras se agrega										
//SODICO NOTEXTO Imprime en letras el total de la factura										
//CSPNT180116										
IF IsInvoice THEN BEGIN										
"PaymEntry.SETRANGE(""Transaction No."",Transaction.""Transaction No."");"										
IF PaymEntry.FIND('-') THEN										
jContador := 1;										
REPEAT										
vAgregarSalesPersonNo := 0;										
FOR iContador := 1 TO 30 DO BEGIN										
TenderType.RESET;										
"TenderType.SETRANGE(Code,PaymEntry.""Tender Type"");"										
TenderType.FIND('-');										
IF TenderType.Description = vMediosPago[iContador] THEN										
vAgregarSalesPersonNo += 1;										
END;										
IF vAgregarSalesPersonNo=0 THEN BEGIN										
vMediosPago[jContador] := TenderType.Description;										
jContador += 1;										
END;										
UNTIL PaymEntry.NEXT = 0;										
Value[1] := 'Medios pago: ';										
FOR iContador := 1 TO jContador DO BEGIN										
Value[1] := Value[1] + vMediosPago[iContador] + ' ';										
END;										
END;										
										
{  IF IsInvoice THEN BEGIN										
"FormatNoText1(Texto,ABS(Transaction.Payment));"										
TotalLetras := TotFac;										
//CSPNT130116										
//CSPNT150116										
{  Longitud := STRLEN(TotalLetras);										
IF Longitud > 44 THEN BEGIN										
"Texto1:= COPYSTR(TotalLetras,1,44);"										
DSTR1 := '#L##########################################';										
Value[1] := Texto1;										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
CLEAR(Value);										
"Texto2:= COPYSTR(TotalLetras,45,Longitud);"										
DSTR1 := '#L##########################################';										
Value[1] := Texto2;										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END										
ELSE BEGIN										
}										
//    DSTR1 := '#L##########################################';										
Value[1] :=TotalLetras;										
"//    PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
//  END										
END;										
}										
"IF NOT Transaction.""Sale Is Return Sale"" AND (Transaction.""No. Serie NCF"" = POSTerminal.""No. Serie NCF Cons. Final"") THEN BEGIN"										
//CSPNT130116										
"Value[2] := '$' + FORMAT(TotalVentG,0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END										
//CSPNT271015 iva percibido para credito fiscal y nota de credito										
ELSE BEGIN										
//CSPNT130116										
"Value[2] := '$' + FORMAT(TotalPercepcion,0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
END;										
										
//Ventas No Sujetas										
//CSPNT301015										
//CSPNT201115IF NOT IsInvoice AND NOT vIncomeExpense THEN BEGIN										
"IF NOT IsInvoice AND (Transaction.Ticket OR Transaction.""Doc. Devolucion"") AND NOT vIncomeExpense THEN BEGIN"										
DSTR1 := '#L################## #R#################';        //CSRG15102013										
Value[1] := TextVentNoSuj;										
"IF NOT Transaction.""Sale Is Return Sale"" THEN BEGIN"										
"Value[2] := '$' + FORMAT(TotalNoSuj,0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END										
"ELSE IF Transaction.""Sale Is Return Sale"" THEN BEGIN"										
"Value[2] := '(' + '$' + FORMAT(TotalNoSuj,0,'<Integer Thousand><Decimals,3>') + ')';"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
END										
//CSPNT260915 impresion ventas no sujetas agregada										
//FOOTER5										
ELSE IF IsInvoice THEN BEGIN										
"IF RetailSetup.""Ancho Columnas""=RetailSetup.""Ancho Columnas""::""48"" THEN"										
//CSPNT021015										
//CSPNT180116										
//CSPNT280416										
DSTR1 := '      #L######################################                               #R########'										
ELSE										
DSTR1 := '                                                    #L################     #R#######';										
										
//CSPNT150116										
//CSPNT180116  Value[1] := vDecimalesTextoFactura + ' DOLARES';										
IF IsInvoice THEN BEGIN										
"FormatNoText1(Texto,ABS(Transaction.Payment));"										
TotalLetras := TotFac;										
Value[1] :=TotalLetras;										
END;										
										
//CSPNT260915  Value[1] := TextVentNoSuj;										
//CSPNT021015										
"IF NOT Transaction.""Sale Is Return Sale"" AND (Transaction.""No. Serie NCF"" = POSTerminal.""No. Serie NCF Cons. Final"") THEN BEGIN"										
"Value[2] := '$' + FORMAT(TotalVentG + TotalIVA ,0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END										
"ELSE IF NOT Transaction.""Sale Is Return Sale"" THEN BEGIN"										
"Value[2] := '$' + FORMAT(TotalNoSuj,0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END										
"ELSE IF Transaction.""Sale Is Return Sale"" AND"										
"(Transaction.""No. Serie NCF"" = POSTerminal.""No. Serie NCF Nota de Credito"") THEN BEGIN"										
"Value[2] := '$' + FORMAT(TotalNoSuj,0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END										
ELSE BEGIN										
"Value[2] := '(' + '$' + FORMAT(TotalNoSuj,0,'<Integer Thousand><Decimals,3>') + ')';"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
										
//CSPNT260915 ventas exentas agregado										
//FOOTER6										
"IF RetailSetup.""Ancho Columnas""=RetailSetup.""Ancho Columnas""::""48"" THEN"										
//CSPNT021015										
//CSPNT180116    DSTR1 := '                                                                               #R######'										
//CSPNT280416										
DSTR1 := '      #L######################################                               #R########'										
ELSE										
DSTR1 := '                                                    #L################     #R#######';										
										
//CSPNT180116										
Value[1] := vDecimalesTextoFactura + ' DOLARES';										
										
//CSPNT021015 iva retenido para facturas de consumidor final										
"IF NOT Transaction.""Sale Is Return Sale"" AND (Transaction.""No. Serie NCF"" = POSTerminal.""No. Serie NCF Cons. Final"") THEN BEGIN"										
"Value[2] := '$' + FORMAT(TotalRetencion,0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END										
"ELSE IF NOT Transaction.""Sale Is Return Sale"" THEN BEGIN"										
"Value[2] := '$' + FORMAT(TotalVentE,0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END										
"ELSE IF Transaction.""Sale Is Return Sale"" AND"										
"(Transaction.""No. Serie NCF"" = POSTerminal.""No. Serie NCF Nota de Credito"") THEN BEGIN"										
"Value[2] := '$' + FORMAT(TotalVentE,0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END										
ELSE BEGIN										
"Value[2] := '(' + '$' + FORMAT(TotalVentE,0,'<Integer Thousand><Decimals,3>') + ')';"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
//CSPNT260915										
END;										
										
//TOTAL										
//FOOTER7										
//CSPNT301015										
//CSPNT201115IF NOT IsInvoice AND NOT vIncomeExpense THEN BEGIN										
"IF NOT IsInvoice AND (Transaction.Ticket OR Transaction.""Doc. Devolucion"") AND NOT vIncomeExpense THEN BEGIN"										
//CSPNT261015										
DSTR1 := '#L##############           #R###########';         //CSRG15102013										
Value[1] := TextTotal;										
"IF NOT Transaction.""Sale Is Return Sale"" THEN BEGIN"										
"Value[2] := '$' + FORMAT(TotalVentG + TotalVentE + TotalNoSuj,0,'<Integer Thousand><Decimals,3>');"										
//CSPNT261015										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE)); //CSRG15102013 BOLD"										
END										
"ELSE IF Transaction.""Sale Is Return Sale""  THEN BEGIN"										
"Value[2] :='$' + FORMAT(TotalVentG + TotalVentE + TotalNoSuj,0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
END										
//CSPNT260915 total movido a la derecha de la factura										
ELSE IF IsInvoice THEN BEGIN										
"IF RetailSetup.""Ancho Columnas""=RetailSetup.""Ancho Columnas""::""48"" THEN"										
//CSPNT021015        DSTR1 := '             #L################   #R#######'										
//CSPNT180116    DSTR1 := '                                                                               #R######'										
//CSPNT180416										
DSTR1 := '                                                                             #R########'										
ELSE										
DSTR1 := '                                                    #L############         #R#######';										
										
//CSPNT260915  Value[1] := TextTotal;										
"IF NOT Transaction.""Sale Is Return Sale"" THEN BEGIN"										
//CSPNT260116										
//CSPNT290916										
"IF (Transaction.""No. Serie NCF"" = POSTerminal.""No. Serie NCF Cons. Final"") THEN BEGIN"										
Value[1] := '$' + FORMAT(TotalVentG + TotalIVA + TotalVentE + TotalNoSuj + TotalPercepcion										
"- TotalRetencion ,0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END										
ELSE BEGIN										
"IF (Item.""No."" = vProductoTelefonica1) OR (Item.""No."" = vProductoTelefonica2)"										
"OR (Item.""No."" = vProductoTelefonica3) OR (Item.""No."" = vProductoTelefonica4) THEN"										
Value[1] := '$' + FORMAT(TotalVentG + TotalIVA + TotalVentE + TotalNoSuj + TotalPercepcion										
"- TotalRetencion + vCESC,0,'<Integer Thousand><Decimals,3>')"										
ELSE										
Value[1] := '$' + FORMAT(TotalVentG + TotalIVA + TotalVentE + TotalNoSuj + TotalPercepcion										
//CSPNT301116										
"- TotalRetencion + vCESC,0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
END										
"ELSE IF Transaction.""Sale Is Return Sale"" AND"										
"(Transaction.""No. Serie NCF"" = POSTerminal.""No. Serie NCF Nota de Credito"") THEN BEGIN"										
//CSPNT290916										
"IF (Item.""No."" = vProductoTelefonica1) OR (Item.""No."" = vProductoTelefonica2)"										
"OR (Item.""No."" = vProductoTelefonica3) OR (Item.""No."" = vProductoTelefonica4) THEN"										
Value[1] := '$' + FORMAT(TotalVentG + TotalIVA + TotalVentE + TotalNoSuj + TotalPercepcion										
"- TotalRetencion - vCESC,0,'<Integer Thousand><Decimals,3>')"										
ELSE										
Value[1] := '$' + FORMAT(TotalVentG + TotalIVA + TotalVentE + TotalNoSuj + TotalPercepcion										
//CSPNT301116										
"- TotalRetencion - vCESC,0,'<Integer Thousand><Decimals,3>') ;"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END										
ELSE BEGIN										
Value[1] := '(' + '$' + FORMAT(TotalVentG + TotalIVA +										
"TotalVentE + TotalNoSuj + TotalPercepcion - TotalRetencion,0,'<Integer Thousand><Decimals,3>') + ')';"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
END;										
//CSPNT260915 total el letras se quita										
{										
//SODICO NOTEXTO Imprime en letras el total de la factura										
IF IsInvoice THEN BEGIN										
										
"FormatNoText1(Texto,ABS(Transaction.Payment));"										
TotalLetras:= 'SON: ' + TotFac;										
Longitud := STRLEN(TotalLetras);										
IF Longitud > 44 THEN BEGIN										
"Texto1:= COPYSTR(TotalLetras,1,44);"										
DSTR1 := '#L##########################################';										
Value[1] := Texto1;										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
CLEAR(Value);										
										
"Texto2:= COPYSTR(TotalLetras,45,Longitud);"										
DSTR1 := '#L##########################################';										
Value[1] := Texto2;										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END										
ELSE										
BEGIN										
DSTR1 := '#L##########################################';										
Value[1] :=TotalLetras;										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END										
END;}										
										
"//CSPNT180116IF (totalCustItemDisc <> 0) OR (Transaction.""Customer Discount"" <> 0) THEN"										
//CSPNT180116  PrintSeperator(Tray);										
										
"IncExpEntry.SETRANGE(""Store No."",Transaction.""Store No."");"										
"IncExpEntry.SETRANGE(""POS Terminal No."",Transaction.""POS Terminal No."");"										
"IncExpEntry.SETRANGE(""Transaction No."",Transaction.""Transaction No."");"										
IF IncExpEntry.FIND('-') THEN BEGIN										
REPEAT										
"IncExpAcc.GET(IncExpEntry.""Store No."",IncExpEntry.""No."");"										
DSTR1 := '#L#################### #N############';										
Value[1] := IncExpAcc.Description;										
Value[2] := POSFunctions.FormatAmount(-IncExpEntry.Amount);										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
"IF IncExpAcc.""Slip Text 1"" <> '' THEN"										
"PrintLine(Tray,IncExpAcc.""Slip Text 1"");"										
"IF IncExpAcc.""Slip Text 2"" <> '' THEN"										
"PrintLine(Tray,IncExpAcc.""Slip Text 2"");"										
"TransInfoEntry.SETRANGE(""Store No."",Transaction.""Store No."");"										
"TransInfoEntry.SETRANGE(""POS Terminal No."",Transaction.""POS Terminal No."");"										
"TransInfoEntry.SETRANGE(""Transaction No."",Transaction.""Transaction No."");"										
"TransInfoEntry.SETRANGE(""Transaction Type"",TransInfoEntry.""Transaction Type""::""Income/Expense Entry"");"										
"TransInfoEntry.SETRANGE(""Line No."",IncExpEntry.""Line No."");"										
"PrintTransInfoCode(TransInfoEntry,Tray,FALSE);"										
UNTIL IncExpEntry.NEXT = 0;										
PrintSeperator(Tray);										
END;										
										
{										
IF NOT IsInvoice THEN BEGIN										
//CONSISA Imprimir nombre Cajero...										
rStaff1.RESET;										
"IF rStaff1.GET(SalesEntry.""Staff ID"") THEN BEGIN"										
DSTR1 := '#C######################################';										
"Value[1] := TextAtencion + ' ' + rStaff1.""Name on Receipt"";"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
//Imprimir Linea en blanco...										
"DSTR1 :=     COPYSTR('                     ',1);"										
Value[1] := '';										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
}										
//END;										
IF NOT IsInvoice THEN BEGIN										
//CONSISA Imprimir nombre Cajero...										
rStaff1.RESET;										
"rStaff1.SETRANGE(ID,SalesEntry.""Staff ID"");"										
IF rStaff1.FINDFIRST() THEN BEGIN										
DSTR1 := '  #L####################################';										
"Value[1] := 'Cajero:' + ' ' + rStaff1.""Name on Receipt"";"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
										
//CSPNT061015 Imprimir nombre de vendedor(es)										
"SalesEntry.SETRANGE(""Transaction No."",Transaction.""Transaction No."");"										
IF SalesEntry.FIND('-') THEN										
jContador := 1;										
REPEAT										
vAgregarSalesPersonNo := 0;										
FOR iContador := 1 TO 30 DO BEGIN										
"IF SalesEntry.""Sales Staff"" = vSalesPersonNo[iContador] THEN"										
vAgregarSalesPersonNo += 1;										
END;										
IF vAgregarSalesPersonNo=0 THEN BEGIN										
"vSalesPersonNo[jContador] := SalesEntry.""Sales Staff"";"										
jContador += 1;										
rStaff1.RESET;										
"rStaff1.SETRANGE(ID,SalesEntry.""Sales Staff"");"										
IF rStaff1.FIND('-') THEN BEGIN										
rSalesPerson.RESET;										
"rSalesPerson.SETRANGE(Code,rStaff1.""Sales Person"");"										
rSalesPerson.FIND('-');										
REPEAT										
DSTR1 := '  #L####################################';										
//CSPNT191115										
Value[1] := 'Vendedor:' +  rStaff1.ID ;										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
UNTIL rSalesPerson.NEXT=0;										
END;										
END;										
UNTIL SalesEntry.NEXT = 0;										
										
//Imprimir Linea en blanco...										
"DSTR1 :=     COPYSTR('                     ',1);"										
Value[1] := '';										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
										
IF NOT IsInvoice THEN BEGIN										
//Imprime los medios de pago con se cancelo la transaccion										
"IF NOT Transaction.""Post as Shipment"" THEN BEGIN"										
PrintSeperator(Tray);                                //CSRG15102013										
"PrintPaymInfo(Transaction,Tray);"										
END;										
										
"POSTerminal.GET(Transaction.""POS Terminal No."");"										
"IF POSTerminal.""Print Number of Items"" AND (totalNumberOfItems <> 0) THEN BEGIN"										
CLEAR(Value);										
PrintSeperator(Tray);                                //CSRG15102013										
DSTR1 := '#L###################### #R#############';   //CSRG15102013										
										
Value[1] := Text151;										
Value[2] := POSFunctions.FormatQty(totalNumberOfItems);										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
PrintSeperator(Tray);										
END;										
END;										
//CSPNT270116 no imprimir ahorro cuando es devoluci¢n										
"IF POSTerminal.""Print Total Savings"" AND (totalSavings <> 0) AND NOT Transaction.""Sale Is Return Sale"" THEN BEGIN"										
//Descuento										
IF NOT IsInvoice THEN BEGIN										
//    DSTR1 := '#L################### #R################';    //CSRG15102013										
DSTR1 := ' #C############';    //CSRG15102013										
Value[1] := TextDescuento;										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),TRUE,TRUE,TRUE,FALSE));"										
										
//Imprimir Linea en blanco...										
"DSTR1 :=     COPYSTR('                     ',1);"										
Value[1] := '';										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
"IF NOT Transaction.""Sale Is Return Sale"" THEN BEGIN"										
										
DSTR1 := '  #L###################';    //CSRG15102013										
"Value[1] := '$' + FORMAT(-1*Descuento,0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),TRUE,TRUE,TRUE,FALSE));"										
END										
"ELSE IF Transaction.""Sale Is Return Sale"" THEN BEGIN"										
"Value[1] := '(' + '$' + FORMAT(Descuento,0,'<Integer Thousand><Decimals,3>') + ')';"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
END;										
END;										
										
IF discountSection THEN										
PrintSeperator(Tray);										
										
glTrans.INIT;										
END;										
										
PROCEDURE PrintSPOSalesInfo@1100409017(VAR Transaction@1100409001 : Record 99001472;Tray@1100409000 : Integer) : Integer;										
VAR										
PaymEntry@1100409012 : Record 99001474;										
Tendertype@1100409011 : Record 99001462;										
DSTR1@1100409007 : Text[100];										
LineCount@1100409002 : Integer;										
BEGIN										
//PrintSPOSalesInfo										
										
LineCount := 0;										
totSPOAmount := 0;										
CLEAR(PaymEntry);										
"PaymEntry.SETRANGE(""Store No."",Transaction.""Store No."");"										
"PaymEntry.SETRANGE(""POS Terminal No."",Transaction.""POS Terminal No."");"										
"PaymEntry.SETRANGE(""Transaction No."",Transaction.""Transaction No."");"										
IF PaymEntry.FIND('-') THEN BEGIN										
REPEAT										
"IF Tendertype.GET(PaymEntry.""Store No."", PaymEntry.""Tender Type"") THEN"										
"IF Tendertype.""Auto Account Payment Tender"" THEN"										
"totSPOAmount := totSPOAmount - PaymEntry.""Amount Tendered"";"										
UNTIL PaymEntry.NEXT = 0;										
DSTR1 := '#L####################### #R#########';										
CLEAR(Value);										
"Value[1] := Text216 + ' ' + Transaction.""Order No."";"										
NodeName[1] := 'Total Text'; //LS7.1-02										
Value[2] := POSFunctions.FormatAmount(totSPOAmount);										
NodeName[2] := 'Total Amount'; //LS7.1-02										
IF (totSPOAmount <> 0) THEN BEGIN										
LineCount := LineCount + 1;										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
"AddPrintLine(600,2,NodeName,Value,DSTR1,FALSE,FALSE,FALSE,FALSE,Tray); //LS7.1-02"										
END;										
END;										
										
EXIT(LineCount);										
END;										
										
PROCEDURE PrintPaymInfo@26(Transaction@1000 : Record 99001472;Tray@1001 : Integer);										
VAR										
PaymEntry@1002 : Record 99001474;										
Tendertype@1003 : Record 99001462;										
Tendercard@1004 : Record 99001464;										
Currency@1005 : Record 4;										
TransInfoCode@1006 : Record 99001478;										
DSTR1@1007 : Text[100];										
DSTR2@1008 : Text[100];										
Payment@1009 : Text[30];										
tmpStr@1010 : Text[50];										
i@1011 : Integer;										
CouponEntry@1012 : Record 99001477;										
BEGIN										
//PrintPaymInfo										
//CSPNT201115										
DSTR1 := '#L################ #R####      #R#######';										
CLEAR(PaymEntry);										
"PaymEntry.SETRANGE(""Store No."",Transaction.""Store No."");"										
"PaymEntry.SETRANGE(""POS Terminal No."",Transaction.""POS Terminal No."");"										
"PaymEntry.SETRANGE(""Transaction No."",Transaction.""Transaction No."");"										
IF PaymEntry.FIND('-') THEN BEGIN										
REPEAT										
CLEAR(Value);										
"Payment := PaymEntry.""Tender Type"";"										
"IF Tendertype.GET(PaymEntry.""Store No."", PaymEntry.""Tender Type"") THEN BEGIN"										
"IF PaymEntry.""Change Line"" AND (Tendertype.""Change Line on Receipt""<>'') THEN"										
"Payment := Tendertype.""Change Line on Receipt"""										
ELSE										
Payment := Tendertype.Description;										
END										
ELSE										
CLEAR(Tendertype);										
"IF NOT Tendertype.""Auto Account Payment Tender"" THEN BEGIN"										
Value[1] := Payment;										
NodeName[1] := 'Tender Description'; //LS7.1-02										
"IF (Tendertype.""Function"" = Tendertype.""Function""::Coupons) AND (PaymEntry.Quantity > 1) THEN"										
Value[2] := FORMAT(PaymEntry.Quantity);										
NodeName[2] := 'Quantity'; //LS7.1-02										
"//Value[3] := POSFunctions.FormatAmount(-PaymEntry.""Amount Tendered""); No se tiene que mostrar en negativo"										
"Value[3] := POSFunctions.FormatAmount(PaymEntry.""Amount Tendered"");"										
NodeName[3] := 'Amount In Tender'; //LS7.1-02										
//LS7.1-02 -										
"Value[4] := PaymEntry.""Tender Type"";"										
NodeName[4] := 'Tender Type';										
"Value[5] := FORMAT(PaymEntry.""Line No."");"										
NodeName[5] := 'Line No.';										
//LS7.1-02 +										
//CSPNT261015										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
"AddPrintLine(700,5,NodeName,Value,DSTR1,FALSE,TRUE,FALSE,FALSE,Tray); //LS7.1-02"										
"IF (Tendertype.""Function"" = Tendertype.""Function""::Card) THEN BEGIN"										
//CSPNT011015										
//CSPNT231015										
DSTR2 := '#L############################';										
"IF Tendercard.GET(PaymEntry.""Store No."",PaymEntry.""Tender Type"",PaymEntry.""Card No."") THEN BEGIN"										
IF Tendercard.Description <> '' THEN BEGIN										
Value[1] := Tendercard.Description;										
NodeName[1] := 'Card Name'; //LS7.1-02										
//LS7.1-02 -										
"Value[2] := FORMAT(PaymEntry.""Line No."");"										
NodeName[2] := 'Line No.';										
//LS7.1-02 +										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR2),FALSE,TRUE,FALSE,FALSE));"										
"AddPrintLine(700,2,NodeName,Value,DSTR2,FALSE,TRUE,FALSE,FALSE,Tray); //LS7.1-02"										
END;										
END;										
"IF PaymEntry.""Card or Account"" <> '' THEN BEGIN"										
"tmpStr := PaymEntry.""Card or Account"";"										
FOR i:=1 TO STRLEN(tmpStr)-6 DO										
tmpStr[i] := '*';										
Value[1] :=										
"COPYSTR(tmpStr,1,4) + ' ' +"										
"COPYSTR(tmpStr,5,4) + ' ' +"										
"COPYSTR(tmpStr,9,4) + ' ' +"										
"COPYSTR(tmpStr,13,4) + ' ' +"										
"COPYSTR(tmpStr,17,4);"										
NodeName[1] := 'Detail Text'; //LS7.1-02										
//LS7.1-02 -										
"Value[2] := FORMAT(PaymEntry.""Line No."");"										
NodeName[2] := 'Line No.';										
//LS7.1-02 +										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR2),FALSE,TRUE,FALSE,FALSE));"										
"AddPrintLine(700,2,NodeName,Value,DSTR2,FALSE,TRUE,FALSE,FALSE,Tray); //LS7.1-02"										
END;										
END										
"ELSE IF Tendertype.""Card/Account No."" THEN BEGIN"										
//CSPNT011015										
//CSPNT231015										
DSTR2 := '#L############################';										
"Value[1] := Tendertype.""Ask for Card/Account"" + ' ' + PaymEntry.""Card or Account"";"										
NodeName[1] := 'Detail Text'; //LS7.1-02										
//LS7.1-02 -										
"Value[2] := FORMAT(PaymEntry.""Line No."");"										
NodeName[2] := 'Line No.';										
//LS7.1-02 +										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR2),FALSE,TRUE,FALSE,FALSE));"										
"AddPrintLine(700,2,NodeName,Value,DSTR2,FALSE,TRUE,FALSE,FALSE,Tray); //LS7.1-02"										
END;										
"IF Tendertype.""Foreign Currency"" THEN BEGIN"										
"IF PaymEntry.""Amount in Currency"" = 0 THEN"										
"PaymEntry.""Amount in Currency"" := 1;"										
"Currency.GET(PaymEntry.""Currency Code"");"										
//CSPNT011015										
//CSPNT231015										
DSTR2 := '#L###### #L###################';										
Value[1] := Currency.Code;										
NodeName[1] := 'Currency Code'; //LS7.1-02										
"Value[2] := POSFunctions.FormatCurrency(-PaymEntry.""Amount in Currency"",PaymEntry.""Currency Code"") +"										
"' @ ' + FORMAT(PaymEntry.""Exchange Rate"");"										
NodeName[2] := 'x'; //LS7.1-02										
//LS7.1-02 -										
"Value[3] := FORMAT(PaymEntry.""Line No."");"										
NodeName[3] := 'Line No.';										
"Value[4] := POSFunctions.FormatCurrency(-PaymEntry.""Amount in Currency"",PaymEntry.""Currency Code"");"										
NodeName[4] := 'Amount In Currency';										
"Value[5] := FORMAT(PaymEntry.""Exchange Rate"");"										
NodeName[5] := 'Exchange Rate';										
//LS7.1-02 +										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR2),FALSE,TRUE,FALSE,FALSE));"										
"AddPrintLine(700,5,NodeName,Value,DSTR2,FALSE,TRUE,FALSE,FALSE,Tray); //LS7.1-02"										
END;										
										
"TransInfoCode.SETRANGE(""Store No."",Transaction.""Store No."");"										
"TransInfoCode.SETRANGE(""POS Terminal No."",Transaction.""POS Terminal No."");"										
"TransInfoCode.SETRANGE(""Transaction No."",Transaction.""Transaction No."");"										
"TransInfoCode.SETRANGE(""Transaction Type"",TransInfoCode.""Transaction Type""::""Payment Entry"");"										
"TransInfoCode.SETRANGE(""Line No."",PaymEntry.""Line No."");"										
"PrintTransInfoCode(TransInfoCode,Tray,FALSE);"										
END;										
UNTIL PaymEntry.NEXT = 0;										
IF Transaction.Rounded <> 0 THEN BEGIN										
"PrintLine(Tray,'');"										
DSTR1 := '#L################# #R###############   ';										
Value[1] := Text093;										
NodeName[1] := 'x'; //LS7.1-02										
Value[2] := POSFunctions.FormatAmount(Transaction.Rounded);										
NodeName[2] := 'Rounding Amount'; //LS7.1-02										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
"AddPrintLine(200,5,NodeName,Value,DSTR2,FALSE,TRUE,FALSE,FALSE,Tray); //LS7.1-02"										
END;										
PrintSeperator(Tray);										
END;										
END;										
										
PROCEDURE PrintPosSalesInfo@61(VAR POSTransaction@1000 : Record 99008980;Tray@1001 : Integer;SplitNumber@1200070001 : Integer);										
VAR										
POSTransInfoEntry@1200070000 : Record 99008982;										
Customer@1003 : Record 18;										
Contact@1100409005 : Record 5050;										
POSSalesEntry@1004 : Record 99008981;										
Item@1005 : Record 27;										
VATSetup@1006 : Record 99001560;										
MixMatchEntry@1008 : Record 99001496;										
POSTerminal@1012 : Record 99001471;										
ItemPosTextHeader@1013 : Record 99001534;										
ItemPosTextLine@1014 : Record 99001535;										
IncExpEntry@1015 : Record 99001475;										
IncExpAcc@1016 : Record 99001476;										
ItemVariant@1100409000 : Record 5401;										
TrPerDisc@1100409001 : Record 99008943;										
PeriodicDiscount@1100409002 : Record 99001453;										
ItemName@1017 : Text[30];										
SalesLineAmount@1018 : Decimal;										
SalesAmountVAT@1019 : ARRAY [5] OF Decimal;										
VATPerc@1020 : ARRAY [5] OF Decimal;										
VATAmount@1021 : ARRAY [5] OF Decimal;										
VATCode@1022 : ARRAY [5] OF Code[10];										
TmpVATPerc@1023 : Decimal;										
i@1024 : Integer;										
j@1025 : Integer;										
PrintItemNo@1026 : Integer;										
VATPrinted@1027 : Boolean;										
discText@1028 : Text[30];										
discountSection@1029 : Boolean;										
totalCustItemDisc@1030 : Decimal;										
mixMatchArr@1031 : ARRAY [250] OF Code[10];										
mixMatchAmtArr@1032 : ARRAY [250] OF Decimal;										
mixMatchArrCount@1033 : Integer;										
maxCounter@1034 : Integer;										
multibuyArr@1035 : ARRAY [250] OF Code[10];										
multibuyAmtArr@1036 : ARRAY [250] OF Decimal;										
multibuyArrCount@1037 : Integer;										
discOffArr@1038 : ARRAY [250] OF Code[10];										
discOffAmtArr@1039 : ARRAY [250] OF Decimal;										
discOffArrCount@1040 : Integer;										
DSTR1@1041 : Text[100];										
qtyTxt@1042 : Text[15];										
LineArr@1043 : ARRAY [10] OF Text[50];										
ItemTranslate@1200070002 : Record 30;										
LineDisc@1100409003 : Decimal;										
CustDisc@1100409004 : Decimal;										
ItemModifier@1100409006 : Record 99001482;										
SkipPrintingZeroItemModifier@1100409007 : Boolean;										
POSSalesEntryBuffer@1100409008 : TEMPORARY Record 99008981;										
CouponHeader@1100409009 : Record 99001621;										
STATE_SALES@1100409010 : Code[10];										
POSTransactionCodeunit@1100409011 : Codeunit 99001570;										
POSIncExpEntry@1100409012 : Record 99008981;										
ThisIsATipsLine@1100409013 : Boolean;										
IncomeExpenseAccount@1100409014 : Record 99001476;										
BEGIN										
//PrintPosSalesInfo										
//Splitnumber is splitnumber + 1										
										
STATE_SALES := 'SALES';										
IF (SplitNumber = 0) AND (POSTransactionCodeunit.GetPosState = STATE_SALES) THEN										
POSTransactionCodeunit.TotalPressed(TRUE);										
"POSTransaction.CALCFIELDS(""Gross Amount"");"										
TotalAmt := 0;										
										
HospitalityType.RESET;										
"HospitalityType.SETRANGE(""Restaurant No."",POSTransaction.""Store No."");"										
"HospitalityType.SETRANGE(""Sales Type"",POSTransaction.""Sales Type"");"										
IF NOT HospitalityType.FINDFIRST THEN										
CLEAR(HospitalityType);										
"IF GenPosFunc.""Multiple Items Symbol""='' THEN"										
"GenPosFunc.""Multiple Items Symbol"" := ' x ';"										
										
"POSTransInfoEntry.SETRANGE(""Receipt No."",POSTransaction.""Receipt No."");"										
"POSTransInfoEntry.SETRANGE(""Transaction Type"",POSTransInfoEntry.""Transaction Type""::Header);"										
"PrintPOSTransInfoCode(POSTransInfoEntry,Tray,TRUE);"										
										
DSTR1 := '#T######################################';										
"IF POSTransaction.""Customer No."" <> '' THEN BEGIN"										
"IF Customer.GET(POSTransaction.""Customer No."") THEN BEGIN"										
"Value[1] := COPYSTR(Customer.""No."" + ' ' + Customer.Name,1,MAXSTRLEN(Value[1]));"										
NodeName[1] := 'x'; //LS7.1-02										
//LS7.1-02 -										
"Value[2] := Customer.""No."";"										
NodeName[2] := 'Customer No.'; //LS7.1-02										
Value[3] := Customer.Name;										
NodeName[3] := 'Customer Name'; //LS7.1-02										
//LS7.1-02 +										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
"AddPrintLine(200,3,NodeName,Value,DSTR1,FALSE,FALSE,FALSE,FALSE,Tray); //LS7.1-02"										
PrintSeperator(Tray);										
END;										
END;										
"IF POSTransaction.""Sell-to Contact No."" <> '' THEN BEGIN"										
"IF Contact.GET(POSTransaction.""Sell-to Contact No."") THEN BEGIN"										
"Value[1] := COPYSTR(Contact.""No."" + ' ' + Contact.Name,1,MAXSTRLEN(Value[1]));"										
NodeName[1] := 'x'; //LS7.1-02										
//LS7.1-02 -										
"Value[2] := Contact.""No."";"										
NodeName[2] := 'Contact No.'; //LS7.1-02										
Value[3] := Contact.Name;										
NodeName[3] := 'Contact Name'; //LS7.1-02										
//LS7.1-02 +										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
"AddPrintLine(200,3,NodeName,Value,DSTR1,FALSE,FALSE,FALSE,FALSE,Tray); //LS7.1-02"										
PrintSeperator(Tray);										
END;										
END;										
										
DSTR1 := '#T######################################';										
IF SplitNumber <> 0 THEN BEGIN										
Value[1] := Text146 + FORMAT(SplitNumber - 1);										
IF SplitNumber = 1 THEN										
Value[1] := Text234;										
NodeName[1] := 'Print Info'; //LS7.1-02										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
"AddPrintLine(250,1,NodeName,Value,DSTR1,FALSE,FALSE,FALSE,FALSE,Tray); //LS7.1-02"										
PrintSeperator(Tray);										
END;										
										
DSTR1 := '#C##################';										
"IF POSTransaction.""Sale Is Return Sale"" THEN BEGIN"										
Value[1] := Text003;										
NodeName[1] := 'Description'; //LS7.1-02										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),TRUE,TRUE,TRUE,FALSE));"										
"AddPrintLine(200,1,NodeName,Value,DSTR1,TRUE,TRUE,TRUE,FALSE,Tray); //LS7.1-02"										
PrintSeperator(Tray);										
END;										
										
"IF POSTransaction.""Entry Status"" = POSTransaction.""Entry Status""::Training THEN"										
PrintTrainingText(Tray);										
										
mixMatchArrCount := 0;										
multibuyArrCount := 0;										
discOffArrCount := 0;										
totalCustItemDisc := 0;										
										
CLEAR(VATCode);										
CLEAR(VATPerc);										
CLEAR(VATAmount);										
CLEAR(SalesAmountVAT);										
CLEAR(POSSalesEntry);										
CLEAR(Value);										
tmpDeal.DELETEALL;										
"POSSalesEntry.SETRANGE(""Receipt No."",POSTransaction.""Receipt No."");"										
"POSSalesEntry.SETRANGE(""Entry Type"",POSSalesEntry.""Entry Type""::Item);"										
"POSSalesEntry.SETRANGE(""Entry Status"",POSSalesEntry.""Entry Status""::"" "");"										
										
IF SplitNumber <> 0 THEN										
BEGIN										
IF SplitNumber <> 1 THEN										
"POSSalesEntry.SETRANGE(POSSalesEntry.""Guest/Seat No."",SplitNumber - 1)"										
ELSE										
"POSSalesEntry.SETRANGE(POSSalesEntry.""Guest/Seat No."",0)"										
END;										
										
"CompressHospitalityTransLines(POSTransaction,GenPosFunc,POSSalesEntryBuffer,POSSalesEntry.GETFILTER(""Guest/Seat No.""));"										
										
IF POSSalesEntryBuffer.FIND('-') THEN BEGIN										
DSTR1 := '#L############### #R#################   ';										
Value[1] := Text071;										
Value[2] := Text004;										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
PrintSeperator(Tray);										
										
PrintItemNo := 0;										
"IF POSTerminal.GET(POSSalesEntryBuffer.""POS Terminal No."") THEN"										
"IF POSTerminal.""Receipt Setup Location"" = POSTerminal.""Receipt Setup Location""::Store THEN BEGIN"										
"CASE Store.""Item No. on Receipt"" OF"										
"Store.""Item No. on Receipt""::""Item Number"" :"										
PrintItemNo := 1;										
"Store.""Item No. on Receipt""::""Barcode/Item Number"" :"										
PrintItemNo := 2;										
END;										
END ELSE BEGIN										
"CASE POSTerminal.""Item No. on Receipt"" OF"										
"POSTerminal.""Item No. on Receipt"" :: ""Item Number"":"										
PrintItemNo := 1;										
"POSTerminal.""Item No. on Receipt"" :: ""Barcode/Item Number"":"										
PrintItemNo := 2;										
END;										
END;										
										
REPEAT										
"PosPriceUtil.GetTransDisc(POSSalesEntryBuffer,TRUE,0);"										
										
IF Item.GET(POSSalesEntryBuffer.Number) THEN BEGIN										
"IF (POSSalesEntryBuffer.""Variant Code"" <> '') AND"										
"(ItemVariant.GET(POSSalesEntryBuffer.Number,POSSalesEntryBuffer.""Variant Code"")) THEN"										
"ItemName := COPYSTR(ItemVariant.Description,1,20)"										
ELSE										
"ItemName := COPYSTR(Item.Description,1,20);"										
END ELSE										
ItemName := POSSalesEntryBuffer.Number;										
										
"IF Customer.GET(POSTransaction.""Customer No."") THEN"										
"IF Customer.""Language Code"" <> '' THEN"										
"IF ItemTranslate.GET(POSSalesEntryBuffer.Number,"										
"POSSalesEntryBuffer.""Variant Code"",Customer.""Language Code"") THEN"										
IF ItemTranslate.Description <> '' THEN										
"ItemName:= COPYSTR(ItemTranslate.Description,1,20);"										
										
TotalAmt := TotalAmt + POSSalesEntryBuffer.Amount;										
										
"IF POSSalesEntryBuffer.""Deal Line"" THEN BEGIN"										
"PrintPOSDeal(POSSalesEntryBuffer,Tray,PrintItemNo,SplitNumber);"										
END ELSE BEGIN										
"IF GenPosFunc.""Print Disc/Cpn Info on Slip"" = GenPosFunc.""Print Disc/Cpn Info on Slip""::""No printing"" THEN"										
SalesLineAmount := POSSalesEntryBuffer.Amount										
ELSE										
"SalesLineAmount := POSSalesEntryBuffer.Amount + POSSalesEntryBuffer.""Discount Amount"";"										
										
DSTR1 := '#L######### #L###################';										
IF PrintItemNo <> 0 THEN BEGIN										
IF PrintItemNo = 1 THEN BEGIN										
Value[1] := Text074;										
NodeName[1] := 'x'; //LS7.1-02										
Value[2] := POSSalesEntryBuffer.Number;										
NodeName[2] := 'Item No.'; //LS7.1-02										
END ELSE BEGIN										
"IF POSSalesEntryBuffer.""Barcode No."" <> '' THEN BEGIN"										
Value[1] := Text075;										
NodeName[1] := 'x'; //LS7.1-02										
"Value[2] := POSSalesEntryBuffer.""Barcode No."";"										
NodeName[2] := 'Barcode'; //LS7.1-02										
END ELSE BEGIN										
Value[1] := Text074;										
NodeName[1] := 'x'; //LS7.1-02										
Value[2] := POSSalesEntryBuffer.Number;										
NodeName[2] := 'Item No.'; //LS7.1-02										
END;										
END;										
//LS7.1-02 -										
"Value[3] := FORMAT(POSSalesEntryBuffer.""Line No."");"										
NodeName[3] := 'Line No.';										
//LS7.1-02 +										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
"AddPrintLine(300,3,NodeName,Value,DSTR1,FALSE,FALSE,FALSE,FALSE,Tray); //LS7.1-02"										
END;										
										
"IF (ABS(POSSalesEntryBuffer.Quantity) <> 1) OR POSSalesEntryBuffer.""Scale Item"" OR"										
"POSSalesEntryBuffer.""Price in Barcode"" THEN BEGIN"										
SkipPrintingZeroItemModifier := FALSE;										
IF SalesLineAmount = 0 THEN										
"IF POSSalesEntryBuffer.""Orig. from Infocode"" <> '' THEN"										
"IF ItemModifier.GET(POSSalesEntryBuffer.""Orig. from Infocode"") THEN"										
"IF ItemModifier.""Print Item Modifier on Receipt"" ="										
"ItemModifier.""Print Item Modifier on Receipt""::""Skip Zero Price"" THEN"										
SkipPrintingZeroItemModifier := TRUE;										
DSTR1 := '#L######################################';										
Value[1] := ItemName;										
NodeName[1] := 'Item Description'; //LS7.1-02										
//LS7.1-02 -										
"Value[2] := FORMAT(POSSalesEntryBuffer.""Line No."");"										
NodeName[2] := 'Line No.';										
//LS7.1-02 +										
//LS7.1-02 IF NOT SkipPrintingZeroItemModifier THEN										
IF NOT SkipPrintingZeroItemModifier THEN BEGIN //LS7.1-02										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
"AddPrintLine(300,2,NodeName,Value,DSTR1,FALSE,FALSE,FALSE,FALSE,Tray); //LS7.1-02"										
END; //LS7.1-02										
										
CLEAR(Value);										
DSTR1 := '   #L################### #N########## #R';										
"IF POSSalesEntryBuffer.""Scale Item"" OR POSSalesEntryBuffer.""Price in Barcode"" THEN BEGIN"										
"IF POSSalesEntryBuffer.""Weight manually Entered"" THEN"										
DSTR1 := 'MAN #L################## #N########## #R';										
"Value[1] := Value[1] + POSFunctions.FormatWeight(POSSalesEntryBuffer.Quantity,"										
"POSSalesEntryBuffer.""Unit of Measure"") +"										
"' ' + GenPosFunc.""Multiple Items Symbol"" + ' ';"										
"Value[1] := Value[1] + POSFunctions.FormatPricePrUnit(POSSalesEntryBuffer.Price,"										
"POSSalesEntryBuffer.""Unit of Measure"");"										
END ELSE BEGIN										
"IF POSSalesEntryBuffer.""Unit of Measure"" = '' THEN"										
"POSSalesEntryBuffer.""Unit of Measure"" :=  Text131;"										
										
Value[1] :=										
POSFunctions.FormatQty(POSSalesEntryBuffer.Quantity) + ' ' +										
"LOWERCASE(POSSalesEntryBuffer.""Unit of Measure"") +"										
"' ' + GenPosFunc.""Multiple Items Symbol"" + ' ';"										
Value[1] := Value[1] + POSFunctions.FormatPrice(POSSalesEntryBuffer.Price);										
END;										
NodeName[1] := 'x'; //LS7.1-02										
Value[2] := POSFunctions.FormatAmount(SalesLineAmount);										
NodeName[2] := 'Amount'; //LS7.1-02										
"Value[3] := POSSalesEntryBuffer.""VAT Code"";"										
NodeName[3] := 'VAT Code'; //LS7.1-02										
//LS7.1-02 -										
"Value[4] := POSSalesEntryBuffer.""Unit of Measure"";"										
NodeName[4] := 'UOM ID';										
Value[5] := POSFunctions.FormatQty(POSSalesEntryBuffer.Quantity);										
NodeName[5] := 'Quantity';										
Value[6] := POSFunctions.FormatPrice(POSSalesEntryBuffer.Price);										
NodeName[6] := 'Price';										
"Value[7] := FORMAT(POSSalesEntryBuffer.""Line No."");"										
NodeName[7] := 'Line No.';										
//LS7.1-02 -										
//LS7.1-02 IF NOT SkipPrintingZeroItemModifier THEN										
IF NOT SkipPrintingZeroItemModifier THEN BEGIN //LS7.1-02										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
"AddPrintLine(300,7,NodeName,Value,DSTR1,FALSE,FALSE,FALSE,FALSE,Tray); //LS7.1-02"										
END; //LS7.1-02										
										
END ELSE BEGIN										
DSTR1 := '#L###################### #N########## #R';										
Value[1] := ItemName;										
"IF POSSalesEntryBuffer.""Unit of Measure"" <> '' THEN"										
"Value[1] := Value[1] + ' ' + LOWERCASE(POSSalesEntryBuffer.""Unit of Measure"");"										
NodeName[1] := 'x'; //LS7.1-02										
Value[2] := POSFunctions.FormatAmount(SalesLineAmount);										
NodeName[2] := 'Amount'; //LS7.1-02										
"Value[3] := POSSalesEntryBuffer.""VAT Code"";"										
NodeName[3] := 'VAT Code'; //LS7.1-02										
//LS7.1-02 -										
"Value[4] := POSSalesEntryBuffer.""Unit of Measure"";"										
NodeName[4] := 'UOM ID';										
Value[5] := POSFunctions.FormatQty(POSSalesEntryBuffer.Quantity);										
NodeName[5] := 'Quantity';										
Value[6] := POSFunctions.FormatPrice(POSSalesEntryBuffer.Price);										
NodeName[6] := 'Price';										
"Value[7] := FORMAT(POSSalesEntryBuffer.""Line No."");"										
NodeName[7] := 'Line No.';										
//LS7.1-02 -										
SkipPrintingZeroItemModifier := FALSE;										
IF SalesLineAmount = 0 THEN										
"IF POSSalesEntryBuffer.""Orig. from Infocode"" <> '' THEN"										
"IF ItemModifier.GET(POSSalesEntryBuffer.""Orig. from Infocode"") THEN"										
"IF ItemModifier.""Print Item Modifier on Receipt"" ="										
"ItemModifier.""Print Item Modifier on Receipt""::""Skip Zero Price"" THEN"										
SkipPrintingZeroItemModifier := TRUE;										
//LS7.1-02 IF NOT SkipPrintingZeroItemModifier THEN										
IF NOT SkipPrintingZeroItemModifier THEN BEGIN //LS7.1-02										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
"AddPrintLine(300,7,NodeName,Value,DSTR1,FALSE,FALSE,FALSE,FALSE,Tray); //LS7.1-02"										
END; //LS7.1-02										
END;										
										
"IF GenPosFunc.""Print Free Text on Receipt"" THEN"										
"PrintPOSFreeTextLines(POSSalesEntryBuffer,Tray,FALSE,FALSE);"										
										
CustDisc := 0;										
LineDisc := 0;										
"IF POSSalesEntryBuffer.""Customer Disc. %"" <> 0 THEN"										
"CustDisc := ROUND((POSSalesEntryBuffer.""Customer Disc. %"" / 100) * SalesLineAmount);"										
										
"SalesLineAmount := SalesLineAmount - POSSalesEntryBuffer.""Periodic Discount Amount"" - CustDisc;"										
"IF POSSalesEntryBuffer.""Line Disc. %"" <> 0 THEN"										
"LineDisc := ROUND((POSSalesEntryBuffer.""Line Disc. %"" / 100) * SalesLineAmount);"										
SalesLineAmount := SalesLineAmount - LineDisc;										
										
"IF GenPosFunc.""Print Disc/Cpn Info on Slip"" ="										
"GenPosFunc.""Print Disc/Cpn Info on Slip""::""Detail information for each line"" THEN BEGIN"										
POSTransPeriodicDiscTEMP.RESET;										
"POSTransPeriodicDiscTEMP.SETRANGE(""Receipt No."",POSTransaction.""Receipt No."");"										
"POSTransPeriodicDiscTEMP.SETRANGE(""Line No."",POSSalesEntryBuffer.""Line No."");"										
IF POSTransPeriodicDiscTEMP.FINDSET THEN REPEAT										
Value[1] := FORMAT(POSTransPeriodicDiscTEMP.DiscType) + ' ' + Text012;										
DSTR1 := '   #L################### #N########## #R';										
IF POSTransPeriodicDiscTEMP.DiscType <> POSTransPeriodicDiscTEMP.DiscType::Coupon THEN BEGIN										
"IF PeriodicDiscount.GET(POSTransPeriodicDiscTEMP.""Offer No."") THEN"										
Value[1] := PeriodicDiscount.Description;										
END										
ELSE										
IF (POSTransPeriodicDiscTEMP.DiscType = POSTransPeriodicDiscTEMP.DiscType::Coupon) AND										
"(POSTransPeriodicDiscTEMP.""Coupon Code"" <> '') THEN"										
"IF CouponHeader.GET(POSTransPeriodicDiscTEMP.""Coupon Code"") THEN"										
Value[1] := CouponHeader.Description;										
NodeName[1] := 'Detail Text'; //LS7.1-02										
"Value[2] := POSFunctions.FormatAmount(-POSTransPeriodicDiscTEMP.""Discount Amount"");"										
NodeName[2] := 'Detail Amount'; //LS7.1-02										
//LS7.1-02 -										
"Value[3] := FORMAT(POSSalesEntryBuffer.""Line No."");"										
NodeName[3] := 'Line No.';										
//LS7.1-02 +										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
"AddPrintLine(360,3,NodeName,Value,DSTR1,FALSE,FALSE,FALSE,FALSE,Tray); //LS7.1-02"										
										
UNTIL POSTransPeriodicDiscTEMP.NEXT = 0;										
END;										
										
"IF ItemPosTextHeader.GET(POSSalesEntryBuffer.Number,ItemPosTextHeader.""Text Type""::""Receipt Text"",'') THEN BEGIN"										
"ItemPosTextLine.SETRANGE(""Item No."",POSSalesEntryBuffer.Number);"										
"ItemPosTextLine.SETRANGE(""Text Type"",ItemPosTextHeader.""Text Type""::""Receipt Text"");"										
"ItemPosTextLine.SETRANGE(""Language Code"",'');"										
IF ItemPosTextLine.FIND('-') THEN REPEAT										
//LS7.1-02 -										
"Value[1] := FORMAT(POSSalesEntryBuffer.""Line No."");"										
NodeName[1] := 'Line No.';										
Value[2] := ItemPosTextLine.Text;										
NodeName[2] := 'Extra Info Line';										
//LS7.1-02 -										
"PrintLine(Tray,ItemPosTextLine.Text);"										
"AddPrintLine(350,2,NodeName,Value,DSTR1,FALSE,FALSE,FALSE,FALSE,Tray); //LS7.1-02"										
UNTIL ItemPosTextLine.NEXT = 0;										
END;										
										
"POSTransInfoEntry.SETRANGE(""Receipt No."",POSTransaction.""Receipt No."");"										
"POSTransInfoEntry.SETRANGE(""Transaction Type"",POSTransInfoEntry.""Transaction Type""::""Sales Entry"");"										
"POSTransInfoEntry.SETRANGE(""Line No."",POSSalesEntryBuffer.""Line No."");"										
"PrintPOSTransInfoCode(POSTransInfoEntry,Tray,FALSE);"										
										
"IF POSSalesEntryBuffer.""InfoCode Disc. %"" <> 0 THEN BEGIN"										
"totalCustItemDisc := totalCustItemDisc + ROUND((POSSalesEntryBuffer.""InfoCode Disc. %"" / 100 ) * SalesLineAmount);"										
END;										
END;										
UNTIL POSSalesEntryBuffer.NEXT = 0;										
PrintSeperator(Tray);										
END;										
										
TipsAmount1 := 0;										
TipsAmount2 := 0;										
TipsText1 := '';										
TipsText2 := '';										
POSIncExpEntry.RESET;										
"POSIncExpEntry.SETRANGE(""Receipt No."",POSTransaction.""Receipt No."");"										
"POSIncExpEntry.SETRANGE(""Entry Type"",POSIncExpEntry.""Entry Type""::IncomeExpense);"										
IF POSIncExpEntry.FIND('-') THEN BEGIN										
REPEAT										
"IncExpAcc.GET(POSIncExpEntry.""Store No."",POSIncExpEntry.Number);"										
DSTR1 :=  '#L#################### #N############ #R';										
Value[1] := IncExpAcc.Description;										
NodeName[1] := 'Inc./Exp. Description'; //LS7.1-02										
Value[2] := POSFunctions.FormatAmount(POSIncExpEntry.Amount);										
NodeName[2] := 'Amount'; //LS7.1-02										
"Value[3] := POSIncExpEntry.""VAT Code"";"										
NodeName[3] := 'VAT Code'; //LS7.1-02										
//LS7.1-02 -										
"Value[4] := FORMAT(POSIncExpEntry.""Line No."");"										
NodeName[4] := 'Line No.';										
Value[5] := POSIncExpEntry.Number;										
NodeName[5] := 'Income/Expense No.';										
//LS7.1-02 +										
"IF POSIncExpEntry.""VAT Code"" <> '' THEN BEGIN"										
i := 0;										
j := 0;										
"IF VATSetup.GET(POSIncExpEntry.""VAT Code"") THEN BEGIN"										
REPEAT										
i := i + 1;										
IF j = 0 THEN										
IF VATCode[i] = '' THEN										
j := i;										
"UNTIL (VATCode[i] = VATSetup.""VAT Code"") OR (i >= 5);"										
"IF VATCode[i] <> VATSetup.""VAT Code"" THEN BEGIN"										
i := j;										
"VATPerc[i] := VATSetup.""VAT %"";"										
"VATCode[i] := VATSetup.""VAT Code"";"										
END;										
"VATAmount[i] := VATAmount[i] + POSIncExpEntry.""VAT Amount"";"										
SalesAmountVAT[i] := SalesAmountVAT[i] + POSIncExpEntry.Amount;										
END;										
END;										
POSSlipSubTotAmt := POSSlipSubTotAmt + POSIncExpEntry.Amount;										
ThisIsATipsLine := FALSE;										
IF POSIncExpEntry.Number <> '' THEN BEGIN										
"IF POSIncExpEntry.Number = HospitalityType.""Tips Income Acc. 1"" THEN BEGIN"										
ThisIsATipsLine := TRUE;										
TipsAmount1 := TipsAmount1 + POSIncExpEntry.Amount;										
IF TipsText1 = '' THEN BEGIN										
IncomeExpenseAccount.RESET;										
"IncomeExpenseAccount.SETRANGE(""Store No."",POSTransaction.""Store No."");"										
"IncomeExpenseAccount.SETRANGE(""No."",POSIncExpEntry.Number);"										
IF IncomeExpenseAccount.FINDFIRST THEN										
TipsText1 := IncomeExpenseAccount.Description										
ELSE										
TipsText1 := Text321;										
END										
END										
ELSE										
"IF POSIncExpEntry.Number = HospitalityType.""Tips Income Acc. 2"" THEN BEGIN"										
ThisIsATipsLine := TRUE;										
TipsAmount2 := TipsAmount2 + POSIncExpEntry.Amount;										
IF TipsText2 = '' THEN BEGIN										
IncomeExpenseAccount.RESET;										
"IncomeExpenseAccount.SETRANGE(""Store No."",POSTransaction.""Store No."");"										
"IncomeExpenseAccount.SETRANGE(""No."",POSIncExpEntry.Number);"										
IF IncomeExpenseAccount.FINDFIRST THEN										
TipsText2 := IncomeExpenseAccount.Description										
ELSE										
TipsText2 := Text321;										
END;										
END;										
END;										
IF NOT ThisIsATipsLine THEN BEGIN										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
"AddPrintLine(340,5,NodeName,Value,DSTR1,FALSE,FALSE,FALSE,FALSE,Tray); //LS7.1-02"										
//LS7.1-02 -										
"Value[1] := FORMAT(IncExpEntry.""Line No."");"										
NodeName[1] := 'Line No.';										
NodeName[2] := 'Extra Info Line';										
//LS7.1-02 +										
"//LS7.1-02 IF IncExpAcc.""Slip Text 1"" <> '' THEN"										
"IF IncExpAcc.""Slip Text 1"" <> '' THEN BEGIN //LS7.1-02"										
"PrintLine(Tray,IncExpAcc.""Slip Text 1"");"										
"Value[2] := IncExpAcc.""Slip Text 1""; //LS7.1-02"										
"AddPrintLine(350,2,NodeName,Value,DSTR1,FALSE,FALSE,FALSE,FALSE,Tray); //LS7.1-02"										
END; //LS7.1-02										
"//LS7.1-02 IF IncExpAcc.""Slip Text 2"" <> '' THEN"										
"IF IncExpAcc.""Slip Text 2"" <> '' THEN BEGIN //LS7.1-02"										
"PrintLine(Tray,IncExpAcc.""Slip Text 2"");"										
"Value[2] := IncExpAcc.""Slip Text 2""; //LS7.1-02"										
"AddPrintLine(350,2,NodeName,Value,DSTR1,FALSE,FALSE,FALSE,FALSE,Tray); //LS7.1-02"										
END; //LS7.1-02										
END;										
UNTIL POSIncExpEntry.NEXT = 0;										
PrintSeperator(Tray);										
END;										
//LS7.1-02 -										
NodeName[1] := 'Total Text';										
NodeName[2] := 'Total Amount';										
//LS7.1-02 +										
"//LS7.1-12 IF GenPosFunc.""Print Disc/Cpn Info on Slip"" ="										
"//LS7.1-12   GenPosFunc.""Print Disc/Cpn Info on Slip""::""Summary information below Sub-total"" THEN BEGIN"										
//LS7.1-12 -										
"IF GenPosFunc.""Print Disc/Cpn Info on Slip"" IN"										
"[GenPosFunc.""Print Disc/Cpn Info on Slip""::""Detail for each line and Sub-total"","										
"GenPosFunc.""Print Disc/Cpn Info on Slip""::""Summary information below Sub-total""] THEN BEGIN"										
//LS7.1-12 +										
PeriodicDiscountInfoTEMP.RESET;										
IF PeriodicDiscountInfoTEMP.FINDSET THEN BEGIN										
DSTR1 := '#L################# #R###############   ';										
CLEAR(Value);										
Value[1] := Text042 + ' ' + Globals.GetValue('CURRSYM');										
Value[2] := POSFunctions.FormatAmount(POSSlipSubTotAmt - TipsAmount1 - TipsAmount2);										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
"AddPrintLine(800,2,NodeName,Value,DSTR1,FALSE,FALSE,FALSE,FALSE,Tray); //LS7.1-02"										
REPEAT										
CLEAR(Value);										
DSTR1 := '#L################# #R###############   ';										
Value[1] := PeriodicDiscountInfoTEMP.Description;										
"Value[2] := POSFunctions.FormatAmount(-PeriodicDiscountInfoTEMP.""Discount Amount Value"");"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
"AddPrintLine(800,2,NodeName,Value,DSTR1,FALSE,FALSE,FALSE,FALSE,Tray); //LS7.1-02"										
UNTIL PeriodicDiscountInfoTEMP.NEXT = 0;										
discountSection := TRUE;										
END;										
PrintSeperator(Tray);										
DSTR1 := '#L################# #R###############   ';										
Value[1] := Text005;										
Value[2] := POSFunctions.FormatAmount(TotalAmt);										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
"AddPrintLine(800,2,NodeName,Value,DSTR1,FALSE,FALSE,FALSE,FALSE,Tray); //LS7.1-02"										
END;										
"IF GenPosFunc.""Print Disc/Cpn Info on Slip"" IN [GenPosFunc.""Print Disc/Cpn Info on Slip""::""Detail information for each line"","										
"GenPosFunc.""Print Disc/Cpn Info on Slip""::""No printing""] THEN BEGIN"										
PrintSeperator(Tray);										
DSTR1 := '#L################# #R###############   ';										
Value[1] := Text005;										
Value[2] := POSFunctions.FormatAmount(TotalAmt);										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
"AddPrintLine(800,2,NodeName,Value,DSTR1,FALSE,FALSE,FALSE,FALSE,Tray); //LS7.1-02"										
END;										
										
"PrintPOSPaymInfo(POSTransaction,Tray);"										
										
IF (TipsAmount1 <> 0) OR (TipsAmount2 <> 0) THEN BEGIN										
IF TipsAmount1 <> 0 THEN BEGIN										
DSTR1 := '#L################# #R###############   ';										
Value[1] := TipsText1 + ' ' + Globals.GetValue('CURRSYM');										
Value[2] := POSFunctions.FormatAmount(TipsAmount1);										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
"AddPrintLine(800,2,NodeName,Value,DSTR1,FALSE,FALSE,FALSE,FALSE,Tray); //LS7.1-02"										
END;										
IF TipsAmount2 <> 0 THEN BEGIN										
DSTR1 := '#L################# #R###############   ';										
Value[1] := TipsText2 + ' ' + Globals.GetValue('CURRSYM');										
Value[2] := POSFunctions.FormatAmount(TipsAmount2);										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
"AddPrintLine(800,2,NodeName,Value,DSTR1,FALSE,FALSE,FALSE,FALSE,Tray); //LS7.1-02"										
END;										
END;										
										
IF discountSection THEN										
PrintSeperator(Tray);										
END;										
										
PROCEDURE PrintFooter@20(Transaction@10012000 : Record 99001472;Tray@1000 : Integer);										
VAR										
POSText@1001 : Record 99001492;										
DSTR1@1002 : Text[100];										
LineLength@1003 : Integer;										
Terminal@1004 : Record 99001471;										
ReceiptHeader@10012003 : Record 99001498;										
RetailUtil@10012002 : Codeunit 99001462;										
ReceiptNo@10012001 : Code[20];										
BEGIN										
//PrintFooter										
IF Tray = 2 THEN										
LineLength := LineLen										
ELSE IF Tray = 4 THEN										
LineLength := InvLineLen;										
										
CLEAR(ReceiptNo);										
ReceiptHeader.RESET;										
ReceiptHeader.SETCURRENTKEY(Priority);										
IF ReceiptHeader.FINDLAST THEN BEGIN										
REPEAT										
"IF RetailUtil.DiscValPerValid(ReceiptHeader.""Validation Period ID"",Transaction.Date,Transaction.Time) THEN BEGIN"										
"ReceiptNo := ReceiptHeader.""No."";"										
END;										
UNTIL (ReceiptHeader.NEXT(-1) = 0) OR (ReceiptNo <> '');										
END;										
										
CLEAR(POSText);										
										
IF (ReceiptNo <> '') THEN										
"POSText.SETRANGE(""No."",ReceiptNo)"										
ELSE										
"POSText.SETRANGE(""No."",'');"										
										
Terminal.GET(Globals.TerminalNo);										
"IF Terminal.""Receipt Setup Location"" = Terminal.""Receipt Setup Location""::Terminal THEN BEGIN"										
"POSText.SETRANGE(Relation,POSText.Relation::Terminal);"										
"POSText.SETRANGE(Number,Globals.TerminalNo);"										
END ELSE BEGIN										
"POSText.SETRANGE(Relation,POSText.Relation::Store);"										
"POSText.SETRANGE(Number,Globals.StoreNo);"										
END;										
										
"POSText.SETRANGE(Type,POSText.Type::Bottom);"										
										
IF NOT POSText.FINDFIRST THEN										
"POSText.SETRANGE(""No."",'');"										
										
IF POSText.FINDSET THEN BEGIN										
REPEAT										
CASE POSText.Align OF										
POSText.Align::Left   :										
"DSTR1 := COPYSTR('#L################################################',1,LineLength);"										
POSText.Align::Center :										
"DSTR1 := COPYSTR('#C################################################',1,LineLength);"										
POSText.Align::Right  :										
"DSTR1 := COPYSTR('#R################################################',1,LineLength);"										
END;										
"Value[1] := POSText.""Receipt Text"";"										
NodeName[1] := 'Footer Line'; //LS7.1-02										
IF POSText.Wide THEN										
"DSTR1 := COPYSTR(DSTR1,1,ROUND(STRLEN(DSTR1) / 2,1,'>'));"										
"//PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),POSText.Wide,POSText.Bold,POSText.High,POSText.Italic));"										
"AddPrintLine(1000,1,NodeName,Value,DSTR1,POSText.Wide,POSText.Bold,POSText.High,POSText.Italic,Tray); //LS7.1-02"										
UNTIL POSText.NEXT = 0;										
END;										
END;										
										
PROCEDURE PrintPOSFooter@1100409041(POSTrans@10012000 : Record 99008980;Tray@1000 : Integer);										
VAR										
POSText@1001 : Record 99001492;										
DSTR1@1002 : Text[100];										
LineLength@1003 : Integer;										
Terminal@1004 : Record 99001471;										
ReceiptHeader@10012003 : Record 99001498;										
RetailUtil@10012002 : Codeunit 99001462;										
ReceiptNo@10012001 : Code[20];										
BEGIN										
//PrintPOSFooter										
IF Tray = 2 THEN										
LineLength := LineLen										
ELSE IF Tray = 4 THEN										
LineLength := InvLineLen;										
										
CLEAR(ReceiptNo);										
ReceiptHeader.RESET;										
ReceiptHeader.SETCURRENTKEY(Priority);										
IF ReceiptHeader.FINDLAST THEN BEGIN										
REPEAT										
"IF RetailUtil.DiscValPerValid(ReceiptHeader.""Validation Period ID"",POSTrans.""Original Date"",POSTrans.""Trans Time"") THEN"										
BEGIN										
"ReceiptNo := ReceiptHeader.""No."";"										
END;										
UNTIL (ReceiptHeader.NEXT(-1) = 0) OR (ReceiptNo <> '');										
END;										
										
CLEAR(POSText);										
										
IF (ReceiptNo <> '') THEN										
"POSText.SETRANGE(""No."",ReceiptNo)"										
ELSE										
"POSText.SETRANGE(""No."",'');"										
										
Terminal.GET(Globals.TerminalNo);										
"IF Terminal.""Receipt Setup Location"" = Terminal.""Receipt Setup Location""::Terminal THEN BEGIN"										
"POSText.SETRANGE(Relation,POSText.Relation::Terminal);"										
"POSText.SETRANGE(Number,Globals.TerminalNo);"										
END ELSE BEGIN										
"POSText.SETRANGE(Relation,POSText.Relation::Store);"										
"POSText.SETRANGE(Number,Globals.StoreNo);"										
END;										
										
"POSText.SETRANGE(Type,POSText.Type::Bottom);"										
										
IF NOT POSText.FINDFIRST THEN										
"POSText.SETRANGE(""No."",'');"										
										
IF POSText.FINDSET THEN BEGIN										
REPEAT										
CASE POSText.Align OF										
POSText.Align::Left   :										
"DSTR1 := COPYSTR('#L################################################',1,LineLength);"										
POSText.Align::Center :										
"DSTR1 := COPYSTR('#C################################################',1,LineLength);"										
POSText.Align::Right  :										
"DSTR1 := COPYSTR('#R################################################',1,LineLength);"										
END;										
"Value[1] := POSText.""Receipt Text"";"										
NodeName[1] := 'Footer Line'; //LS7.1-02										
IF POSText.Wide THEN										
"DSTR1 := COPYSTR(DSTR1,1,ROUND(STRLEN(DSTR1) / 2,1,'>'));"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),POSText.Wide,POSText.Bold,POSText.High,POSText.Italic));"										
"AddPrintLine(1000,1,NodeName,Value,DSTR1,POSText.Wide,POSText.Bold,POSText.High,POSText.Italic,Tray); //LS7.1-02"										
UNTIL POSText.NEXT = 0;										
END;										
END;										
										
PROCEDURE PrintVoidFooter@1100409034(Transaction@10012000 : Record 99001472;Tray@1000 : Integer);										
VAR										
POSText@1001 : Record 99001492;										
DSTR1@1002 : Text[100];										
LineLength@1003 : Integer;										
Terminal@1004 : Record 99001471;										
ReceiptHeader@10012003 : Record 99001498;										
RetailUtil@10012002 : Codeunit 99001462;										
ReceiptNo@10012001 : Code[20];										
BEGIN										
//PrintFooter										
IF Tray = 2 THEN										
LineLength := LineLen										
ELSE IF Tray = 4 THEN										
LineLength := InvLineLen;										
										
CLEAR(ReceiptNo);										
ReceiptHeader.RESET;										
ReceiptHeader.SETCURRENTKEY(Priority);										
IF ReceiptHeader.FINDLAST THEN BEGIN										
REPEAT										
"IF RetailUtil.DiscValPerValid(ReceiptHeader.""Validation Period ID"",Transaction.Date,Transaction.Time) THEN BEGIN"										
"ReceiptNo := ReceiptHeader.""No."";"										
END;										
UNTIL (ReceiptHeader.NEXT(-1) = 0) OR (ReceiptNo <> '');										
END;										
										
CLEAR(POSText);										
										
IF (ReceiptNo <> '') THEN										
"POSText.SETRANGE(""No."",ReceiptNo)"										
ELSE										
"POSText.SETRANGE(""No."",'');"										
										
Terminal.GET(Globals.TerminalNo);										
"IF Terminal.""Receipt Setup Location"" = Terminal.""Receipt Setup Location""::Terminal THEN BEGIN"										
"POSText.SETRANGE(Relation,POSText.Relation::Terminal);"										
"POSText.SETRANGE(Number,Globals.TerminalNo);"										
END ELSE BEGIN										
"POSText.SETRANGE(Relation,POSText.Relation::Store);"										
"POSText.SETRANGE(Number,Globals.StoreNo);"										
END;										
										
"POSText.SETRANGE(Type,POSText.Type::Bottom);"										
										
IF NOT POSText.FINDFIRST THEN										
"POSText.SETRANGE(""No."",'');"										
										
IF POSText.FINDSET THEN BEGIN										
REPEAT										
CASE POSText.Align OF										
POSText.Align::Left   :										
"DSTR1 := COPYSTR('#L################################################',1,LineLength);"										
POSText.Align::Center :										
"DSTR1 := COPYSTR('#C################################################',1,LineLength);"										
POSText.Align::Right  :										
"DSTR1 := COPYSTR('#R################################################',1,LineLength);"										
END;										
"Value[1] := POSText.""Receipt Text"";"										
NodeName[1] := 'Footer Line'; //LS7.1-02										
IF POSText.Wide THEN										
"DSTR1 := COPYSTR(DSTR1,1,ROUND(STRLEN(DSTR1) / 2,1,'>'));"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),POSText.Wide,POSText.Bold,POSText.High,POSText.Italic));"										
"AddPrintLine(1000,1,NodeName,Value,DSTR1,POSText.Wide,POSText.Bold,POSText.High,POSText.Italic,Tray); //LS7.1-02"										
UNTIL POSText.NEXT = 0;										
END;										
END;										
										
PROCEDURE PrintSignature@21(Sign@1000 : Text[30]);										
VAR										
DSTR1@1001 : Text[100];										
BEGIN										
//PrintSignature										
"PrintLine(2,'');"										
"PrintLine(2,'');"										
"PrintLine(2,'');"										
PrintSeperator(2);										
										
DSTR1 := '#C######################################';										
IF Sign='' THEN										
Value[1] := Text094										
ELSE										
Value[1] := Sign;										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
										
PROCEDURE PrintSeperator@29(Tray@1000 : Integer);										
VAR										
LineLength@1001 : Integer;										
DSTR1@1002 : Text[100];										
BEGIN										
//PrintSeperator										
IF Tray = 2 THEN										
LineLength := LineLen										
ELSE IF Tray = 4 THEN										
LineLength := InvLineLen;										
										
//CSPNT160116										
"DSTR1 := '#C' + StringPad('#',LineLength - 2);"										
"Value[1] := StringPad('-',LineLength);"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
										
PROCEDURE PrintBarcode@35(Tray@1000 : Integer;BCString@1001 : Code[50];Width@1200070000 : Integer;Height@1200070001 : Integer;bcType	@10	2	:	Cod	e[10];bcPos@1003 : Integer);					
BEGIN										
//PrintBarCode										
PrintBuffer.INIT;										
"//LS7.1-13 PrintBuffer.""Transaction No."" := PrintBufferTransNo;"										
"PrintBuffer.""Buffer Index"" := PrintBufferIndex;"										
"PrintBuffer.""Station No."" := Tray;"										
"PrintBuffer.""Page No."" := PageNo;"										
"PrintBuffer.""Printed Line No."" := LinesPrinted;"										
PrintBuffer.LineType := PrintBuffer.LineType::PrintBarcode;										
PrintBuffer.Text := BCString;										
PrintBuffer.Width := Width;										
PrintBuffer.Height := Height;										
PrintBuffer.BCType := bcType;										
PrintBuffer.BCPos := bcPos;										
PrintBuffer.INSERT;										
//SavePrinterBufferRecord(PrintBuffer);  //LS7.1-35										
PrintBufferIndex += 1;										
END;										
										
PROCEDURE PrintLogo@40(Tray@1000 : Integer);										
BEGIN										
//PrintLogo										
PrintBuffer.INIT;										
"//LS7.1-13 PrintBuffer.""Transaction No."" := PrintBufferTransNo;"										
"PrintBuffer.""Buffer Index"" := PrintBufferIndex;"										
"PrintBuffer.""Station No."" := Tray;"										
"PrintBuffer.""Page No."" := PageNo;"										
"PrintBuffer.""Printed Line No."" := LinesPrinted;"										
PrintBuffer.LineType := PrintBuffer.LineType::PrintLogo;										
PrintBuffer.INSERT;										
//SavePrinterBufferRecord(PrintBuffer);  //LS7.1-35										
PrintBufferIndex += 1;										
END;										
										
PROCEDURE PrintTransInfoCode@39(VAR TransInfoEntry@1000 : Record 99001478;Tray@1001 : Integer;PrintSep@1002 : Boolean);										
BEGIN										
//PrintInfoCode										
IF TransInfoEntry.FIND('-') THEN REPEAT										
"PrintInfoCodeLine(Tray,FALSE,TransInfoEntry.Infocode,TransInfoEntry.Subcode,TransInfoEntry.Information,TransInfoEntry.""Line No."""	);	//L	S7	-0.1	2					
UNTIL TransInfoEntry.NEXT = 0;										
IF PrintSep THEN										
"PrintLine(Tray,'');"										
END;										
										
PROCEDURE PrintPOSTransInfoCode@62(VAR POSTransInfoEntry@1000 : Record 99008982;Tray@1001 : Integer;PrintSep@1002 : Boolean);										
BEGIN										
//PrintInfoCode										
IF POSTransInfoEntry.FIND('-') THEN REPEAT										
"PrintInfoCodeLine(Tray,FALSE,POSTransInfoEntry.Infocode,POSTransInfoEntry.Subcode,POSTransInfoEntry.Information,POSTransInfoEntr"	"y."""	Lin	e	No.	"""); //LS7.1-02"					
UNTIL POSTransInfoEntry.NEXT = 0;										
IF PrintSep THEN										
"PrintLine(Tray,'');"										
END;										
										
PROCEDURE PrintInfoCodeLine@63(Tray@1000 : Integer;PrintSep@1001 : Boolean;ICode@1002 : Code[10];ISubCode@1007 : Code[20];Informatio	n@1	8	:	Te	xt[100];LineNo@1100409000 : Integer);					
VAR										
InfoCode@1003 : Record 99001482;										
InfoSub@1004 : Record 99001483;										
DSTR@1005 : Text[50];										
InfoText@1006 : Text[250];										
BEGIN										
//PrintInfoCode										
//LS7.1-02										
DSTR := '  #T####################################';										
IF InfoCode.GET(ICode) THEN BEGIN										
InfoText := '';										
"IF InfoCode.""Print Prompt on Receipt"" THEN"										
InfoText := InfoText + InfoCode.Prompt + ' ';										
"IF InfoCode.""Print Input on Receipt"" THEN"										
InfoText := InfoText + Information + ' ';										
"IF InfoCode.""Print Inp. Name on Rcpt."" THEN"										
"IF InfoSub.GET(InfoCode.Code,ISubCode) THEN"										
InfoText := InfoText + InfoSub.Description + ' ';										
IF InfoText <> '' THEN BEGIN										
WHILE InfoText <> '' DO BEGIN										
"Value[1] := COPYSTR(InfoText,1,LineLen - 2);"										
IF STRLEN(InfoText) > (LineLen - 2) THEN										
"InfoText := COPYSTR(InfoText,LineLen - 1,STRLEN(InfoText) - (LineLen - 2))"										
ELSE										
InfoText := '';										
NodeName[1] := 'Extra Info Line'; //LS7.1-02										
//LS7.1-02 -										
Value[1] := FORMAT(LineNo); //LS7.1-02										
NodeName[1] := 'Line No.';										
//LS7.1-02 +										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR),FALSE,FALSE,FALSE,FALSE));"										
"AddPrintLine(350,2,NodeName,Value,DSTR,FALSE,FALSE,FALSE,FALSE,Tray); //LS7.1-02"										
END;										
IF PrintSep THEN										
"PrintLine(Tray,'');"										
END;										
END;										
END;										
										
PROCEDURE OpenReceiptPrinter@65(Tray@1000 : Integer;Role@1100409000 : Code[10];SubRole@1100409001 : Code[20];TransNo@1100409002 : In	teg	er;	Re	cei	ptNo@1100409003 : Code[20]) : Boolean;					
BEGIN										
//OpenReceiptPrinter										
Initialize(Globals.HardwareProfileID); //LS7.1-13										
"EXIT(OpenPrinter(Role, SubRole, Globals.HardwareProfileID,Tray, TransNo, ReceiptNo));"										
END;										
										
PROCEDURE OpenPrinter@10(RoleID@1001 : Code[10];SubRoleID@1100409000 : Code[20];ProfileID@1002 : Code[10];Tray@1000 : Integer;TransN	o@1	100	40	900	3 : Integer;ReceiptNo@1100409004 : Code[20]) : Boolean;					
VAR										
DeviceID@1100409001 : Code[10];										
DeviceRole@1100409002 : Record 99001798;										
onlyOne@1100409006 : Boolean;										
i@1100409005 : Integer;										
BEGIN										
//OpenPrinter										
										
//LS7.1-13-										
"IF NOT DeviceRole.GET(0, RoleID, SubRoleID) THEN BEGIN"										
"//LastErrorText := STRSUBSTNO(Text351, RoleID, SubRoleID);"										
//EXIT(FALSE);										
DeviceRole.Description := RoleID + ' ' + SubRoleID;										
END;										
										
PrintBufferIndex := 0;										
PrintBuffer.RESET;										
PrintBuffer.DELETEALL;										
										
IF NOT NoPrint_BufferOnly THEN BEGIN										
ActivePrintHeader.INIT;										
"ActivePrintHeader.""Store No."" := Globals.StoreNo();"										
"ActivePrintHeader.""Terminal No."" := Globals.TerminalNo;"										
"ActivePrintHeader.""Entry No."" := POSSESSION.GetNextPrintEntryNo();"										
"ActivePrintHeader.""Transaction No."" := TransNo;"										
"ActivePrintHeader.""Created Date"" := TODAY;"										
"ActivePrintHeader.""Created Time"" := TIME;"										
"ActivePrintHeader.""Receipt No."" := ReceiptNo;"										
"ActivePrintHeader.""Print Role"" := RoleID;"										
"ActivePrintHeader.""Print Sub Role"" := SubRoleID;"										
"ActivePrintHeader.""Hardware Profile"" := PosSetup.""Profile ID"";"										
ActivePrintHeader.Training := POSSESSION.GetTrainingStatus <> '';										
										
IF NOT ActivePrintHeader.INSERT THEN BEGIN										
"LastErrorText := STRSUBSTNO(Text355, ActivePrintHeader.TABLENAME, RoleID, SubRoleID);"										
EXIT(FALSE);										
END;										
										
FiscalON := FALSE;										
OnlyFiscal := TRUE;										
										
"ActivePrintEntryNo := ActivePrintHeader.""Entry No."";"										
i := -1;										
WHILE i < 5 DO BEGIN //5 max devices										
i += 1;										
"IF PosSetup.GetDevice(0, RoleID, SubRoleID, i, DeviceID) THEN BEGIN"										
IF ActivePrinter.GET(DeviceID) THEN BEGIN										
ActivePrintLine.INIT;										
"ActivePrintLine.""Store No."" := Globals.StoreNo();"										
"ActivePrintLine.""Terminal No."" := Globals.TerminalNo;"										
"ActivePrintLine.""Entry No."" := ActivePrintEntryNo;"										
"ActivePrintLine.""Line No."" := i;"										
"ActivePrintLine.""Transaction No."" := TransNo;"										
"ActivePrintLine.""Receipt No."" := ReceiptNo;"										
"ActivePrintLine.""Print Role"" := RoleID;"										
"ActivePrintLine.""Print Sub Role"" := SubRoleID;"										
"ActivePrintLine.""Start Date"" := TODAY;"										
"ActivePrintLine.""Start Time"" := TIME;"										
"ActivePrintLine.""Printer ID"" := ActivePrinter.ID;"										
ActivePrintLine.Printer := ActivePrinter.Printer;										
"ActivePrintLine.""Printer Device Name"" := ActivePrinter.""Printer Device Name"";"										
"ActivePrintLine.""Fiscal Printer"" := ActivePrinter.""Fiscal Printer"";"										
"ActivePrintLine.""Session Staff ID"" := POSSESSION.StaffID();"										
										
IF NOT ActivePrintLine.INSERT() THEN BEGIN										
"LastErrorText := STRSUBSTNO(Text355, ActivePrintLine.TABLENAME, RoleID, SubRoleID);"										
EXIT(FALSE);										
END;										
										
"IF ActivePrintLine.""Fiscal Printer"" THEN"										
FiscalON := TRUE										
ELSE										
OnlyFiscal := FALSE;										
END										
ELSE BEGIN										
"LastErrorText := STRSUBSTNO(Text354, DeviceID);"										
EXIT(FALSE);										
END;										
END										
ELSE IF (i = 0) AND (NOT WebPrinting) THEN BEGIN										
IF PosSetup.Printer = PosSetup.Printer::None THEN BEGIN										
"LastErrorText := STRSUBSTNO(Text350, RoleID, SubRoleID, PosSetup.""Profile ID"");"										
EXIT(FALSE);										
END										
ELSE BEGIN										
//USING DEFAULT HARDWARE PROFILE PRINTER... (old way)										
i := 6;										
ActivePrintLine.INIT;										
"ActivePrintLine.""Store No."" := Globals.StoreNo();"										
"ActivePrintLine.""Terminal No."" := Globals.TerminalNo;"										
"ActivePrintLine.""Entry No."" := ActivePrintEntryNo;"										
"ActivePrintLine.""Line No."" := i;"										
"ActivePrintLine.""Transaction No."" := TransNo;"										
"ActivePrintLine.""Start Date"" := TODAY;"										
"ActivePrintLine.""Start Time"" := TIME;"										
"ActivePrintLine.""Printer ID"" := '';"										
ActivePrintLine.Printer := PosSetup.Printer;										
"ActivePrintLine.""Printer Device Name"" := PosSetup.""Printer Device Name"";"										
"ActivePrintLine.""Fiscal Printer"" := PosSetup.""Fiscal Printer"";"										
IF OverrideWindowPrinterName <> '' THEN BEGIN										
ActivePrintLine.Printer := ActivePrintLine.Printer::Windows;										
"ActivePrintLine.""Printer Device Name"" := OverrideWindowPrinterName;"										
OverrideWindowPrinterName := '';										
END										
"ELSE IF PosSetup.""OPOS Windows Printing"" THEN BEGIN"										
ActivePrintLine.Printer := ActivePrintLine.Printer::Windows;										
"ActivePrintLine.""Printer Device Name"" := PosSetup.""Windows Printer"";"										
END;										
IF NOT ActivePrintLine.INSERT() THEN BEGIN										
"LastErrorText := STRSUBSTNO(Text355, ActivePrintLine.TABLENAME, RoleID, SubRoleID);"										
EXIT(FALSE);										
END;										
										
"IF ActivePrintLine.""Fiscal Printer"" THEN"										
FiscalON := TRUE										
ELSE										
OnlyFiscal := FALSE;										
END;										
END;										
END;										
										
"IF WebPrinting THEN BEGIN //Add ""Web Printer"""										
i += 1;										
ActivePrintLine.INIT;										
"ActivePrintLine.""Store No."" := Globals.StoreNo();"										
"ActivePrintLine.""Terminal No."" := Globals.TerminalNo;"										
"ActivePrintLine.""Entry No."" := ActivePrintEntryNo;"										
"ActivePrintLine.""Line No."" := i;"										
"ActivePrintLine.""Transaction No."" := TransNo;"										
"ActivePrintLine.""Start Date"" := TODAY;"										
"ActivePrintLine.""Start Time"" := TIME;"										
"ActivePrintLine.""Printer ID"" := '#E-MAIL#';"										
ActivePrintLine.Printer := ActivePrintLine.Printer::Email;										
"ActivePrintLine.""Printer Device Name"" := COPYSTR(MailRecipients, 1, 200);"										
IF NOT ActivePrintLine.INSERT() THEN BEGIN										
"LastErrorText := STRSUBSTNO(Text355, ActivePrintLine.TABLENAME, RoleID, SubRoleID);"										
EXIT(FALSE);										
END;										
END;										
										
COMMIT;  //ATH Ëetta ver–ur a– committa .. losa lësingu † Print Header og Lines tîflunum..										
//mëtti sko–a a– hafa Áetta ° temp og flusha eftir prentun..										
//										
										
END; //NoPrint_BufferOnly										
										
//IF Tray = 2 THEN										
"//  LeftMargin := StringPad(' ',PosSetup.""Left Margin on Receipt"")"										
//ELSE										
//  LeftMargin := '';										
										
//LS7.1-13+										
										
PrintBuffer.INIT;										
"//LS7.1-13 PrintBuffer.""Transaction No."" := PrintBufferTransNo;"										
"PrintBuffer.""Buffer Index"" := PrintBufferIndex;"										
"PrintBuffer.""Station No."" := Tray;"										
"PrintBuffer.""Page No."" := PageNo;"										
"PrintBuffer.""Printed Line No."" := LinesPrinted;"										
PrintBuffer.LineType := PrintBuffer.LineType::StartTransaction;										
PrintBuffer.HostID := ActivePrinter.ID;										
PrintBuffer.Text := DeviceRole.Description;										
PrintBuffer.ProfileID := ProfileID;										
PrintBuffer.Training := ActivePrintHeader.Training; //LS7.1-13										
PrintBuffer.INSERT;										
//SavePrinterBufferRecord(PrintBuffer);  //LS7.1-35										
PrintBufferIndex += 1;										
										
LinesPrinted := 0;										
PageNo := 1;										
IsInvoice := FALSE;										
										
IF NOT NoPrint_BufferOnly THEN BEGIN										
"POSGUI.ScreenDisplay(STRSUBSTNO(Text353, DeviceRole.Description));"										
DisplayOpen := TRUE;										
END;										
										
EXIT(TRUE);										
END;										
										
PROCEDURE ClosePrinter@11(Tray@1000 : Integer) : Boolean;										
VAR										
i@1001 : Integer;										
RecRef@1100409000 : RecordRef;										
BEGIN										
//ClosePrinter										
IF Tray = 4 THEN										
RemovePage;										
										
//LS7.1-13 ELSE BEGIN										
"//LS7.1-13   FOR i := 1 TO PosSetup.""No. of LF at Receipt End"" DO"										
"//LS7.1-13     PrintLine(Tray,'');"										
//LS7.1-13 END;										
										
PrintBuffer.INIT;										
"//LS7.1-13 PrintBuffer.""Transaction No."" := PrintBufferTransNo;"										
"PrintBuffer.""Buffer Index"" := PrintBufferIndex;"										
"PrintBuffer.""Station No."" := Tray;"										
"PrintBuffer.""Page No."" := PageNo;"										
"PrintBuffer.""Printed Line No."" := LinesPrinted;"										
PrintBuffer.LineType := PrintBuffer.LineType::EndTransaction;										
"IF PosSetup.""Printer Cut Percentage"" <> 0 THEN BEGIN"										
PrintBuffer.Height := 1;										
"PrintBuffer.Width := PosSetup.""Printer Cut Percentage"";"										
END;										
PrintBuffer.INSERT;										
//SavePrinterBufferRecord(PrintBuffer);  //LS7.1-35										
PrintBufferIndex += 1;										
										
//POSGUI.PrintBuffer(pRecRef)										
										
PrintBuffer.RESET;										
										
IF NoPrint_BufferOnly THEN										
EXIT(TRUE);										
										
ActivePrintLine.RESET;										
"ActivePrintLine.SETRANGE(""Store No."", Globals.StoreNo);"										
"ActivePrintLine.SETRANGE(""Terminal No."", Globals.TerminalNo);"										
"ActivePrintLine.SETRANGE(""Entry No."", ActivePrintEntryNo);"										
IF ActivePrintLine.FIND('-') THEN										
REPEAT										
"POSGUI.ScreenDisplay(STRSUBSTNO(Text353, ActivePrintLine.Printer));"										
LastErrorText := '';										
IF ActivePrintLine.Printer = ActivePrintLine.Printer::Email THEN BEGIN										
ActivePrintLine.Error := NOT SendEmail();										
"ActivePrintLine.""Error Reason"" := LastErrorText;"										
"ActivePrintLine.""Finished Date"" := TODAY;"										
"ActivePrintLine.""Finished Time"" := TIME;"										
ActivePrintLine.MODIFY;										
END										
ELSE IF ActivePrintLine.Printer = ActivePrintLine.Printer::Windows THEN BEGIN										
//WINDOWS REPORT (from func profile ??)										
"ActivePrintLine.Error := NOT PrintToWindowsPrinter(ActivePrintLine.""Printer Device Name"");"										
										
"ActivePrintLine.""Error Reason"" := LastErrorText;"										
"ActivePrintLine.""Finished Date"" := TODAY;"										
"ActivePrintLine.""Finished Time"" := TIME;"										
ActivePrintLine.MODIFY;										
END										
"ELSE BEGIN //OPOS,VIRTUAL"										
RecRef.GETTABLE(PrintBuffer);										
"ActivePrintLine.Error := NOT POSGUI.PrintBufferEx(ActivePrintLine.""Printer ID"", RecRef, LastErrorText, FALSE);"										
"ActivePrintLine.""Error Reason"" := LastErrorText;"										
"ActivePrintLine.""Finished Date"" := TODAY;"										
"ActivePrintLine.""Finished Time"" := TIME;"										
ActivePrintLine.MODIFY;										
END;										
UNTIL ActivePrintLine.NEXT = 0;										
										
"//IF PosSetup.""OPOS Windows Printing"" OR WebPrinting THEN BEGIN"										
//  PrintToWindowsPrinter;										
//END;										
IF DisplayOpen THEN BEGIN										
POSGUI.ScreenDisplay('');										
DisplayOpen := FALSE;										
END;										
										
EXIT(TRUE);										
END;										
										
PROCEDURE InsertPage@42(MsgTxt@1000 : Text[50]) : Boolean;										
BEGIN										
//InsertPage										
										
PrintBuffer.INIT;										
"//LS7.1-13 PrintBuffer.""Transaction No."" := PrintBufferTransNo;"										
"PrintBuffer.""Buffer Index"" := PrintBufferIndex;"										
"PrintBuffer.""Page No."" := PageNo;"										
"PrintBuffer.""Printed Line No."" := LinesPrinted;"										
PrintBuffer.LineType := PrintBuffer.LineType::InsertPage;										
PrintBuffer.Text := MsgTxt;										
PrintBuffer.INSERT;										
//SavePrinterBufferRecord(PrintBuffer);  //LS7.1-35										
PrintBufferIndex += 1;										
										
EXIT(TRUE);										
END;										
										
PROCEDURE RemovePage@43() : Boolean;										
BEGIN										
//RemovePage										
										
PrintBuffer.INIT;										
"//LS7.1-13 PrintBuffer.""Transaction No."" := PrintBufferTransNo;"										
"PrintBuffer.""Buffer Index"" := PrintBufferIndex;"										
"PrintBuffer.""Page No."" := PageNo;"										
"PrintBuffer.""Printed Line No."" := LinesPrinted;"										
PrintBuffer.LineType := PrintBuffer.LineType::RemovePage;										
PrintBuffer.INSERT;										
//SavePrinterBufferRecord(PrintBuffer);  //LS7.1-35										
PrintBufferIndex += 1;										
										
EXIT(TRUE);										
END;										
										
PROCEDURE PrintLine@9(Tray@1000 : Integer;TxtLine@1001 : Text[100]);										
VAR										
i@10012000 : Integer;										
Transaction@1002 : Record 99001472;										
BEGIN										
//PrintLine										
IF IsInvoice AND (Tray = 4) THEN BEGIN										
"PosSetup.TESTFIELD(PosSetup.""No. of Lines on Invoice"");"										
"IF LinesPrinted >= PosSetup.""No. of Lines on Invoice"" THEN BEGIN"										
LinesPrinted := 0;										
PageNo := PageNo + 1;										
RemovePage;										
InsertPage(Text097);										
END;										
IF LinesPrinted = 0 THEN BEGIN										
LinesPrinted := LinesPrinted + 1;										
"//LS7.1-13 FOR i := 1 TO PosSetup.""No. of LF at Invoice Top"" DO"										
"//LS7.1-13   PrintLine(4,'');"										
IF PageNo <> 1 THEN BEGIN										
Transaction.Date := TODAY;										
Transaction.Time := TIME;										
"PrintHeader(Transaction,FALSE,4);"										
"IF glTrans.""Transaction No."" <> 0 THEN"										
"PrintSubHeader(glTrans,4,glTrans.Date,glTrans.Time);"										
END;										
LinesPrinted := LinesPrinted - 1;										
END;										
END;										
LinesPrinted := LinesPrinted + 1;										
										
PrintBuffer.INIT;										
"//LS7.1-13 PrintBuffer.""Transaction No."" := PrintBufferTransNo;"										
"PrintBuffer.""Buffer Index"" := PrintBufferIndex;"										
"PrintBuffer.""Station No."" := Tray;"										
"PrintBuffer.""Page No."" := PageNo;"										
"PrintBuffer.""Printed Line No."" := LinesPrinted;"										
PrintBuffer.LineType := PrintBuffer.LineType::PrintLine;										
PrintBuffer.Text := TxtLine;										
PrintBuffer.FontType := ActiveFontType; //LS7.1-13										
PrintBuffer.INSERT;										
//SavePrinterBufferRecord(PrintBuffer);  //LS7.1-35										
PrintBufferIndex += 1;										
END;										
										
PROCEDURE FormatLine@2(Txt@1000 : Text;Wide@1001 : Boolean;Bold@1002 : Boolean;High@1003 : Boolean;Italic@1004 : Boolean) : Text[100	];									
VAR										
TmpTxt@1005 : Text[100];										
Par@1006 : Text[250];										
BEGIN										
//FormatLine										
										
//LS7.1-13-										
RetailSetup.GET;										
										
IF RetailSetup.ImpRollo THEN										
"InsertPrintingCopy(Txt, Wide, Bold, High, Italic);  // CSRG01"										
										
IF Wide AND High THEN										
ActiveFontType := ActiveFontType::WideAndHight										
ELSE IF Wide THEN										
ActiveFontType := ActiveFontType::Wide										
ELSE IF High THEN										
ActiveFontType := ActiveFontType::High										
ELSE IF Bold THEN										
ActiveFontType := ActiveFontType::Bold										
ELSE										
ActiveFontType := ActiveFontType::Normal;										
										
EXIT(Txt);										
										
{										
IF ScreenDisplay THEN EXIT(Txt);										
"IF PosSetup.""OPOS Windows Printing"" OR WebPrinting THEN BEGIN"										
TmpTxt := '';										
IF Wide AND High THEN										
TmpTxt := '4_'										
ELSE IF Wide THEN										
TmpTxt := '2_'										
ELSE IF High THEN										
TmpTxt := '3_'										
ELSE IF Bold THEN										
TmpTxt := '1_'										
ELSE										
TmpTxt := '0_';										
										
Par := LeftMargin;										
IF Wide THEN										
"Par := COPYSTR(Par,1,ROUND(STRLEN(Par) / 2,1));"										
										
EXIT(TmpTxt + Par + Txt);										
END;										
										
TmpTxt := '';										
IF Wide AND High THEN										
"TmpTxt := CreateEscapeChar(PosSetup.""Printer Wide / High"")"										
ELSE IF Wide THEN										
"TmpTxt := CreateEscapeChar(PosSetup.""Printer Wide"")"										
ELSE IF High THEN										
"TmpTxt := CreateEscapeChar(PosSetup.""Printer High"")"										
ELSE IF Bold THEN										
"TmpTxt := TmpTxt + CreateEscapeChar(PosSetup.""Printer Bold"")"										
ELSE										
"TmpTxt := CreateEscapeChar(PosSetup.""Printer Normal"");"										
										
Par := LeftMargin;										
IF Wide THEN										
"Par := COPYSTR(Par,1,ROUND(STRLEN(Par) / 2,1));"										
										
EXIT(TmpTxt + Par + Txt);										
}										
//LS7.1-13+										
END;										
										
PROCEDURE CreateEscapeChar@6(InText@1001 : Text[30]) OutText@1000 : Text[30];										
VAR										
Character@1002 : Text[1];										
Chr@1003 : Char;										
ReadToken@1004 : Boolean;										
Endtoken@1005 : Boolean;										
TmpText@1006 : Text[30];										
Int@1007 : Integer;										
i@1008 : Integer;										
Totlen@1009 : Integer;										
BEGIN										
//CreateEscapeChar										
CLEAR(OutText);										
CLEAR(TmpText);										
ReadToken := FALSE;										
i := 0;										
Totlen := STRLEN(InText);										
										
FOR i := 1 TO Totlen DO BEGIN										
"Character := COPYSTR(InText,i,1);"										
CASE Character OF										
'<':										
BEGIN										
ReadToken := TRUE;										
END;										
'>':										
BEGIN										
ReadToken := FALSE;										
IF TmpText <> '' THEN BEGIN										
"EVALUATE(Int,TmpText);"										
Chr := Int;										
OutText := OutText + FORMAT(Chr);										
TmpText := '';										
END;										
END;										
ELSE										
BEGIN										
IF ReadToken THEN										
TmpText := TmpText + Character;										
END;										
END;										
END;										
END;										
										
LOCAL PROCEDURE Initialize@5(ProfileID@1001 : Code[10]);										
BEGIN										
//Initialize										
										
LastErrorText := '';                //LS7.1-13										
										
PrintBuffer.INIT;										
"//LS7.1-13 PrintBuffer.""Transaction No."" := PrintBufferTransNo;"										
"PrintBuffer.""Buffer Index"" := PrintBufferIndex;"										
"PrintBuffer.""Page No."" := PageNo;"										
"PrintBuffer.""Printed Line No."" := LinesPrinted;"										
PrintBuffer.LineType := PrintBuffer.LineType::InitPrinter;										
//LS7.1-13 PrintBuffer.HostID := HostID;										
PrintBuffer.ProfileID := ProfileID;										
PrintBuffer.INSERT;										
//SavePrinterBufferRecord(PrintBuffer);  //LS7.1-35										
PrintBufferIndex += 1;										
										
//LS7.1-13-										
"IF PosSetup.""Profile ID"" <> ProfileID THEN"										
PosSetup.GET(ProfileID);										
//LS7.1-13+										
IF LineLen = 0 THEN BEGIN										
//LS7.1-13 PosSetup.GET(Globals.HardwareProfileID);										
Store.GET(Globals.StoreNo);										
GenPosFunc.GET(Globals.FunctionalityProfileID);										
"Globals.SetValue('LAST_ZID','');"										
//CSPNT011015 caracteres ticket										
LineLen := 40;										
//CSPNT021015  caracteres factura										
InvLineLen := 68;										
"//LS7.1-13 TimeOut := PosSetup.""Doc. Insert/Removal Timeout"" * 1000;"										
//LS7.1-13 CurrencySymbol := Globals.GetValue('CURRSYM');										
POSFunctions.InitPosFunctions;										
//LS7.1-13 ReceiptStation := 2;										
//LS7.1-13 SlipStation := 4;										
END;										
END;										
										
PROCEDURE WindowInitialize@1200070003();										
BEGIN										
//WindowInitialize										
//Initalize records										
LastErrorText := ''; //LS7.1-13										
PosSetup.GET(Globals.HardwareProfileID);										
Store.GET(Globals.StoreNo);										
GenPosFunc.GET(Globals.FunctionalityProfileID);										
END;										
										
PROCEDURE BufferDiscount@15(VAR codeArr@1000 : ARRAY [250] OF Code[20];VAR decArr@1001 : ARRAY [250] OF Decimal;VAR numItems@1002 :	Int	ege	r;	cod	eAdd@1003 : Code[20];decAdd@1004 : Decimal);					
VAR										
found@1005 : Boolean;										
i@1006 : Integer;										
BEGIN										
//BufferDiscount										
found := FALSE;										
FOR i := 1 TO numItems DO										
IF codeArr[i] = codeAdd THEN BEGIN										
decArr[i] := decArr[i] + decAdd;										
found := TRUE;										
END;										
										
IF NOT found THEN BEGIN										
numItems := numItems + 1;										
codeArr[numItems] := codeAdd;										
decArr[numItems] := decAdd;										
END;										
END;										
										
PROCEDURE FormatStr@18(Value@1000 : ARRAY [10] OF Text[100];Design@1001 : Text[100]) : Text[100];										
VAR										
k@1002 : Integer;										
Pos@1003 : Integer;										
Pos2@1004 : Integer;										
Stars@1005 : Text[50];										
Blanks@1006 : Text[50];										
Zeros@1007 : Text[50];										
Len@1008 : Integer;										
LenValue@1009 : Integer;										
Type@1010 : Text[1];										
AddToStr@1011 : Text[50];										
a@1012 : Integer;										
b@1013 : Integer;										
tmpPos@1014 : Integer;										
BEGIN										
//FormatStr										
										
										
Stars  := '************************************************';										
Blanks := '                                                ';										
Zeros  := '000000000000000000000000000000000000000000000000';										
k := 0;										
"Pos := STRPOS(Design,'#');"										
IF Pos = 0 THEN										
EXIT('');										
WHILE Pos <> 0 DO BEGIN										
Pos2 := Pos;										
"Type := COPYSTR(Design,Pos + 1,1);"										
Pos2 := Pos + 2;										
"WHILE COPYSTR(Design,Pos2,1) = '#' DO"										
Pos2 := Pos2 + 1;										
k := k + 1;										
Len := Pos2 - Pos;										
LenValue := STRLEN(Value[k]);										
IF Len < LenValue THEN BEGIN										
IF (Type = 'N') OR (Type = 'Z') THEN										
"AddToStr := COPYSTR(Stars,1,Len)"										
ELSE										
"AddToStr := COPYSTR(Value[k],1,Len);"										
END										
ELSE BEGIN										
CASE Type OF										
"'N' : AddToStr := COPYSTR(Blanks,1,Len - LenValue) + Value[k];"										
"'Z' : AddToStr := COPYSTR(Zeros,1,Len - LenValue) + Value[k];"										
'T' : AddToStr := Value[k];										
"'L' : AddToStr := Value[k] + COPYSTR(Blanks,1,Len - LenValue);"										
"'R' : AddToStr := COPYSTR(Blanks,1,Len - LenValue) + Value[k];"										
'C' : BEGIN										
"a := ROUND((Len - LenValue) / 2,1,'<');"										
b := Len - LenValue - a;										
"AddToStr := COPYSTR(Blanks,1,a) + Value[k] + COPYSTR(Blanks,1,b);"										
END;										
END;										
END;										
"tmpPos := STRPOS(COPYSTR(Design,Pos2),'#');"										
IF Pos <> 1 THEN										
"Design := COPYSTR(Design,1,Pos - 1) + AddToStr + COPYSTR(Design,Pos2)"										
ELSE										
"Design := AddToStr + COPYSTR(Design,Pos2);"										
										
IF tmpPos <> 0 THEN										
IF (Type = 'T') AND (LenValue < Len) THEN										
Pos := Pos2 + tmpPos - Len + LenValue - 1										
ELSE										
Pos := Pos2 + tmpPos - 1										
ELSE										
Pos := 0;										
END;										
EXIT(Design);										
END;										
										
"PROCEDURE PrintXZReport@31(RunType@1100409025 : 'X,Z,Y') : Boolean;"										
VAR										
PaymTrans2@1001 : Record 99001474;										
PaymTrans3@1018 : Record 99001474;										
PaymTemp@1019 : TEMPORARY Record 99001474;										
Terminal@1002 : Record 99001471;										
Staff@1003 : Record 99001461;										
SCode@1200070000 : Code[20];										
Transaction@1005 : Record 99001472;										
Transaction2@1100409016 : Record 99001472;										
IncExpAccount@1006 : Record 99001476;										
IncExpEntry@1007 : Record 99001475;										
SuspTrans@1016 : Record 99008980;										
DSTR1@1008 : Text[80];										
YReportID@1100409032 : Code[10];										
ZReportID@1009 : Code[10];										
FloatTotal@1011 : Decimal;										
RemoveTotal@1012 : Decimal;										
SalesTotal@1013 : Decimal;										
TendDeclEntry2@1014 : Record 99001465;										
IncExpEntry2@1015 : Record 99001475;										
RecCount@1020 : Integer;										
TSUtil@1200070001 : Codeunit 99008909;										
POSGUI@1100409007 : Codeunit 99001575;										
TransServerWorkTable@1100409000 : Record 99001615;										
TransNotSent@1100409001 : Integer;										
SuspTransLine@1100409002 : Record 99008981;										
POSTransactionSuspend@1100409008 : Record 99008980;										
POSTransactionSuspendTEMP@1100409011 : TEMPORARY Record 99008980;										
POSTransactionSuspendMM@1100409013 : Record 99008980;										
POSTransLineSuspend@1100409010 : Record 99008981;										
POSTransaction@1100409014 : Codeunit 99001570;										
NoSuspended@1100409003 : Integer;										
NoSuspPrepayment@1100409004 : Integer;										
SuspPrepayment@1100409005 : Decimal;										
PrintHeaderLines@1100409006 : Boolean;										
TSErr@1100409012 : Integer;										
YReportStats@1100409031 : Record 99008956;										
ZReportStats@1100409015 : Record 99008955;										
lText001@1100409017 : TextConst 'ENU=No of Trans. not on Z-report;ESP=Nß de Trans. que no est†n en el Informe-Z';										
"lText002@1100409018 : TextConst 'ENU=""    Date of oldest Trans."";ESP=""    Fecha de la Trans. m†s antigua""';"										
lText003@1100409019 : TextConst 'ENU=Total Trans not on Z-report;ESP=Total Trans. que no est†n en Informe-Z';										
OldestDate@1100409020 : Date;										
NoTables@1100409021 : Integer;										
NoSplitTrans@1100409022 : Integer;										
lText004@1100409023 : TextConst 'ENU=Unsent WarrHotel entries;ESP=Movs. Garant.Hotel No env.';										
WHBatchQueue@1100409024 : Record 99008979;										
LineFound@1100409030 : Boolean;										
lSafeType@1100409029 : Integer;										
NoOfLines@1100409028 : Integer;										
HeaderText@1100409027 : Text[50];										
TotalSafeType@1100409026 : Decimal;										
BEGIN										
//PrintXZReport										
IF NOT Staff.GET(Globals.StaffID) THEN										
EXIT(TRUE);										
IF NOT Terminal.GET(Globals.TerminalNo) THEN										
EXIT(TRUE);										
										
"IF NOT OpenReceiptPrinter(2, 'TENDER', 'ZXREPORT', 0, '') THEN"										
EXIT(FALSE);										
										
//LS7.1-13-										
IF FiscalON THEN BEGIN										
FiscalPrintXZReport(RunType);										
IF OnlyFiscal THEN										
EXIT( ClosePrinter(2) );										
END;										
//LS7.1-13+										
										
"IF NOT Terminal.""Terminal Statement"" THEN"										
"Terminal.""Statement Method"" := Store.""Statement Method"";"										
										
//Print Header info										
DSTR1 := '#L######## #L#########';										
Value[1] := Text078 + ':';										
"Value[2] := Store.""No."";"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
										
"IF Terminal.""Statement Method"" = Terminal.""Statement Method""::""POS Terminal"" THEN BEGIN"										
DSTR1:='#L####### #L########';										
Value[1] := Text079 + ':';										
"Value[2] := Terminal.""No."";"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
END;										
										
SCode := POSFunctions.GetStatementCode;										
										
Transaction.Date := TODAY;										
Transaction.Time := TIME;										
PrintLogo(2); //LS7.1-06										
"PrintHeader(Transaction,FALSE,2);"										
										
DSTR1 := '#L#### #T###### #T#### ';										
Value[1] := Text048 + ':';										
Value[2] := FORMAT(TODAY());										
"Value[3] := FORMAT(TIME(),5);"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
										
DSTR1 := '#L###### #L############';										
Value[1] := Text051 + ':';										
"IF Staff.""Name on Receipt""<>'' THEN"										
"Value[2] := Staff.""Name on Receipt"""										
ELSE										
Value[2] := Globals.StaffID;										
										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
PrintSeperator(2);										
										
//X or Z Report..										
DSTR1:='#C###################';										
										
CASE RunType OF										
RunType::Z:										
Value[1] := Text106;										
RunType::X:										
Value[1] := Text107;										
RunType::Y:										
Value[1] := Text108;										
END;										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),TRUE,TRUE,TRUE,FALSE));"										
"IF GenPosFunc.""TS Floating Cashier"" AND"										
"(Terminal.""Statement Method"" = Terminal.""Statement Method""::Staff) AND"										
(Globals.GetValue('TS_ERROR') <> '') THEN BEGIN										
"PrintLine(2,'');"										
"PrintLine(2,FormatLine(STRSUBSTNO(Text141,Terminal.""No.""),FALSE,TRUE,FALSE,FALSE));"										
END;										
										
PrintSeperator(2);										
										
// Report Body										
//  Line per Tender Type										
CLEAR(PaymEntry);										
"PaymEntry.SETCURRENTKEY(""Statement Code"",""Z-Report ID"",""Tender Type"",""Currency Code"",""Card No."");"										
"PaymEntry.SETRANGE(""Statement Code"",SCode);"										
"PaymEntry.SETRANGE(""Z-Report ID"",'');"										
IF RunType = RunType::Y THEN										
"PaymEntry.SETRANGE(""Y-Report ID"",'');"										
PaymTrans3.COPYFILTERS(PaymEntry);										
										
"TenderType.SETCURRENTKEY(""Store No."");"										
"TenderType.SETRANGE(""Store No."",Globals.StoreNo);"										
"TenderType.SETFILTER(TenderType.""Function"",'<>%1',TenderType.""Function""::""Tender Remove/Float"");"										
"TenderType.SETRANGE(""Foreign Currency"",FALSE);"										
LocalTotal := 0;										
PrintXZLines();										
										
//  Totals for LCY										
IF LocalTotal <> 0 THEN BEGIN										
PrintSeperator(2);										
DSTR1    := '#L########              #R##############';										
Value[1] := Text005 + ':';										
Value[2] := POSFunctions.FormatAmount(LocalTotal);										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
END;										
										
//  Totals for FCY										
"PrintLine(2,'');"										
"TenderType.SETRANGE(""Foreign Currency"",TRUE);"										
										
TotalLCYInCurrency := 0;										
PrintXZLines();										
IF TotalLCYInCurrency <> 0 THEN BEGIN										
PrintSeperator(2);										
DSTR1    := '#L##################### #R##############';										
Value[1] := Text300;										
Value[2] := POSFunctions.FormatAmount(TotalLCYInCurrency);										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
"PrintLine(2,'');"										
PrintSeperator(2);										
DSTR1    := '#L##################### #R##############';										
Value[1] := Text301;										
Value[2] := POSFunctions.FormatAmount(LocalTotal);										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
PrintSeperator(2);										
END;										
										
//  Floating and Removal Totals										
"TenderType.SETRANGE(""Foreign Currency"");"										
"TenderType.SETRANGE(TenderType.""Function"",TenderType.""Function""::""Tender Remove/Float"");"										
IF TenderType.FIND('-') THEN BEGIN										
PrintSeperator(2);										
REPEAT										
FOR lSafeType := 0 TO 3 DO BEGIN										
NoOfLines := 0;										
TotalSafeType := 0;										
"PaymEntry.SETRANGE(""Safe type"",lSafeType);"										
"PaymEntry.SETRANGE(""Currency Code"");"										
"PaymEntry.SETRANGE(""Card No."");"										
"PaymEntry.SETRANGE(""Tender Type"",TenderType.Code);"										
IF PaymEntry.FIND('-') THEN REPEAT										
IF NoOfLines = 0 THEN BEGIN										
IF lSafeType = 0 THEN										
HeaderText := Text320										
ELSE										
"HeaderText := FORMAT(PaymEntry.""Safe type"");"										
DSTR1 := '#C######################################';										
Value[1] := HeaderText;										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
NoOfLines := NoOfLines + 1;										
"Transaction.GET(PaymEntry.""Store No."",PaymEntry.""POS Terminal No."",PaymEntry.""Transaction No."");"										
"IF PaymEntry.""Amount Tendered"" > 0 THEN BEGIN"										
"RemoveTotal := RemoveTotal + PaymEntry.""Amount Tendered"";"										
DSTR1    := '#L############## #L###### #R############';										
"Value[1] := STRSUBSTNO('%1',Transaction.""Transaction Type"");"										
"Value[2] := Transaction.""Staff ID"";"										
"Value[3] := POSFunctions.FormatAmount(PaymEntry.""Amount Tendered"");"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END										
ELSE BEGIN										
"FloatTotal := FloatTotal + PaymEntry.""Amount Tendered"";"										
DSTR1    := '#L############## #L###### #R############';;										
"Value[1] := STRSUBSTNO('%1',Transaction.""Transaction Type"");"										
"Value[2] := Transaction.""Staff ID"";"										
"Value[3] := POSFunctions.FormatAmount(-PaymEntry.""Amount Tendered"");"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
"TotalSafeType := TotalSafeType + PaymEntry.""Amount Tendered"";"										
LineFound := TRUE;										
UNTIL PaymEntry.NEXT = 0;										
IF NoOfLines > 0 THEN BEGIN										
IF NoOfLines > 1 THEN BEGIN										
"PrintLine(2,'');"										
DSTR1    := '#L############## #L###### #R############';;										
Value[1] := Text005;										
Value[2] := '';										
Value[3] := POSFunctions.FormatAmount(TotalSafeType);										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
PrintSeperator(2);										
END										
ELSE										
PrintSeperator(2);										
END;										
END;										
UNTIL TenderType.NEXT = 0;										
END;										
"PaymEntry.SETRANGE(""Safe type"");"										
										
IF FloatTotal <> 0 THEN BEGIN										
DSTR1    := '#L##############    #R##################';										
Value[1] := Text009 + ':';										
Value[2] := POSFunctions.FormatAmount(-FloatTotal);										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
										
IF RemoveTotal <> 0 THEN BEGIN										
DSTR1    := '#L##############    #R##################';										
Value[1] := Text010 + ':';										
Value[2] := POSFunctions.FormatAmount(RemoveTotal);										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
										
IF (LocalTotal<>0) OR (FloatTotal<>0) OR (RemoveTotal<>0) THEN										
PrintSeperator(2);										
										
//  Tender Declaration										
"Transaction.""Transaction No."" := 0;"										
"TendDeclEntry.SETCURRENTKEY(""Statement Code"",""Z-Report ID"",""Tender Type"",""Currency Code"",""Card No."");"										
"TendDeclEntry.SETRANGE(""Statement Code"",SCode);"										
"TendDeclEntry.SETRANGE(""Z-Report ID"",'');"										
IF RunType = RunType::Y THEN										
"TendDeclEntry.SETRANGE(""Y-Report ID"",'')"										
ELSE										
"TendDeclEntry.SETRANGE(""Y-Report ID"");"										
"IF Store.""Tend. Decl. Calculation"" = Store.""Tend. Decl. Calculation""::Sum THEN BEGIN"										
BufferTendDeclEntry;										
IF TendDeclEntry.FIND('-') THEN										
"Transaction.""Transaction No."" := TendDeclEntry.""Transaction No."";"										
END ELSE BEGIN										
IF TendDeclEntry.FIND('-') THEN										
REPEAT										
"IF TendDeclEntry.""Transaction No."" > Transaction.""Transaction No."" THEN"										
"Transaction.GET(TendDeclEntry.""Store No."",TendDeclEntry.""POS Terminal No."",TendDeclEntry.""Transaction No."")"										
UNTIL TendDeclEntry.NEXT=0;										
END;										
										
"IF Transaction.""Transaction No."" <> 0 THEN BEGIN"										
"PrintLine(2,FormatLine(Text112,FALSE,TRUE,FALSE,FALSE));"										
CLEAR(TendDeclEntry);										
LocalTotal := 0;										
"IF Store.""Tend. Decl. Calculation"" = Store.""Tend. Decl. Calculation""::Last THEN BEGIN"										
"TendDeclEntry.SETCURRENTKEY(""Store No."",""POS Terminal No."",""Transaction No."");"										
"TendDeclEntry.SETRANGE(""Store No."",Transaction.""Store No."");"										
"TendDeclEntry.SETRANGE(""POS Terminal No."",Transaction.""POS Terminal No."");"										
"TendDeclEntry.SETRANGE(""Transaction No."",Transaction.""Transaction No."");"										
BufferTendDeclEntry;										
END;										
"TempTendDeclEntry.SETFILTER(""Currency Code"",'=%1','');"										
PrintTenderDeclLines;										
"Transaction.""Gross Amount"" := -LocalTotal;"										
"PrintTotal(Transaction,2,0);"										
"PrintLine(2,'');"										
"TempTendDeclEntry.SETFILTER(""Currency Code"",'<>%1','');"										
PrintTenderDeclLines;										
END;										
										
PrintSeperator(2);										
										
// Sales and Discount Totals										
"Transaction.SETCURRENTKEY(""Statement Code"",""Z-Report ID"",""Transaction Type"",""Entry Status"");"										
"Transaction.SETRANGE(""Statement Code"",SCode);"										
"Transaction.SETRANGE(""Z-Report ID"",'');"										
"Transaction.SETRANGE(""Transaction Type"",Transaction.""Transaction Type""::Sales);"										
"Transaction.SETFILTER(""Entry Status"",'%1|%2',Transaction.""Entry Status""::"" "",Transaction.""Entry Status""::Posted);"										
IF RunType = RunType::Y THEN										
"Transaction.SETRANGE(""Y-Report ID"",'');"										
"Transaction.CALCSUMS(""Gross Amount"",""Discount Amount"",""Total Discount"",Rounded,""No. of Items"","										
"""No. of Covers"");"										
										
"IF Transaction.""Entry Status"" <> Transaction.""Entry Status""::Training THEN BEGIN  //LS7.1-09"										
CASE RunType OF										
RunType::Z:										
BEGIN										
ZReportStats.INIT;										
"ZReportStats.""Store No."" := Globals.StoreNo;"										
"ZReportStats.""POS Terminal No."" := Globals.TerminalNo;"										
ZReportStats.Date := TODAY;										
"ZReportStats.""Sales Amount"":= -Transaction.""Gross Amount"" + Transaction.Rounded;"										
ZReportStats.INSERT(TRUE);										
END;										
RunType::Y:										
BEGIN										
YReportStats.INIT;										
"YReportStats.""Store No."" := Globals.StoreNo;"										
"YReportStats.""POS Terminal No."" := Globals.TerminalNo;"										
YReportStats.Date := TODAY;										
"YReportStats.""Sales Amount"":= -Transaction.""Gross Amount"" + Transaction.Rounded;"										
YReportStats.INSERT(TRUE);										
END;										
END;										
END;  //LS7.1-09										
										
DSTR1 := '#L######################### #R##########';										
"Value[2] := POSFunctions.FormatAmount(-Transaction.""Gross Amount"" + Transaction.""Discount Amount"");"										
Value[1] := Text011;										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
"Value[2] := POSFunctions.FormatAmount(-Transaction.""Discount Amount"");"										
Value[1] := Text012;										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
Value[2] := POSFunctions.FormatAmount(Transaction.Rounded);										
Value[1] := Text093;										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
PrintSeperator(2);										
Value[1] := Text027;										
"Value[2] := POSFunctions.FormatAmount(-Transaction.""Gross Amount"" + Transaction.Rounded);"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
										
"IncExpAccount.SETRANGE(IncExpAccount.""Store No."",Globals.StoreNo);"										
IF IncExpAccount.FIND('-') THEN BEGIN										
"IncExpEntry.SETCURRENTKEY(""Statement Code"",""Z-Report ID"",""No."");"										
"IncExpEntry.SETRANGE(""Statement Code"",SCode);"										
"IncExpEntry.SETRANGE(""Z-Report ID"",'');"										
IF RunType = RunType::Y THEN										
"IncExpEntry.SETRANGE(""Z-Report ID"",'');"										
IF IncExpEntry.FIND('-') THEN BEGIN										
PrintSeperator(2);										
REPEAT										
"IncExpEntry.SETRANGE(""No."",IncExpAccount.""No."");"										
IF IncExpEntry.FIND('-') THEN BEGIN										
Value[1] := IncExpAccount.Description;										
IncExpEntry.CALCSUMS(Amount);										
Value[2] := POSFunctions.FormatAmount(IncExpEntry.Amount);										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
UNTIL IncExpAccount.NEXT = 0;										
END;										
END;										
										
PrintSeperator(2);										
										
//Transaction counting										
IF PaymTrans3.FIND('-') THEN										
REPEAT										
"IF NOT PaymTemp.GET(PaymTrans3.""Store No."",PaymTrans3.""POS Terminal No."",PaymTrans3.""Transaction No."") THEN BEGIN"										
"Transaction2.GET(PaymTrans3.""Store No."",PaymTrans3.""POS Terminal No."",PaymTrans3.""Transaction No."");"										
"IF Transaction2.""Transaction Type"" = Transaction2.""Transaction Type""::Sales THEN"										
RecCount := RecCount + 1;										
"PaymTemp.""Store No."" := PaymTrans3.""Store No."";"										
"PaymTemp.""POS Terminal No."" := PaymTrans3.""POS Terminal No."";"										
"PaymTemp.""Transaction No."" := PaymTrans3.""Transaction No."";"										
PaymTemp.INSERT;										
END;										
UNTIL PaymTrans3.NEXT = 0;										
Value[1] := Text134 + ':';										
Value[2] := FORMAT(RecCount);										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
										
Value[1] := Text028;										
"Value[2] := FORMAT(Transaction.COUNT,0,'<Integer>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
										
Value[1] := Text029;										
"Value[2] := FORMAT(Transaction.""No. of Items"",0,'<Integer>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
										
"Transaction.SETRANGE(Transaction.""Sale Is Return Sale"",TRUE);"										
Value[1] := Text030;										
"Value[2] := FORMAT(Transaction.COUNT,0,'<Integer>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
"Transaction.SETRANGE(Transaction.""Sale Is Return Sale"");"										
										
"SuspTrans.SETRANGE(""Store No."",Store.""No."");"										
"SuspTrans.SETRANGE(""Entry Status"",SuspTrans.""Entry Status""::Suspended);"										
NoSuspended := SuspTrans.COUNT;										
Value[1] := Text031;										
"Value[2] := FORMAT(NoSuspended,0,'<Integer>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
"SuspTrans.SETRANGE(""Store No."");"										
										
IF RunType = RunType::Z THEN BEGIN										
"IF Terminal.""Print Suspend with Prepayment"" THEN BEGIN"										
NoSuspPrepayment := 0;										
SuspPrepayment := 0;										
										
SuspTransLine.RESET;										
"SuspTransLine.SETCURRENTKEY(""Receipt No."",""Entry Type"",""Entry Status"");"										
"SuspTransLine.SETRANGE(""Entry Type"",SuspTransLine.""Entry Type""::IncomeExpense);"										
IF SuspTransLine.FIND('-') THEN BEGIN										
REPEAT										
"IF (SuspTransLine.""POS Terminal No."" = '0') THEN BEGIN"										
NoSuspPrepayment := NoSuspPrepayment + 1;										
SuspPrepayment := SuspPrepayment + SuspTransLine.Amount;										
END;										
UNTIL SuspTransLine.NEXT = 0;										
END;										
SuspPrepayment := ABS(SuspPrepayment);										
IF (NoSuspPrepayment > 0) THEN BEGIN										
Value[1] := '  ' + Text154;										
"Value[2] := FORMAT(NoSuspPrepayment,0,'<Integer>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
END;										
IF (SuspPrepayment > 0) THEN BEGIN										
Value[1] := '  ' + Text155;										
Value[2] := POSFunctions.FormatAmount(SuspPrepayment);										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
END;										
END;										
END;										
										
IF RunType = RunType::Y THEN BEGIN										
"IF Terminal.""Print Suspend with Prepayment"" THEN BEGIN"										
NoSuspPrepayment := 0;										
SuspPrepayment := 0;										
										
SuspTransLine.RESET;										
"SuspTransLine.SETCURRENTKEY(""Receipt No."",""Entry Type"",""Entry Status"");"										
"SuspTransLine.SETRANGE(""Entry Type"",SuspTransLine.""Entry Type""::IncomeExpense);"										
IF SuspTransLine.FIND('-') THEN BEGIN										
REPEAT										
"IF (SuspTransLine.""POS Terminal No."" = '0') THEN BEGIN"										
NoSuspPrepayment := NoSuspPrepayment + 1;										
SuspPrepayment := SuspPrepayment + SuspTransLine.Amount;										
END;										
UNTIL SuspTransLine.NEXT = 0;										
END;										
SuspPrepayment := ABS(SuspPrepayment);										
IF (NoSuspPrepayment > 0) THEN BEGIN										
Value[1] := '  ' + Text154;										
"Value[2] := FORMAT(NoSuspPrepayment,0,'<Integer>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
END;										
IF (SuspPrepayment > 0) THEN BEGIN										
Value[1] := '  ' + Text155;										
Value[2] := POSFunctions.FormatAmount(SuspPrepayment);										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
END;										
END;										
END;										
										
"Transaction.SETRANGE(""Entry Status"",Transaction.""Entry Status""::Voided);"										
Value[1] := Text032;										
"Value[2] := FORMAT(Transaction.COUNT,0,'<Integer>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
										
IF gNoSuspPOSTransactionsVoided <> 0 THEN BEGIN										
Value[1] := '  ' + Text230;										
"Value[2] := FORMAT(gNoSuspPOSTransactionsVoided,0,'<Integer>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
END;										
										
"Transaction.SETRANGE(""Entry Status"",Transaction.""Entry Status""::Training);"										
Value[1] := Text034;										
"Value[2] := FORMAT(Transaction.COUNT,0,'<Integer>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
"Transaction.SETRANGE(""Entry Status"");"										
										
"Transaction.SETFILTER(""Transaction Type"",'%1|%2',"										
"Transaction.""Transaction Type""::Sales,Transaction.""Transaction Type""::""Open Drawer"");"										
"Transaction.SETRANGE(""Open Drawer"",TRUE);"										
Value[1] := Text037;										
"Value[2] := FORMAT(Transaction.COUNT,0,'<Integer>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
"Transaction.SETRANGE(""Open Drawer"");"										
										
"Transaction.SETRANGE(""Transaction Type"",Transaction.""Transaction Type""::Logon);"										
Value[1] := Text139;										
"Value[2] := FORMAT(Transaction.COUNT,0,'<Integer>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
"Transaction.SETRANGE(""Transaction Type"");"										
										
"IF Transaction.""No. of Covers"" <> 0 THEN BEGIN"										
Value[1] := Text235;										
"Value[2] := FORMAT(Transaction.""No. of Covers"",0,'<Integer>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
										
"Transaction.SETFILTER(""Split Number"",'<>%1',0);"										
NoSplitTrans := Transaction.COUNT;										
Value[1] := Text236;										
"Value[2] := FORMAT(NoSplitTrans,0,'<Integer>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
"Transaction.SETRANGE(""Split Number"");"										
										
NoTables:= RecCount - NoSplitTrans;										
										
Value[1] := Text237;										
"Value[2] := FORMAT(Transaction.""No. of Covers""/NoTables,0,'<Integer>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
										
Value[1] := Text238;										
"Value[2] := FORMAT(RecCount/NoTables,0,'<Integer>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
END;										
										
IF WHBatchQueue.COUNT > 0 THEN BEGIN										
Value[1] := lText004;										
"Value[2] := FORMAT(WHBatchQueue.COUNT,0,'<Integer>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
END;										
										
										
IF RunType = RunType::Z THEN BEGIN										
"IF Terminal.""Statement Method"" = Terminal.""Statement Method""::""POS Terminal"" THEN BEGIN"										
"IF Terminal.""Last Z-Report"" <> '' THEN"										
"Terminal.""Last Z-Report"" := INCSTR(Terminal.""Last Z-Report"")"										
ELSE										
"Terminal.""Last Z-Report"" :='T000000001';"										
"ZReportID := Terminal.""Last Z-Report"";"										
END ELSE BEGIN										
"IF Staff.""Last Z-Report"" <> '' THEN"										
"Staff.""Last Z-Report"" := INCSTR(Staff.""Last Z-Report"")"										
ELSE										
"Staff.""Last Z-Report"" :='S000000001';"										
"ZReportID := Staff.""Last Z-Report"";"										
END;										
IF (Globals.GetValue('TS_ERROR') <> '') THEN										
"ZReportID := 'X' + COPYSTR(ZReportID,2);"										
PrintSeperator(2);										
"PrintLine(2,Text116 + ZReportID);"										
PrintSeperator(2);										
END;										
										
IF RunType = RunType::Y THEN BEGIN										
"IF Terminal.""Statement Method"" = Terminal.""Statement Method""::""POS Terminal"" THEN BEGIN"										
"IF Terminal.""Last Y-Report"" <> '' THEN"										
"Terminal.""Last Y-Report"" := INCSTR(Terminal.""Last Y-Report"")"										
ELSE										
"Terminal.""Last Y-Report"" :='T000000001';"										
"YReportID := Terminal.""Last Y-Report"";"										
END ELSE BEGIN										
"IF Staff.""Last Y-Report"" <> '' THEN"										
"Staff.""Last Y-Report"" := INCSTR(Staff.""Last Y-Report"")"										
ELSE										
"Staff.""Last Y-Report"" :='S000000001';"										
"YReportID := Staff.""Last Y-Report"";"										
END;										
IF (Globals.GetValue('TS_ERROR') <> '') THEN										
"YReportID := 'X' + COPYSTR(YReportID,2);"										
PrintSeperator(2);										
"PrintLine(2,Text117 + YReportID);"										
PrintSeperator(2);										
END;										
										
										
IF RunType = RunType::X THEN BEGIN										
"IF GenPosFunc.""TS Send Transactions"" AND (GenPosFunc.""Send Transaction"" <> '') THEN BEGIN"										
TransServerWorkTable.RESET;										
"TransServerWorkTable.SETRANGE(Table,DATABASE::""Transaction Header"");"										
"TransServerWorkTable.SETRANGE(""Store No."",Globals.StoreNo);"										
"TransServerWorkTable.SETRANGE(""POS Terminal No."",Globals.TerminalNo);"										
TransNotSent := TransServerWorkTable.COUNT;										
IF TransNotSent > 0 THEN BEGIN										
PrintSeperator(2);										
CLEAR(Value);										
DSTR1 := '#L######################################';										
Value[1] := Text153;										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
"Value[1] := STRSUBSTNO(Text161,TransNotSent);"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
PrintSeperator(2);										
END;										
END;										
END;										
										
										
IF (RunType = RunType::Z) OR (RunType = RunType::Y) THEN BEGIN										
DSTR1 := '#L##################### #R##############';										
Value[1] := Text035;										
										
IF RunType = RunType::Y THEN										
"Value[2] := POSFunctions.FormatAmount(YReportStats.""Cumulative Sales Amount"")"										
ELSE										
"Value[2] := POSFunctions.FormatAmount(ZReportStats.""Cumulative Sales Amount"");"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
										
//Count not z-printed entries in the database										
"Transaction2.SETCURRENTKEY(""Statement Code"",""Z-Report ID"",""Transaction Type"",""Entry Status"");"										
"Transaction2.SETFILTER(""Statement Code"",'<>%1',SCode);"										
"Transaction2.SETRANGE(""Z-Report ID"",'');"										
"Transaction2.SETRANGE(""Transaction Type"",Transaction.""Transaction Type""::Sales);"										
"Transaction2.SETFILTER(""Entry Status"",'%1|%2',Transaction.""Entry Status""::"" "",Transaction.""Entry Status""::Posted);"										
IF RunType = RunType::Y THEN										
"Transaction2.SETRANGE(""Y-Report ID"",'');"										
IF Transaction2.FIND('-') THEN BEGIN										
Value[1] := lText001;										
"Value[2] := FORMAT(Transaction2.COUNT,0,'<Integer>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
OldestDate := Transaction2.Date;										
REPEAT										
IF Transaction2.Date < OldestDate THEN										
OldestDate := Transaction2.Date;										
UNTIL Transaction2.NEXT = 0;										
Value[1] := lText002;										
Value[2] := FORMAT(OldestDate);										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
										
"Transaction2.CALCSUMS(""Gross Amount"",""Discount Amount"",""Total Discount"",Rounded,""No. of Items"");"										
Value[1] := lText003;										
"Value[2] := POSFunctions.FormatAmount(-Transaction2.""Gross Amount"" + Transaction2.Rounded);"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
END;										
Transaction2.RESET;										
PrintSeperator(2);										
END;										
										
IF NOT ClosePrinter(2) THEN										
EXIT(FALSE);										
										
//LS7.1-09-										
"IF Transaction.""Entry Status"" = Transaction.""Entry Status""::Training THEN"										
EXIT(TRUE);										
//LS7.1-09+										
										
//Mark every entry included in the report with Z or Y report code.										
IF (RunType = RunType::Z) OR (RunType = RunType::Y) THEN BEGIN										
"IF Terminal.""Statement Method"" = Terminal.""Statement Method""::""POS Terminal"" THEN"										
Terminal.MODIFY										
ELSE BEGIN										
Staff.MODIFY;										
END;										
										
"PaymEntry.SETRANGE(""Currency Code"");"										
"PaymEntry.SETRANGE(""Card No."");"										
"PaymEntry.SETRANGE(""Tender Type"");"										
IF PaymEntry.FIND('-') THEN REPEAT										
PaymTrans2 := PaymEntry;										
IF RunType = RunType::Y THEN										
"PaymTrans2.""Y-Report ID"" := YReportID"										
ELSE										
"PaymTrans2.""Z-Report ID"" := ZReportID;"										
PaymTrans2.MODIFY(TRUE);										
UNTIL PaymEntry.NEXT = 0;										
										
CLEAR(TendDeclEntry);										
"TendDeclEntry.SETCURRENTKEY(""Statement Code"",""Z-Report ID"",""Tender Type"",""Currency Code"",""Card No."");"										
"TendDeclEntry.SETRANGE(""Statement Code"",SCode);"										
"TendDeclEntry.SETRANGE(""Z-Report ID"",'');"										
IF RunType = RunType::Y THEN										
"TendDeclEntry.SETRANGE(""Y-Report ID"",'');"										
IF TendDeclEntry.FIND('-') THEN REPEAT										
TendDeclEntry2 :=  TendDeclEntry;										
IF RunType = RunType::Y THEN										
"TendDeclEntry2.""Y-Report ID"" := YReportID"										
ELSE										
"TendDeclEntry2.""Z-Report ID"" := ZReportID;"										
TendDeclEntry2.MODIFY(TRUE);										
UNTIL TendDeclEntry.NEXT=0;										
										
CLEAR(IncExpEntry);										
"IncExpEntry.SETCURRENTKEY(""Statement Code"",""Z-Report ID"");"										
"IncExpEntry.SETRANGE(""Statement Code"",SCode);"										
"IncExpEntry.SETRANGE(""Z-Report ID"",'');"										
IF RunType = RunType::Y THEN										
"IncExpEntry.SETRANGE(""Y-Report ID"",'');"										
IF IncExpEntry.FIND('-') THEN REPEAT										
IncExpEntry2 := IncExpEntry;										
"IncExpEntry2.""Z-Report ID"" := ZReportID;"										
IncExpEntry2.MODIFY(TRUE);										
UNTIL IncExpEntry.NEXT = 0;										
										
IF Transaction.FIND('-') THEN REPEAT										
Transaction2 := Transaction;										
IF RunType = RunType::Y THEN										
"Transaction2.""Y-Report ID"" := YReportID"										
ELSE										
"Transaction2.""Z-Report ID"" := ZReportID;"										
Transaction2.MODIFY(TRUE);										
UNTIL Transaction.NEXT = 0;										
										
IF RunType = RunType::Y THEN BEGIN										
"YReportStats.""Y-Report Id"" := YReportID;"										
YReportStats.MODIFY(TRUE);										
"Globals.SetValue('LAST_YID',YReportID);"										
END										
ELSE BEGIN										
"ZReportStats.""Z-Report Id"" := ZReportID;"										
ZReportStats.MODIFY(TRUE);										
"Globals.SetValue('LAST_ZID',ZReportID);"										
END;										
END;										
										
EXIT(TRUE);										
END;										
										
PROCEDURE PrintZReport@32(NoSuspPOSTransactionsVoided@1100409000 : Integer) : Boolean;										
BEGIN										
//PrintZReport										
gNoSuspPOSTransactionsVoided := NoSuspPOSTransactionsVoided;										
//EXIT(PrintXZReport(1));										
//CONSISA										
//EXIT(PrintXZReportSV(TRUE));										
EXIT(PrintXZReportSV_2(1));										
END;										
										
PROCEDURE PrintXReport@33() : Boolean;										
BEGIN										
//PrintXReport										
//EXIT(PrintXZReport(0));										
//CONSISA										
//EXIT(PrintXZReportSV(FALSE));										
EXIT(PrintXZReportSV_2(0));										
END;										
										
PROCEDURE PrintYReport@1100409025(NoSuspPOSTransactionsVoided@1100409000 : Integer) : Boolean;										
BEGIN										
gNoSuspPOSTransactionsVoided := NoSuspPOSTransactionsVoided;										
EXIT(PrintXZReport(2));										
END;										
										
PROCEDURE PrintXZLines@51();										
VAR										
DSTR1@1000 : Text[80];										
Currency@1002 : Record 4;										
TTCardSetup@1003 : Record 99001464;										
vEfectivoTotalVentas@1000000000 : Decimal;										
vChequeTotalVentas@1000000001 : Decimal;										
vOtroTotal@1000000002 : Decimal;										
rTransHeader@1000000003 : Record 99001472;										
rPaymentEntry@1000000004 : Record 99001474;										
BEGIN										
//PrintXZLines										
"TTCardSetup.SETCURRENTKEY(""Store No."",""Tender Type Code"");"										
"TTCardSetup.SETRANGE(""Store No."",Globals.StoreNo);"										
										
//CSPNT200116IF TenderType.FIND('-') THEN										
IF TenderType.FIND('-') THEN BEGIN										
//CSPNT200116										
"IF TenderType.""Foreign Currency"" THEN BEGIN"										
//CSPNT210116										
{    DSTR1 := '#C######################################';										
Value[1] := 'RETIROS';										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
DSTR1 := '#L#############     #R##################';										
Value[1] := 'DESCRIPCI‡N';										
Value[2] := 'MONTO';										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
}										
END										
ELSE BEGIN										
//CSPNT201115										
DSTR1 := '#C######################################';										
Value[1] := 'MEDIOS DE PAGO';										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
DSTR1 := '#L#############     #R##################';										
Value[1] := 'DESCRIPCI‡N';										
Value[2] := 'MONTO';										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
REPEAT										
//CSPNT201115										
//CSPNT250216										
vEfectivoTotalVentas := 0;										
vChequeTotalVentas := 0;										
vOtroTotal := 0;										
										
Value[2] := '';										
"PaymEntry.SETRANGE(""Tender Type"",TenderType.Code);"										
"PaymEntry.SETRANGE(""Card No."");"										
Value[1] := TenderType.Description;										
"//CSPNT250216    PaymEntry.CALCSUMS(""Amount Tendered"");"										
"LocalTotal := LocalTotal + PaymEntry.""Amount Tendered"";"										
										
"IF TenderType.""Foreign Currency"" THEN BEGIN"										
"PaymEntry.SETRANGE(""Currency Code"");"										
"PaymEntry.CALCSUMS(""Amount Tendered"");"										
"IF PaymEntry.""Amount Tendered""<>0 THEN BEGIN"										
DSTR1 := '#L#### #R########### #R#################';										
IF Currency.FIND('-') THEN										
REPEAT										
"PaymEntry.SETRANGE(""Currency Code"",Currency.Code);"										
"PaymEntry.CALCSUMS(""Amount Tendered"",""Amount in Currency"");"										
"IF PaymEntry.""Amount Tendered""<>0 THEN BEGIN"										
Value[1] := Currency.Code;										
"Value[2] := POSFunctions.FormatCurrency(PaymEntry.""Amount in Currency"",Currency.Code);"										
"Value[3] := POSFunctions.FormatAmount(PaymEntry.""Amount Tendered"");"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
"TotalLCYInCurrency := TotalLCYInCurrency + PaymEntry.""Amount Tendered"";"										
UNTIL Currency.NEXT=0;										
END;										
END ELSE BEGIN										
"IF (TenderType.""Function"" = TenderType.""Function""::Card) THEN BEGIN"										
"PaymEntry.SETRANGE(""Card No."");"										
"PaymEntry.CALCSUMS(""Amount Tendered"");"										
"IF PaymEntry.""Amount Tendered""<>0 THEN BEGIN"										
DSTR1 := '#L################# #R##################';										
"Value[2] := POSFunctions.FormatAmount(PaymEntry.""Amount Tendered"");"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
"TTCardSetup.SETRANGE(""Tender Type Code"",TenderType.Code);"										
IF TTCardSetup.FIND('-') THEN										
REPEAT										
DSTR1 := '   #L######### #R####### #R#############';										
"PaymEntry.SETRANGE(""Card No."",TTCardSetup.""Card No."");"										
"PaymEntry.CALCSUMS(""Amount Tendered"");"										
"IF PaymEntry.""Amount Tendered""<>0 THEN BEGIN"										
Value[1] := TTCardSetup.Description;										
//CSPNT201115              Value[2] := POSFunctions.FormatQty(PaymEntry.COUNT);										
Value[2] := '';										
"Value[3] := POSFunctions.FormatAmount(PaymEntry.""Amount Tendered"");"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END										
UNTIL TTCardSetup.NEXT=0;										
END;										
END ELSE BEGIN										
DSTR1 := '#L################## #R## #R############';										
//CSPNT250216										
rTransHeader.RESET;										
"rTransHeader.SETRANGE(""Transaction Type"",rTransHeader.""Transaction Type""::Sales);"										
//CSPNT270216										
"rTransHeader.SETRANGE(""Z-Report ID"",'');"										
//CSPNT280416										
"rTransHeader.SETRANGE(""Income/Exp. Amount"",0.0);"										
IF rTransHeader.FINDSET THEN										
REPEAT										
rPaymentEntry.RESET;										
"rPaymentEntry.SETRANGE(""Store No."",rTransHeader.""Store No."");"										
"rPaymentEntry.SETRANGE(""POS Terminal No."",rTransHeader.""POS Terminal No."");"										
"rPaymentEntry.SETRANGE(""Transaction No."",rTransHeader.""Transaction No."");"										
"rPaymentEntry.SETRANGE(""Tender Type"",TenderType.Code);"										
"rPaymentEntry.SETRANGE(""Receipt No."",rTransHeader.""Receipt No."");"										
//CSPNT260216										
"//CSPNT270216            rPaymentEntry.SETRANGE(""Z-Report ID"",'');"										
IF rPaymentEntry.FIND('-') THEN BEGIN										
"rPaymentEntry.CALCSUMS(""Amount Tendered"");"										
IF (TenderType.Code = '1') THEN										
"vEfectivoTotalVentas := vEfectivoTotalVentas + rPaymentEntry.""Amount Tendered"""										
ELSE IF (TenderType.Code = '2') THEN										
"vChequeTotalVentas := vChequeTotalVentas + rPaymentEntry.""Amount Tendered"""										
ELSE										
"vOtroTotal := vOtroTotal + rPaymentEntry.""Amount Tendered"";"										
END;										
UNTIL rTransHeader.NEXT = 0;										
										
"//CSPNT250216        IF PaymEntry.""Amount Tendered""<>0 THEN BEGIN"										
IF TRUE THEN BEGIN										
"//CSPNT201115        IF TenderType.""POS Count Entries"" THEN"										
//CSPNT201115          Value[2]:=POSFunctions.FormatQty(PaymEntry.COUNT())										
//CSPNT201115        ELSE										
//CSPNT201115          Value[2]:='';										
//CSPNT210116										
IF (TenderType.Code = '1') THEN										
//CSPNT250216										
//CSPNT100316										
//CSPNT160316quito vivas										
Value[3] := POSFunctions.FormatAmount(vEfectivoTotalVentas)										
ELSE IF (TenderType.Code = '2') THEN										
//CSPNT250216										
Value[3] := POSFunctions.FormatAmount(vChequeTotalVentas)										
ELSE										
//CSPNT250216										
Value[3] := POSFunctions.FormatAmount(vOtroTotal);										
//CSPNT250216										
//CSPNT020516										
IF (((vEfectivoTotalVentas) <> 0) OR (vChequeTotalVentas <> 0) OR (vOtroTotal <> 0)) THEN										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
//CSPNT201115 ANALISIS										
"{        IF PaymEntry.""Tender Type"" = 21 THEN BEGIN"										
"PaymEntry.SETRANGE(""Tender Type"",'21');"										
IF PaymEntry.FIND('-') THEN										
REPEAT										
"TransInfCode.SETRANGE(""Transaction No."",PaymEntry.""Transaction No."");"										
DSTR1 := '   #L######### #R####### #R#############';										
"PaymEntry.SETRANGE(""Card No."",TTCardSetup.""Card No."");"										
"PaymEntry.CALCSUMS(""Amount Tendered"");"										
"IF PaymEntry.""Amount Tendered""<>0 THEN BEGIN"										
Value[1] := TTCardSetup.Description;										
Value[2] := '';										
"Value[3] := POSFunctions.FormatAmount(PaymEntry.""Amount Tendered"");"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END										
UNTIL TTCardSetup.NEXT=0;										
END;}										
END;										
END;										
//CSPNT200116										
END;										
UNTIL TenderType.NEXT = 0;										
//CSPNT200116										
END;										
END;										
										
PROCEDURE StringPad@27(Char@1000 : Text[1];Length@1001 : Integer) : Text[250];										
VAR										
ReturnString@1002 : Text[250];										
i@1003 : Integer;										
BEGIN										
//StringPad										
ReturnString := '';										
FOR i := 1 TO Length DO										
ReturnString := ReturnString + Char;										
EXIT(ReturnString);										
END;										
										
PROCEDURE StrToInt@36(Text@1000 : Text[30]) : Integer;										
VAR										
Int@1001 : Integer;										
BEGIN										
//StrToInt										
"IF NOT EVALUATE(Int,Text) THEN Int := 0;"										
EXIT(Int);										
END;										
										
PROCEDURE VerboseAmount@55(Amount@1000 : Decimal;MaxLen@1001 : Integer) : Text[150];										
VAR										
AmtTxt@1002 : Text[150];										
TmpTxt@1003 : Text[10];										
BEGIN										
//VerboseAmount										
Amount := ABS(Amount);										
AmtTxt := '';										
IF Amount < 10000000 THEN BEGIN										
TmpTxt := FORMAT((Amount * 100) MOD 100);										
IF Amount >= 1000000 THEN										
AmtTxt := VAHundreds(Amount DIV 1000000) + Text121;										
Amount := Amount MOD 1000000;										
IF Amount >= 1000 THEN										
AmtTxt := AmtTxt + VAHundreds(Amount DIV 1000) + Text122;										
"Amount := ROUND(Amount MOD 1000,1,'<');"										
IF (Amount <> 0) OR (AmtTxt = '') THEN										
AmtTxt := AmtTxt + VAHundreds(Amount);										
IF STRLEN(TmpTxt) < 2 THEN TmpTxt := '0' + TmpTxt;										
AmtTxt := AmtTxt + '/' + TmpTxt;										
END										
ELSE										
MaxLen := -1;										
IF STRLEN(AmtTxt) > MaxLen THEN										
AmtTxt := '**' + FORMAT(Amount) + '**';										
EXIT(AmtTxt);										
END;										
										
PROCEDURE VAHundreds@53(Amount@1000 : Decimal) : Text[50];										
VAR										
Steps@1001 : Integer;										
Str@1002 : Text[30];										
BEGIN										
//VAHundreds										
"Steps := VAReduce(Amount,100);"										
IF Steps <> 0 THEN										
Str := Str +										
"SELECTSTR(Steps+1,Text123) +"										
Text124;										
IF (Amount <> 0) AND (Str <> '') THEN										
Str := Str + Text125;										
IF Amount >= 20 THEN BEGIN										
"Steps := VAReduce(Amount,10);"										
Str := Str +										
"SELECTSTR(Steps+1,Text126);"										
END;										
"Steps := VAReduce(Amount,1);"										
IF (Steps <> 0) OR (Str = '') THEN BEGIN										
Str := Str +										
"SELECTSTR(Steps+1,Text127 +"										
Text128);										
END;										
EXIT(Str);										
END;										
										
PROCEDURE VAReduce@52(VAR Amount@1000 : Decimal;Step@1001 : Decimal) : Integer;										
VAR										
Steps@1002 : Integer;										
BEGIN										
//VAReduce										
Steps := 0;										
WHILE Amount >= Step DO BEGIN										
Steps := Steps + 1;										
Amount := Amount - Step;										
END;										
EXIT(Steps);										
END;										
										
PROCEDURE PrintApplEntryBarcode@4(Tray@1010 : Integer;EntryType@1004 : Code[10];EntryCode@1008 : Code[20]) : Code[20];										
VAR										
DataEntryType@1000 : Record 99001557;										
DataEntry@1009 : Record 99001558;										
Mask@1007 : Record 99001459;										
MaskSegm@1005 : Record 99001480;										
MaskLen@1011 : Integer;										
Chk@1001 : Integer;										
Char@1002 : Text[10];										
TmpStr@1003 : Text[15];										
Found@1006 : Boolean;										
BEGIN										
//PrintApplEntryBarcode										
										
IF NOT DataEntryType.GET(EntryType) THEN										
EXIT;										
"IF NOT Mask.GET(DataEntryType.""Barcode Mask Entry No"") THEN"										
"ERROR(STRSUBSTNO(Text130,Mask.TABLECAPTION,DataEntry.TABLECAPTION,DataEntryType.TABLECAPTION));"										
										
TmpStr := Mask.Prefix;										
Mask.CALCFIELDS(Length);										
MaskLen := STRLEN(Mask.Prefix) + Mask.Length;										
										
IF MaskLen < Mask.GetRefLength THEN										
"TmpStr := COPYSTR('0000000000000',1,Mask.GetRefLength - MaskLen) + TmpStr;"										
										
"MaskSegm.SETRANGE(""Mask Entry No."",Mask.""Entry No."");"										
IF MaskSegm.FIND('-') THEN REPEAT										
CASE MaskSegm.Type OF										
"MaskSegm.Type::""Data Entry"" : BEGIN"										
Found := TRUE;										
IF (EntryCode = '') OR (STRLEN(EntryCode) > MaskSegm.Length) THEN										
ERROR(Text129);										
"TmpStr := TmpStr + COPYSTR('0000000000000',1,MaskSegm.Length - STRLEN(EntryCode)) + EntryCode;"										
END;										
										
"MaskSegm.Type::""Check Digit"" : BEGIN"										
"Chk := 1 + STRCHECKSUM(TmpStr,COPYSTR('1313131313131',13 - STRLEN(TmpStr),STRLEN(TmpStr)));"										
"TmpStr := TmpStr + SELECTSTR(Chk,'0,1,2,3,4,5,6,7,8,9');"										
END;										
END;										
UNTIL MaskSegm.NEXT = 0;										
										
IF NOT Found THEN BEGIN										
"MaskSegm.Type := MaskSegm.Type::""Data Entry"";"										
"ERROR(STRSUBSTNO(Text130,MaskSegm.TABLECAPTION,FORMAT(MaskSegm.Type),Mask.TABLECAPTION));"										
END;										
										
"PrintBarcode(Tray,TmpStr,100,40,FORMAT(Mask.Symbology),2)"										
END;										
										
PROCEDURE MarkLinesPrinted@1200070001(SlipNo@1200070005 : Code[20];PrinterGroupID@1200070001 : Code[10];VAR LineList@1200070000 : TE	MPO	RAR	Y	Rec	ord 307);					
VAR										
TextLine@1003 : Record 99008981;										
TransLine@1004 : Record 99008981;										
BEGIN										
//MarkLinesPrinted										
"LineList.SETRANGE(""Item No."");"										
"LineList.SETRANGE(""Variant Code"",PrinterGroupID);"										
IF LineList.FIND('-') THEN REPEAT										
"TransLine.GET(SlipNo,LineList.""Dimension Entry No."");"										
"TransLine.""Dispense Printing"" := TransLine.""Dispense Printing""::Printed;"										
TransLine.MODIFY;										
UNTIL LineList.NEXT = 0;										
COMMIT;										
END;										
										
PROCEDURE PrintHospSubHeader@1000000001(PosTransNo@1000 : Code[10];PrinterGroupNo@1200070001 : Code[10];Table@1200070002 : Integer;T	ray	@10	1	:	Integer);					
VAR										
Staff@1004 : Record 99001461;										
PosTrans@1008 : Record 99008980;										
DSTR1@1005 : Text[100];										
StaffName@1006 : Text[30];										
blankStr@1007 : Text[30];										
PrinterGroup@1009 : Record 99008930;										
BEGIN										
//PrintSubHeader										
IF Tray = 2 THEN										
"blankStr := StringPad(' ',LineLen - 38)"										
ELSE IF Tray = 4 THEN										
"blankStr := StringPad(' ',InvLineLen - 38);"										
										
PosTrans.GET(PosTransNo);										
PrinterGroup.GET(PrinterGroupNo);										
										
CLEAR(Value);										
DSTR1 := '#C##################';										
Value[1] := PrinterGroup.Description;										
NodeName[1] := 'Description'; //LS7.1-02										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),TRUE,FALSE,TRUE,FALSE));"										
"AddPrintLine(200,1,NodeName,Value,DSTR1,TRUE,FALSE,TRUE,FALSE,Tray); //LS7.1-02"										
"PrintLine(Tray,'');"										
										
DSTR1 := '#L#### #T###### #T###' + blankStr + '#L### #N#########';										
Value[1] := Text048 + ':';										
NodeName[1] := 'x'; //LS7.1-02										
Value[2] := FORMAT(TODAY);										
NodeName[2] := 'Trans. Date'; //LS7.1-02										
"Value[3] := FORMAT(TIME,5);"										
NodeName[3] := 'Trans. Time'; //LS7.1-02										
Value[4] := Text020 + ':';										
NodeName[4] := 'x'; //LS7.1-02										
Value[5] := PosTransNo;										
NodeName[5] := 'Receipt No.'; //LS7.1-02										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
"AddPrintLine(200,5,NodeName,Value,DSTR1,TRUE,FALSE,TRUE,FALSE,Tray); //LS7.1-02"										
										
DSTR1 := '#L#### #L############' + blankStr + '#L#### #N########';										
"StaffName := PosTrans.""Staff ID"";"										
"IF Staff.GET(PosTrans.""Staff ID"") THEN"										
"StaffName := Staff.""Name on Receipt"";"										
Value[1] := Text051 + ':';										
NodeName[1] := 'x'; //LS7.1-02										
Value[2] := StaffName;										
NodeName[2] := 'x'; //LS7.1-02										
Value[3] := Text500 +':';										
NodeName[3] := 'x'; //LS7.1-02										
Value[4] := FORMAT(Table);										
NodeName[4] := 'Table No.'; //LS7.1-02										
//LS7.1-02 -										
"Value[5] := PosTrans.""Staff ID"";"										
NodeName[5] := 'Staff ID'; //LS7.1-02										
//LS7.1-02 +										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
"AddPrintLine(200,5,NodeName,Value,DSTR1,TRUE,FALSE,TRUE,FALSE,Tray); //LS7.1-02"										
PrintSeperator(Tray);										
END;										
										
PROCEDURE PrintLoyalty@1200070002(VAR POSTrans@1200070000 : Record 99001472;Tray@1200070001 : Integer);										
VAR										
MemberClubTemp_l@1100409004 : TEMPORARY Record 99009000;										
TransPointEntry@1200070003 : Record 99001495;										
MemberCardTemp_l@1100409003 : TEMPORARY Record 99009003;										
IssuedPoints@1100409005 : Decimal;										
UsedPoints@1100409012 : Decimal;										
"lText000@1100409001 : TextConst 'ENU="" pts"";ESP="" pts""';"										
lText001@1100409000 : TextConst 'ENU=Issued;ESP=Emitido';										
"lText002@1100409002 : TextConst 'ENU=""Status "";ESP=""Estado ""';"										
lText010@1100409009 : TextConst 'ENU=Member Account %1.;ESP=Cuenta Miembro %1.';										
lText011@1100409007 : TextConst 'ENU=Membership Card %1.;ESP=Ficha Miembro %1.';										
MemberText@1100409008 : Text[100];										
lText012@1100409006 : TextConst 'ENU=Issued Points: %1;ESP=Puntos Emitidos: %1';										
lText013@1100409010 : TextConst 'ENU=Used Points..: %1;ESP=Puntos Usados..: %1';										
lText014@1100409011 : TextConst 'ENU=Point Balance: %1;ESP=Balance de Puntos: %1';										
MsgText@1100409013 : Text[250];										
DSTR1@1100409014 : Text[100];										
BEGIN										
//PrintLoyalty										
"IF POSTrans.""Member Card No."" = '' THEN"										
EXIT;										
{ //LS7.1-14										
"IF NOT POSFunctions.GetMembershipCard(POSTrans.""Member Card No."",MemberCard,MsgText) THEN"										
EXIT;										
"IF NOT MemberClub.GET(MemberCard.""Club Code"") THEN"										
EXIT;										
"IF MemberClub.""Show Points on Receipt"" = MemberClub.""Show Points on Receipt""::No THEN"										
EXIT;										
} //LS7.1-14										
//LS7.1-14 -										
"IF NOT POSFunctions.LoadMemberInfo(POSTrans.""Member Card No."") THEN"										
EXIT;										
POSFunctions.GetMemberShipCardInfo(MemberCardTemp_l);										
POSFunctions.GetMemberClubInfo(MemberClubTemp_l);										
"IF MemberClubTemp_l.""Show Points on Receipt"" = MemberClubTemp_l.""Show Points on Receipt""::No THEN"										
EXIT;										
//LS7.1-14 +										
										
"TransPointEntry.SETRANGE(""Store No."",POSTrans.""Store No."");"										
"TransPointEntry.SETRANGE(""POS Terminal No."",POSTrans.""POS Terminal No."");"										
"TransPointEntry.SETRANGE(""Transaction No."",POSTrans.""Transaction No."");"										
IF TransPointEntry.FINDSET THEN REPEAT										
"IF TransPointEntry.""Entry Type"" = TransPointEntry.""Entry Type""::Sale THEN"										
IssuedPoints := IssuedPoints + TransPointEntry.Points										
ELSE										
UsedPoints := UsedPoints - TransPointEntry.Points;										
UNTIL TransPointEntry.NEXT = 0;										
										
"IF (POSTrans.""Starting Point Balance"" = 0) AND (IssuedPoints = 0) AND (UsedPoints = 0) THEN"										
EXIT;										
										
"IF MemberCardTemp_l.""Account No."" <> '' THEN //LS7.1-14"										
"MemberText := STRSUBSTNO(lText010,MemberCardTemp_l.""Account No."") //LS7.1-14"										
ELSE										
"MemberText := STRSUBSTNO(lText011,POSTrans.""Member Card No."");"										
										
"CASE MemberClubTemp_l.""Show Points on Receipt"" OF //LS7.1-14"										
"MemberClubTemp_l.""Show Points on Receipt""::""Issued Points"": //LS7.1-14"										
BEGIN										
IF (IssuedPoints <> 0) OR (UsedPoints <> 0) THEN BEGIN										
"PrintLine(Tray,'');"										
//LS7.1-02 -										
Value[1] := MemberText;										
NodeName[1] := 'Member Info';										
//LS7.1-02 +										
"PrintLine(Tray,FormatLine(MemberText,FALSE,FALSE,FALSE,FALSE));"										
"AddPrintLine(750,1,NodeName,Value,DSTR1,FALSE,FALSE,FALSE,FALSE,Tray); //LS7.1-02"										
//LS7.1-02 -										
Value[1] := FORMAT(IssuedPoints);										
NodeName[1] := 'Issued Points';										
//LS7.1-02 +										
"PrintLine(Tray,FormatLine(STRSUBSTNO(lText012,IssuedPoints),FALSE,FALSE,FALSE,FALSE));"										
"AddPrintLine(750,1,NodeName,Value,DSTR1,FALSE,FALSE,FALSE,FALSE,Tray); //LS7.1-02"										
//LS7.1-02 -										
Value[1] := FORMAT(UsedPoints);										
NodeName[1] := 'Used Points';										
//LS7.1-02 +										
"PrintLine(Tray,FormatLine(STRSUBSTNO(lText013,UsedPoints),FALSE,FALSE,FALSE,FALSE));"										
"AddPrintLine(750,1,NodeName,Value,DSTR1,FALSE,FALSE,FALSE,FALSE,Tray); //LS7.1-02"										
END;										
END;										
"MemberClubTemp_l.""Show Points on Receipt""::""Point Summary"": //LS7.1-14"										
"IF POSTrans.""Starting Point Balance"" <> 0 THEN BEGIN"										
"PrintLine(Tray,'');"										
//LS7.1-02 -										
Value[1] := MemberText;										
NodeName[1] := 'Member Info';										
//LS7.1-02 +										
"PrintLine(Tray,FormatLine(MemberText,FALSE,FALSE,FALSE,FALSE));"										
"AddPrintLine(750,1,NodeName,Value,DSTR1,FALSE,FALSE,FALSE,FALSE,Tray); //LS7.1-02"										
//LS7.1-02 -										
Value[1] := FORMAT(IssuedPoints);										
NodeName[1] := 'Issued Points';										
//LS7.1-02 +										
"PrintLine(Tray,FormatLine(STRSUBSTNO(lText012,IssuedPoints),FALSE,FALSE,FALSE,FALSE));"										
"AddPrintLine(750,1,NodeName,Value,DSTR1,FALSE,FALSE,FALSE,FALSE,Tray); //LS7.1-02"										
//LS7.1-02 -										
Value[1] := FORMAT(UsedPoints);										
NodeName[1] := 'Used Points';										
//LS7.1-02 +										
"PrintLine(Tray,FormatLine(STRSUBSTNO(lText013,UsedPoints),FALSE,FALSE,FALSE,FALSE));"										
"AddPrintLine(750,1,NodeName,Value,DSTR1,FALSE,FALSE,FALSE,FALSE,Tray); //LS7.1-02"										
//LS7.1-02 -										
"Value[1] := FORMAT(POSTrans.""Starting Point Balance"" + IssuedPoints - UsedPoints);"										
NodeName[1] := 'Point Balance';										
//LS7.1-02 +										
"PrintLine(Tray,FormatLine(STRSUBSTNO(lText014,POSTrans.""Starting Point Balance"" + IssuedPoints - UsedPoints),FALSE,FALSE,FAL"	"SE,"	FAL	SE	));						
"AddPrintLine(750,1,NodeName,Value,DSTR1,FALSE,FALSE,FALSE,FALSE,Tray); //LS7.1-02"										
END ELSE BEGIN										
"PrintLine(Tray,'');"										
//LS7.1-02 -										
Value[1] := MemberText;										
NodeName[1] := 'Member Info';										
//LS7.1-02 +										
"PrintLine(Tray,FormatLine(MemberText,FALSE,FALSE,FALSE,FALSE));"										
"AddPrintLine(750,1,NodeName,Value,DSTR1,FALSE,FALSE,FALSE,FALSE,Tray); //LS7.1-02"										
//LS7.1-02 -										
Value[1] := FORMAT(IssuedPoints);										
NodeName[1] := 'Issued Points';										
//LS7.1-02 +										
"PrintLine(Tray,FormatLine(STRSUBSTNO(lText012,IssuedPoints),FALSE,FALSE,FALSE,FALSE));"										
"AddPrintLine(750,1,NodeName,Value,DSTR1,FALSE,FALSE,FALSE,FALSE,Tray); //LS7.1-02"										
//LS7.1-02 -										
Value[1] := FORMAT(UsedPoints);										
NodeName[1] := 'Used Points';										
//LS7.1-02 +										
"PrintLine(Tray,FormatLine(STRSUBSTNO(lText013,UsedPoints),FALSE,FALSE,FALSE,FALSE));"										
"AddPrintLine(750,1,NodeName,Value,DSTR1,FALSE,FALSE,FALSE,FALSE,Tray); //LS7.1-02"										
END;										
END;										
END;										
										
PROCEDURE PrintDeal@1100409000(TransSalesEntry@1100409000 : Record 99001473;Tray@1100409002 : Integer;PrintItemNo@1100409009 : Integ	er)	;								
VAR										
tmpTransSalesEntry@1100409001 : TEMPORARY Record 99001473;										
Deal@1100409003 : Record 99001502;										
DealLine@1100409011 : Record 99001503;										
DealEntry@1100409004 : Record 99001460;										
tmpPOSVATCode@1100409008 : TEMPORARY Record 99001560;										
DealAmount@1100409005 : Decimal;										
DealQty@1100409006 : Decimal;										
DSTR1@1100409007 : Text[100];										
DiscountText@1100409014 : Text[1000];										
DSTR2@1100409017 : Text[100];										
TransSalesEntry2@1100409013 : Record 99001473;										
TransDiscountEntry@1100409010 : Record 99001642;										
TransDiscountEntryTEMP@1100409012 : TEMPORARY Record 99001642;										
CouponHeader@1100409015 : Record 99001621;										
PeriodicDiscount@1100409016 : Record 99001453;										
DealHeaderLineNo@1100409018 : Integer;										
"DealPrintingOption@1100409020 : 'Header Only,Items w/Added Amt. Only,All Lines';"										
"DealModifierPrintingOption@1100409019 : 'None,Modifier Desc. & Amt. Only,All Modifier Lines ';"										
DealAddedAmt@1100409021 : Decimal;										
BEGIN										
//PrintDeal										
IF NOT DealEntry.GET(										
"TransSalesEntry.""Store No."",TransSalesEntry.""POS Terminal No."",TransSalesEntry.""Transaction No."","										
"TransSalesEntry.""Line No."")"										
THEN										
EXIT;										
										
"DealHeaderLineNo := TransSalesEntry.""Deal Header Line No."";"										
										
"IF tmpDeal.GET(TransSalesEntry.""Promotion No."") THEN"										
EXIT										
ELSE BEGIN										
"tmpDeal.""No."" := TransSalesEntry.""Promotion No."";"										
tmpDeal.INSERT;										
END;										
										
tmpTransSalesEntry.DELETEALL;										
tmpPOSVATCode.DELETEALL;										
										
"DealEntry.SETRANGE(""Store No."",DealEntry.""Store No."");"										
"DealEntry.SETRANGE(""POS Terminal No."",DealEntry.""POS Terminal No."");"										
"DealEntry.SETRANGE(""Transaction No."",DealEntry.""Transaction No."");"										
"DealEntry.SETRANGE(""Deal No."",DealEntry.""Deal No."");"										
DealEntry.FIND('-');										
DealAmount := 0;										
DealQty := 0;										
DealAddedAmt := 0;										
REPEAT										
DealAmount += -DealEntry.Amount;										
"DealAddedAmt += -DealEntry.""Total Deal Line Added Amt."" - DealEntry.""Total Deal Modifier Added Amt."";"										
										
"IF GenPosFunc.""Print Disc/Cpn Info on Slip"" = GenPosFunc.""Print Disc/Cpn Info on Slip""::""No printing"" THEN"										
DealAmount := DealAmount - ReturnDealDiscount(TransSalesEntry);										
										
DealQty += -DealEntry.Quantity;										
UNTIL DealEntry.NEXT = 0;										
										
"IF Deal.GET(DealEntry.""Deal No."") THEN BEGIN"										
"IF Deal.""Deal Lines Printing"" <> Deal.""Deal Lines Printing""::""From Functionality Profile"" THEN"										
"DealPrintingOption := Deal.""Deal Lines Printing"" - 1"										
ELSE										
"DealPrintingOption := GenPosFunc.""Deal Lines Printing"";"										
END ELSE										
"DealPrintingOption := GenPosFunc.""Deal Lines Printing"";"										
										
"TransSalesEntry.SETRANGE(""Store No."",TransSalesEntry.""Store No."");"										
"TransSalesEntry.SETRANGE(""POS Terminal No."",TransSalesEntry.""POS Terminal No."");"										
"TransSalesEntry.SETRANGE(""Transaction No."",TransSalesEntry.""Transaction No."");"										
IF TransSalesEntry.FIND('-') THEN REPEAT										
"IF TransSalesEntry.""Promotion No."" = DealEntry.""Deal No."" THEN BEGIN"										
tmpTransSalesEntry := TransSalesEntry;										
tmpTransSalesEntry.INSERT;										
"IF tmpPOSVATCode.GET(tmpTransSalesEntry.""VAT Code"") THEN BEGIN"										
"tmpPOSVATCode.""VAT %"" +="										
"tmpTransSalesEntry.""Net Amount"" + tmpTransSalesEntry.""VAT Amount"""										
"- tmpTransSalesEntry.""Discount Amount"" - tmpTransSalesEntry.""Total Discount"";"										
tmpPOSVATCode.MODIFY;										
END ELSE BEGIN										
"tmpPOSVATCode.""VAT Code"" := tmpTransSalesEntry.""VAT Code"";"										
"tmpPOSVATCode.""VAT %"" :="										
"tmpTransSalesEntry.""Net Amount"" + tmpTransSalesEntry.""VAT Amount"""										
"- tmpTransSalesEntry.""Discount Amount"" - tmpTransSalesEntry.""Total Discount"";"										
tmpPOSVATCode.INSERT;										
END;										
END;										
UNTIL TransSalesEntry.NEXT = 0;										
										
"IF Deal.GET(DealEntry.""Deal No."") THEN"										
Value[1] := Deal.Description										
ELSE										
Value[1] := Text501;										
NodeName[1] := 'Item Description'; //LS7.1-02										
DSTR1 := '#L###################### #N########## #R';										
IF tmpPOSVATCode.COUNT = 1 THEN BEGIN										
IF DealQty = 1 THEN BEGIN										
Value[2] := POSFunctions.FormatPrice(DealAmount);										
NodeName[2] := 'Amount'; //LS7.1-02										
"Value[3] := tmpPOSVATCode.""VAT Code"";"										
NodeName[3] := 'VAT Code'; //LS7.1-02										
//LS7.1-02 -										
"Value[4] := FORMAT(TransSalesEntry.""Line No."");"										
NodeName[4] := 'Line No.';										
//LS7.1-02 +										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
"AddPrintLine(300,4,NodeName,Value,DSTR1,FALSE,FALSE,FALSE,FALSE,Tray); //LS7.1-02"										
END ELSE BEGIN										
Value[2] := '';										
//LS7.1-02 -										
NodeName[2] := 'x';										
NodeName[3] := 'x';										
"Value[4] := FORMAT(TransSalesEntry.""Line No."");"										
NodeName[4] := 'Line No.';										
//LS7.1-02 +										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
"AddPrintLine(300,4,NodeName,Value,DSTR1,FALSE,FALSE,FALSE,FALSE,Tray); //LS7.1-02"										
DSTR1 := '   #L################### #N########## #R';										
Value[1] :=										
"POSFunctions.FormatQty(DealQty) + ' ' + GenPosFunc.""Multiple Items Symbol"" + ' '"										
+ POSFunctions.FormatPrice(DealAmount/DealQty);										
NodeName[1] := 'x'; //LS7.1-02										
Value[2] := POSFunctions.FormatPrice(DealAmount);										
NodeName[2] := 'Amount'; //LS7.1-02										
"Value[3] := tmpPOSVATCode.""VAT Code"";"										
NodeName[3] := 'VAT Code'; //LS7.1-02										
//LS7.1-02 -										
"Value[4] := FORMAT(TransSalesEntry.""Line No."");"										
NodeName[4] := 'Line No.';										
Value[5] := POSFunctions.FormatQty(DealQty);										
NodeName[5] := 'Quantity';										
Value[6] := POSFunctions.FormatPrice(DealAmount/DealQty);										
NodeName[6] := 'Price';										
//LS7.1-02 -										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
"AddPrintLine(300,6,NodeName,Value,DSTR1,FALSE,FALSE,FALSE,FALSE,Tray); //LS7.1-02"										
END;										
END ELSE BEGIN										
Value[2] := '';										
//LS7.1-02 -										
NodeName[2] := 'x';										
NodeName[3] := 'x';										
"Value[4] := FORMAT(TransSalesEntry.""Line No."");"										
NodeName[4] := 'Line No.';										
//LS7.1-02 +										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
"AddPrintLine(300,4,NodeName,Value,DSTR1,FALSE,FALSE,FALSE,FALSE,Tray); //LS7.1-02"										
IF DealQty <> 1 THEN BEGIN										
DSTR1 := '   #L################### #N########## #R';										
Value[1] :=										
"POSFunctions.FormatQty(DealQty) + ' ' + GenPosFunc.""Multiple Items Symbol"" + ' '"										
+ POSFunctions.FormatPrice(DealAmount/DealQty);										
NodeName[1] := 'x'; //LS7.1-02										
Value[2] := '';										
NodeName[2] := 'x'; //LS7.1-02										
//LS7.1-02 -										
NodeName[3] := 'x'; //LS7.1-02										
"Value[4] := FORMAT(TransSalesEntry.""Line No."");"										
NodeName[4] := 'Line No.';										
Value[5] := POSFunctions.FormatQty(DealQty);										
NodeName[5] := 'Quantity';										
Value[6] := POSFunctions.FormatPrice(DealAmount/DealQty);										
NodeName[6] := 'Price';										
//LS7.1-02 -										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
"AddPrintLine(300,6,NodeName,Value,DSTR1,FALSE,FALSE,FALSE,FALSE,Tray); //LS7.1-02"										
END;										
tmpPOSVATCode.FIND('-');										
DSTR1 := '   #L################### #N########## #R';										
REPEAT										
"Value[3] := tmpPOSVATCode.""VAT Code"";"										
NodeName[3] := 'x'; //LS7.1-02										
"Value[2] := FORMAT(-tmpPOSVATCode.""VAT %"");"										
NodeName[2] := 'x'; //LS7.1-02										
Value[1] := '';										
NodeName[1] := 'x'; //LS7.1-02										
//LS7.1-02 -										
"Value[4] := FORMAT(TransSalesEntry.""Line No."");"										
NodeName[4] := 'Line No.';										
//LS7.1-02 +										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
"AddPrintLine(350,4,NodeName,Value,DSTR1,FALSE,FALSE,FALSE,FALSE,Tray); //LS7.1-02"										
UNTIL tmpPOSVATCode.NEXT = 0;										
END;										
"IF GenPosFunc.""Print Free Text on Receipt"" THEN BEGIN"										
IF DealEntry.FINDSET THEN REPEAT										
"PrintDealFreeTextLines(DealEntry,Tray,FALSE,TransSalesEntry.""Line No.""); //LS7.1-02"										
UNTIL DealEntry.NEXT = 0;										
END;										
										
"IF DealPrintingOption <> DealPrintingOption::""Header Only"" THEN BEGIN"										
IF tmpTransSalesEntry.FIND('-') THEN REPEAT										
"IF tmpTransSalesEntry.""Deal Modifier Added Amt."" <> 0 THEN BEGIN"										
DSTR1 := '   #L###################################';										
"IF DealLine.GET(DealEntry.""Deal No."",tmpTransSalesEntry.""Deal Line No."") THEN BEGIN"										
Value[1] := DealLine.Description;										
"DealModifierPrintingOption := DealLine.""Receipt Printing"" + 1;"										
END ELSE BEGIN										
Value[1] := Text502;										
"DealModifierPrintingOption := DealModifierPrintingOption::""Modifier Desc. & Amt. Only"";"										
END;										
"Value[1] := Value[1] + ' ' + GenPosFunc.""Multiple Items Symbol"" + ' '"										
"+ POSFunctions.FormatPrice(tmpTransSalesEntry.""Deal Modifier Added Amt."") + ' ' + Globals.GetValue('CURRSYM');"										
//LS7.1-02 -										
NodeName[1] := 'Extra Info Line';										
"Value[2] := FORMAT(TransSalesEntry.""Line No."");"										
NodeName[2] := 'Line No.';										
//LS7.1-02 +										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,(tmpTransSalesEntry.""Periodic Discount"" <> 0),FALSE,FALSE));"										
"AddPrintLine(350,2,NodeName,Value,DSTR1,FALSE,FALSE,FALSE,FALSE,Tray); //LS7.1-02"										
"TransSalesEntry.SETRANGE(""Deal Header Line No."",tmpTransSalesEntry.""Deal Header Line No."");"										
"TransSalesEntry.SETRANGE(""Deal Line No."",tmpTransSalesEntry.""Deal Line No."");"										
IF TransSalesEntry.FIND('-') THEN REPEAT										
"PrintDealLines(PrintItemNo,TransSalesEntry,Tray,TRUE,DealPrintingOption,DealModifierPrintingOption);"										
UNTIL TransSalesEntry.NEXT = 0;										
CLEAR(DealModifierPrintingOption);										
END ELSE										
"PrintDealLines(PrintItemNo,tmpTransSalesEntry,Tray,FALSE,DealPrintingOption,DealModifierPrintingOption);"										
"IF GenPosFunc.""Print Free Text on Receipt"" THEN"										
"PrintFreeTextLines(tmpTransSalesEntry,Tray,TRUE);"										
UNTIL tmpTransSalesEntry.NEXT = 0;										
END;										
										
"IF GenPosFunc.""Print Disc/Cpn Info on Slip"" ="										
"GenPosFunc.""Print Disc/Cpn Info on Slip""::""Detail information for each line"" THEN BEGIN"										
										
TransDiscountEntryTEMP.RESET;										
TransDiscountEntryTEMP.DELETEALL;										
										
TransSalesEntry2.RESET;										
"TransSalesEntry2.SETRANGE(""Store No."",TransSalesEntry.""Store No."");"										
"TransSalesEntry2.SETRANGE(""POS Terminal No."",TransSalesEntry.""POS Terminal No."");"										
"TransSalesEntry2.SETRANGE(""Transaction No."",TransSalesEntry.""Transaction No."");"										
"TransSalesEntry2.SETRANGE(""Deal Header Line No."",DealHeaderLineNo);"										
IF TransSalesEntry2.FINDSET THEN REPEAT										
TransDiscountEntry.RESET;										
"TransDiscountEntry.SETRANGE(""Store No."",TransSalesEntry2.""Store No."");"										
"TransDiscountEntry.SETRANGE(""POS Terminal No."",TransSalesEntry2.""POS Terminal No."");"										
"TransDiscountEntry.SETRANGE(""Transaction No."",TransSalesEntry2.""Transaction No."");"										
"TransDiscountEntry.SETRANGE(""Line No."",TransSalesEntry2.""Line No."");"										
IF TransDiscountEntry.FINDSET THEN REPEAT										
"TransDiscountEntryTEMP.SETRANGE(""Offer Type"",TransDiscountEntry.""Offer Type"");"										
"TransDiscountEntryTEMP.SETFILTER(""Offer No."",'%1',TransDiscountEntry.""Offer No."");"										
IF TransDiscountEntryTEMP.FINDFIRST THEN BEGIN										
"TransDiscountEntryTEMP.""Discount Amount"" := TransDiscountEntryTEMP.""Discount Amount"" +"										
"TransDiscountEntry.""Discount Amount"";"										
TransDiscountEntryTEMP.Points := TransDiscountEntryTEMP.Points +										
TransDiscountEntry.Points;										
TransDiscountEntryTEMP.MODIFY;										
END										
ELSE BEGIN										
TransDiscountEntryTEMP := TransDiscountEntry;										
TransDiscountEntryTEMP.INSERT;										
END;										
UNTIL TransDiscountEntry.NEXT = 0;										
UNTIL TransSalesEntry2.NEXT = 0;										
TransDiscountEntryTEMP.RESET;										
IF TransDiscountEntryTEMP.FINDSET THEN REPEAT										
//LS7.1-10 -										
"IF TransDiscountEntryTEMP.""Offer Type"" = TransDiscountEntryTEMP.""Offer Type""::Line THEN"										
DiscountText := Text084										
ELSE										
//LS7.1-10 +										
"DiscountText := FORMAT(TransDiscountEntryTEMP.""Offer Type"");"										
										
"IF TransDiscountEntryTEMP.""Offer Type"" = TransDiscountEntryTEMP.""Offer Type""::Coupon THEN BEGIN"										
"IF CouponHeader.GET(TransDiscountEntryTEMP.""Offer No."") THEN"										
DiscountText := CouponHeader.Description;										
END										
ELSE										
"IF PeriodicDiscount.GET(TransDiscountEntryTEMP.""Offer No."") THEN"										
DiscountText := PeriodicDiscount.Description										
ELSE										
{ //LS7.1-10-										
"IF TransDiscountEntryTEMP.""Offer Type"" = TransDiscountEntryTEMP.""Offer Type""::Total THEN"										
DiscountText := Text024										
ELSE										
"DiscountText := FORMAT(TransDiscountEntryTEMP.""Offer Type"");"										
//LS7.1-10+ }										
//LS7.1-10 -										
"CASE TransDiscountEntryTEMP.""Offer Type"" OF"										
"TransDiscountEntryTEMP.""Offer Type""::Total : DiscountText := Text024;"										
"TransDiscountEntryTEMP.""Offer Type""::Line : DiscountText := Text084;"										
ELSE										
"DiscountText := FORMAT(TransDiscountEntryTEMP.""Offer Type"");"										
END;										
//LS7.1-10 +										
"DiscountText := CONVERTSTR(DiscountText,'&','+');"										
//LS7.1-02 -										
NodeName[1] := 'Total Text';										
NodeName[2] := 'Total Amount';										
//LS7.1-02 +										
"IF TransDiscountEntryTEMP.""Discount Amount"" <> 0 THEN BEGIN"										
DSTR2 := '   #L################# #N############   ';										
Value[1] := DiscountText;										
"Value[2] := POSFunctions.FormatAmount(-TransDiscountEntryTEMP.""Discount Amount"");"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR2),FALSE,FALSE,FALSE,FALSE));"										
"AddPrintLine(800,2,NodeName,Value,DSTR1,FALSE,FALSE,FALSE,FALSE,Tray); //LS7.1-02"										
END;										
IF TransDiscountEntryTEMP.Points <> 0 THEN BEGIN										
DSTR2 := '   #L################# #N############   ';										
Value[1] := DiscountText;										
"Value[2] := POSFunctions.FormatAmount(TransDiscountEntry.""Discount Amount"") + ' ' + Text232;"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR2),FALSE,FALSE,FALSE,FALSE));"										
"AddPrintLine(800,2,NodeName,Value,DSTR1,FALSE,FALSE,FALSE,FALSE,Tray); //LS7.1-02"										
END;										
UNTIL TransDiscountEntryTEMP.NEXT = 0;										
END;										
END;										
										
PROCEDURE PrintDealLines@1100409004(PrintItemNo@1100409001 : Integer;SalesEntry@1100409002 : Record 99001473;Tray@1100409003 : Integ	er;	Ind	en	t@1	"100409010 : Boolean;DealPrintingOption@1100409012 : 'Header Only,Items w/Added Amt. Only,All Lines';DealModifierPrintingOption@1100409011 : 'None,Modifier Desc. & Amt. Only,All Modifier Lines ');"					
VAR										
Item@1100409005 : Record 27;										
ItemPosTextHeader@1100409007 : Record 99001534;										
ItemPosTextLine@1100409006 : Record 99001535;										
TransInfoEntry@1100409008 : Record 99001478;										
DSTR1@1100409000 : Text[100];										
ItemName@1100409004 : Text[30];										
PosTrans@1200070000 : Record 99001472;										
Customer@1200070001 : Record 18;										
ItemTranslate@1200070002 : Record 30;										
ItemVariant@1100409009 : Record 5401;										
BEGIN										
//PrintDealLines										
IF TmpPrintedSalesEntry.GET(										
"SalesEntry.""Store No."",SalesEntry.""POS Terminal No."",SalesEntry.""Transaction No."",SalesEntry.""Line No."")"										
THEN										
EXIT										
ELSE BEGIN										
"TmpPrintedSalesEntry.""Store No."" := SalesEntry.""Store No."";"										
"TmpPrintedSalesEntry.""POS Terminal No."" := SalesEntry.""POS Terminal No."";"										
"TmpPrintedSalesEntry.""Transaction No."" := SalesEntry.""Transaction No."";"										
"TmpPrintedSalesEntry.""Line No."" := SalesEntry.""Line No."";"										
TmpPrintedSalesEntry.INSERT;										
END;										
										
"IF DealModifierPrintingOption = DealModifierPrintingOption::""Modifier Desc. & Amt. Only"" THEN"										
EXIT;										
										
"IF (DealPrintingOption = DealPrintingOption::""Items w/Added Amt. Only"") AND (SalesEntry.""Deal Line Added Amt."" = 0) THEN"										
EXIT;										
										
"IF Item.GET(SalesEntry.""Item No."") THEN BEGIN"										
"IF (SalesEntry.""Variant Code"" <> '') AND (ItemVariant.GET(SalesEntry.""Item No."",SalesEntry.""Variant Code"")) THEN"										
"ItemName := COPYSTR(ItemVariant.Description,1,20)"										
ELSE										
"ItemName := COPYSTR(Item.Description,1,20);"										
END ELSE										
"ItemName := SalesEntry.""Item No."";"										
										
"PosTrans.GET(SalesEntry.""Store No."",SalesEntry.""POS Terminal No."",SalesEntry.""Transaction No."");"										
"IF Customer.GET(PosTrans.""Customer No."") THEN"										
"IF Customer.""Language Code"" <> '' THEN"										
"IF ItemTranslate.GET(SalesEntry.""Item No."",SalesEntry.""Variant Code"",Customer.""Language Code"") THEN"										
IF ItemTranslate.Description <> '' THEN										
ItemName := ItemTranslate.Description;										
										
DSTR1 := '   #L######### #L###################';										
IF PrintItemNo <> 0 THEN BEGIN										
IF PrintItemNo = 1 THEN BEGIN										
Value[1] := Text074;										
NodeName[1] := 'x'; //LS7.1-02										
"Value[2] := SalesEntry.""Item No."";"										
NodeName[2] := 'Item No.'; //LS7.1-02										
END ELSE BEGIN										
"IF SalesEntry.""Barcode No."" <> '' THEN BEGIN"										
Value[1] := Text075;										
NodeName[1] := 'x'; //LS7.1-02										
"Value[2] := SalesEntry.""Barcode No."";"										
NodeName[2] := 'Barcode'; //LS7.1-02										
END ELSE BEGIN										
Value[1] := Text074;										
NodeName[1] := 'x'; //LS7.1-02										
"Value[2] := SalesEntry.""Item No."";"										
NodeName[2] := 'Item No.'; //LS7.1-02										
END;										
END;										
//LS7.1-02 -										
"Value[3] := FORMAT(SalesEntry.""Line No."");"										
NodeName[3] := 'Line No.';										
//LS7.1-02 +										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
"AddPrintLine(300,3,NodeName,Value,DSTR1,FALSE,FALSE,FALSE,FALSE,Tray); //LS7.1-02"										
END;										
										
"IF (ABS(SalesEntry.Quantity) <> 1) OR SalesEntry.""Scale Item"" OR SalesEntry.""Price in Barcode"" THEN BEGIN"										
IF Indent THEN										
DSTR1 := '     #L#################################'										
ELSE										
DSTR1 := '   #L###################################';										
Value[1] := ItemName;										
NodeName[1] := 'x'; //LS7.1-02										
"IF SalesEntry.""Deal Line Added Amt."" <> 0 THEN"										
"Value[1] := Value[1] + ' ' + GenPosFunc.""Multiple Items Symbol"" + ' '"										
"+ POSFunctions.FormatPrice(SalesEntry.""Deal Line Added Amt."") + ' ' + Globals.GetValue('CURRSYM');"										
//LS7.1-02 -										
Value[2] := ItemName;										
NodeName[2] := 'Item Description'; //LS7.1-02										
"Value[3] := FORMAT(SalesEntry.""Line No."");"										
NodeName[3] := 'Line No.';										
"Value[4] := POSFunctions.FormatPrice(SalesEntry.""Deal Line Added Amt."");"										
NodeName[4] := 'Price';										
//LS7.1-02 +										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
"AddPrintLine(300,3,NodeName,Value,DSTR1,FALSE,FALSE,FALSE,FALSE,Tray); //LS7.1-02"										
										
CLEAR(Value);										
IF Indent THEN										
DSTR1 := '       #L############### #N########## #R'										
ELSE										
DSTR1 := '     #L################# #N########## #R';										
"IF SalesEntry.""Scale Item"" OR SalesEntry.""Price in Barcode"" THEN BEGIN"										
"IF SalesEntry.""Weight Manually Entered"" THEN BEGIN"										
IF Indent THEN										
DSTR1 := '    MAN #L############## #N########## #R'										
ELSE										
DSTR1 := '  MAN #L################ #N########## #R';										
END;										
"Value[1] := Value[1] + POSFunctions.FormatWeight(-SalesEntry.Quantity,SalesEntry.""Unit of Measure"");"										
END ELSE BEGIN										
"IF SalesEntry.""Unit of Measure"" = '' THEN"										
"SalesEntry.""Unit of Measure"" :=  Text131;"										
"IF (SalesEntry.""UOM Quantity"" <> 0) THEN BEGIN"										
"SalesEntry.Quantity := SalesEntry.""UOM Quantity"";"										
"SalesEntry.Price := SalesEntry.""UOM Price"";"										
END;										
"Value[1] := POSFunctions.FormatQty(-SalesEntry.Quantity) + LOWERCASE(SalesEntry.""Unit of Measure"");"										
END;										
NodeName[1] := 'x'; //LS7.1-02										
Value[2] := '';										
NodeName[2] := 'x'; //LS7.1-02										
"Value[3] := SalesEntry.""VAT Code"";"										
NodeName[3] := 'VAT Code'; //LS7.1-02										
//LS7.1-02 -										
"Value[4] := FORMAT(SalesEntry.""Line No."");"										
NodeName[4] := 'Line No.';										
"Value[5] := SalesEntry.""Unit of Measure"";"										
NodeName[5] := 'UOM ID';										
Value[6] := POSFunctions.FormatQty(-SalesEntry.Quantity);										
NodeName[6] := 'Quantity';										
//LS7.1-02 +										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,(SalesEntry.""Periodic Discount"" <> 0),FALSE,FALSE));"										
"AddPrintLine(300,6,NodeName,Value,DSTR1,FALSE,(SalesEntry.""Periodic Discount"" <> 0),FALSE,FALSE,Tray); //LS7.1-02"										
END ELSE BEGIN										
IF Indent THEN										
DSTR1 := '     #L############################## #R'										
ELSE										
DSTR1 := '   #L################################ #R';										
Value[1] := ItemName;										
"IF SalesEntry.""Unit of Measure"" <> '' THEN"										
"Value[1] := Value[1] + ' ' + SalesEntry.""Unit of Measure"";"										
"IF SalesEntry.""Deal Line Added Amt."" <> 0 THEN"										
"Value[1] := Value[1] + ' ' + GenPosFunc.""Multiple Items Symbol"" + ' '"										
"+ POSFunctions.FormatPrice(SalesEntry.""Deal Line Added Amt."") + ' ' + Globals.GetValue('CURRSYM');"										
NodeName[1] := 'x'; //LS7.1-02										
"Value[2] := SalesEntry.""VAT Code"";"										
NodeName[2] := 'VAT Code'; //LS7.1-02										
//LS7.1-02 -										
"Value[3] := FORMAT(SalesEntry.""Line No."");"										
NodeName[3] := 'Line No.';										
"Value[4] := SalesEntry.""Unit of Measure"";"										
NodeName[4] := 'UOM ID';										
Value[5] := POSFunctions.FormatQty(-SalesEntry.Quantity);										
NodeName[5] := 'Quantity';										
"Value[6] := POSFunctions.FormatPrice(SalesEntry.""Deal Line Added Amt."");"										
NodeName[6] := 'Price';										
//LS7.1-02 +										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,(SalesEntry.""Periodic Discount"" <> 0),FALSE,FALSE));"										
"AddPrintLine(300,6,NodeName,Value,DSTR1,FALSE,(SalesEntry.""Periodic Discount"" <> 0),FALSE,FALSE,Tray); //LS7.1-02"										
END;										
										
IF ItemPosTextHeader.GET(										
"SalesEntry.""Item No."",ItemPosTextHeader.""Text Type""::""Receipt Text"",Store.""Language Code"")"										
THEN BEGIN										
"ItemPosTextLine.SETRANGE(""Item No."",SalesEntry.""Item No."");"										
"ItemPosTextLine.SETRANGE(""Text Type"",ItemPosTextHeader.""Text Type""::""Receipt Text"");"										
"ItemPosTextLine.SETRANGE(""Language Code"",Store.""Language Code"");"										
IF ItemPosTextLine.FIND('-') THEN REPEAT										
//LS7.1-02 -										
"Value[1] := FORMAT(SalesEntry.""Line No."");"										
NodeName[1] := 'Line No.';										
Value[2] := ItemPosTextLine.Text;										
NodeName[3] := 'Extra Info Line';										
//LS7.1-02 +										
"PrintLine(Tray,ItemPosTextLine.Text);"										
"AddPrintLine(350,2,NodeName,Value,DSTR1,FALSE,FALSE,FALSE,FALSE,Tray); //LS7.1-02"										
UNTIL ItemPosTextLine.NEXT = 0;										
END;										
										
"TransInfoEntry.SETRANGE(""Store No."",SalesEntry.""Store No."");"										
"TransInfoEntry.SETRANGE(""POS Terminal No."",SalesEntry.""POS Terminal No."");"										
"TransInfoEntry.SETRANGE(""Transaction No."",SalesEntry.""Transaction No."");"										
"TransInfoEntry.SETRANGE(""Transaction Type"",TransInfoEntry.""Transaction Type""::""Sales Entry"");"										
"TransInfoEntry.SETRANGE(""Line No."",SalesEntry.""Line No."");"										
"PrintTransInfoCode(TransInfoEntry,Tray,FALSE);"										
END;										
										
PROCEDURE PrintPOSDeal@1100409010(DealPosTransLine@1100409000 : Record 99008981;Tray@1100409002 : Integer;PrintItemNo@1100409009 : I	nte	ger	;C	ove	rNo@1100409011 : Integer);					
VAR										
tmpDealPOSTransLine@1100409001 : TEMPORARY Record 99008981;										
Deal@1100409003 : Record 99001502;										
DealLine@1100409013 : Record 99001503;										
tmpPOSVATCode@1100409008 : TEMPORARY Record 99001560;										
DealPosTransLine2@1100409010 : Record 99008981;										
DealPosTransLine3@1100409017 : Record 99008981;										
tmpHdrPOSTransLine@1100409004 : TEMPORARY Record 99008981;										
DealAmount@1100409005 : Decimal;										
DealQty@1100409006 : Decimal;										
DSTR1@1100409007 : Text[100];										
DealPrice@1100409012 : Decimal;										
"DealPrintingOption@1100409016 : 'Header Only,Items w/Added Amt. Only,All Lines';"										
"DealModifierPrintingOption@1100409015 : 'None,Modifier Desc. & Amt. Only,All Modifier Lines ';"										
DealAddedAmt@1100409014 : Decimal;										
BEGIN										
//PrintPOSDeal										
//Coverno is coverno + 1										
"IF tmpDeal.GET(DealPosTransLine.""Promotion No."") THEN"										
EXIT										
ELSE BEGIN										
"tmpDeal.""No."" := DealPosTransLine.""Promotion No."";"										
tmpDeal.INSERT;										
END;										
										
tmpDealPOSTransLine.DELETEALL;										
tmpPOSVATCode.DELETEALL;										
tmpHdrPOSTransLine.DELETEALL;										
										
DealPosTransLine2.RESET;										
"DealPosTransLine2.SETRANGE(""Receipt No."",DealPosTransLine.""Receipt No."");"										
"DealPosTransLine2.SETRANGE(""Entry Type"",DealPosTransLine2.""Entry Type""::FreeText);"										
"DealPosTransLine2.SETRANGE(""Entry Status"",DealPosTransLine2.""Entry Status""::"" "");"										
"DealPosTransLine2.SETRANGE(""Promotion No."",DealPosTransLine.""Promotion No."");"										
"DealPosTransLine2.SETRANGE(""Deal Line"",TRUE);"										
DealAmount := 0;										
DealQty := 0;										
DealAddedAmt := 0;										
										
IF CoverNo > 0 THEN BEGIN										
"DealPosTransLine2.SETRANGE(""Guest/Seat No."",DealPosTransLine.""Guest/Seat No."");"										
END;										
IF DealPosTransLine2.FINDSET THEN										
REPEAT										
DealAmount += DealPosTransLine2.Amount;										
"//LS7.1-12   IF GenPosFunc.""Print Disc/Cpn Info on Slip"" <> GenPosFunc.""Print Disc/Cpn Info on Slip""::""Summary information below"	Sub	#NAME?	ta	"l"""	THEN BEGIN					
//LS7.1-12 -										
"IF NOT (GenPosFunc.""Print Disc/Cpn Info on Slip"" IN"										
"[GenPosFunc.""Print Disc/Cpn Info on Slip""::""Detail for each line and Sub-total"","										
"GenPosFunc.""Print Disc/Cpn Info on Slip""::""Summary information below Sub-total""]) THEN BEGIN"										
//LS7.1-12 +										
DealPosTransLine3.COPY(DealPosTransLine2);										
"DealPosTransLine3.SETRANGE(""Entry Type"",DealPosTransLine3.""Entry Type""::Item);"										
IF DealPosTransLine3.FINDSET THEN REPEAT										
"DealAmount := DealAmount - DealPosTransLine3.""Discount Amount"";"										
UNTIL DealPosTransLine3.NEXT = 0;										
END;										
"DealAddedAmt += DealPosTransLine2.""Deal Added Amount"" + DealPosTransLine2.""Deal Modifier Added Amt."";"										
DealQty += DealPosTransLine2.Quantity;										
tmpHdrPOSTransLine := DealPosTransLine2;										
tmpHdrPOSTransLine.INSERT;										
UNTIL DealPosTransLine2.NEXT = 0;										
										
"IF Deal.GET(DealPosTransLine2.""Promotion No."") THEN BEGIN"										
"IF Deal.""Deal Lines Printing"" <> Deal.""Deal Lines Printing""::""From Functionality Profile"" THEN"										
"DealPrintingOption := Deal.""Deal Lines Printing"" - 1"										
ELSE										
"DealPrintingOption := GenPosFunc.""Deal Lines Printing"";"										
END ELSE										
"DealPrintingOption := GenPosFunc.""Deal Lines Printing"";"										
										
DealPrice := DealPosTransLine2.Price;										
										
CLEAR(Value);										
"IF Deal.GET(DealPosTransLine.""Promotion No."") THEN"										
"Value[1] := COPYSTR(Deal.Description,1,20)"										
ELSE										
Value[1] := Text501;										
NodeName[1] := 'Item Description'; //LS7.1-02										
DSTR1 := '#L###################### #N########## #R';										
										
"DealPosTransLine2.SETRANGE(""Entry Type"",DealPosTransLine2.""Entry Type""::Item);"										
IF DealPosTransLine2.FINDSET THEN REPEAT										
tmpDealPOSTransLine := DealPosTransLine2;										
tmpDealPOSTransLine.INSERT;										
"IF tmpPOSVATCode.GET(tmpDealPOSTransLine.""VAT Code"") THEN BEGIN"										
"tmpPOSVATCode.""VAT %"" += tmpDealPOSTransLine.""Net Amount"" + tmpDealPOSTransLine.""VAT Amount"";"										
"//LS7.1-12    IF GenPosFunc.""Print Disc/Cpn Info on Slip"" = GenPosFunc.""Print Disc/Cpn Info on Slip""::""Summary information below S"	ub-	tot	al	""" T"	HEN					
//LS7.1-12 -										
"IF GenPosFunc.""Print Disc/Cpn Info on Slip"" IN"										
"[GenPosFunc.""Print Disc/Cpn Info on Slip""::""Detail for each line and Sub-total"","										
"GenPosFunc.""Print Disc/Cpn Info on Slip""::""Summary information below Sub-total""] THEN"										
//LS7.1-12 +										
"tmpPOSVATCode.""VAT %"" := tmpPOSVATCode.""VAT %"" + tmpDealPOSTransLine.""Discount Amount"";"										
tmpPOSVATCode.MODIFY;										
END ELSE BEGIN										
"tmpPOSVATCode.""VAT Code"" := tmpDealPOSTransLine.""VAT Code"";"										
"tmpPOSVATCode.""VAT %"" := tmpDealPOSTransLine.""Net Amount"" + tmpDealPOSTransLine.""VAT Amount"";"										
"//LS7.1-12    IF GenPosFunc.""Print Disc/Cpn Info on Slip"" = GenPosFunc.""Print Disc/Cpn Info on Slip""::""Summary information below S"	ub-	tot	al	""" T"	HEN					
//LS7.1-12 -										
"IF GenPosFunc.""Print Disc/Cpn Info on Slip"" IN"										
"[GenPosFunc.""Print Disc/Cpn Info on Slip""::""Detail for each line and Sub-total"","										
"GenPosFunc.""Print Disc/Cpn Info on Slip""::""Summary information below Sub-total""] THEN"										
//LS7.1-12 +										
"tmpPOSVATCode.""VAT %"" := tmpPOSVATCode.""VAT %"" + tmpDealPOSTransLine.""Discount Amount"";"										
tmpPOSVATCode.INSERT;										
END;										
UNTIL DealPosTransLine2.NEXT = 0;										
										
IF tmpPOSVATCode.COUNT = 1 THEN BEGIN										
IF DealQty = 1 THEN BEGIN										
Value[2] := POSFunctions.FormatPrice(DealAmount);										
NodeName[2] := 'Amount'; //LS7.1-02										
"Value[3] := DealPosTransLine2.""VAT Code"";"										
NodeName[3] := 'VAT Code'; //LS7.1-02										
//LS7.1-02 -										
"Value[4] := FORMAT(DealPosTransLine.""Line No."");"										
NodeName[4] := 'Line No.';										
//LS7.1-02 +										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
"AddPrintLine(300,4,NodeName,Value,DSTR1,FALSE,FALSE,FALSE,FALSE,Tray); //LS7.1-02"										
END ELSE BEGIN										
//LS7.1-02 -										
NodeName[2] := 'x';										
NodeName[3] := 'x';										
"Value[4] := FORMAT(DealPosTransLine.""Line No."");"										
NodeName[4] := 'Line No.';										
//LS7.1-02 +										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
"AddPrintLine(300,4,NodeName,Value,DSTR1,FALSE,FALSE,FALSE,FALSE,Tray); //LS7.1-02"										
DSTR1 := '   #L################### #N########## #R';										
Value[1] :=										
"POSFunctions.FormatQty(DealQty) + ' ' + GenPosFunc.""Multiple Items Symbol"" + ' '"										
+ POSFunctions.FormatPrice(DealPrice);										
NodeName[1] := 'x'; //LS7.1-02										
Value[2] := POSFunctions.FormatPrice(DealAmount);										
NodeName[2] := 'Amount'; //LS7.1-02										
"Value[3] := DealPosTransLine2.""VAT Code"";"										
NodeName[3] := 'VAT Code'; //LS7.1-02										
//LS7.1-02 -										
"Value[4] := FORMAT(DealPosTransLine.""Line No."");"										
NodeName[4] := 'Line No.';										
Value[5] := POSFunctions.FormatQty(DealQty);										
NodeName[5] := 'Quantity';										
Value[6] := POSFunctions.FormatPrice(DealPrice);										
NodeName[6] := 'Price';										
//LS7.1-02 -										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
"AddPrintLine(300,6,NodeName,Value,DSTR1,FALSE,FALSE,FALSE,FALSE,Tray); //LS7.1-02"										
END;										
END ELSE BEGIN										
//LS7.1-02 -										
NodeName[2] := 'x';										
NodeName[3] := 'x';										
"Value[4] := FORMAT(DealPosTransLine.""Line No."");"										
NodeName[4] := 'Line No.';										
//LS7.1-02 +										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
"AddPrintLine(300,4,NodeName,Value,DSTR1,FALSE,FALSE,FALSE,FALSE,Tray); //LS7.1-02"										
IF DealQty <> 1 THEN BEGIN										
DSTR1 := '   #L################### #N########## #R';										
"Value[1] := POSFunctions.FormatQty(DealQty) + ' ' + GenPosFunc.""Multiple Items Symbol"" + ' '"										
+ POSFunctions.FormatPrice(DealPrice);										
NodeName[1] := 'x'; //LS7.1-02										
Value[2] := '';										
NodeName[2] := 'x'; //LS7.1-02										
//LS7.1-02 -										
NodeName[3] := 'x'; //LS7.1-02										
"Value[4] := FORMAT(DealPosTransLine.""Line No."");"										
NodeName[4] := 'Line No.';										
Value[5] := POSFunctions.FormatQty(DealQty);										
NodeName[5] := 'Quantity';										
Value[6] := POSFunctions.FormatPrice(DealPrice);										
NodeName[6] := 'Price';										
//LS7.1-02 -										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
"AddPrintLine(300,6,NodeName,Value,DSTR1,FALSE,FALSE,FALSE,FALSE,Tray); //LS7.1-02"										
DSTR1 := '#L###################### #N########## #R';										
END;										
tmpPOSVATCode.FIND('-');										
REPEAT										
"Value[3] := tmpPOSVATCode.""VAT Code"";"										
NodeName[3] := 'x'; //LS7.1-02										
"Value[2] := FORMAT(tmpPOSVATCode.""VAT %"");"										
NodeName[2] := 'x'; //LS7.1-02										
Value[1] := '';										
NodeName[1] := 'x'; //LS7.1-02										
"Value[4] := FORMAT(DealPosTransLine.""Line No."");"										
NodeName[4] := 'Line No.';										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
"AddPrintLine(350,4,NodeName,Value,DSTR1,FALSE,FALSE,FALSE,FALSE,Tray); //LS7.1-02"										
UNTIL tmpPOSVATCode.NEXT = 0;										
END;										
										
"IF GenPosFunc.""Print Free Text on Receipt"" THEN BEGIN"										
IF tmpHdrPOSTransLine.FINDSET THEN REPEAT										
"PrintPOSFreeTextLines(tmpHdrPOSTransLine,Tray,FALSE,TRUE);"										
UNTIL tmpHdrPOSTransLine.NEXT = 0;										
END;										
										
"IF DealPrintingOption <> DealPrintingOption::""Header Only"" THEN BEGIN"										
IF tmpDealPOSTransLine.FIND('-') THEN REPEAT										
"IF tmpDealPOSTransLine.""Deal Modifier Added Amt."" <> 0 THEN BEGIN"										
DSTR1 := '   #L###################################';										
"IF DealLine.GET(DealPosTransLine.""Promotion No."",tmpDealPOSTransLine.""Deal Line No."") THEN BEGIN"										
Value[1] := DealLine.Description;										
"DealModifierPrintingOption := DealLine.""Receipt Printing"" + 1;"										
END ELSE BEGIN										
Value[1] := Text502;										
"DealModifierPrintingOption := DealModifierPrintingOption::""Modifier Desc. & Amt. Only"";"										
END;										
"Value[1] := Value[1] + ' ' + GenPosFunc.""Multiple Items Symbol"" + ' '"										
"+ POSFunctions.FormatPrice(tmpDealPOSTransLine.""Deal Modifier Added Amt."") + ' ' + Globals.GetValue('CURRSYM');"										
//LS7.1-02 -										
NodeName[1] := 'Extra Info Line';										
"Value[2] := FORMAT(DealPosTransLine.""Line No."");"										
NodeName[2] := 'Line No.';										
//LS7.1-02 +										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,(tmpDealPOSTransLine.""Periodic Discount Amount"" <> 0),FALSE,FALSE));"										
"AddPrintLine(350,2,NodeName,Value,DSTR1,FALSE,(tmpDealPOSTransLine.""Periodic Discount Amount"" <> 0),FALSE,FALSE,Tray); //LS7"	-0.1	2								
"DealPosTransLine2.SETRANGE(""Disc. Info Line No."",tmpDealPOSTransLine.""Disc. Info Line No."");"										
"DealPosTransLine2.SETRANGE(""Deal Line No."",tmpDealPOSTransLine.""Deal Line No."");"										
IF DealPosTransLine2.FIND('-') THEN REPEAT										
"PrintPOSDealLines(PrintItemNo,DealPosTransLine2,Tray,TRUE,DealPrintingOption,DealModifierPrintingOption);"										
UNTIL DealPosTransLine2.NEXT = 0;										
CLEAR(DealModifierPrintingOption);										
END ELSE										
"PrintPOSDealLines(PrintItemNo,tmpDealPOSTransLine,Tray,FALSE,DealPrintingOption,DealModifierPrintingOption);"										
"IF GenPosFunc.""Print Free Text on Receipt"" THEN"										
"PrintPOSFreeTextLines(tmpDealPOSTransLine,Tray,TRUE,FALSE);"										
UNTIL tmpDealPOSTransLine.NEXT = 0;										
END;										
END;										
										
PROCEDURE PrintPOSDealLines@1100409009(PrintItemNo@1100409001 : Integer;DealLine@1100409002 : Record 99008981;Tray@1100409003 : Inte	ger	;In	de	nt@	"1100409009 : Boolean;DealPrintingOption@1100409011 : 'Header Only,Items w/Added Amt. Only,All Lines';DealModifierPrintingOption@1100409010 : 'None,Modifier Desc. & Amt. Only,All Modifier Lines ');"					
VAR										
Item@1100409005 : Record 27;										
ItemPosTextHeader@1100409007 : Record 99001534;										
ItemPosTextLine@1100409006 : Record 99001535;										
POSTransInfoEntry@1100409008 : Record 99008982;										
DSTR1@1100409000 : Text[100];										
ItemName@1100409004 : Text[30];										
PosTrans@1200070000 : Record 99008980;										
Customer@1200070001 : Record 18;										
ItemTranslate@1200070002 : Record 30;										
BEGIN										
//PrintPOSDealLines										
"IF TmpPrintedDealPOSTransLine.GET(DealLine.""Receipt No."",DealLine.""Line No."") THEN"										
EXIT										
ELSE BEGIN										
"TmpPrintedDealPOSTransLine.""Receipt No."" := DealLine.""Receipt No."";"										
"TmpPrintedDealPOSTransLine.""Line No."" := DealLine.""Line No."";"										
TmpPrintedDealPOSTransLine.INSERT;										
END;										
										
"IF DealModifierPrintingOption = DealModifierPrintingOption::""Modifier Desc. & Amt. Only"" THEN"										
EXIT;										
										
"IF (DealPrintingOption = DealPrintingOption::""Items w/Added Amt. Only"") AND (DealLine.""Deal Added Amount"" = 0) THEN"										
EXIT;										
										
"ItemName := COPYSTR(DealLine.Description,1,20);"										
IF ItemName = '' THEN BEGIN										
IF Item.GET(DealLine.Number) THEN										
"ItemName := COPYSTR(Item.Description,1,20)"										
ELSE										
ItemName := DealLine.Number;										
END;										
										
"PosTrans.GET(DealLine.""Receipt No."");"										
"IF Customer.GET(PosTrans.""Customer No."") THEN"										
"IF Customer.""Language Code"" <> '' THEN"										
"IF ItemTranslate.GET(DealLine.Number,DealLine.""Variant Code"",Customer.""Language Code"") THEN"										
IF ItemTranslate.Description <> '' THEN										
ItemName := ItemTranslate.Description;										
										
DSTR1 := '   #L######### #L###################';										
CLEAR(Value);										
										
IF PrintItemNo <> 0 THEN BEGIN										
IF PrintItemNo = 1 THEN BEGIN										
Value[1] := Text074;										
NodeName[1] := 'x'; //LS7.1-02										
Value[2] := DealLine.Number;										
NodeName[2] := 'Item No.'; //LS7.1-02										
END ELSE BEGIN										
"IF DealLine.""Barcode No."" <> '' THEN BEGIN"										
Value[1] := Text075;										
NodeName[1] := 'x'; //LS7.1-02										
"Value[2] := DealLine.""Barcode No."";"										
NodeName[2] := 'Barcode'; //LS7.1-02										
END ELSE BEGIN										
Value[1] := Text074;										
NodeName[1] := 'x'; //LS7.1-02										
Value[2] := DealLine.Number;										
NodeName[2] := 'Item No.'; //LS7.1-02										
END;										
END;										
//LS7.1-02 -										
"Value[3] := FORMAT(DealLine.""Line No."");"										
NodeName[3] := 'Line No.';										
//LS7.1-02 +										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
"AddPrintLine(300,3,NodeName,Value,DSTR1,FALSE,FALSE,FALSE,FALSE,Tray); //LS7.1-02"										
END;										
										
"IF (ABS(DealLine.Quantity) <> 1) OR DealLine.""Scale Item"" OR DealLine.""Price in Barcode"" THEN BEGIN"										
IF Indent THEN										
DSTR1 := '     #L#################################'										
ELSE										
DSTR1 := '   #L###################################';										
Value[1] := ItemName;										
"IF DealLine.""Deal Added Amount"" <> 0 THEN"										
"Value[1] := Value[1] + ' ' + GenPosFunc.""Multiple Items Symbol"" + ' '"										
"+ POSFunctions.FormatPrice(DealLine.""Deal Added Amount"") + ' ' + Globals.GetValue('CURRSYM');"										
NodeName[1] := 'x'; //LS7.1-02										
//LS7.1-02 -										
Value[2] := ItemName;										
NodeName[2] := 'Item Description'; //LS7.1-02										
"Value[3] := FORMAT(DealLine.""Line No."");"										
NodeName[3] := 'Line No.';										
"Value[4] := POSFunctions.FormatPrice(DealLine.""Deal Added Amount"");"										
NodeName[4] := 'Price';										
//LS7.1-02 +										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
"AddPrintLine(300,3,NodeName,Value,DSTR1,FALSE,FALSE,FALSE,FALSE,Tray); //LS7.1-02"										
										
CLEAR(Value);										
IF Indent THEN										
DSTR1 := '       #L############### #N########## #R'										
ELSE										
DSTR1 := '     #L################# #N########## #R';										
										
"IF DealLine.""Scale Item"" OR DealLine.""Price in Barcode"" THEN BEGIN"										
"IF DealLine.""Weight manually Entered"" THEN"										
IF Indent THEN										
DSTR1 := '    MAN #L############## #N########## #R'										
ELSE										
DSTR1 := '  MAN #L################ #N########## #R';										
"Value[1] := POSFunctions.FormatWeight(-DealLine.Quantity,DealLine.""Unit of Measure"");"										
END ELSE BEGIN										
"IF DealLine.""Unit of Measure"" = '' THEN"										
"DealLine.""Unit of Measure"" :=  Text131;"										
"Value[1] := POSFunctions.FormatQty(DealLine.Quantity) + LOWERCASE(DealLine.""Unit of Measure"");"										
END;										
NodeName[1] := 'x'; //LS7.1-02										
Value[2] := '';										
NodeName[2] := 'x'; //LS7.1-02										
"Value[3] := DealLine.""VAT Code"";"										
NodeName[3] := 'VAT Code'; //LS7.1-02										
//LS7.1-02 -										
"Value[4] := FORMAT(DealLine.""Line No."");"										
NodeName[4] := 'Line No.';										
"Value[5] := DealLine.""Unit of Measure"";"										
NodeName[5] := 'UOM ID';										
Value[6] := POSFunctions.FormatQty(DealLine.Quantity);										
NodeName[6] := 'Quantity';										
//LS7.1-02 +										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,(DealLine.""Periodic Discount Amount"" <> 0),FALSE,FALSE));"										
"AddPrintLine(300,6,NodeName,Value,DSTR1,FALSE,(DealLine.""Periodic Discount Amount"" <> 0),FALSE,FALSE,Tray); //LS7.1-02"										
END ELSE BEGIN										
IF Indent THEN										
DSTR1 := '     #L############################## #R'										
ELSE										
DSTR1 := '   #L################################ #R';										
Value[1] := ItemName;										
"IF DealLine.""Unit of Measure"" <> '' THEN"										
"Value[1] := COPYSTR(Value[1],1,18) + ' ' + DealLine.""Unit of Measure"";"										
"IF DealLine.""Deal Added Amount"" <> 0 THEN"										
"Value[1] := Value[1] + ' ' + GenPosFunc.""Multiple Items Symbol"" + ' '"										
"+ POSFunctions.FormatPrice(DealLine.""Deal Added Amount"") + ' ' + Globals.GetValue('CURRSYM');"										
NodeName[1] := 'x'; //LS7.1-02										
"Value[2] := DealLine.""VAT Code"";"										
NodeName[2] := 'VAT Code'; //LS7.1-02										
//LS7.1-02 -										
"Value[3] := FORMAT(DealLine.""Line No."");"										
NodeName[3] := 'Line No.';										
"Value[4] := DealLine.""Unit of Measure"";"										
NodeName[4] := 'UOM ID';										
Value[5] := POSFunctions.FormatQty(DealLine.Quantity);										
NodeName[5] := 'Quantity';										
"Value[6] := POSFunctions.FormatPrice(DealLine.""Deal Added Amount"");"										
NodeName[6] := 'Price';										
//LS7.1-02 +										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,(DealLine.""Periodic Discount Amount"" <> 0),FALSE,FALSE));"										
"AddPrintLine(300,6,NodeName,Value,DSTR1,FALSE,(DealLine.""Periodic Discount Amount"" <> 0),FALSE,FALSE,Tray); //LS7.1-02"										
END;										
										
IF ItemPosTextHeader.GET(										
"DealLine.Number,ItemPosTextHeader.""Text Type""::""Receipt Text"",Store.""Language Code"")"										
THEN BEGIN										
"ItemPosTextLine.SETRANGE(""Item No."",DealLine.Number);"										
"ItemPosTextLine.SETRANGE(""Text Type"",ItemPosTextHeader.""Text Type""::""Receipt Text"");"										
"ItemPosTextLine.SETRANGE(""Language Code"",Store.""Language Code"");"										
IF ItemPosTextLine.FIND('-') THEN REPEAT										
//LS7.1-02 -										
"Value[1] := FORMAT(DealLine.""Line No."");"										
NodeName[1] := 'Line No.';										
Value[2] := ItemPosTextLine.Text;										
NodeName[3] := 'Extra Info Line';										
//LS7.1-02 +										
"PrintLine(Tray,ItemPosTextLine.Text);"										
"AddPrintLine(350,2,NodeName,Value,DSTR1,FALSE,FALSE,FALSE,FALSE,Tray); //LS7.1-02"										
UNTIL ItemPosTextLine.NEXT = 0;										
END;										
										
"POSTransInfoEntry.SETRANGE(""Receipt No."",DealLine.""Receipt No."");"										
"POSTransInfoEntry.SETRANGE(""Transaction Type"",POSTransInfoEntry.""Transaction Type""::""Sales Entry"");"										
"POSTransInfoEntry.SETRANGE(""Line No."",DealLine.""Line No."");"										
"POSTransInfoEntry.SETRANGE(""Transaction Type"",POSTransInfoEntry.""Transaction Type""::""Sales Entry"");"										
"POSTransInfoEntry.SETRANGE(""Line No."",DealLine.""Line No."");"										
"PrintPOSTransInfoCode(POSTransInfoEntry,Tray,FALSE);"										
END;										
										
PROCEDURE PrintVoucherRemainingAmt@1200070005(TransPaymentEntry@1200070000 : Record 99001474) : Boolean;										
VAR										
VoucherEntries@1200070001 : Record 99001467;										
POSDataEntry@1200070002 : Record 99001558;										
TenderType@1200070004 : Record 99001462;										
TransactionHeader@1200070005 : Record 99001472;										
POSTableSpecPrintSetup@1200070007 : Record 99001552;										
POSPrintSetupHeader@1200070006 : Record 99001550;										
InfoNumber@1200070003 : Text[30];										
BEGIN										
//PrintVoucherRemainingAmt										
InfoNumber := '';										
POSDataEntry.RESET;										
"POSDataEntry.SETCURRENTKEY(""Created by Receipt No."",""Created by Line No."");"										
"POSDataEntry.SETRANGE(""Created by Receipt No."",TransPaymentEntry.""Receipt No."");"										
"POSDataEntry.SETRANGE(""Created by Line No."",TransPaymentEntry.""Line No."");"										
IF POSDataEntry.FIND('-') THEN										
"InfoNumber := POSDataEntry.""Entry Code"""										
ELSE BEGIN										
POSDataEntry.RESET;										
"POSDataEntry.SETCURRENTKEY(""Applied by Receipt No."",""Applied by Line No."");"										
"POSDataEntry.SETRANGE(""Applied by Receipt No."",TransPaymentEntry.""Receipt No."");"										
"POSDataEntry.SETRANGE(""Applied by Line No."",TransPaymentEntry.""Line No."");"										
IF POSDataEntry.FIND('-') THEN										
"InfoNumber := POSDataEntry.""Entry Code"";"										
END;										
IF InfoNumber = '' THEN										
EXIT;										
"IF NOT TenderType.GET(Globals.StoreNo,TransPaymentEntry.""Tender Type"") THEN"										
EXIT(TRUE);										
VoucherEntries.RESET;										
"VoucherEntries.SETRANGE(""Store No."",TransPaymentEntry.""Store No."");"										
"VoucherEntries.SETRANGE(""POS Terminal No."",TransPaymentEntry.""POS Terminal No."");"										
"VoucherEntries.SETRANGE(""Transaction No."",TransPaymentEntry.""Transaction No."");"										
"VoucherEntries.SETRANGE(""Receipt Number"",TransPaymentEntry.""Receipt No."");"										
"VoucherEntries.SETRANGE(""Voucher No."",InfoNumber);"										
IF NOT VoucherEntries.FIND('+') THEN										
EXIT;										
"IF VoucherEntries.""Remaining Amount Now"" <= 0 THEN"										
EXIT;										
										
"TransactionHeader.GET(TransPaymentEntry.""Store No."",TransPaymentEntry.""POS Terminal No."",TransPaymentEntry.""Transaction No."");"										
POSTableSpecPrintSetup.RESET;										
"POSTableSpecPrintSetup.SETRANGE(""Table No."",DATABASE::""Tender Type"");"										
"POSTableSpecPrintSetup.SETRANGE(Key,TenderType.""Primary Key"");"										
"POSTableSpecPrintSetup.SETRANGE(""When Required"",POSTableSpecPrintSetup.""When Required""::""Voucher Re-Issue"");"										
IF POSTableSpecPrintSetup.FIND('-') THEN REPEAT										
"IF POSPrintSetupHeader.GET(POSTableSpecPrintSetup.""Setup ID"") THEN"										
"IF NOT PrintExtra(TransactionHeader,POSPrintSetupHeader,VoucherEntries.""Remaining Amount Now"",0,0"										
",TenderType.Code,TenderType.Description,InfoNumber,"										
"2,TransPaymentEntry.""Line No."",POSDataEntry.""Entry Type"",'','','','') THEN"										
EXIT(FALSE);										
UNTIL POSTableSpecPrintSetup.NEXT = 0;										
EXIT(TRUE);										
END;										
										
PROCEDURE PrintHOSPSlip@1200070006(VAR POSTrans@1000 : Record 99008980;SplittNumber@1200070000 : Integer) : Boolean;										
VAR										
Transaction@1010 : Record 99001472;										
POSTransactionCodeunit@1100409000 : Codeunit 99001570;										
STATE_SALES@1100409001 : Code[10];										
BEGIN										
//PrintHOSPSlip										
//SplittNumber is SplittNumber + 1										
"IF NOT OpenReceiptPrinter(2, 'HOSP', '', 0, POSTrans.""Receipt No."") THEN"										
EXIT(FALSE);										
										
PrintLogo(2); //LS7.1-06										
"POSTrans.CALCFIELDS(""Gross Amount"",""Total Discount"",""Income/Exp. Amount"");"										
"PrintPOSHeader(POSTrans,2,SplittNumber);"										
"PrintPOSSubHeader(POSTrans,2,POSTrans.""Original Date"",POSTrans.""Trans Time"");"										
										
STATE_SALES := 'SALES';										
IF (SplittNumber > 0) AND (POSTransactionCodeunit.GetPosState = STATE_SALES) THEN										
POSTransactionCodeunit.TotalPressed(TRUE);										
"POSTrans.CALCFIELDS(""Gross Amount"");"										
										
"PrintPosSalesInfo(POSTrans,2,SplittNumber);"										
"PrintHOSPTotal(POSTrans,2,0,SplittNumber);"										
"PrintTipLines(POSTrans,2);"										
"PrintPOSFooter(POSTrans,2);"										
IF NOT ClosePrinter(2) THEN										
EXIT(FALSE);										
										
EXIT(TRUE);										
END;										
										
PROCEDURE PrintHOSPTotal@1200070008(POSTrans@1000 : Record 99008980;Tray@1001 : Integer;RightIndent@1002 : Integer;SplittNumber@1200	70	1	:	In	teger) : Boolean;					
VAR										
DSTR1@1003 : Text[50];										
SecTotal@1004 : Decimal;										
CurrencyExchRate@1006 : Record 330;										
Total@1007 : Decimal;										
POSSalesEntry@1200070000 : Record 99008981;										
"""Total Discount""@1200070002 : Decimal;"										
BEGIN										
//PrintHOSPTotal										
//SPlittNumber is SplittNumber + 1										
										
EXIT;										
										
CLEAR(Value);										
CLEAR(Currency);										
										
"POSSalesEntry.SETRANGE(""Receipt No."",POSTrans.""Receipt No."");"										
POSSalesEntry.SETFILTER(										
"""Entry Type"",'%1|%2',POSSalesEntry.""Entry Type""::Item,POSSalesEntry.""Entry Type""::IncomeExpense);"										
"POSSalesEntry.SETRANGE(POSSalesEntry.""Entry Status"",POSSalesEntry.""Entry Status""::"" "");"										
										
IF SplittNumber <> 1 THEN										
"POSSalesEntry.SETRANGE(POSSalesEntry.""Guest/Seat No."",SplittNumber - 1)"										
ELSE										
"POSSalesEntry.SETRANGE(POSSalesEntry.""Guest/Seat No."",0);"										
										
Total := 0;										
"""Total Discount"" := 0;"										
										
IF POSSalesEntry.FIND('-') THEN REPEAT										
"PosPriceUtil.GetTransDisc(POSSalesEntry,TRUE,0);"										
Total := Total + POSSalesEntry.Amount;										
"""Total Discount"" := ""Total Discount"" + POSSalesEntry.""Total Disc. Amount"";"										
UNTIL POSSalesEntry.NEXT() = 0;										
										
"IF GenPosFunc.""Display Secondary Total Curr"" AND (GenPosFunc.""Secondary Total Currency"" <> '') THEN BEGIN"										
"IF NOT Currency.GET(GenPosFunc.""Secondary Total Currency"") THEN"										
CLEAR(Currency);										
SecTotal :=										
ROUND(										
"CurrencyExchRate.ExchangeAmtFCYToFCY(POSTrans.""Original Date"",POSTrans.""Trans. Currency Code"","										
"Currency.Code, Total),Currency.""Amount Rounding Precision"");"										
END;										
//LS7.1-02 -										
NodeName[1] := 'Total Text';										
NodeName[2] := 'Total Amount';										
//LS7.1-02 +										
DSTR1 := '#L########## #R######### #R#############';										
"DSTR1 := COPYSTR(DSTR1,1,STRLEN(DSTR1) - RightIndent);"										
"IF ""Total Discount"" <> 0 THEN BEGIN"										
Value[1] := Text042;										
"Value[2] := POSFunctions.FormatAmount(Total + ""Total Discount"");"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
"AddPrintLine(800,2,NodeName,Value,DSTR1,FALSE,TRUE,FALSE,FALSE,2); //LS7.1-02"										
Value[1] := Text043;										
"Value[2] := POSFunctions.FormatAmount(-""Total Discount"");"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
"AddPrintLine(800,2,NodeName,Value,DSTR1,FALSE,TRUE,FALSE,FALSE,2); //LS7.1-02"										
END;										
Value[1] := Text005 + ' ' +  Globals.GetValue('CURRSYM');										
Value[2] := '';										
"IF GenPosFunc.""Display Secondary Total Curr"" AND (GenPosFunc.""Secondary Total Currency"" <> '') AND (SecTotal <> 0) THEN"										
"Value[2] := Currency.Code + FORMAT(SecTotal,0,ApplMan.AutoFormatTranslate(1,Currency.Code));"										
NodeName[2] := 'x'; //LS7.1-02										
Value[3] := POSFunctions.FormatAmount(Total);										
NodeName[3] := 'Total Amount'; //LS7.1-02										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
"AddPrintLine(800,3,NodeName,Value,DSTR1,FALSE,TRUE,FALSE,FALSE,2); //LS7.1-02"										
END;										
										
PROCEDURE BreakDownCommTxt@1100409011(CommentString@1100409004 : Text[150];VAR CommentTxt@1100409003 : ARRAY [4] OF Text[150]);										
VAR										
tmpComTxt@1100409002 : Text[150];										
Len@1100409001 : Integer;										
LineLenTemp@1100409000 : Integer;										
HospPosComm@1100409006 : Codeunit 10001201;										
Counter@1100409005 : Integer;										
BEGIN										
//BreakDownCommTxt										
CLEAR(CommentTxt);										
tmpComTxt := CommentString;										
LineLenTemp := LineLen - 1;										
Len := STRLEN(tmpComTxt);										
Counter := 1;										
WHILE (Len <> 0) AND (Counter < 5) DO BEGIN										
CommentTxt[Counter] := tmpComTxt;										
"Len := HospPosComm.BreakDownCommTxt(CommentTxt[Counter],LineLenTemp,TRUE);"										
IF Len <> 0 THEN										
"tmpComTxt := COPYSTR(tmpComTxt,Len + 1);"										
Counter := Counter + 1;										
END;										
										
{org.code										
IF (Len <> 0) THEN BEGIN										
IF (Len <= LineLenTemp) THEN BEGIN										
"CommentTxt[1] := COPYSTR(tmpComTxt,1,Len);"										
END										
ELSE BEGIN										
"CommentTxt[1] := COPYSTR(tmpComTxt,1,LineLenTemp);"										
"tmpComTxt := COPYSTR(tmpComTxt,(LineLenTemp + 1),(Len - LineLenTemp));"										
Len := STRLEN(tmpComTxt);										
IF (Len <> 0) THEN BEGIN										
CommentTxt[1] := CommentTxt[1] + '-';										
IF (Len <= LineLenTemp) THEN BEGIN										
"CommentTxt[2] := COPYSTR(tmpComTxt,1,Len);"										
END										
ELSE BEGIN										
"CommentTxt[2] := COPYSTR(tmpComTxt,1,LineLenTemp);"										
"tmpComTxt := COPYSTR(tmpComTxt,(LineLenTemp + 1),(Len - LineLenTemp));"										
Len := STRLEN(tmpComTxt);										
IF (Len <> 0) THEN BEGIN										
CommentTxt[2] := CommentTxt[2] + '-';										
IF (Len <= LineLenTemp) THEN BEGIN										
"CommentTxt[3] := COPYSTR(tmpComTxt,1,Len);"										
END										
ELSE BEGIN										
"CommentTxt[3] := COPYSTR(tmpComTxt,1,LineLenTemp);"										
"tmpComTxt := COPYSTR(tmpComTxt,(LineLenTemp + 1),(Len - LineLenTemp));"										
Len := STRLEN(tmpComTxt);										
IF (Len <> 0) THEN BEGIN										
CommentTxt[3] := CommentTxt[3] + '-';										
IF (Len > LineLenTemp) THEN BEGIN										
"CommentTxt[4] := COPYSTR(tmpComTxt,1,LineLenTemp);"										
END										
ELSE BEGIN										
"CommentTxt[4] := COPYSTR(tmpComTxt,1,Len);"										
END;										
END;										
END;										
END;										
END;										
END;										
END;										
END;										
org.code}										
END;										
										
PROCEDURE PrintNegAdjSlip@1200070007(VAR Transaction@1000 : Record 99001472) : Boolean;										
VAR										
POSTerminal@1001 : Record 99001471;										
TransInventoryEntry@1200070000 : Record 99001490;										
ItemVariant@1200070001 : Record 5401;										
Item@1200070004 : Record 27;										
DSTR1@1200070002 : Text[50];										
Descr@1200070003 : Text[30];										
BEGIN										
//PrintNegAdjSlip										
"IF Transaction.""Transaction No."" = 0 THEN"										
EXIT(TRUE);										
										
WindowInitialize();										
"IF GenPosFunc.""Neg. Adj. Slip Report ID"" <> 0 THEN BEGIN"										
"Transaction.SETRANGE(""Store No."",Transaction.""Store No."");"										
"Transaction.SETRANGE(""POS Terminal No."",Transaction.""POS Terminal No."");"										
"Transaction.SETRANGE(""Transaction No."",Transaction.""Transaction No."");"										
"REPORT.RUN(GenPosFunc.""Neg. Adj. Slip Report ID"", FALSE, TRUE, Transaction);"										
END ELSE BEGIN										
										
"POSTerminal.GET(Transaction.""POS Terminal No."");"										
"IF NOT POSTerminal.""Print Receipt for Neg. Adj."" THEN"										
EXIT(TRUE);										
										
"IF NOT OpenReceiptPrinter(2, 'NEG_ADJ', '', Transaction.""Transaction No."", Transaction.""Receipt No."") THEN"										
EXIT(FALSE);										
										
PrintLogo(2); //LS7.1-06										
"PrintHeader(Transaction,FALSE,2);"										
										
DSTR1 := '#C##################';										
Value[1] := Text147;										
NodeName[1] := 'Description'; //LS7.1-02										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),TRUE,TRUE,TRUE,FALSE));"										
"AddPrintLine(200,1,NodeName,Value,DSTR1,TRUE,TRUE,TRUE,FALSE,2); //LS7.1-02"										
PrintSeperator(2);										
										
"PrintSubHeader(Transaction,2,Transaction.Date,Transaction.Time);"										
										
"TransInventoryEntry.SETRANGE(""Store No."",Transaction.""Store No."");"										
"TransInventoryEntry.SETRANGE(""POS Terminal No."",Transaction.""POS Terminal No."");"										
"TransInventoryEntry.SETRANGE(""Transaction No."",Transaction.""Transaction No."");"										
IF TransInventoryEntry.FIND('-') THEN BEGIN										
DSTR1 := '#L############# #L########### #L########';										
Value[1] := Text148;										
Value[2] := Text071;										
Value[3] := Text143;										
										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
PrintSeperator(2);										
REPEAT										
										
"IF TransInventoryEntry.""Variant Code"" <> '' THEN"										
"Value[1] := TransInventoryEntry.""Item No."" + '/' + TransInventoryEntry.""Variant Code"""										
ELSE										
"Value[1] := TransInventoryEntry.""Item No."";"										
										
"IF (TransInventoryEntry.""Variant Code"" <> '') AND"										
"ItemVariant.GET(TransInventoryEntry.""Item No."",TransInventoryEntry.""Variant Code"") AND"										
(ItemVariant.Description <> '') THEN										
Descr := ItemVariant.Description										
ELSE BEGIN										
"Item.GET(TransInventoryEntry.""Item No."");"										
Descr := Item.Description;										
END;										
NodeName[1] := 'x'; //LS7.1-02										
Value[2] := Descr;										
NodeName[2] := 'Item Description'; //LS7.1-02										
"IF TransInventoryEntry.""Unit of Measure"" = '' THEN"										
"TransInventoryEntry.""Unit of Measure"" :=  Text131;"										
										
"IF TransInventoryEntry.""UOM Quantity"" <> 0 THEN"										
"Value[3] := POSFunctions.FormatQty(TransInventoryEntry.""UOM Quantity"") + ' ' +"										
"LOWERCASE(TransInventoryEntry.""Unit of Measure"")"										
ELSE										
Value[3] := POSFunctions.FormatQty(TransInventoryEntry.Quantity) + ' ' +										
"LOWERCASE(TransInventoryEntry.""Unit of Measure"");"										
NodeName[3] := 'x'; //LS7.1-02										
//LS7.1-02 -										
"Value[4] := FORMAT(TransInventoryEntry.""Line No."");"										
NodeName[4] := 'Line No.';										
"Value[5] := TransInventoryEntry.""Item No."";"										
NodeName[5] := 'Item No.';										
"Value[6] := TransInventoryEntry.""Variant Code"";"										
NodeName[6] := 'Variant Code';										
"Value[7] := TransInventoryEntry.""Unit of Measure"";"										
NodeName[7] := 'UOM ID';										
"IF TransInventoryEntry.""UOM Quantity"" <> 0 THEN"										
"Value[8] := POSFunctions.FormatQty(TransInventoryEntry.""UOM Quantity"")"										
ELSE										
Value[8] := POSFunctions.FormatQty(TransInventoryEntry.Quantity);										
NodeName[8] := 'Quantity';										
//LS7.1-02 +										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
"AddPrintLine(300,8,NodeName,Value,DSTR1,FALSE,FALSE,FALSE,FALSE,2); //LS7.1-02"										
UNTIL TransInventoryEntry.NEXT = 0;										
PrintSeperator(2);										
END;										
										
"PrintFooter(Transaction,2);"										
										
IF NOT ClosePrinter(2) THEN										
EXIT(FALSE);										
										
END;										
										
										
Transaction.IncPrintedCounter(1);										
COMMIT;										
EXIT(TRUE);										
END;										
										
PROCEDURE PrintPOSPaymInfo@1200070009(Transaction@1000 : Record 99008980;Tray@1001 : Integer);										
VAR										
PosSalesEntry@1002 : Record 99008981;										
Tendertype@1003 : Record 99001462;										
Tendercard@1004 : Record 99001464;										
Currency@1005 : Record 4;										
TransInfoCode@1006 : Record 99001478;										
DSTR1@1007 : Text[100];										
DSTR2@1008 : Text[100];										
Payment@1009 : Text[30];										
tmpStr@1010 : Text[50];										
i@1011 : Integer;										
CouponEntry@1012 : Record 99001477;										
BEGIN										
//PrintPOSPaymInfo										
										
DSTR1 := '#L############## #R## #R#############   ';										
										
CLEAR(PosSalesEntry);										
"PosSalesEntry.SETRANGE(""Receipt No."",Transaction.""Receipt No."");"										
"PosSalesEntry.SETRANGE(""Entry Type"",PosSalesEntry.""Entry Type""::Payment);"										
"PosSalesEntry.SETRANGE(""Entry Status"",0);"										
										
DSTR1 := '#L############## #R## #R#############   ';										
										
IF PosSalesEntry.FIND('-') THEN BEGIN										
REPEAT										
CLEAR(Value);										
Payment := PosSalesEntry.Number;										
"IF Tendertype.GET(PosSalesEntry.""Store No."", PosSalesEntry.Number) THEN"										
Payment := Tendertype.Description										
ELSE										
CLEAR(Tendertype);										
										
Value[1] := Payment;										
NodeName[1] := 'Tender Description'; //LS7.1-02										
"IF (Tendertype.""Function"" = Tendertype.""Function""::Coupons) AND (PosSalesEntry.Quantity > 1) THEN"										
Value[2] := FORMAT(PosSalesEntry.Quantity);										
NodeName[2] := 'Quantity'; //LS7.1-02										
Value[3] := POSFunctions.FormatAmount(- PosSalesEntry.Amount);										
NodeName[3] := 'Amount In Tender'; //LS7.1-02										
//LS7.1-02 -										
Value[4] := PosSalesEntry.Number;										
NodeName[4] := 'Tender Type';										
"Value[5] := FORMAT(PosSalesEntry.""Line No."");"										
NodeName[5] := 'Line No.';										
//LS7.1-02 +										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
"AddPrintLine(700,5,NodeName,Value,DSTR1,FALSE,TRUE,FALSE,FALSE,2); //LS7.1-02"										
"IF (Tendertype.""Function"" = Tendertype.""Function""::Card) THEN BEGIN"										
DSTR2 := '  #L##################################  ';										
"IF Tendercard.GET(PosSalesEntry.""Store No."", PosSalesEntry.Number, PaymEntry.""Card No."") THEN BEGIN"										
IF Tendercard.Description <> '' THEN BEGIN										
Value[1] := Tendercard.Description;										
NodeName[1] := 'Card Name'; //LS7.1-02										
//LS7.1-02 -										
"Value[2] := FORMAT(PosSalesEntry.""Line No."");"										
NodeName[2] := 'Line No.';										
//LS7.1-02 +										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR2),FALSE,TRUE,FALSE,FALSE));"										
"AddPrintLine(700,2,NodeName,Value,DSTR2,FALSE,TRUE,FALSE,FALSE,Tray); //LS7.1-02"										
END;										
END;										
										
"IF PaymEntry.""Card or Account"" <> '' THEN BEGIN"										
"tmpStr := PaymEntry.""Card or Account"";"										
FOR i:=1 TO STRLEN(tmpStr)-6 DO										
tmpStr[i] := '*';										
Value[1] :=										
"COPYSTR(tmpStr,1,4) + ' ' +"										
"COPYSTR(tmpStr,5,4) + ' ' +"										
"COPYSTR(tmpStr,9,4) + ' ' +"										
"COPYSTR(tmpStr,13,4) + ' ' +"										
"COPYSTR(tmpStr,17,4);"										
NodeName[1] := 'Detail Text'; //LS7.1-02										
//LS7.1-02 -										
"Value[2] := FORMAT(PosSalesEntry.""Line No."");"										
NodeName[2] := 'Line No.';										
//LS7.1-02 +										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR2),FALSE,TRUE,FALSE,FALSE));"										
"AddPrintLine(700,2,NodeName,Value,DSTR2,FALSE,TRUE,FALSE,FALSE,Tray); //LS7.1-02"										
END;										
END										
"ELSE IF Tendertype.""Card/Account No."" THEN BEGIN"										
DSTR2 := '  #L##################################  ';										
"Value[1] := Tendertype.""Ask for Card/Account"" + ' ' + PaymEntry.""Card or Account"";"										
NodeName[1] := 'Detail Text'; //LS7.1-02										
//LS7.1-02 -										
"Value[2] := FORMAT(PosSalesEntry.""Line No."");"										
NodeName[2] := 'Line No.';										
//LS7.1-02 +										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR2),FALSE,TRUE,FALSE,FALSE));"										
END;										
										
"IF Tendertype.""Foreign Currency"" THEN BEGIN"										
"IF PosSalesEntry.""Amount In Currency"" = 0 THEN"										
"PosSalesEntry.""Amount In Currency"" := 1;"										
										
"Currency.GET(PosSalesEntry.""Currency Code"");"										
DSTR2 := '  #L###### #L####################       ';										
Value[1] := Currency.Code;										
NodeName[1] := 'Currency Code'; //LS7.1-02										
"Value[2] := POSFunctions.FormatCurrency(PosSalesEntry.""Amount In Currency"", PosSalesEntry.""Currency Code"") +"										
"' @ ' + POSFunctions.FormatAmount(PosSalesEntry.Amount / PosSalesEntry.""Amount In Currency"" );"										
NodeName[2] := 'x'; //LS7.1-02										
//LS7.1-02 -										
"Value[3] := FORMAT(PosSalesEntry.""Line No."");"										
NodeName[3] := 'Line No.';										
"Value[4] := POSFunctions.FormatCurrency(PosSalesEntry.""Amount In Currency"",PosSalesEntry.""Currency Code"");"										
NodeName[4] := 'Amount In Currency';										
"Value[5] := POSFunctions.FormatAmount(PosSalesEntry.Amount / PosSalesEntry.""Amount In Currency"" );"										
NodeName[5] := 'Exchange Rate';										
//LS7.1-02 +										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR2),FALSE,TRUE,FALSE,FALSE));"										
"AddPrintLine(700,5,NodeName,Value,DSTR2,FALSE,TRUE,FALSE,FALSE,Tray); //LS7.1-02"										
END;										
										
										
IF Transaction.Rounded <> 0 THEN BEGIN										
"PrintLine(Tray,'');"										
DSTR1 := '#L################# #R###############   ';										
Value[1] := Text093;										
NodeName[1] := 'x'; //LS7.1-02										
Value[2] := POSFunctions.FormatAmount(Transaction.Rounded);										
NodeName[2] := 'Rounding Amount'; //LS7.1-02										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
"AddPrintLine(200,5,NodeName,Value,DSTR2,FALSE,TRUE,FALSE,FALSE,Tray); //LS7.1-02"										
END;										
										
UNTIL PosSalesEntry.NEXT = 0;										
										
PrintSeperator(Tray);										
										
END;										
END;										
										
PROCEDURE PrintCashDeclaration@1100409001(Transaction@1200070000 : Record 99001472) : Boolean;										
VAR										
TendDeclEntry2@1200070003 : Record 99001465;										
PayEntry2@1100409003 : Record 99001474;										
TenderType2@1200070004 : Record 99001462;										
TenderType3@1100409004 : Record 99001462;										
TenderTypeTable@1100409002 : Record 99001466;										
Currency2@1200070005 : Record 4;										
TransSafeEntry@1100409001 : Record 99001630;										
DSTR1@1200070001 : Text[50];										
TotalAmount@1100409000 : Decimal;										
BEGIN										
//PrintCashDeclaration										
										
"IF (Transaction.""Transaction Type"" = Transaction.""Transaction Type""::""Tender Decl."") THEN BEGIN"										
TendDeclEntry2.RESET;										
"TendDeclEntry2.SETRANGE(""Store No."",Transaction.""Store No."");"										
"TendDeclEntry2.SETRANGE(""POS Terminal No."",Transaction.""POS Terminal No."");"										
"TendDeclEntry2.SETRANGE(""Transaction No."",Transaction.""Transaction No."");"										
IF TendDeclEntry2.FIND('-') THEN BEGIN										
REPEAT										
"PrintCashDeclLine(Transaction,TendDeclEntry2.""Tender Type"",TendDeclEntry2.""Currency Code"",1);"										
UNTIL TendDeclEntry2.NEXT = 0;										
END;										
END;										
										
"IF (Transaction.""Transaction Type"" = Transaction.""Transaction Type""::""Float Entry"") OR"										
"(Transaction.""Transaction Type"" = Transaction.""Transaction Type""::""Remove Tender"") THEN BEGIN"										
"TenderTypeTable.SETRANGE(""Default Function"",TenderTypeTable.""Default Function""::""Tender Remove/Float"");"										
IF TenderTypeTable.FINDFIRST THEN BEGIN										
PayEntry2.RESET;										
"PayEntry2.SETRANGE(""Store No."",Transaction.""Store No."");"										
"PayEntry2.SETRANGE(""POS Terminal No."",Transaction.""POS Terminal No."");"										
"PayEntry2.SETRANGE(""Transaction No."",Transaction.""Transaction No."");"										
IF PayEntry2.FIND('-') THEN BEGIN										
REPEAT										
"IF (PayEntry2.""Tender Type"" <> TenderTypeTable.Code) THEN"										
"PrintCashDeclLine(Transaction,PayEntry2.""Tender Type"",PayEntry2.""Currency Code"",1);"										
UNTIL PayEntry2.NEXT = 0;										
END;										
END;										
END;										
										
//LS7.1-02*********************************										
//* Safe Transaction										
//LS7.1-02*********************************										
TransSafeEntry.RESET;										
"TransSafeEntry.SETCURRENTKEY(""Transaction Type"",""Safe Type"");"										
"TransSafeEntry.SETRANGE(""Safe Type"",TransSafeEntry.""Safe Type""::Safe);"										
"TransSafeEntry.SETRANGE(""Store No."",Transaction.""Store No."");"										
"TransSafeEntry.SETRANGE(""POS Terminal No."",Transaction.""POS Terminal No."");"										
"TransSafeEntry.SETRANGE(""Transaction No."",Transaction.""Transaction No."");"										
IF TransSafeEntry.FIND('-') THEN BEGIN										
"PrintLine(2,'');"										
PrintSeperator(2);										
CLEAR(Value);										
DSTR1 := '#C##################';										
Value[1] := Text163;										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),TRUE,TRUE,TRUE,FALSE));"										
PrintSeperator(2);										
										
"IF NOT TenderType3.GET(TransSafeEntry.""Store No."",TransSafeEntry.""Tender Type"") THEN"										
CLEAR(TenderType3);										
										
CLEAR(Value);										
DSTR1 := '#L######### #L########### #R############';										
Value[1] := Text159;										
Value[2] := Text158;										
Value[3] := Text004;										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
PrintSeperator(2);										
										
REPEAT										
CLEAR(Value);										
DSTR1 := '#L######### #L########### #R############';										
"IF (TransSafeEntry.""Currency Code"" <> '') THEN BEGIN"										
"Currency2.GET(TransSafeEntry.""Currency Code"");"										
Value[1] := Currency2.Description;										
END										
ELSE BEGIN										
Value[1] := TenderType3.Description;										
END;										
"Value[2] := TransSafeEntry.""Bank Bag No."";"										
"Value[3] := POSFunctions.FormatPrice(ABS(TransSafeEntry.""Amount in Currency""));"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
UNTIL TransSafeEntry.NEXT = 0;										
										
IF TransSafeEntry.FIND('-') THEN BEGIN										
REPEAT										
"PrintCashDeclLine(Transaction,TransSafeEntry.""Tender Type"",TransSafeEntry.""Currency Code"",2);"										
UNTIL TransSafeEntry.NEXT = 0;										
END;										
										
END;										
										
//***********************************										
//* Bank Transaction										
//***********************************										
TransSafeEntry.RESET;										
"TransSafeEntry.SETCURRENTKEY(""Transaction Type"",""Safe Type"");"										
"TransSafeEntry.SETRANGE(""Safe Type"",TransSafeEntry.""Safe Type""::Bank);"										
"TransSafeEntry.SETRANGE(""Store No."",Transaction.""Store No."");"										
"TransSafeEntry.SETRANGE(""POS Terminal No."",Transaction.""POS Terminal No."");"										
"TransSafeEntry.SETRANGE(""Transaction No."",Transaction.""Transaction No."");"										
IF TransSafeEntry.FIND('-') THEN BEGIN										
"PrintLine(2,'');"										
PrintSeperator(2);										
CLEAR(Value);										
DSTR1 := '#C##################';										
Value[1] := Text164;										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),TRUE,TRUE,TRUE,FALSE));"										
PrintSeperator(2);										
										
										
CLEAR(Value);										
DSTR1 := '#L######### #L########### #R############';										
Value[1] := Text159;										
Value[2] := Text158;										
Value[3] := Text004;										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
PrintSeperator(2);										
										
REPEAT										
"IF NOT TenderType3.GET(TransSafeEntry.""Store No."",TransSafeEntry.""Tender Type"") THEN"										
CLEAR(TenderType3);										
										
CLEAR(Value);										
DSTR1 := '#L######### #L########### #R############';										
"IF (TransSafeEntry.""Currency Code"" <> '') THEN BEGIN"										
"Currency2.GET(TransSafeEntry.""Currency Code"");"										
Value[1] := Currency2.Description;										
END										
ELSE BEGIN										
Value[1] := TenderType3.Description;										
END;										
"Value[2] := TransSafeEntry.""Bank Bag No."";"										
"Value[3] := POSFunctions.FormatPrice(ABS(TransSafeEntry.""Amount in Currency""));"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
UNTIL TransSafeEntry.NEXT = 0;										
IF TransSafeEntry.FIND('-') THEN BEGIN										
REPEAT										
"PrintCashDeclLine(Transaction,TransSafeEntry.""Tender Type"",TransSafeEntry.""Currency Code"",3);"										
UNTIL TransSafeEntry.NEXT = 0;										
END;										
END;										
										
//***********************************										
//* Float Transaction										
//***********************************										
TransSafeEntry.RESET;										
"TransSafeEntry.SETCURRENTKEY(""Transaction Type"",""Safe Type"");"										
"TransSafeEntry.SETRANGE(""Safe Type"",TransSafeEntry.""Safe Type""::""Fixed Float"");"										
"TransSafeEntry.SETRANGE(""Store No."",Transaction.""Store No."");"										
"TransSafeEntry.SETRANGE(""POS Terminal No."",Transaction.""POS Terminal No."");"										
"TransSafeEntry.SETRANGE(""Transaction No."",Transaction.""Transaction No."");"										
IF TransSafeEntry.FIND('-') THEN BEGIN										
"PrintLine(2,'');"										
PrintSeperator(2);										
CLEAR(Value);										
DSTR1 := '#C##################';										
Value[1] := Text167;										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),TRUE,TRUE,TRUE,FALSE));"										
PrintSeperator(2);										
										
"IF NOT TenderType3.GET(TransSafeEntry.""Store No."",TransSafeEntry.""Tender Type"") THEN"										
CLEAR(TenderType3);										
										
CLEAR(Value);										
DSTR1 := '#L######### #L########### #R############';										
Value[1] := Text159;										
Value[2] := Text158;										
Value[3] := Text004;										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
PrintSeperator(2);										
										
REPEAT										
CLEAR(Value);										
DSTR1 := '#L######### #L########### #R############';										
"IF (TransSafeEntry.""Currency Code"" <> '') THEN BEGIN"										
"Currency2.GET(TransSafeEntry.""Currency Code"");"										
Value[1] := Currency2.Description;										
END										
ELSE BEGIN										
Value[1] := TenderType3.Description;										
END;										
"Value[2] := TransSafeEntry.""Bank Bag No."";"										
"Value[3] := POSFunctions.FormatPrice(ABS(TransSafeEntry.""Amount in Currency""));"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
UNTIL TransSafeEntry.NEXT = 0;										
										
IF TransSafeEntry.FIND('-') THEN BEGIN										
REPEAT										
"PrintCashDeclLine(Transaction,TransSafeEntry.""Tender Type"",TransSafeEntry.""Currency Code"",4);"										
UNTIL TransSafeEntry.NEXT = 0;										
END;										
END;										
END;										
										
PROCEDURE PrintCashDeclLine@1100409003(Transaction@1100409001 : Record 99001472;TenderType@1100409002 : Code[10];CurrCode@1100409003	:	Cod	e[	10]	;DeclType@10012000 : Integer);					
VAR										
TransCashDecl@1100409000 : Record 99001626;										
TenderType2@1100409004 : Record 99001462;										
Currency2@1100409005 : Record 4;										
DSTR1@1100409007 : Text[50];										
Len@1100409006 : Integer;										
TotalAmount@1100409008 : Decimal;										
BEGIN										
//PrintCashDeclLine										
										
TransCashDecl.RESET;										
"TransCashDecl.SETCURRENTKEY(""Decl. Type"");"										
CASE DeclType OF										
"1 : TransCashDecl.SETRANGE(""Decl. Type"",TransCashDecl.""Decl. Type""::""Counted Amount"");"										
"2 : TransCashDecl.SETRANGE(""Decl. Type"",TransCashDecl.""Decl. Type""::""Safe Amount"");"										
"3 : TransCashDecl.SETRANGE(""Decl. Type"",TransCashDecl.""Decl. Type""::""Bank Amount"");"										
"4 : TransCashDecl.SETRANGE(""Decl. Type"",TransCashDecl.""Decl. Type""::""Fixed Float"");"										
END;										
"TransCashDecl.SETRANGE(""Store No."",Transaction.""Store No."");"										
"TransCashDecl.SETRANGE(""POS Terminal No."",Transaction.""POS Terminal No."");"										
"TransCashDecl.SETRANGE(""Transaction No."",Transaction.""Transaction No."");"										
"TransCashDecl.SETRANGE(""Tender Type"",TenderType);"										
"TransCashDecl.SETRANGE(""Currency Code"",CurrCode);"										
IF TransCashDecl.FIND('-') THEN BEGIN										
PrintSeperator(2);										
CLEAR(Value);										
"TenderType2.GET(Transaction.""Store No."",TenderType);"										
Value[1] := TenderType2.Description;										
"IF TenderType2.""Foreign Currency"" THEN"										
IF Currency2.GET(CurrCode) THEN BEGIN										
Len := STRLEN(Value[1]) + 1;										
IF (Len < 40) THEN										
"Value[1] := Value[1] + ' ' + COPYSTR(Currency2.Description,1,(40 - Len));"										
END;										
										
Value[1] := Value[1] + ' ' + Text162;										
DSTR1 := '#T######################################';										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
"PrintLine(2,'');"										
										
TotalAmount := 0;										
CLEAR(Value);										
DSTR1 := '#L#### #R######## #R##### #R############';										
REPEAT										
Value[1] := FORMAT(TransCashDecl.Type);										
Value[2] := POSFunctions.FormatPrice(TransCashDecl.Amount);										
"Value[3] := POSFunctions.FormatQty(TransCashDecl.""Qty."");"										
Value[4] := POSFunctions.FormatAmount(TransCashDecl.Total);										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
TotalAmount := TotalAmount + TransCashDecl.Total;										
UNTIL TransCashDecl.NEXT = 0;										
										
"PrintLine(2,'');"										
CLEAR(Value);										
DSTR1 := '#L##################### #R##############';										
										
Value[1] := TenderType2.Description;										
IF (CurrCode <> '') THEN										
Value[1] := Value[1] + ' ' + CurrCode;										
Value[1] := Value[1] + ' ' + Text005;										
Value[2] := POSFunctions.FormatAmount(TotalAmount);										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
END;										
										
PROCEDURE PrePrintCashDeclaration@1100409006(PosTrans@1200070000 : Record 99008980) : Boolean;										
VAR										
PosCashDecl@1100409003 : Record 99001624;										
TenderType2@1200070004 : Record 99001462;										
TenderTypeTable@1100409002 : Record 99001466;										
Currency2@1200070005 : Record 4;										
PosCashDeclLine@1100409004 : Record 99001625;										
Trans@1100409001 : Record 99001472;										
DSTR1@1200070001 : Text[50];										
Len@1200070006 : Integer;										
TotalAmount@1100409000 : Decimal;										
FirstLineOk@1100409005 : Boolean;										
FoundOk@10012000 : Boolean;										
BEGIN										
//PrePrintCashDeclaration										
										
"IF NOT OpenReceiptPrinter(2, 'TENDER', 'PRE_DECL', 0, PosTrans.""Receipt No."") THEN"										
EXIT(FALSE);										
										
"Trans.Date := PosTrans.""Trans. Date"";"										
"Trans.Time := PosTrans.""Trans Time"";"										
PrintLogo(2); //LS7.1-06										
"PrintHeader(Trans,FALSE,2);"										
										
"Trans.""Transaction Type"" := PosTrans.""Transaction Type"";"										
"PrintTransType(Trans,2);"										
										
PosCashDecl.RESET;										
"PosCashDecl.SETRANGE(""Receipt No."",PosTrans.""Receipt No."");"										
IF PosCashDecl.FIND('-') THEN BEGIN										
REPEAT										
IF (PosCashDecl.Amount <> 0) THEN BEGIN										
CLEAR(Value);										
"TenderType2.GET(PosTrans.""Store No."",PosCashDecl.""Tender Type"");"										
Value[1] := TenderType2.Description;										
"IF (PosCashDecl.""Currency Code"" <> '') THEN"										
"IF Currency2.GET(PosCashDecl.""Currency Code"") THEN BEGIN"										
Len := STRLEN(Value[1]) + 1;										
IF (Len < 40) THEN										
"Value[1] := Value[1] + ' ' + COPYSTR(Currency2.Description,1,(40 - Len));"										
END;										
Value[2] := POSFunctions.FormatPrice(PosCashDecl.Amount);										
DSTR1 := '#L#################### #R###############';										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
UNTIL PosCashDecl.NEXT = 0;										
END;										
										
PosCashDeclLine.RESET;										
"PosCashDeclLine.SETRANGE(""Receipt No."",PosTrans.""Receipt No."");"										
"PosCashDeclLine.SETRANGE(""Decl. Type"",PosCashDeclLine.""Decl. Type""::""Counted Amount"");"										
										
IF PosCashDecl.FIND('-') THEN BEGIN										
REPEAT										
FoundOk := FALSE;										
"PosCashDeclLine.SETRANGE(""Tender Type"",PosCashDecl.""Tender Type"");"										
"PosCashDeclLine.SETRANGE(""Currency Code"",PosCashDecl.""Currency Code"");"										
IF PosCashDeclLine.FINDSET THEN BEGIN										
REPEAT										
IF (PosCashDeclLine.Total <> 0) THEN										
FoundOk := TRUE;										
UNTIL (PosCashDeclLine.NEXT = 0) OR FoundOk;										
END;										
										
IF FoundOk THEN BEGIN										
IF PosCashDeclLine.FINDSET THEN BEGIN										
PrintSeperator(2);										
"TenderType2.GET(PosTrans.""Store No."",PosCashDecl.""Tender Type"");"										
CLEAR(Value);										
Value[1] := TenderType2.Description;										
"IF (PosCashDecl.""Currency Code"" <> '') THEN"										
"Value[1] := Value[1] + ' ' + PosCashDecl.""Currency Code"";"										
Value[1] := Value[1] + ' ' + Text162;										
DSTR1 := '#L######################################';										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
"PrintLine(2,'');"										
CLEAR(Value);										
DSTR1 := '#L#### #R######## #R##### #R############';										
TotalAmount := 0;										
REPEAT										
IF (PosCashDeclLine.Total <> 0) THEN BEGIN										
Value[1] := FORMAT(PosCashDeclLine.Type);										
Value[2] := POSFunctions.FormatPrice(PosCashDeclLine.Amount);										
"Value[3] := POSFunctions.FormatQty(PosCashDeclLine.""Qty."");"										
Value[4] := POSFunctions.FormatAmount(PosCashDeclLine.Total);										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
TotalAmount := TotalAmount + PosCashDeclLine.Total;										
END;										
UNTIL PosCashDeclLine.NEXT = 0;										
"PrintLine(2,'');"										
CLEAR(Value);										
DSTR1 := '#L#################### #R###############';										
Value[1] := TenderType2.Description;										
"IF (PosCashDecl.""Currency Code"" <> '') THEN"										
"Value[1] := Value[1] + ' ' + PosCashDecl.""Currency Code"";"										
Value[1] := Value[1] + ' ' + Text005;										
Value[2] := POSFunctions.FormatAmount(TotalAmount);										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
END;										
UNTIL PosCashDecl.NEXT = 0;										
END;										
										
//********************************										
//* Safe transaction										
//********************************										
"PrePrintCashDeclDenomination(PosTrans,FALSE);"										
//********************************										
//* Bank transaction										
//********************************										
"PrePrintCashDeclDenomination(PosTrans,TRUE);"										
IF NOT ClosePrinter(2) THEN										
EXIT(FALSE);										
										
EXIT(TRUE);										
END;										
										
PROCEDURE PrePrintCashDeclDenomination@1100409054(PosTrans@1200070000 : Record 99008980;IsBank_p@1100409006 : Boolean) : Boolean;										
VAR										
PosCashDecl@1100409003 : Record 99001624;										
TenderType2@1100409007 : Record 99001462;										
Currency2@1100409002 : Record 4;										
PosCashDeclLine@1100409004 : Record 99001625;										
DSTR1@1200070001 : Text[50];										
Len@1200070006 : Integer;										
TotalAmount@1100409000 : Decimal;										
FirstLineOk@1100409005 : Boolean;										
BEGIN										
FirstLineOk := TRUE;										
PosCashDecl.RESET;										
"PosCashDecl.SETRANGE(""Receipt No."",PosTrans.""Receipt No."");"										
IF PosCashDecl.FIND('-') THEN BEGIN										
{  //LS7.1-15										
IF IsBank_p THEN										
"TotalAmount := PosCashDecl.""Bank Amount"""										
ELSE										
"TotalAmount := PosCashDecl.""Safe Amount"";"										
}  //LS7.1-15										
REPEAT										
//LS7.1-15-										
IF IsBank_p THEN										
"TotalAmount := PosCashDecl.""Bank Amount"""										
ELSE										
"TotalAmount := PosCashDecl.""Safe Amount"";"										
//LS7.1-15+										
IF (TotalAmount <> 0) THEN BEGIN										
IF FirstLineOk THEN BEGIN										
"PrintLine(2,'');"										
PrintSeperator(2);										
DSTR1 := '#C##################';										
IF IsBank_p THEN										
Value[1] := Text164										
ELSE										
Value[1] := Text163;										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),TRUE,TRUE,TRUE,FALSE));"										
PrintSeperator(2);										
"PrintLine(2,'');"										
FirstLineOk := FALSE;										
END;										
										
CLEAR(Value);										
"TenderType2.GET(PosTrans.""Store No."",PosCashDecl.""Tender Type"");"										
Value[1] := TenderType2.Description;										
"IF (PosCashDecl.""Currency Code"" <> '') THEN"										
"IF Currency2.GET(PosCashDecl.""Currency Code"") THEN BEGIN"										
Len := STRLEN(Value[1]) + 1;										
IF (Len < 40) THEN										
"Value[1] := Value[1] + ' ' + COPYSTR(Currency2.Description,1,(40 - Len));"										
END;										
Value[2] := POSFunctions.FormatPrice(TotalAmount);										
DSTR1 := '#L#################### #R###############';										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
UNTIL PosCashDecl.NEXT = 0;										
END;										
										
IF NOT FirstLineOk THEN BEGIN										
PosCashDeclLine.RESET;										
"PosCashDeclLine.SETRANGE(""Receipt No."",PosTrans.""Receipt No."");"										
IF  IsBank_p THEN										
"PosCashDeclLine.SETRANGE(""Decl. Type"",PosCashDeclLine.""Decl. Type""::""Bank Amount"")"										
ELSE										
"PosCashDeclLine.SETRANGE(""Decl. Type"",PosCashDeclLine.""Decl. Type""::""Safe Amount"");"										
IF PosCashDecl.FIND('-') THEN BEGIN										
REPEAT										
"PosCashDeclLine.SETRANGE(""Tender Type"",PosCashDecl.""Tender Type"");"										
"PosCashDeclLine.SETRANGE(""Currency Code"",PosCashDecl.""Currency Code"");"										
IF PosCashDeclLine.FIND('-') THEN BEGIN										
PrintSeperator(2);										
"TenderType2.GET(PosTrans.""Store No."",PosCashDecl.""Tender Type"");"										
CLEAR(Value);										
Value[1] := TenderType2.Description;										
"IF  (PosCashDecl.""Currency Code"" <> '') THEN"										
"Value[1] := Value[1] + ' ' + PosCashDecl.""Currency Code"";"										
Value[1] := Value[1] + ' ' + Text162;										
DSTR1 := '#L######################################';										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
"PrintLine(2,'');"										
										
CLEAR(Value);										
DSTR1 := '#L#### #R######## #R##### #R############';										
TotalAmount := 0;										
REPEAT										
IF (PosCashDeclLine.Total <> 0) THEN BEGIN										
Value[1] := FORMAT(PosCashDeclLine.Type);										
Value[2] := POSFunctions.FormatPrice(PosCashDeclLine.Amount);										
"Value[3] := POSFunctions.FormatQty(PosCashDeclLine.""Qty."");"										
Value[4] := POSFunctions.FormatAmount(PosCashDeclLine.Total);										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
TotalAmount := TotalAmount + PosCashDeclLine.Total;										
END;										
UNTIL PosCashDeclLine.NEXT = 0;										
										
"PrintLine(2,'');"										
CLEAR(Value);										
DSTR1 := '#L#################### #R###############';										
										
Value[1] := TenderType2.Description;										
"IF (PosCashDecl.""Currency Code"" <> '') THEN"										
"Value[1] := Value[1] + ' ' + PosCashDecl.""Currency Code"";"										
Value[1] := Value[1] + ' ' + Text005;										
Value[2] := POSFunctions.FormatAmount(TotalAmount);										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
UNTIL PosCashDecl.NEXT = 0;										
END;										
END;										
END;										
										
PROCEDURE PrintCIDReport@1100409002(PosTrans@10012005 : Record 99008980) : Boolean;										
VAR										
PaymTrans2@1001 : Record 99001474;										
PaymTrans3@1018 : Record 99001474;										
PaymTemp@1019 : TEMPORARY Record 99001474;										
Terminal@1002 : Record 99001471;										
Staff@1003 : Record 99001461;										
StoreRec@10012000 : Record 99001470;										
CurrencyRec@10012002 : Record 4;										
lTenderType@1100409006 : Record 99001462;										
PosStartStat@10012001 : Record 99001627;										
CashDeclTmp@10012003 : TEMPORARY Record 99001624;										
CashDeclTmp2@10012004 : TEMPORARY Record 99001624;										
TSUtil@1100409013 : Codeunit 99008909;										
CashMgm@1100409014 : Codeunit 99001488;										
DSTR1@1008 : Text[80];										
SCode@1100409010 : Code[20];										
ZReportID@1009 : Code[10];										
FloatTotal@1011 : Decimal;										
RemoveTotal@1012 : Decimal;										
SalesTotal@1013 : Decimal;										
RecCount@1020 : Integer;										
TransNotSendt@1100409001 : Integer;										
NoSuspended@1100409003 : Integer;										
NoSuspPrepayment@1100409004 : Integer;										
FromTransNo@1100409015 : Integer;										
SuspPrepayment@1100409005 : Decimal;										
tmpSTR@1100409009 : Text[80];										
tmpSTR2@1100409008 : Text[80];										
CounterOk@10012006 : Boolean;										
Transaction@10012007 : Record 99001472;										
BEGIN										
//PrintCIDReport										
										
										
IF NOT Staff.GET(Globals.StaffID) THEN										
EXIT(TRUE);										
										
IF NOT Terminal.GET(Globals.TerminalNo) THEN										
EXIT(TRUE);										
										
IF NOT StoreRec.GET(Globals.StoreNo) THEN										
EXIT(TRUE);										
										
CLEAR(CashDeclTmp);										
CashDeclTmp.DELETEALL;										
CLEAR(CashDeclTmp2);										
CashDeclTmp2.DELETEALL;										
CounterOk := FALSE;										
										
lTenderType.RESET;										
"lTenderType.SETCURRENTKEY(""Store No."");"										
"lTenderType.SETRANGE(""Store No."",Globals.StoreNo);"										
"lTenderType.SETFILTER(""Function"",'<>%1',lTenderType.""Function""::""Tender Remove/Float"");"										
"lTenderType.SETRANGE(""Print in CID Report"",TRUE);"										
IF NOT lTenderType.FIND('-') THEN										
EXIT(TRUE);										
										
"CashMgm.CalcPaymentEntry(PosTrans,CashDeclTmp2,1);"										
										
REPEAT										
"IF lTenderType.""Foreign Currency"" THEN BEGIN"										
CLEAR(CurrencyRec);										
IF CurrencyRec.FINDSET THEN BEGIN										
REPEAT										
"IF CashDeclTmp2.GET('',lTenderType.Code,CurrencyRec.Code) THEN BEGIN"										
"CashDeclTmp.""Tender Type"" := lTenderType.Code;"										
"CashDeclTmp.""Currency Code"" := CurrencyRec.Code;"										
"CashDeclTmp.Amount := CashDeclTmp2.""Trans. Amount"";"										
CashDeclTmp.Counter := CashDeclTmp2.Counter;										
IF CashDeclTmp.Counter <> 0 THEN										
CounterOk := TRUE;										
CashDeclTmp.INSERT;										
END;										
UNTIL CurrencyRec.NEXT = 0;										
END;										
END										
ELSE BEGIN										
"IF CashDeclTmp2.GET('',lTenderType.Code,'') THEN BEGIN"										
"CashDeclTmp.""Tender Type"" := lTenderType.Code;"										
										
"CashDeclTmp.""Currency Code"" := '';"										
										
"CashDeclTmp.Amount := CashDeclTmp2.""Trans. Amount"";"										
CashDeclTmp.Counter := CashDeclTmp2.Counter;										
IF CashDeclTmp.Counter <> 0 THEN										
CounterOk := TRUE;										
CashDeclTmp.INSERT;										
END;										
END;										
UNTIL lTenderType.NEXT = 0;										
										
"IF NOT OpenReceiptPrinter(2, 'TENDER', 'CID', Transaction.""Transaction No."", Transaction.""Receipt No."") THEN"										
EXIT(FALSE);										
										
"IF NOT Terminal.""Terminal Statement"" THEN"										
"Terminal.""Statement Method"" := Store.""Statement Method"";"										
										
DSTR1:='#L####### #L########';										
Value[1] := Text079 + ':';										
"Value[2] := Terminal.""No."";"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
PrintSeperator(2);										
										
"Transaction.Date := PosTrans.""Trans. Date"";"										
"Transaction.Time := PosTrans.""Trans Time"";"										
PrintLogo(2); //LS7.1-06										
"PrintHeader(Transaction,FALSE,2);"										
										
DSTR1 := '#L#### #T###### #T#### ';										
Value[1] := Text048 + ':';										
Value[2] := FORMAT(TODAY());										
"Value[3] := FORMAT(TIME(),5);"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
										
DSTR1 := '#L###### #L############';										
Value[1] := Text051 + ':';										
"IF Staff.""Name on Receipt""<>'' THEN"										
"Value[2] := Staff.""Name on Receipt"""										
ELSE										
Value[2] := Globals.StaffID;										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
PrintSeperator(2);										
										
DSTR1 := '#C###################';										
										
Value[1] := Text156;										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,TRUE,FALSE));"										
PrintSeperator(2);										
										
CLEAR(Value);										
IF CounterOk THEN BEGIN										
DSTR1 := '#L############ #R## #R##################';										
Value[1] := Text159;										
Value[2] := Text160;										
Value[3] := Text004;										
END										
ELSE BEGIN										
DSTR1 := '#L################# #R##################';										
Value[1] := Text159;										
Value[2] := Text004;										
END;										
										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
PrintSeperator(2);										
										
SCode := POSFunctions.GetStatementCode;										
										
CLEAR(CashDeclTmp);										
IF CashDeclTmp.FINDSET THEN BEGIN										
CLEAR(Value);										
IF CounterOk THEN										
DSTR1 := '#L############ #R## #R##################'										
ELSE										
DSTR1 := '#L################# #R##################';										
										
//CSPNT010216										
rTransSafeEntry.RESET;										
"rTransSafeEntry.SETRANGE(""Safe Type"", rTransSafeEntry.""Safe Type""::Safe);"										
"rTransSafeEntry.SETRANGE(""Tender Type"", '1');"										
IF rTransSafeEntry.FIND('-') THEN BEGIN										
"rTransSafeEntry.CALCSUMS(""Amount Tendered"");"										
"vCofreEfectivo := rTransSafeEntry.""Amount Tendered"";"										
END;										
//CSPNT120316										
rTransSafeEntry.RESET;										
"rTransSafeEntry.SETRANGE(""Safe Type"", rTransSafeEntry.""Safe Type""::Safe);"										
"rTransSafeEntry.SETRANGE(""Tender Type"", '2');"										
IF rTransSafeEntry.FIND('-') THEN BEGIN										
"rTransSafeEntry.CALCSUMS(""Amount Tendered"");"										
"vCofreCheque := rTransSafeEntry.""Amount Tendered"";"										
END;										
										
REPEAT										
"lTenderType.GET(StoreRec.""No."",CashDeclTmp.""Tender Type"");"										
"IF (CashDeclTmp.""Currency Code"" <> '') THEN BEGIN"										
"CurrencyRec.GET(CashDeclTmp.""Currency Code"");"										
Value[1] := CurrencyRec.Description;										
END										
ELSE BEGIN										
Value[1] := lTenderType.Description;										
END;										
										
IF CounterOk THEN BEGIN										
"Value[2] := POSFunctions.FormatQty(CashDeclTmp.""Trans. Amount"");"										
Value[3] := POSFunctions.FormatAmount(CashDeclTmp.Amount);										
END										
ELSE BEGIN										
//CSPNT010216      Value[2] := POSFunctions.FormatAmount(CashDeclTmp.Amount);										
IF lTenderType.Code = '1' THEN										
//CSPNT140316										
//CSPNT030616        Value[2] := POSFunctions.FormatAmount(CashDeclTmp.Amount-ABS(vCofreEfectivo))										
Value[2] := POSFunctions.FormatAmount(CashDeclTmp.Amount)										
//CSPNT120316										
ELSE IF lTenderType.Code = '2' THEN										
//CSPNT140316										
//CSPNT030616        Value[2] := POSFunctions.FormatAmount(CashDeclTmp.Amount-ABS(vCofreCheque))										
Value[2] := POSFunctions.FormatAmount(CashDeclTmp.Amount)										
ELSE										
Value[2] := POSFunctions.FormatAmount(CashDeclTmp.Amount);										
END;										
										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
UNTIL CashDeclTmp.NEXT = 0;										
										
//CSPNT300116										
//CSPNT010216										
//CSPNT140316										
IF TRUE THEN BEGIN										
DSTR1 := '#L################# #R##################';										
Value[1] := 'Cofre Efectivo';										
Value[2] := POSFunctions.FormatAmount(vCofreEfectivo);										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
//CSPNT140316										
IF TRUE THEN BEGIN										
DSTR1 := '#L################# #R##################';										
Value[1] := 'Cofre Cheque';										
Value[2] := POSFunctions.FormatAmount(vCofreCheque);										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
										
END;										
										
IF NOT ClosePrinter(2) THEN										
EXIT(FALSE);										
										
EXIT(TRUE);										
END;										
										
PROCEDURE PrintCoupon@10012000(Transaction@1200070000 : Record 99001472) : Boolean;										
VAR										
TransCouponEntry@1200070007 : Record 99001477;										
POSPrintSetupHeader@1200070006 : Record 99001550;										
CouponHeader@10012000 : Record 99001621;										
BEGIN										
//PrintCoupon										
										
CouponPrinting := TRUE;										
"TransCouponEntry.SETRANGE(""Store No."",Transaction.""Store No."");"										
"TransCouponEntry.SETRANGE(""POS Terminal No."",Transaction.""POS Terminal No."");"										
"TransCouponEntry.SETRANGE(""Transaction No."",Transaction.""Transaction No."");"										
IF TransCouponEntry.FIND('-') THEN REPEAT										
"IF (TransCouponEntry.""Issued Amount"" <> 0) AND"										
"(CouponHeader.GET(TransCouponEntry.""Coupon Code"")) AND"										
"(CouponHeader.""Extra Print Setup"" <> '') AND"										
"(POSPrintSetupHeader.GET(CouponHeader.""Extra Print Setup""))"										
THEN BEGIN										
"IF NOT PrintExtra(Transaction,POSPrintSetupHeader,TransCouponEntry.""Issued Amount"",0,0"										
",CouponHeader.Code,CouponHeader.Description,'',"										
"2,TransCouponEntry.""Line No."",'','','','','') THEN"										
EXIT(FALSE);										
END;										
UNTIL TransCouponEntry.NEXT = 0;										
CouponPrinting := FALSE;										
EXIT(TRUE);										
END;										
										
PROCEDURE PrintCouponBarcode@10012001(Tray@1010 : Integer;EntryType@1004 : Code[10];Amount@1008 : Decimal) : Code[20];										
VAR										
CouponHeader@1000 : Record 99001621;										
Mask@1007 : Record 99001459;										
MaskSegm@1005 : Record 99001480;										
BarcodeManagement@10012000 : Codeunit 99001450;										
MaskLen@1011 : Integer;										
Chk@1001 : Integer;										
Char@1002 : Text[10];										
TmpStr@1003 : Text[15];										
txtAmount@10012001 : Text[30];										
Found@1006 : Boolean;										
BEGIN										
//PrintCouponBarcode										
										
IF NOT CouponHeader.GET(EntryType) THEN										
EXIT;										
										
"IF CouponHeader.""Barcode Mask"" = '' THEN"										
EXIT;										
										
"IF NOT BarcodeManagement.FindBarcodeMask(CouponHeader.""Barcode Mask"",Mask) THEN"										
"ERROR(STRSUBSTNO(Text166,Mask.TABLECAPTION,CouponHeader.TABLECAPTION));"										
										
TmpStr := Mask.Prefix;										
Mask.CALCFIELDS(Length);										
MaskLen := STRLEN(Mask.Prefix) + Mask.Length;										
										
IF MaskLen < Mask.GetRefLength THEN										
"TmpStr := COPYSTR('0000000000000',1,Mask.GetRefLength - MaskLen) + TmpStr;"										
										
"MaskSegm.SETRANGE(""Mask Entry No."",Mask.""Entry No."");"										
IF MaskSegm.FIND('-') THEN REPEAT										
CASE MaskSegm.Type OF										
										
"MaskSegm.Type::""EAN License No."" : BEGIN"										
"IF (CouponHeader.""Coupon Issuer"" = '') OR (STRLEN(CouponHeader.""Coupon Issuer"") > MaskSegm.Length) THEN"										
ERROR(Text129);										
"TmpStr := TmpStr + COPYSTR('0000000000000',1,MaskSegm.Length - STRLEN(CouponHeader.""Coupon Issuer"")) +"										
"CouponHeader.""Coupon Issuer"";"										
END;										
										
"MaskSegm.Type::""Coupon reference"" : BEGIN"										
"IF (CouponHeader.""Coupon Reference No."" = '') OR (STRLEN(CouponHeader.""Coupon Reference No."") > MaskSegm.Length) THEN"										
ERROR(Text129);										
"TmpStr := TmpStr + COPYSTR('0000000000000',1,MaskSegm.Length - STRLEN(CouponHeader.""Coupon Reference No."")) +"										
"CouponHeader.""Coupon Reference No."";"										
END;										
										
MaskSegm.Type::Price : BEGIN										
"Amount := ROUND(Amount * POWER(10,MaskSegm.Decimals),1);"										
"txtAmount := FORMAT(Amount,0,1);"										
IF (STRLEN(txtAmount) > MaskSegm.Length) THEN										
ERROR(Text129);										
"TmpStr := TmpStr + COPYSTR('0000000000000',1,MaskSegm.Length - STRLEN(txtAmount)) + txtAmount;"										
END;										
										
"MaskSegm.Type::""Check Digit"" : BEGIN"										
"Chk := 1 + STRCHECKSUM(TmpStr,COPYSTR('1313131313131',13 - STRLEN(TmpStr),STRLEN(TmpStr)));"										
"TmpStr := TmpStr + SELECTSTR(Chk,'0,1,2,3,4,5,6,7,8,9');"										
END;										
END;										
UNTIL MaskSegm.NEXT = 0;										
										
"PrintBarcode(Tray,TmpStr,100,40,FORMAT(Mask.Symbology),2)"										
END;										
										
PROCEDURE BufferTendDeclEntry@10012004();										
VAR										
TransInfoCode@10012000 : Record 99001478;										
BEGIN										
//BufferTendDeclEntry										
										
TempTendDeclEntry.RESET;										
TempTendDeclEntry.DELETEALL;										
TempTransInfoCode.RESET;										
TempTransInfoCode.DELETEALL;										
										
"TempTendDeclEntry.SETCURRENTKEY(""Statement Code"",""Z-Report ID"",""Tender Type"",""Currency Code"",""Card No."");"										
IF TendDeclEntry.FIND('-') THEN BEGIN										
REPEAT										
"TempTendDeclEntry.SETRANGE(""Statement Code"",TendDeclEntry.""Statement Code"");"										
"TempTendDeclEntry.SETRANGE(""Z-Report ID"",TendDeclEntry.""Z-Report ID"");"										
"TempTendDeclEntry.SETRANGE(""Tender Type"",TendDeclEntry.""Tender Type"");"										
"TempTendDeclEntry.SETRANGE(""Currency Code"",TendDeclEntry.""Currency Code"");"										
"TempTendDeclEntry.SETRANGE(""Card No."",TendDeclEntry.""Card No."");"										
IF TempTendDeclEntry.FIND THEN BEGIN										
"TempTendDeclEntry.""Amount Tendered"" += TendDeclEntry.""Amount Tendered"";"										
TempTendDeclEntry.Quantity += TendDeclEntry.Quantity;										
"TempTendDeclEntry.""Amount in Currency"" += TendDeclEntry.""Amount in Currency"";"										
TempTendDeclEntry.MODIFY;										
END ELSE BEGIN										
TempTendDeclEntry := TendDeclEntry;										
TempTendDeclEntry.INSERT;										
END;										
										
"TransInfoCode.SETRANGE(""Store No."",TendDeclEntry.""Store No."");"										
"TransInfoCode.SETRANGE(""POS Terminal No."",TendDeclEntry.""Store No."");"										
"TransInfoCode.SETRANGE(""Transaction No."",TendDeclEntry.""Transaction No."");"										
"TransInfoCode.SETRANGE(""Transaction Type"",TransInfoCode.""Transaction Type""::""Payment Entry"");"										
"TransInfoCode.SETRANGE(""Line No."",TendDeclEntry.""Line No."");"										
IF TransInfoCode.FIND('-') THEN										
REPEAT										
TempTransInfoCode := TransInfoCode;										
"TempTransInfoCode.""Replication Counter"" := TempTendDeclEntry.""Line No."";"										
TempTransInfoCode.INSERT;										
UNTIL TransInfoCode.NEXT = 0;										
										
UNTIL TendDeclEntry.NEXT = 0;										
END;										
										
TempTendDeclEntry.RESET;										
"TempTendDeclEntry.SETCURRENTKEY(""Statement Code"",""Z-Report ID"",""Tender Type"",""Currency Code"",""Card No."");"										
END;										
										
PROCEDURE PrintFreeTextLines@1100409005(SalesEntry@1100409000 : Record 99001473;Tray@1100409005 : Integer;Indent@1100409006 : Boolea	n);									
VAR										
DSTR1@1100409001 : Text[100];										
TransInfoEntry@1100409002 : Record 99001478;										
FromLineNo@1100409003 : Integer;										
ToLineNo@1100409004 : Integer;										
BEGIN										
//PrintFreeTextLines										
										
"FromLineNo := SalesEntry.""Line No."" + 1;"										
"ToLineNo := SalesEntry.""Line No."" - (SalesEntry.""Line No."" MOD 10000) + 9999;"										
										
CLEAR(TransInfoEntry);										
"TransInfoEntry.SETRANGE(""Store No."",SalesEntry.""Store No."");"										
"TransInfoEntry.SETRANGE(""POS Terminal No."",SalesEntry.""POS Terminal No."");"										
"TransInfoEntry.SETRANGE(""Transaction No."",SalesEntry.""Transaction No."");"										
"TransInfoEntry.SETRANGE(""Transaction Type"",TransInfoEntry.""Transaction Type""::""Sales Entry"");"										
"TransInfoEntry.SETRANGE(""Line No."",FromLineNo,ToLineNo);"										
"TransInfoEntry.SETRANGE(Infocode,'TEXT');"										
"TransInfoEntry.SETRANGE(""Text Type"",TransInfoEntry.""Text Type""::""Deal Header"");"										
IF TransInfoEntry.FINDFIRST THEN										
"ToLineNo := TransInfoEntry.""Line No."" - 1;"										
"TransInfoEntry.SETRANGE(""Line No."",FromLineNo,ToLineNo);"										
"TransInfoEntry.SETRANGE(Infocode,'TEXT');"										
"TransInfoEntry.SETRANGE(""Text Type"",TransInfoEntry.""Text Type""::""Freetext Input"");"										
IF TransInfoEntry.FINDSET THEN BEGIN										
CLEAR(Value);										
DSTR1 := '#T######################################';										
IF Indent THEN										
DSTR1 := '   #T###################################';										
REPEAT										
IF (TransInfoEntry.Information <> '') THEN BEGIN										
"Value[1] := COPYSTR(TransInfoEntry.Information,1,50);"										
NodeName[1] := 'Extra Info Line'; //LS7.1-02										
//LS7.1-02 -										
"Value[1] := FORMAT(SalesEntry.""Line No."");"										
NodeName[2] := 'Line No.';										
//LS7.1-02 +										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
"AddPrintLine(350,2,NodeName,Value,DSTR1,FALSE,TRUE,FALSE,FALSE,Tray); //LS7.1-02"										
END;										
UNTIL TransInfoEntry.NEXT = 0;										
END;										
END;										
										
PROCEDURE PrintDealFreeTextLines@1100409016(DealEntry@1100409000 : Record 99001460;Tray@1100409005 : Integer;Indent@1100409006 : Boo	lea	n;L	in	eNo	@1100409007 : Integer);					
VAR										
DSTR1@1100409001 : Text[100];										
TransInfoEntry@1100409002 : Record 99001478;										
FromLineNo@1100409003 : Integer;										
ToLineNo@1100409004 : Integer;										
BEGIN										
//PrintDealFreeTextLines										
										
"FromLineNo := DealEntry.""Deal Header Line No."" + 1;"										
"ToLineNo := DealEntry.""Deal Header Line No."" - (DealEntry.""Deal Header Line No."" MOD 10000) + 9999;"										
										
CLEAR(TransInfoEntry);										
"TransInfoEntry.SETRANGE(""Store No."",DealEntry.""Store No."");"										
"TransInfoEntry.SETRANGE(""POS Terminal No."",DealEntry.""POS Terminal No."");"										
"TransInfoEntry.SETRANGE(""Transaction No."",DealEntry.""Transaction No."");"										
"TransInfoEntry.SETRANGE(""Transaction Type"",TransInfoEntry.""Transaction Type""::""Sales Entry"");"										
"TransInfoEntry.SETRANGE(""Line No."",FromLineNo,ToLineNo);"										
"TransInfoEntry.SETRANGE(Infocode,'TEXT');"										
"TransInfoEntry.SETRANGE(""Text Type"",TransInfoEntry.""Text Type""::""Freetext Input"");"										
										
IF TransInfoEntry.FINDSET THEN BEGIN										
CLEAR(Value);										
DSTR1 := '#T######################################';										
IF Indent THEN										
DSTR1 := '   #T###################################';										
REPEAT										
IF (TransInfoEntry.Information <> '') THEN BEGIN										
"Value[1] := COPYSTR(TransInfoEntry.Information,1,50);"										
NodeName[1] := 'Extra Info Line'; //LS7.1-02										
//LS7.1-02 -										
"Value[1] := FORMAT(DealEntry.""Line No."");"										
NodeName[2] := 'Line No.';										
//LS7.1-02 +										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
"AddPrintLine(350,2,NodeName,Value,DSTR1,FALSE,TRUE,FALSE,FALSE,Tray); //LS7.1-02"										
END;										
UNTIL TransInfoEntry.NEXT = 0;										
END;										
END;										
										
PROCEDURE PrintPOSFreeTextLines@1100409013(POSTransLineIn@1100409000 : Record 99008981;Tray@1100409004 : Integer;Indent@1100409006 :	Bo	ole	an	;De	alHdr@1100409007 : Boolean);					
VAR										
TextPOSTransLine@1100409001 : Record 99008981;										
DSTR1@1100409005 : Text[100];										
FromLineNo@1100409003 : Integer;										
ToLineNo@1100409002 : Integer;										
BEGIN										
//PrintPOSFreeTextLines										
"FromLineNo := POSTransLineIn.""Line No."" + 1;"										
"ToLineNo := POSTransLineIn.""Line No."" - (POSTransLineIn.""Line No."" MOD 10000) + 9999;"										
										
IF DealHdr THEN BEGIN										
TextPOSTransLine.RESET;										
"TextPOSTransLine.SETRANGE(""Receipt No."",POSTransLineIn.""Receipt No."");"										
"TextPOSTransLine.SETRANGE(""Line No."",FromLineNo,ToLineNo);"										
"TextPOSTransLine.SETRANGE(""Entry Type"",TextPOSTransLine.""Entry Type""::FreeText);"										
"TextPOSTransLine.SETRANGE(""Entry Status"",TextPOSTransLine.""Entry Status""::"" "");"										
"TextPOSTransLine.SETRANGE(""Deal Line"",FALSE);"										
END ELSE BEGIN // Stop at first deal line										
TextPOSTransLine.RESET;										
"TextPOSTransLine.SETRANGE(""Receipt No."",POSTransLineIn.""Receipt No."");"										
"TextPOSTransLine.SETRANGE(""Line No."",FromLineNo,ToLineNo);"										
"TextPOSTransLine.SETRANGE(""Entry Type"",TextPOSTransLine.""Entry Type""::FreeText);"										
"TextPOSTransLine.SETRANGE(""Entry Status"",TextPOSTransLine.""Entry Status""::"" "");"										
"TextPOSTransLine.SETRANGE(""Deal Line"",TRUE);"										
IF TextPOSTransLine.FINDFIRST THEN										
"ToLineNo := TextPOSTransLine.""Line No."" - 1;"										
"TextPOSTransLine.SETRANGE(""Line No."",FromLineNo,ToLineNo);"										
"TextPOSTransLine.SETRANGE(""Entry Type"",TextPOSTransLine.""Entry Type""::FreeText);"										
"TextPOSTransLine.SETRANGE(""Entry Status"",TextPOSTransLine.""Entry Status""::"" "");"										
"TextPOSTransLine.SETRANGE(""Deal Line"",FALSE);"										
END;										
										
IF TextPOSTransLine.FINDSET THEN BEGIN										
CLEAR(Value);										
DSTR1 := '#T######################################';										
IF Indent THEN										
DSTR1 := '   #T###################################';										
REPEAT										
IF (TextPOSTransLine.Description <> '') THEN BEGIN										
"Value[1] := COPYSTR(TextPOSTransLine.Description,1,40);"										
NodeName[1] := 'Extra Info Line'; //LS7.1-02										
//LS7.1-02 -										
"Value[1] := FORMAT(POSTransLineIn.""Line No."");"										
NodeName[2] := 'Line No.';										
//LS7.1-02 +										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
"AddPrintLine(350,2,NodeName,Value,DSTR1,FALSE,TRUE,FALSE,FALSE,Tray); //LS7.1-02"										
END;										
UNTIL TextPOSTransLine.NEXT = 0;										
END;										
END;										
										
PROCEDURE PrintSpoOrderConfirm@1100409014(VAR Transaction@1000 : Record 99001472) : Boolean;										
VAR										
TransOrderHeader@1100409000 : Record 10012703;										
BEGIN										
//PrintSpoOrderConfirm										
CurrentPrintID := 400; //LS7.1-02										
										
"IF Transaction.""Transaction No."" = 0 THEN"										
EXIT(TRUE);										
										
WindowInitialize();										
"IF Transaction.""Order No."" <> '' THEN BEGIN"										
TransOrderHeader.RESET;										
"TransOrderHeader.SETRANGE(""Store No."",Transaction.""Store No."");"										
"TransOrderHeader.SETRANGE(""POS Terminal No."",Transaction.""POS Terminal No."");"										
"TransOrderHeader.SETRANGE(""Transaction No."",Transaction.""Transaction No."");"										
IF TransOrderHeader.FINDFIRST THEN										
"IF (GenPosFunc.""Spo. Confirm. Report ID"" <> 0) THEN BEGIN"										
"REPORT.RUN(GenPosFunc.""Spo. Confirm. Report ID"", FALSE, TRUE, TransOrderHeader);"										
END ELSE BEGIN										
"IF TransOrderHeader.""Order Collect"" THEN BEGIN"										
"PrintSpoSlip(Transaction,TransOrderHeader,TRUE);"										
"PrintSpoSlip(Transaction,TransOrderHeader,FALSE);"										
END ELSE BEGIN										
"PrintSpoSlip(Transaction,TransOrderHeader,FALSE);"										
END;										
END;										
END;										
										
EXIT(TRUE);										
END;										
										
PROCEDURE PrintSpoOrderBarcode@1100409015(VAR Transaction@1000 : Record 99001472;Tray@1100409005 : Integer;Slip@1100409006 : Boolean	) :	Bo	ol	ean	;					
VAR										
lText001@1100409001 : TextConst 'ENU=Special Order:;ESP=Pedido Especial:';										
POSTerminal@1100409000 : Record 99001471;										
TransOrderHeader@1100409004 : Record 10012703;										
OrderBarcode@1100409003 : Code[20];										
SpecialOrderUtils@1100409002 : Codeunit 10012702;										
bcWidth@1100409007 : Integer;										
bcHeight@1100409008 : Integer;										
BEGIN										
//PrintSpoOrderBarcode										
										
"POSTerminal.GET(Transaction.""POS Terminal No."");"										
										
"IF Transaction.""Order No."" <> '' THEN BEGIN"										
TransOrderHeader.RESET;										
"TransOrderHeader.SETRANGE(""Store No."",Transaction.""Store No."");"										
"TransOrderHeader.SETRANGE(""POS Terminal No."",Transaction.""POS Terminal No."");"										
"TransOrderHeader.SETRANGE(""Transaction No."",Transaction.""Transaction No."");"										
IF TransOrderHeader.FINDFIRST THEN BEGIN										
IF Slip THEN BEGIN										
"PrintLine(Tray,'');"										
"PrintLine(Tray,FormatLine(lText001,FALSE,FALSE,FALSE,FALSE));"										
END;										
"OrderBarcode := SpecialOrderUtils.CreateSpecOrderBarcode(TransOrderHeader.""Order No."");"										
										
"IF POSTerminal.""Receipt Barcode Width"" > 0 THEN"										
"bcWidth := POSTerminal.""Receipt Barcode Width"""										
ELSE										
bcWidth := 8;										
										
"IF POSTerminal.""Receipt Barcode Height"" > 0 THEN"										
"bcHeight := POSTerminal.""Receipt Barcode Height"""										
ELSE										
bcHeight := 40;										
										
"PrintBarcode(Tray,OrderBarcode,bcWidth,bcHeight,FORMAT(POSTerminal.""Print Receipt BC Type""),2);"										
END;										
END;										
										
EXIT(TRUE);										
END;										
										
PROCEDURE PrintSpoSlip@1100409019(VAR Transaction@1000 : Record 99001472;VAR TransOrderHeader@1100409000 : Record 10012703;Signature	@11	4	9	2	: Boolean) : Boolean;					
VAR										
POSTerminal@1001 : Record 99001471;										
Customer@1100409003 : Record 18;										
Contact@1100409005 : Record 5050;										
DSTR1@1100409004 : Text[100];										
lText001@1100409001 : TextConst 'ENU=Deliver;ESP=Repartir';										
lText002@1100409006 : TextConst 'ENU=Cancelation;ESP=Cancelaci¢n';										
BEGIN										
//PrintSpoSlip										
"POSTerminal.GET(Transaction.""POS Terminal No."");"										
"IF (POSTerminal.""Second Hardware Profile"" <> '') AND (POSTerminal.""Print Second Receipt"") THEN BEGIN"										
bSecondPrintActive := TRUE;										
END;										
										
"IF NOT OpenReceiptPrinter(2, 'SPO', '', Transaction.""Transaction No."", Transaction.""Receipt No."") THEN"										
EXIT(FALSE);										
										
PrintLogo(2); //LS7.1-06										
"PrintHeader(Transaction,FALSE,2);"										
"PrintSpoHeader(Transaction,2,Transaction.Date,Transaction.Time);"										
										
"IF Transaction.""Customer No."" <> '' THEN BEGIN"										
DSTR1 := '#T############# #T######################';										
"Value[1] := Transaction.""Customer No."";"										
NodeName[1] := 'Customer No.'; //LS7.1-02										
Value[2] := '';										
"IF Customer.GET(Transaction.""Customer No."") THEN"										
"Value[2] := COPYSTR(Customer.Name,1,MAXSTRLEN(Value[2]));"										
NodeName[2] := 'Customer Name'; //LS7.1-02										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
"AddPrintLine(200,2,NodeName,Value,DSTR1,FALSE,FALSE,FALSE,FALSE,2); //LS7.1-02"										
PrintSeperator(2);										
END;										
"IF Transaction.""Sell-to Contact No."" <> '' THEN BEGIN"										
DSTR1 := '#T############# #T######################';										
"Value[1] := Transaction.""Sell-to Contact No."";"										
NodeName[1] := 'Contact No.'; //LS7.1-02										
Value[2] := '';										
"IF Contact.GET(Transaction.""Sell-to Contact No."") THEN"										
"Value[2] := COPYSTR(Contact.Name,1,MAXSTRLEN(Value[2]));"										
NodeName[2] := 'Contact Name'; //LS7.1-02										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
"AddPrintLine(200,2,NodeName,Value,DSTR1,FALSE,FALSE,FALSE,FALSE,2); //LS7.1-02"										
PrintSeperator(2);										
END;										
"IF TransOrderHeader.""Order Collect"" THEN BEGIN"										
Value[1] := lText001;										
NodeName[1] := 'Description'; //LS7.1-02										
"PrintLine(2,FormatLine(FormatStr(Value,'#C##################'),TRUE,TRUE,TRUE,FALSE));"										
"AddPrintLine(200,1,NodeName,Value,DSTR1,TRUE,TRUE,TRUE,FALSE,2); //LS7.1-02"										
PrintSeperator(2);										
END;										
										
IF TransOrderHeader.Cancelation THEN BEGIN										
Value[1] := lText002;										
NodeName[1] := 'Description'; //LS7.1-02										
"PrintLine(2,FormatLine(FormatStr(Value,'#C##################'),TRUE,TRUE,TRUE,FALSE));"										
"AddPrintLine(200,1,NodeName,Value,DSTR1,TRUE,TRUE,TRUE,FALSE,2); //LS7.1-02"										
PrintSeperator(2);										
END;										
										
"IF (TransOrderHeader.""Order Collect"") AND (NOT Transaction.""Sale Is Return Sale"") THEN"										
"PrintSpoLinesDeliver(Transaction,TransOrderHeader,2);"										
										
"IF (TransOrderHeader.Cancelation) AND (NOT Transaction.""Sale Is Return Sale"") THEN"										
"PrintSpoLinesCancel(Transaction,TransOrderHeader,2);"										
										
"PrintSpoLines(Transaction,TransOrderHeader,2);"										
										
"PrintFooter(Transaction,2);"										
IF Signature THEN										
PrintSignature('');										
"IF POSTerminal.""Receipt Barcode"" AND NOT Transaction.""Sale Is Return Sale"" THEN"										
"PrintSpoOrderBarcode(Transaction,2,FALSE);"										
IF NOT ClosePrinter(2) THEN										
EXIT(FALSE);										
										
bSecondPrintActive := FALSE;										
										
EXIT(TRUE);										
END;										
										
PROCEDURE PrintSpoHeader@1100409037(VAR Transaction@1000 : Record 99001472;Tray@1001 : Integer;PrDate@1002 : Date;PrTime@1003 : Time	);									
VAR										
Staff@1004 : Record 99001461;										
DSTR1@1005 : Text[100];										
StaffName@1006 : Text[30];										
blankStr@1007 : Text[30];										
lText001@1100409000 : TextConst 'ENU=Special Order;ESP=Pedido especial';										
BEGIN										
//PrintSpoHeader										
										
IF Tray = 2 THEN										
"blankStr := StringPad(' ',LineLen - 38)"										
ELSE IF Tray = 4 THEN										
"blankStr := StringPad(' ',InvLineLen - 38);"										
										
CLEAR(Value);										
DSTR1 := '#L############ #L##################';										
Value[1] := lText001 + ':';										
NodeName[1] := 'x'; //LS7.1-02										
"Value[2] := Transaction.""Order No."";"										
NodeName[2] := 'Order No.'; //LS7.1-02										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
"AddPrintLine(200,2,NodeName,Value,DSTR1,FALSE,TRUE,FALSE,FALSE,Tray); //LS7.1-02"										
DSTR1 := '#L#### #L############' + blankStr + '#L#### #N########';										
"StaffName := Transaction.""Staff ID"";"										
"IF Staff.GET(Transaction.""Staff ID"") THEN"										
"StaffName := Staff.""Name on Receipt"";"										
Value[1] := Text051 + ':';										
NodeName[1] := 'x'; //LS7.1-02										
Value[2] := StaffName;										
NodeName[2] := 'x'; //LS7.1-02										
Value[3] := '';										
Value[4] := '';										
//LS7.1-02 -										
NodeName[3] := 'x';										
NodeName[4] := 'x';										
"Value[5] := Transaction.""Staff ID"";"										
NodeName[5] := 'x';										
//LS7.1-02 +										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
"AddPrintLine(200,5,NodeName,Value,DSTR1,FALSE,TRUE,FALSE,FALSE,Tray); //LS7.1-02"										
CLEAR(Value);										
DSTR1 := '#L#### #T###### #T###' + blankStr + '#L### #N#########';										
Value[1] := Text048 + ':';										
NodeName[1] := 'x'; //LS7.1-02										
Value[2] := FORMAT(PrDate);										
NodeName[2] := 'Trans. Date'; //LS7.1-02										
"Value[3] := FORMAT(PrTime,5);"										
NodeName[3] := 'Trans. Time'; //LS7.1-02										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
"AddPrintLine(200,3,NodeName,Value,DSTR1,FALSE,TRUE,FALSE,FALSE,Tray); //LS7.1-02"										
PrintSeperator(Tray);										
END;										
										
PROCEDURE PrintSpoLines@1100409024(VAR Transaction@1000 : Record 99001472;VAR TransOrderHeader@1100409010 : Record 10012703;Tray@100	1:00	In	te	ger	);					
VAR										
Customer@1100409011 : Record 18;										
TransOrderEntry@1100409012 : Record 10012704;										
Item@1005 : Record 27;										
VATSetup@1006 : Record 99001560;										
MixMatchEntry@1008 : Record 99001496;										
PeriodicDiscount@1010 : Record 99001453;										
TransInfoEntry@1011 : Record 99001478;										
POSTerminal@1012 : Record 99001471;										
ItemPosTextHeader@1013 : Record 99001534;										
ItemPosTextLine@1014 : Record 99001535;										
IncExpEntry@1015 : Record 99001475;										
IncExpAcc@1016 : Record 99001476;										
CompInfo@1046 : Record 79;										
ItemVariant@1200070002 : Record 5401;										
ItemTranslate@1100409018 : Record 30;										
ItemUnitOfMeasure@1100409008 : Record 5404;										
SalesEntry2@1100409007 : Record 99001473;										
LinkedItems@1100409004 : Record 99001452;										
TransactionOrderEntry@1100409003 : Record 10012704;										
OptTypeValueEntry@1100409001 : Record 10012713;										
OptionValue@1100409039 : Record 10012709;										
VATPrinted@1100409021 : Boolean;										
discountSection@1100409020 : Boolean;										
OrderByDepartment@1100409019 : Boolean;										
PrintItem@1100409005 : Boolean;										
CountItemOk@1100409000 : Boolean;										
SubText1@1100409032 : Boolean;										
SubText2@1100409034 : Boolean;										
VATCode@1100409023 : ARRAY [5] OF Code[10];										
PerDiscOffArr@1100409025 : ARRAY [250] OF Code[20];										
LastDepartment@1100409024 : Code[10];										
CanceledAmt@1100409036 : Decimal;										
CanceledNonRefundAmt@1100409038 : Decimal;										
NonRefundTotal@1100409030 : Decimal;										
RemainingAmtTotal@1100409002 : Decimal;										
SalesLineAmount@1018 : Decimal;										
SalesLineDiscAmount@1100409045 : Decimal;										
SalesAmountVAT@1019 : ARRAY [5] OF Decimal;										
VATPerc@1020 : ARRAY [5] OF Decimal;										
VATAmount@1021 : ARRAY [5] OF Decimal;										
TmpVATPerc@1023 : Decimal;										
totalCustItemDisc@1100409027 : Decimal;										
PerDiscOffAmtArr@1100409026 : ARRAY [250] OF Decimal;										
totalNumberOfItems@1100409006 : Decimal;										
i@1024 : Integer;										
j@1025 : Integer;										
PrintItemNo@1026 : Integer;										
maxCounter@1100409029 : Integer;										
PerDiscOffArrCount@1100409028 : Integer;										
LineCount@1100409009 : Integer;										
discText@1028 : Text[30];										
ItemName@1100409022 : Text[30];										
DSTR1@1041 : Text[100];										
qtyTxt@1042 : Text[15];										
LineArr@1043 : ARRAY [10] OF Text[50];										
lText001@1100409013 : TextConst 'ENU=*** Item Ordered ***;ESP=*** Producto Pedido ***';										
"lText002@1100409014 : TextConst 'ENU=""   *** Payments ***"";ESP=""   *** Pagos ***""';"										
lText003@1100409015 : TextConst 'ENU=Total;ESP=Total';										
lText004@1100409016 : TextConst 'ENU=Total Deposit;ESP=Dep¢sito Total';										
lText005@1100409017 : TextConst 'ENU=Remaining Amount;ESP=Importe pendiente';										
lText006@1100409031 : TextConst 'ENU=Non Refundable Amount;ESP=Importe no Reembolsable';										
lText007@1100409033 : TextConst 'ENU=(*) Restricted cancelation;ESP=(*) Cancelaci¢n Restringida';										
lText008@1100409035 : TextConst 'ENU=(**) Cancelation not allowed;ESP=(**) Cancelaci¢n no permitida';										
lText009@1100409037 : TextConst 'ENU=Refundable Amount;ESP=Importe Reembolsable';										
lText010@1100409040 : TextConst 'ENU=Config. ID:;ESP=Config. ID:';										
lText011@1100409041 : TextConst 'ENU=Lenght:;ESP=Longitud:';										
lText012@1100409042 : TextConst 'ENU=Width:;ESP=Anchura:';										
lText013@1100409043 : TextConst 'ENU=Height:;ESP=Altura:';										
lText014@1100409044 : TextConst 'ENU=Discount;ESP=Descuento';										
lText015@1100409046 : TextConst 'ENU=%1 %2;ESP=%1 %2';										
lText016@1100409047 : TextConst 'ENU=%1 %2 %3;ESP=%1 %2 %3';										
BEGIN										
//PrintSpoLines										
										
"IF GenPosFunc.""Multiple Items Symbol""='' THEN"										
"GenPosFunc.""Multiple Items Symbol"" := ' x ';"										
										
"IF Transaction.""Sale Is Return Sale"" THEN BEGIN"										
Value[1] := Text003;										
"PrintLine(Tray,FormatLine(FormatStr(Value,'#C##################'),TRUE,TRUE,TRUE,FALSE));"										
PrintSeperator(Tray);										
END;										
										
"IF Transaction.""Entry Status"" = Transaction.""Entry Status""::Training THEN"										
PrintTrainingText(Tray);										
										
PerDiscOffArrCount := 0;										
totalCustItemDisc := 0;										
										
CLEAR(totalNumberOfItems);										
LineCount := 0;										
CLEAR(VATCode);										
CLEAR(VATPerc);										
CLEAR(VATAmount);										
CLEAR(SalesAmountVAT);										
CLEAR(Value);										
CLEAR(NonRefundTotal);										
CLEAR(SubText1);										
CLEAR(SubText2);										
tmpDeal.DELETEALL;										
"TransOrderEntry.SETRANGE(""Store No."",Transaction.""Store No."");"										
"TransOrderEntry.SETRANGE(""POS Terminal No."",Transaction.""POS Terminal No."");"										
"TransOrderEntry.SETRANGE(""Transaction No."",Transaction.""Transaction No."");"										
IF TransOrderEntry.FIND('-') THEN BEGIN										
Value[1] := lText001;										
"PrintLine(Tray,FormatLine(FormatStr(Value,'#C######################################'),FALSE,TRUE,FALSE,FALSE));"										
DSTR1 := '#L############### #R#################   ';										
Value[1] := Text071;										
Value[2] := Text004;										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
PrintSeperator(Tray);										
										
PrintItemNo := 0;										
"IF POSTerminal.GET(TransOrderEntry.""POS Terminal No."") THEN"										
"IF POSTerminal.""Receipt Setup Location"" = POSTerminal.""Receipt Setup Location""::Store THEN BEGIN"										
"CASE Store.""Item No. on Receipt"" OF"										
"Store.""Item No. on Receipt""::""Item Number"" :"										
PrintItemNo := 1;										
"Store.""Item No. on Receipt""::""Barcode/Item Number"" :"										
PrintItemNo := 2;										
END;										
END ELSE BEGIN										
"CASE POSTerminal.""Item No. on Receipt"" OF"										
"POSTerminal.""Item No. on Receipt"" :: ""Item Number"":"										
PrintItemNo := 1;										
"POSTerminal.""Item No. on Receipt"" :: ""Barcode/Item Number"":"										
PrintItemNo := 2;										
END;										
END;										
										
REPEAT										
"IF Item.GET(TransOrderEntry.""Item No."") THEN BEGIN"										
"IF (TransOrderEntry.""Variant Code"" <> '') AND"										
"(ItemVariant.GET(TransOrderEntry.""Item No."",TransOrderEntry.""Variant Code""))"										
THEN										
"ItemName := COPYSTR(ItemVariant.Description,1,20)"										
ELSE										
"ItemName := COPYSTR(Item.Description,1,20);"										
END ELSE										
"ItemName := TransOrderEntry.""Item No."";"										
										
"IF Customer.GET(Transaction.""Customer No."") THEN"										
"IF Customer.""Language Code"" <> '' THEN"										
"IF ItemTranslate.GET(TransOrderEntry.""Item No."",TransOrderEntry.""Variant Code"",Customer.""Language Code"") THEN"										
IF ItemTranslate.Description <> '' THEN										
ItemName := ItemTranslate.Description;										
										
"SalesLineAmount := TransOrderEntry.""Net Amount"" + TransOrderEntry.""VAT Amount"";"										
SalesLineDiscAmount := SalesLineAmount - (TransOrderEntry.Price * TransOrderEntry.Quantity);										
SalesLineAmount := SalesLineAmount - SalesLineDiscAmount;										
										
DSTR1 := '#L######### #L###################';										
IF PrintItemNo <> 0 THEN BEGIN										
IF PrintItemNo = 1 THEN BEGIN										
Value[1] := Text074;										
NodeName[1] := 'x'; //LS7.1-02										
"Value[2] := TransOrderEntry.""Item No."";"										
NodeName[2] := 'Item No.'; //LS7.1-02										
END										
ELSE BEGIN										
"IF TransOrderEntry.""Barcode No."" <> '' THEN BEGIN"										
Value[1] := Text075;										
NodeName[1] := 'x'; //LS7.1-02										
"Value[2] := TransOrderEntry.""Barcode No."";"										
NodeName[2] := 'Barcode'; //LS7.1-02										
END										
ELSE BEGIN										
Value[1] := Text074;										
NodeName[1] := 'x'; //LS7.1-02										
"Value[2] := TransOrderEntry.""Item No."";"										
NodeName[2] := 'Item No.'; //LS7.1-02										
END;										
END;										
//LS7.1-02 -										
"Value[3] := FORMAT(TransOrderEntry.""Line No."");"										
NodeName[3] := 'Line No.';										
//LS7.1-02 +										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
"AddPrintLine(300,3,NodeName,Value,DSTR1,FALSE,FALSE,FALSE,FALSE,Tray); //LS7.1-02"										
END;										
										
DSTR1 := '#L###################### #N########## #R';										
"IF TransOrderEntry.""Additional Charge Code"" = '' THEN BEGIN"										
"CASE TransOrderEntry.""Cancel Permitted"" OF"										
"TransOrderEntry.""Cancel Permitted""::""Before Sourcing"" : BEGIN"										
"ItemName := COPYSTR(ItemName,1,21) + '(*)';"										
SubText1 := TRUE;										
END;										
"TransOrderEntry.""Cancel Permitted""::Never : BEGIN"										
"ItemName := COPYSTR(ItemName,1,20) + '(**)';"										
SubText2 := TRUE;										
END;										
END;										
END;										
										
Value[1] := ItemName;										
IF ABS(TransOrderEntry.Quantity) <> 1 THEN										
Value[1] := Value[1] + ' ' + POSFunctions.FormatAmount(-TransOrderEntry.Quantity);										
"IF TransOrderEntry.""Unit of Measure"" <> '' THEN"										
"Value[1] := Value[1] + ' ' + TransOrderEntry.""Unit of Measure"";"										
NodeName[1] := 'x'; //LS7.1-02										
"IF TransOrderEntry.""Sourcing Status"" = TransOrderEntry.""Sourcing Status""::Canceled THEN BEGIN"										
"Value[2] := FORMAT(TransOrderEntry.""Sourcing Status"");"										
Value[3] := '';										
END										
ELSE BEGIN										
"NonRefundTotal := NonRefundTotal + TransOrderEntry.""Non Refund Amount"";"										
Value[2] := POSFunctions.FormatAmount(-SalesLineAmount);										
"Value[3] := TransOrderEntry.""VAT Code"";"										
END;										
//LS7.1-02 -										
NodeName[2] := 'x';										
NodeName[3] := 'x';										
"Value[4] := FORMAT(TransOrderEntry.""Line No."");"										
NodeName[4] := 'Line No.';										
Value[5] := ItemName;										
NodeName[5] := 'Item Description';										
"Value[6] := TransOrderEntry.""Unit of Measure"";"										
NodeName[6] := 'UOM ID';										
Value[7] := POSFunctions.FormatAmount(-TransOrderEntry.Quantity);										
NodeName[7] := 'Quantity';										
Value[8] := POSFunctions.FormatAmount(-SalesLineAmount);										
NodeName[8] := 'Amount';										
"Value[9] := FORMAT(TransOrderEntry.""Sourcing Status"");"										
NodeName[9] := 'Sourcing Status';										
//LS7.1-02 +										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
"AddPrintLine(300,9,NodeName,Value,DSTR1,FALSE,FALSE,FALSE,FALSE,Tray); //LS7.1-02"										
										
IF SalesLineDiscAmount <> 0 THEN BEGIN										
DSTR1 := '  #L################## #N############   ';										
Value[1] := lText014;										
NodeName[1] := 'x'; //LS7.1-02										
Value[2] := POSFunctions.FormatAmount(-SalesLineDiscAmount);										
NodeName[2] := 'Discount Amount'; //LS7.1-02										
//LS7.1-02 -										
"Value[3] := FORMAT(TransOrderEntry.""Line No."");"										
NodeName[3] := 'Line No.';										
//LS7.1-02 +										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
"AddPrintLine(300,3,NodeName,Value,DSTR1,FALSE,FALSE,FALSE,FALSE,Tray); //LS7.1-02"										
END;										
										
"OptTypeValueEntry.SETRANGE(OptTypeValueEntry.""Configuration ID"",TransOrderHeader.""Order No."""										
"+ '.' + FORMAT(TransOrderEntry.""Line No.""));"										
IF OptTypeValueEntry.FIND('-') THEN BEGIN										
REPEAT										
CLEAR(Value);										
"IF NOT OptTypeValueEntry.""Fixed Input"" THEN BEGIN"										
DSTR1 := ' #L#####################################';										
Value[1] := OptTypeValueEntry.Description;										
NodeName[1] := 'Extra Info Line'; //LS7.1-02										
//LS7.1-02 -										
"Value[2] := FORMAT(TransOrderEntry.""Line No."");"										
NodeName[2] := 'Line No.';										
//LS7.1-02 +										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
"AddPrintLine(350,2,NodeName,Value,DSTR1,FALSE,FALSE,FALSE,FALSE,Tray); //LS7.1-02"										
END										
ELSE BEGIN										
IF OptTypeValueEntry.Description <> '' THEN BEGIN										
CLEAR(Value);										
DSTR1 := ' #L##################################';										
Value[1] := OptTypeValueEntry.Description;										
NodeName[1] := 'Extra Info Line'; //LS7.1-02										
//LS7.1-02 -										
"Value[2] := FORMAT(TransOrderEntry.""Line No."");"										
NodeName[2] := 'Line No.';										
//LS7.1-02 +										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
"AddPrintLine(350,2,NodeName,Value,DSTR1,FALSE,FALSE,FALSE,FALSE,Tray); //LS7.1-02"										
END;										
"IF OptTypeValueEntry.""Option Configuration Value"" <> '' THEN BEGIN"										
CLEAR(Value);										
DSTR1 := ' #L#########  #L#####################';										
Value[1] := lText010;										
NodeName[1] := 'x'; //LS7.1-02										
"Value[2] := OptTypeValueEntry.""Option Configuration Value"";"										
NodeName[2] := 'x'; //LS7.1-02										
//LS7.1-02 -										
"Value[3] := STRSUBSTNO(lText015,Value[1],Value[2]);"										
NodeName[3] := 'Extra Info Line';										
"Value[4] := FORMAT(TransOrderEntry.""Line No."");"										
NodeName[4] := 'Line No.';										
//LS7.1-02 +										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
"AddPrintLine(350,4,NodeName,Value,DSTR1,FALSE,FALSE,FALSE,FALSE,Tray); //LS7.1-02"										
END;										
IF OptTypeValueEntry.Length <> 0 THEN BEGIN										
DSTR1 := ' #L######### #R############ #L#######';										
"OptTypeValueEntry.CALCFIELDS(""Length UOM"");"										
CLEAR(Value);										
Value[1] := lText011;										
NodeName[1] := 'x'; //LS7.1-02										
Value[2] := POSFunctions.FormatAmount(OptTypeValueEntry.Length);										
NodeName[2] := 'x'; //LS7.1-02										
"Value[3] := OptTypeValueEntry.""Length UOM"";"										
NodeName[3] := 'x'; //LS7.1-02										
//LS7.1-02 -										
"Value[4] := STRSUBSTNO(lText015,Value[1],Value[2]);"										
NodeName[4] := 'Extra Info Line';										
"Value[5] := FORMAT(TransOrderEntry.""Line No."");"										
NodeName[5] := 'Line No.';										
//LS7.1-02 +										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
"AddPrintLine(350,5,NodeName,Value,DSTR1,FALSE,FALSE,FALSE,FALSE,Tray); //LS7.1-02"										
END;										
IF OptTypeValueEntry.Width <> 0 THEN BEGIN										
DSTR1 := ' #L######### #R############ #L#######';										
"OptTypeValueEntry.CALCFIELDS(""Width UOM"");"										
CLEAR(Value);										
Value[1] := lText012;										
NodeName[1] := 'x'; //LS7.1-02										
Value[2] := POSFunctions.FormatAmount(OptTypeValueEntry.Width);										
NodeName[2] := 'x'; //LS7.1-02										
"Value[3] := OptTypeValueEntry.""Width UOM"";"										
NodeName[3] := 'x'; //LS7.1-02										
//LS7.1-02 -										
"Value[4] := STRSUBSTNO(lText015,Value[1],Value[2]);"										
NodeName[4] := 'Extra Info Line';										
"Value[5] := FORMAT(TransOrderEntry.""Line No."");"										
NodeName[5] := 'Line No.';										
//LS7.1-02 +										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
"AddPrintLine(350,5,NodeName,Value,DSTR1,FALSE,FALSE,FALSE,FALSE,Tray); //LS7.1-02"										
END;										
IF OptTypeValueEntry.Height <> 0 THEN BEGIN										
DSTR1 := ' #L######### #R############ #L#######';										
"OptTypeValueEntry.CALCFIELDS(""Height UOM"");"										
CLEAR(Value);										
Value[1] := lText013;										
NodeName[1] := 'x'; //LS7.1-02										
Value[2] := POSFunctions.FormatAmount(OptTypeValueEntry.Height);										
NodeName[2] := 'x'; //LS7.1-02										
"Value[3] := OptTypeValueEntry.""Height UOM"";"										
NodeName[3] := 'x'; //LS7.1-02										
//LS7.1-02 -										
"Value[4] := STRSUBSTNO(lText015,Value[1],Value[2]);"										
NodeName[4] := 'Extra Info Line';										
"Value[5] := FORMAT(TransOrderEntry.""Line No."");"										
NodeName[5] := 'Line No.';										
//LS7.1-02 +										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
"AddPrintLine(350,5,NodeName,Value,DSTR1,FALSE,FALSE,FALSE,FALSE,Tray); //LS7.1-02"										
END;										
END;										
UNTIL OptTypeValueEntry.NEXT = 0;										
END;										
										
i := 0;										
j := 0;										
										
"IF VATSetup.GET(TransOrderEntry.""VAT Code"") THEN BEGIN"										
REPEAT										
i := i + 1;										
IF j = 0 THEN										
IF VATCode[i] = '' THEN										
j := i;										
"UNTIL (VATCode[i] = VATSetup.""VAT Code"") OR (i >= 5);"										
"IF VATCode[i] <> VATSetup.""VAT Code"" THEN BEGIN"										
i := j;										
"VATPerc[i] := VATSetup.""VAT %"";"										
"VATCode[i] := VATSetup.""VAT Code"";"										
END;										
"VATAmount[i] := VATAmount[i] + TransOrderEntry.""VAT Amount"";"										
"SalesAmountVAT[i] := SalesAmountVAT[i] + TransOrderEntry.""Net Amount"" + TransOrderEntry.""VAT Amount"";"										
END;										
LineCount := LineCount + 1;										
UNTIL TransOrderEntry.NEXT = 0;										
END;										
										
IF LineCount > 0 THEN BEGIN										
PrintSeperator(Tray);										
CLEAR(Value);										
DSTR1 := '#L###################### #N########## #R';										
Value[1] := lText003;										
NodeName[1] := 'Total Text'; //LS7.1-02										
"Value[2] := POSFunctions.FormatAmount(TransOrderHeader.""Order Amount for Printing"");"										
NodeName[2] := 'Total Amount'; //LS7.1-02										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
"AddPrintLine(800,2,NodeName,Value,DSTR1,FALSE,TRUE,FALSE,FALSE,Tray); //LS7.1-02"										
PrintSeperator(Tray);										
END;										
										
VATPrinted := FALSE;										
FOR i := 1 TO 5 DO BEGIN										
IF VATCode[i] <> '' THEN BEGIN										
IF i = 1 THEN BEGIN										
DSTR1 := '#R####% #R######## #R######## #R########';										
Value[1] := Text063;										
Value[2] := Text063_2;										
Value[3] := Text063;										
Value[4] := Text004;										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
DSTR1 := '#L #N## #N######## #N######## #N########';										
VATPrinted := TRUE;										
Value[1] := VATCode[i];										
NodeName[1] := 'VAT Code'; //LS7.1-02										
Value[2] := FORMAT(VATPerc[i]);										
NodeName[2] := 'VAT %'; //LS7.1-02										
Value[3] := POSFunctions.FormatAmount(-SalesAmountVAT[i] + VATAmount[i]);										
NodeName[3] := 'Net Amount'; //LS7.1-02										
Value[4] := POSFunctions.FormatAmount(-VATAmount[i]);										
NodeName[4] := 'VAT Amount'; //LS7.1-02										
Value[5] := POSFunctions.FormatAmount(-SalesAmountVAT[i]);										
NodeName[5] := 'Amount'; //LS7.1-02										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
"AddPrintLine(900,5,NodeName,Value,DSTR1,FALSE,FALSE,FALSE,FALSE,Tray); //LS7.1-02"										
END;										
END;										
										
IF VATPrinted THEN										
PrintSeperator(Tray);										
"IF TransOrderHeader.""Deposit Amount for Printing"" <> 0 THEN BEGIN"										
CLEAR(Value);										
Value[1] := lText002;										
"PrintLine(Tray,FormatLine(FormatStr(Value,'#C######################################'),FALSE,TRUE,FALSE,FALSE));"										
PrintSeperator(Tray);										
										
DSTR1 := '#L###################### #N########## #R';										
CLEAR(Value);										
Value[1] := lText004;										
NodeName[1] := 'x'; //LS7.1-02										
"Value[2] := POSFunctions.FormatAmount(TransOrderHeader.""Deposit Amount for Printing"");"										
NodeName[2] := 'Deposit'; //LS7.1-02										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
"AddPrintLine(200,2,NodeName,Value,DSTR1,FALSE,FALSE,FALSE,FALSE,Tray); //LS7.1-02"										
PrintSeperator(Tray);										
END;										
										
CLEAR(Value);										
DSTR1 := '#L###################### #N########## #R';										
Value[1] := lText005;										
NodeName[1] := 'x'; //LS7.1-02										
"Value[2] := POSFunctions.FormatAmount(TransOrderHeader.""Order Amount for Printing"" -"										
"TransOrderHeader.""Deposit Amount for Printing"");"										
NodeName[2] := 'Remaining Amount'; //LS7.1-02										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
"AddPrintLine(200,2,NodeName,Value,DSTR1,FALSE,TRUE,FALSE,FALSE,Tray); //LS7.1-02"										
PrintSeperator(Tray);										
										
IF NonRefundTotal <> 0 THEN BEGIN										
CLEAR(Value);										
DSTR1 := '  #L############################';										
Value[1] := lText006;										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
Value[1] := POSFunctions.FormatAmount(NonRefundTotal);										
NodeName[1] := 'Non Refundable'; //LS7.1-02										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
"AddPrintLine(200,1,NodeName,Value,DSTR1,FALSE,FALSE,FALSE,FALSE,Tray); //LS7.1-02"										
PrintSeperator(Tray);										
END;										
										
IF SubText1 THEN BEGIN										
CLEAR(Value);										
DSTR1 := '#L##############################';										
Value[1] := lText007;										
NodeName[1] := 'Detail Text'; //LS7.1-02										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
"AddPrintLine(950,1,NodeName,Value,DSTR1,FALSE,FALSE,FALSE,FALSE,Tray); //LS7.1-02"										
PrintSeperator(Tray);										
END;										
IF SubText2 THEN BEGIN										
CLEAR(Value);										
DSTR1 := '#L##############################';										
Value[1] := lText008;										
NodeName[1] := 'Detail Text'; //LS7.1-02										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
"AddPrintLine(950,1,NodeName,Value,DSTR1,FALSE,FALSE,FALSE,FALSE,Tray); //LS7.1-02"										
PrintSeperator(Tray);										
END;										
END;										
										
PROCEDURE PrintSpoLinesDeliver@1100409018(VAR Transaction@1000 : Record 99001472;VAR TransOrderHeader@1100409010 : Record 10012703;T	ray	@10	1	:	Integer);					
VAR										
Customer@1100409011 : Record 18;										
TransOrderEntry@1100409012 : Record 10012704;										
Item@1005 : Record 27;										
POSTerminal@1012 : Record 99001471;										
ItemPosTextHeader@1013 : Record 99001534;										
ItemPosTextLine@1014 : Record 99001535;										
CompInfo@1046 : Record 79;										
ItemVariant@1200070002 : Record 5401;										
ItemName@1017 : Text[30];										
PrintItemNo@1026 : Integer;										
DSTR1@1041 : Text[100];										
PrintItem@1100409000 : Boolean;										
ItemTranslate@1200070003 : Record 30;										
ItemUnitOfMeasure@1100409001 : Record 5404;										
LineCount@1100409009 : Integer;										
lText001@1100409013 : TextConst 'ENU=*** Deliver Now ***;ESP=*** Entregar Ahora ***';										
"lText002@1100409014 : TextConst 'ENU=""   *** Payments ***"";ESP=""   *** Pagos ***""';"										
lText003@1100409015 : TextConst 'ENU=Total;ESP=Total';										
lText004@1100409016 : TextConst 'ENU=Total Deposit;ESP=Dep¢sito Total';										
lText005@1100409017 : TextConst 'ENU=Remaining Amount;ESP=Importe pendiente';										
BEGIN										
//PrintSpoLinesDeliver										
										
"IF GenPosFunc.""Multiple Items Symbol""='' THEN"										
"GenPosFunc.""Multiple Items Symbol"" := ' x ';"										
										
"IF Transaction.""Entry Status"" = Transaction.""Entry Status""::Training THEN"										
PrintTrainingText(Tray);										
										
LineCount := 0;										
tmpDeal.DELETEALL;										
"TransOrderEntry.SETRANGE(""Store No."",Transaction.""Store No."");"										
"TransOrderEntry.SETRANGE(""POS Terminal No."",Transaction.""POS Terminal No."");"										
"TransOrderEntry.SETRANGE(""Transaction No."",Transaction.""Transaction No."");"										
"TransOrderEntry.SETRANGE(TransOrderEntry.""Deliver Now"",TRUE);"										
"TransOrderEntry.SETFILTER(""Sourcing Status"",'<>%1',TransOrderEntry.""Sourcing Status""::Canceled);"										
IF TransOrderEntry.FIND('-') THEN BEGIN										
Value[1] := lText001;										
"PrintLine(Tray,FormatLine(FormatStr(Value,'#C######################################'),FALSE,TRUE,FALSE,FALSE));"										
										
DSTR1 := '#L############### #R#################   ';										
Value[1] := Text071;										
Value[2] := Text143;										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
PrintSeperator(Tray);										
										
PrintItemNo := 0;										
"IF POSTerminal.GET(TransOrderEntry.""POS Terminal No."") THEN"										
"IF POSTerminal.""Receipt Setup Location"" = POSTerminal.""Receipt Setup Location""::Store THEN BEGIN"										
"CASE Store.""Item No. on Receipt"" OF"										
"Store.""Item No. on Receipt""::""Item Number"" :"										
PrintItemNo := 1;										
"Store.""Item No. on Receipt""::""Barcode/Item Number"" :"										
PrintItemNo := 2;										
END;										
END ELSE BEGIN										
"CASE POSTerminal.""Item No. on Receipt"" OF"										
"POSTerminal.""Item No. on Receipt"" :: ""Item Number"":"										
PrintItemNo := 1;										
"POSTerminal.""Item No. on Receipt"" :: ""Barcode/Item Number"":"										
PrintItemNo := 2;										
END;										
END;										
										
REPEAT										
										
"IF Item.GET(TransOrderEntry.""Item No."") THEN BEGIN"										
"IF (TransOrderEntry.""Variant Code"" <> '') AND"										
"(ItemVariant.GET(TransOrderEntry.""Item No."",TransOrderEntry.""Variant Code""))"										
THEN										
"ItemName := COPYSTR(ItemVariant.Description,1,20)"										
ELSE										
"ItemName := COPYSTR(Item.Description,1,20);"										
END ELSE										
"ItemName := TransOrderEntry.""Item No."";"										
										
"IF Customer.GET(Transaction.""Customer No."") THEN"										
"IF Customer.""Language Code"" <> '' THEN"										
"IF ItemTranslate.GET(TransOrderEntry.""Item No."",TransOrderEntry.""Variant Code"",Customer.""Language Code"") THEN"										
IF ItemTranslate.Description <> '' THEN										
ItemName := ItemTranslate.Description;										
										
DSTR1 := '#L######### #L###################';										
IF PrintItemNo <> 0 THEN BEGIN										
IF PrintItemNo = 1 THEN BEGIN										
Value[1] := Text074;										
NodeName[1] := 'x'; //LS7.1-02										
"Value[2] := TransOrderEntry.""Item No."";"										
NodeName[2] := 'Item No.'; //LS7.1-02										
END										
ELSE BEGIN										
"IF TransOrderEntry.""Barcode No."" <> '' THEN BEGIN"										
Value[1] := Text075;										
NodeName[1] := 'x'; //LS7.1-02										
"Value[2] := TransOrderEntry.""Barcode No."";"										
NodeName[2] := 'Barcode'; //LS7.1-02										
END										
ELSE BEGIN										
Value[1] := Text074;										
NodeName[1] := 'x'; //LS7.1-02										
"Value[2] := TransOrderEntry.""Item No."";"										
NodeName[2] := 'Item No.'; //LS7.1-02										
END;										
END;										
//LS7.1-02 -										
"Value[3] := FORMAT(TransOrderEntry.""Line No."");"										
NodeName[3] := 'Line No.'; //LS7.1-02										
//LS7.1-02 +										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
"AddPrintLine(400,3,NodeName,Value,DSTR1,FALSE,FALSE,FALSE,FALSE,Tray); //LS7.1-02"										
END;										
										
DSTR1 := '#L###################### #N########## #R';										
Value[1] := ItemName;										
"IF TransOrderEntry.""Unit of Measure"" <> '' THEN"										
"Value[1] := Value[1] + ' ' + TransOrderEntry.""Unit of Measure"";"										
NodeName[1] := 'x'; //LS7.1-02										
Value[2] := POSFunctions.FormatAmount(-TransOrderEntry.Quantity);										
NodeName[2] := 'Quantity'; //LS7.1-02										
Value[3] := ' ';										
NodeName[3] := 'x'; //LS7.1-02										
//LS7.1-02 -										
"Value[4] := FORMAT(TransOrderEntry.""Line No."");"										
NodeName[4] := 'Line No.';										
Value[5] := ItemName;										
NodeName[5] := 'Item Description';										
"Value[6] := TransOrderEntry.""Unit of Measure"";"										
NodeName[6] := 'UOM ID';										
//LS7.1-02 +										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
"AddPrintLine(400,6,NodeName,Value,DSTR1,FALSE,FALSE,FALSE,FALSE,Tray); //LS7.1-02"										
										
LineCount := LineCount + 1;										
UNTIL TransOrderEntry.NEXT = 0;										
END;										
										
PrintSeperator(Tray);										
END;										
										
PROCEDURE PrintSpoLinesCancel@1100409021(VAR Transaction@1000 : Record 99001472;VAR TransOrderHeader@1100409010 : Record 10012703;Tr	ay@	100	1	: I	nteger);					
VAR										
Customer@1100409011 : Record 18;										
TransOrderEntry@1100409012 : Record 10012704;										
Item@1005 : Record 27;										
POSTerminal@1012 : Record 99001471;										
ItemPosTextHeader@1013 : Record 99001534;										
ItemPosTextLine@1014 : Record 99001535;										
CompInfo@1046 : Record 79;										
ItemVariant@1200070002 : Record 5401;										
ItemTranslate@1100409008 : Record 30;										
ItemUnitOfMeasure@1100409018 : Record 5404;										
PrintItem@1100409023 : Boolean;										
PrintItemNo@1100409022 : Integer;										
LineCount@1100409001 : Integer;										
CanceledNonRefundAmt@1100409024 : Decimal;										
AmtToDistribute@1100409000 : Decimal;										
AmtUnpaidOnOtherLines@1100409025 : Decimal;										
CanceledAmt@1100409009 : Decimal;										
SalesLineAmount@1100409019 : Decimal;										
NonRefundTotal@1100409027 : Decimal;										
RemainingAmtTotal@1100409028 : Decimal;										
SalesLineAmountRem@1100409030 : Decimal;										
NonRefundAmtRem@1100409031 : Decimal;										
TotalDepositRem@1100409032 : Decimal;										
RefundedAmount@1100409033 : Decimal;										
RemainingAmountRem@1100409036 : Decimal;										
ItemName@1017 : Text[30];										
DSTR1@1041 : Text[100];										
"lText002@1100409014 : TextConst 'ENU=""   *** Payments ***"";ESP=""   *** Pagos ***""';"										
lText003@1100409015 : TextConst 'ENU=Total;ESP=Total';										
lText004@1100409016 : TextConst 'ENU=Deposit;ESP=Dep¢sito';										
lText005@1100409017 : TextConst 'ENU=Remaining Amount;ESP=Importe pendiente';										
lText006@1100409007 : TextConst 'ENU=Non Ref. Amount;ESP=Valor No Ref.';										
lText009@1100409004 : TextConst 'ENU=Refundable Amount;ESP=Importe Reembolsable';										
"lText010@1100409003 : TextConst 'ENU=""  Amount refunded"";ESP=""  Importe reembolsado""';"										
"lText011@1100409002 : TextConst 'ENU=""  Added to Order "";ESP=""  A§adido al Pedido ""';"										
AmtToDist@1100409021 : Text[50];										
AmountUnpaid@1100409020 : Text[50];										
lText012@1100409026 : TextConst 'ENU=Order Status;ESP=Estado Pedido';										
lText013@1100409029 : TextConst 'ENU=Item Ordered;ESP=Prod. Pedido';										
lText015@1100409035 : TextConst 'ENU=*** Item Canceled ***;ESP=*** Producto Cancelado ***';										
lText016@1100409037 : TextConst 'ENU=Order has been fully canceled;ESP=El Pedido ha sido cancelado completamente';										
BEGIN										
//PrintSpoLinesCancel										
AmtToDist := Globals.GetValue('AmtToDistribute');										
AmountUnpaid := Globals.GetValue('AmtUnpaidOnOtherLines');										
"IF NOT EVALUATE(AmtToDistribute,AmtToDist) THEN"										
AmtToDistribute := 0;										
"IF NOT EVALUATE(AmtUnpaidOnOtherLines,AmountUnpaid) THEN"										
AmtUnpaidOnOtherLines := 0;										
"Globals.SetValue('AmtToDistribute','0');"										
"Globals.SetValue('AmtUnpaidOnOtherLines','0');"										
										
LineCount := 0;										
CLEAR(SalesLineAmount);										
CLEAR(CanceledAmt);										
CLEAR(CanceledNonRefundAmt);										
CLEAR(RefundedAmount);										
CLEAR(Value);										
										
										
"IF GenPosFunc.""Multiple Items Symbol"" = '' THEN"										
"GenPosFunc.""Multiple Items Symbol"" := ' x ';"										
										
"IF Transaction.""Entry Status"" = Transaction.""Entry Status""::Training THEN"										
PrintTrainingText(Tray);										
										
tmpDeal.DELETEALL;										
"TransOrderEntry.SETRANGE(""Store No."",Transaction.""Store No."");"										
"TransOrderEntry.SETRANGE(""POS Terminal No."",Transaction.""POS Terminal No."");"										
"TransOrderEntry.SETRANGE(""Transaction No."",Transaction.""Transaction No."");"										
"TransOrderEntry.SETRANGE(""Cancel Now"",TRUE);"										
										
IF TransOrderEntry.FIND('-') THEN BEGIN										
DSTR1 := '#C######################################';										
Value[1] := lText015;										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
DSTR1 := '#L############### #R#################   ';										
Value[1] := Text071;										
Value[2] := Text004;										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
PrintSeperator(Tray);										
										
PrintItemNo := 0;										
"IF POSTerminal.GET(TransOrderEntry.""POS Terminal No."") THEN"										
"IF POSTerminal.""Receipt Setup Location"" = POSTerminal.""Receipt Setup Location""::Store THEN BEGIN"										
"CASE Store.""Item No. on Receipt"" OF"										
"Store.""Item No. on Receipt""::""Item Number"" :"										
PrintItemNo := 1;										
"Store.""Item No. on Receipt""::""Barcode/Item Number"" :"										
PrintItemNo := 2;										
END;										
END ELSE BEGIN										
"CASE POSTerminal.""Item No. on Receipt"" OF"										
"POSTerminal.""Item No. on Receipt"" :: ""Item Number"":"										
PrintItemNo := 1;										
"POSTerminal.""Item No. on Receipt"" :: ""Barcode/Item Number"":"										
PrintItemNo := 2;										
END;										
END;										
										
REPEAT										
"SalesLineAmount := TransOrderEntry.""Net Amount"" + TransOrderEntry.""VAT Amount"";"										
CanceledAmt := CanceledAmt - SalesLineAmount;										
"CanceledNonRefundAmt := CanceledNonRefundAmt + TransOrderEntry.""Non Refund Amount"";"										
										
"IF Item.GET(TransOrderEntry.""Item No."") THEN BEGIN"										
"IF (TransOrderEntry.""Variant Code"" <> '') AND"										
"(ItemVariant.GET(TransOrderEntry.""Item No."",TransOrderEntry.""Variant Code""))"										
THEN										
"ItemName := COPYSTR(ItemVariant.Description,1,20)"										
ELSE										
"ItemName := COPYSTR(Item.Description,1,20);"										
END ELSE										
"ItemName := TransOrderEntry.""Item No."";"										
										
"IF Customer.GET(Transaction.""Customer No."") THEN"										
"IF Customer.""Language Code"" <> '' THEN"										
"IF ItemTranslate.GET(TransOrderEntry.""Item No."",TransOrderEntry.""Variant Code"",Customer.""Language Code"") THEN"										
IF ItemTranslate.Description <> '' THEN										
ItemName := ItemTranslate.Description;										
										
DSTR1 := '#L######### #L###################';										
IF PrintItemNo <> 0 THEN BEGIN										
IF PrintItemNo = 1 THEN BEGIN										
Value[1] := Text074;										
NodeName[1] := 'x'; //LS7.1-02										
"Value[2] := TransOrderEntry.""Item No."";"										
NodeName[2] := 'Item No.'; //LS7.1-02										
END										
ELSE BEGIN										
"IF TransOrderEntry.""Barcode No."" <> '' THEN BEGIN"										
Value[1] := Text075;										
NodeName[1] := 'x'; //LS7.1-02										
"Value[2] := TransOrderEntry.""Barcode No."";"										
NodeName[2] := 'Barcode'; //LS7.1-02										
END										
ELSE BEGIN										
Value[1] := Text074;										
NodeName[1] := 'x'; //LS7.1-02										
"Value[2] := TransOrderEntry.""Item No."";"										
NodeName[2] := 'Item No.'; //LS7.1-02										
END;										
END;										
//LS7.1-02 -										
"Value[3] := FORMAT(TransOrderEntry.""Line No."");"										
NodeName[3] := 'Line No.'; //LS7.1-02										
//LS7.1-02 +										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
"AddPrintLine(410,3,NodeName,Value,DSTR1,FALSE,FALSE,FALSE,FALSE,Tray); //LS7.1-02"										
END;										
										
DSTR1 := '#L############### #R#################   ';										
Value[1] := ItemName;										
"IF TransOrderEntry.""Unit of Measure"" <> '' THEN"										
"Value[1] := Value[1] + ' ' + TransOrderEntry.""Unit of Measure"";"										
NodeName[1] := 'x'; //LS7.1-02										
Value[2] := POSFunctions.FormatAmount(-SalesLineAmount);										
NodeName[2] := 'Amount'; //LS7.1-02										
//LS7.1-02 -										
"Value[3] := FORMAT(TransOrderEntry.""Line No."");"										
NodeName[3] := 'Line No.';										
Value[4] := ItemName;										
NodeName[4] := 'Item Description';										
"Value[5] := TransOrderEntry.""Unit of Measure"";"										
NodeName[5] := 'UOM ID';										
//LS7.1-02 +										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
"AddPrintLine(410,5,NodeName,Value,DSTR1,FALSE,FALSE,FALSE,FALSE,Tray); //LS7.1-02"										
										
LineCount := LineCount + 1;										
UNTIL TransOrderEntry.NEXT = 0;										
END;										
										
IF LineCount > 0 THEN BEGIN										
PrintSeperator(Tray);										
CLEAR(Value);										
Value[1] := lText003;										
NodeName[1] := 'Total Text';										
Value[2] := POSFunctions.FormatAmount(CanceledAmt);										
NodeName[2] := 'Total Amount';										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
"AddPrintLine(420,2,NodeName,Value,DSTR1,FALSE,FALSE,FALSE,FALSE,Tray); //LS7.1-02"										
PrintSeperator(Tray);										
										
DSTR1 := '#C######################################';										
CLEAR(Value);										
Value[1] := lText002;										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
PrintSeperator(Tray);										
										
//LS7.1-02 -										
NodeName[1] := 'Total Text';										
NodeName[2] := 'Total Amount';										
//LS7.1-02 +										
DSTR1 := '#L############### #R#################   ';										
CLEAR(Value);										
Value[1] := lText004;										
Value[2] := POSFunctions.FormatAmount(AmtToDistribute + CanceledNonRefundAmt);										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
"AddPrintLine(420,2,NodeName,Value,DSTR1,FALSE,FALSE,FALSE,FALSE,Tray); //LS7.1-02"										
										
CLEAR(Value);										
Value[1] := lText006;										
Value[2] := POSFunctions.FormatAmount(CanceledNonRefundAmt);										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
"AddPrintLine(420,2,NodeName,Value,DSTR1,FALSE,FALSE,FALSE,FALSE,Tray); //LS7.1-02"										
										
CLEAR(Value);										
Value[1] := lText009;										
Value[2] := POSFunctions.FormatAmount(AmtToDistribute);										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
"AddPrintLine(420,2,NodeName,Value,DSTR1,FALSE,FALSE,FALSE,FALSE,Tray); //LS7.1-02"										
										
CLEAR(Value);										
IF AmtToDistribute > AmtUnpaidOnOtherLines THEN BEGIN										
RefundedAmount := AmtToDistribute - AmtUnpaidOnOtherLines;										
Value[1] := lText010;										
Value[2] := POSFunctions.FormatAmount(RefundedAmount);										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
"AddPrintLine(420,2,NodeName,Value,DSTR1,FALSE,FALSE,FALSE,FALSE,Tray); //LS7.1-02"										
CLEAR(Value);										
Value[1] := lText011;										
Value[2] := POSFunctions.FormatAmount(AmtUnpaidOnOtherLines);										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
"AddPrintLine(420,2,NodeName,Value,DSTR1,FALSE,FALSE,FALSE,FALSE,Tray); //LS7.1-02"										
END										
ELSE BEGIN										
RefundedAmount := 0;										
Value[1] := lText010;										
Value[2] := POSFunctions.FormatAmount(RefundedAmount);										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
"AddPrintLine(420,2,NodeName,Value,DSTR1,FALSE,FALSE,FALSE,FALSE,Tray); //LS7.1-02"										
CLEAR(Value);										
Value[1] := lText011;										
Value[2] := POSFunctions.FormatAmount(AmtToDistribute);										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
"AddPrintLine(420,2,NodeName,Value,DSTR1,FALSE,FALSE,FALSE,FALSE,Tray); //LS7.1-02"										
CLEAR(Value);										
END;										
END;										
										
LineCount := 0;										
CLEAR(Value);										
CLEAR(SalesLineAmountRem);										
CLEAR(NonRefundAmtRem);										
CLEAR(SalesLineAmount);										
CLEAR(RemainingAmountRem);										
										
PrintSeperator(Tray);										
DSTR1 := '#C##################';										
Value[1] := lText012;										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),TRUE,TRUE,TRUE,FALSE));"										
END;										
										
PROCEDURE InitializeReceiptBackPrinting@1100409020();										
VAR										
POSText@1100409006 : Record 99001492;										
DSTR1@1100409005 : Text[100];										
Terminal@1100409003 : Record 99001471;										
ReceiptHeader@1100409002 : Record 99001498;										
RetailUtil@1100409001 : Codeunit 99001462;										
ReceiptNo@1100409000 : Code[20];										
EscPos@1100409007 : Record 99008948;										
LineLength@1100409008 : Integer;										
BEGIN										
"ReceiptHeader.SETRANGE(""Receipt Setup Location"", Terminal.""Receipt Setup Location"");"										
										
IF ReceiptHeader.FINDLAST THEN BEGIN										
REPEAT										
"IF RetailUtil.DiscValPerValid(ReceiptHeader.""Validation Period ID"",TODAY, TIME) THEN BEGIN"										
"ReceiptNo := ReceiptHeader.""No."";"										
END;										
UNTIL (ReceiptHeader.NEXT(-1) = 0) OR (ReceiptNo <> '');										
END;										
										
CLEAR(POSText);										
IF (ReceiptNo <> '') THEN										
"POSText.SETRANGE(""No."",ReceiptNo)"										
ELSE										
"POSText.SETRANGE(""No."",'');"										
										
"IF Terminal.""Receipt Setup Location"" = Terminal.""Receipt Setup Location""::Terminal THEN BEGIN"										
"POSText.SETRANGE(Relation,POSText.Relation::Terminal);"										
"POSText.SETRANGE(Number,Globals.TerminalNo);"										
END										
ELSE BEGIN										
"POSText.SETRANGE(Relation,POSText.Relation::Store);"										
"POSText.SETRANGE(Number,Globals.StoreNo);"										
END;										
"POSText.SETRANGE(Type,POSText.Type::Back);"										
										
IF NOT POSText.FINDFIRST THEN										
"POSText.SETRANGE(""No."",'');"										
										
IF POSText.FIND('-') THEN BEGIN										
PrintBuffer.INIT;										
"//LS7.1-13 PrintBuffer.""Transaction No."" := PrintBufferTransNo;"										
"PrintBuffer.""Buffer Index"" := PrintBufferIndex;"										
"PrintBuffer.""Station No."" := 2;"										
"PrintBuffer.""Page No."" := PageNo;"										
"PrintBuffer.""Printed Line No."" := LinesPrinted;"										
PrintBuffer.LineType := PrintBuffer.LineType::StartTransaction;										
//PrintBuffer.HostID := ;										
PrintBuffer.ProfileID := Globals.HardwareProfileID;										
PrintBuffer.TransactionType := 711;										
PrintBuffer.INSERT;										
//SavePrinterBufferRecord(PrintBuffer);  //LS7.1-35										
PrintBufferIndex += 1;										
										
REPEAT										
CLEAR(EscPos);										
"IF EscPos.GET(POSText.""ESC/POS"") AND (EscPos.PrintLineChars > 0) THEN"										
LineLength := EscPos.PrintLineChars										
ELSE										
LineLength := 48;										
										
CASE POSText.Align OF										
POSText.Align::Left   :										
"DSTR1 := COPYSTR('#L################################################',1, LineLength);"										
POSText.Align::Center :										
"DSTR1 := COPYSTR('#C################################################',1, LineLength);"										
POSText.Align::Right  :										
"DSTR1 := COPYSTR('#R################################################',1, LineLength);"										
END;										
"Value[1] := POSText.""Receipt Text"";"										
										
"IF EscPos.""ESC/POS"" <> '' THEN BEGIN"										
"PrintLine(2, CreateEscapeChar(EscPos.""ESC/POS"")+FormatStr(Value,DSTR1));//POSText.""Receipt Text"");"										
END										
ELSE										
"PrintLine(2, FormatLine(FormatStr(Value,DSTR1),POSText.Wide,POSText.Bold,POSText.High,POSText.Italic));"										
										
UNTIL POSText.NEXT = 0;										
										
PrintBuffer.INIT;										
"//LS7.1-13 PrintBuffer.""Transaction No."" := PrintBufferTransNo;"										
"PrintBuffer.""Buffer Index"" := PrintBufferIndex;"										
"PrintBuffer.""Station No."" := 2;"										
"PrintBuffer.""Page No."" := PageNo;"										
"PrintBuffer.""Printed Line No."" := LinesPrinted;"										
PrintBuffer.LineType := PrintBuffer.LineType::EndTransaction;										
PrintBuffer.SetBackPrinting := TRUE;										
PrintBuffer.INSERT;										
//SavePrinterBufferRecord(PrintBuffer);  //LS7.1-35										
PrintBufferIndex += 1;										
END;										
END;										
										
PROCEDURE PrintAllIssuedCoupons@1100409023(TransactionHeader@1100409000 : Record 99001472) : Boolean;										
VAR										
TransCouponEntry@1100409001 : Record 99001477;										
BEGIN										
//PrintAllIssuedCoupons										
TransCouponEntry.RESET;										
"TransCouponEntry.SETRANGE(""Store No."",TransactionHeader.""Store No."");"										
"TransCouponEntry.SETRANGE(""POS Terminal No."",TransactionHeader.""POS Terminal No."");"										
"TransCouponEntry.SETRANGE(""Transaction No."",TransactionHeader.""Transaction No."");"										
"TransCouponEntry.SETRANGE(""Coupon Function"",TransCouponEntry.""Coupon Function""::Issue);"										
"TransCouponEntry.SETFILTER(""Coupon Code"",'<>%1','');"										
"TransCouponEntry.SETFILTER(Barcode,'<>%1','');"										
IF TransCouponEntry.FINDSET THEN REPEAT										
IF NOT PrintIssuedCoupon(TransCouponEntry) THEN										
EXIT(FALSE);										
UNTIL TransCouponEntry.NEXT = 0;										
EXIT(TRUE);										
END;										
										
PROCEDURE PrintIssuedCoupon@1100409022(TransCouponEntry@1200070000 : Record 99001477) : Boolean;										
VAR										
TransactionHeader@1200070005 : Record 99001472;										
CouponHeader@1100409000 : Record 99001621;										
POSTableSpecPrintSetup@1200070007 : Record 99001552;										
POSPrintSetupHeader@1200070006 : Record 99001550;										
HdrDescription@1100409001 : Text[30];										
BarcodeMask@1100409002 : Record 99001459;										
BEGIN										
//PrintIssuedCoupon										
"IF TransCouponEntry.""Coupon Code"" = '' THEN"										
EXIT(TRUE);										
IF TransCouponEntry.Barcode = '' THEN										
EXIT(TRUE);										
"CouponHeader.GET(TransCouponEntry.""Coupon Code"");"										
"IF CouponHeader.""Extra Print Setup"" = '' THEN"										
EXIT(TRUE);										
										
CpnPrinting := TRUE;										
CpnBarcodeMaskSymbology := '';										
"IF CouponHeader.""Barcode Mask"" <> '' THEN BEGIN"										
BarcodeMask.RESET;										
BarcodeMask.SETCURRENTKEY(Mask);										
"BarcodeMask.SETRANGE(Type,BarcodeMask.Type::Coupon);"										
"BarcodeMask.SETRANGE(Mask,CouponHeader.""Barcode Mask"");"										
IF BarcodeMask.FINDFIRST THEN										
CpnBarcodeMaskSymbology := FORMAT(BarcodeMask.Symbology);										
END;										
										
"TransactionHeader.GET(TransCouponEntry.""Store No."",TransCouponEntry.""POS Terminal No."",TransCouponEntry.""Transaction No."");"										
"IF POSPrintSetupHeader.GET(CouponHeader.""Extra Print Setup"") THEN BEGIN"										
"IF CouponHeader.""Discount Type"" = CouponHeader.""Discount Type""::""Discount Amount"" THEN"										
"HdrDescription := POSFunctions.FormatAmount(TransCouponEntry.""Issued Amount"") + ' ' + FORMAT(CouponHeader.""Discount Type"")"										
ELSE										
"HdrDescription := POSFunctions.FormatAmount(TransCouponEntry.""Discount %"") + ' ' + FORMAT(CouponHeader.""Discount Type"");"										
"IF NOT PrintExtra(TransactionHeader,POSPrintSetupHeader,TransCouponEntry.""Issued Amount"",0,TransCouponEntry.""Discount %"","										
"CouponHeader.Code,HdrDescription,TransCouponEntry.Barcode,"										
"2,0,'',FORMAT(TransCouponEntry.""Valid From Date""),FORMAT(TransCouponEntry.""Valid To Date""),"										
"CouponHeader.Description,CouponHeader.""Description 2"") THEN"										
EXIT(FALSE);										
END;										
EXIT(TRUE);										
END;										
										
PROCEDURE InitPrintBuffer@1100409026();										
BEGIN										
//LS7.1-13 PrintBufferIndex := 0;										
//LS7.1-13 PrintBuffer.DELETEALL;										
NoPrint_BufferOnly := TRUE; //LS7.1-13										
										
//LS7.1-02 -										
PrintBufferExt.RESET;										
PrintBufferExt.DELETEALL;										
//LS7.1-02 +										
END;										
										
PROCEDURE GetPrintBufferRecRef@1100409027(VAR pRecRef@1100409000 : RecordRef);										
BEGIN										
"//LS7.1-13 IF PosSetup.""OPOS Windows Printing"" THEN BEGIN"										
//LS7.1-13   CLEAR(PrintBuffer);										
//LS7.1-13   PrintBuffer.DELETEALL;										
//LS7.1-13 END;										
										
PrintBuffer.RESET; //LS7.1-13										
pRecRef.GETTABLE(PrintBuffer);										
										
NoPrint_BufferOnly := FALSE; //LS7.1-13										
END;										
										
PROCEDURE CollectDiscInfo@1100409029(TransSalesEntry@1100409000 : Record 99001473;Tray@1100409006 : Integer;VAR TotAmt@1100409007 :	Dec	ima	l;	VAR	Subtot@1100409010 : Decimal;VAR PeriodicDiscountInfoTEMP@1100409009 : TEMPORARY Record 99001453);					
VAR										
TransDiscountEntry@1100409001 : Record 99001642;										
CouponHeader@1100409003 : Record 99001621;										
PeriodicDiscount@1100409004 : Record 99001453;										
DiscountText@1100409002 : Text[1000];										
DSTR2@1100409005 : Text[1000];										
OfferCode@1100409008 : Code[20];										
BEGIN										
//CollectDiscInfo										
"Subtot := Subtot + TransSalesEntry.""Net Amount"" + TransSalesEntry.""VAT Amount"" - TransSalesEntry.""Discount Amount"";"										
{//LS7.1-12 -										
"IF GenPosFunc.""Print Disc/Cpn Info on Slip"" IN"										
"[GenPosFunc.""Print Disc/Cpn Info on Slip""::""Summary information below Sub-total"","										
"GenPosFunc.""Print Disc/Cpn Info on Slip""::""Detail information for each line""] THEN BEGIN"										
} //LS7.1-12 +										
//LS7.1-12 -										
"IF GenPosFunc.""Print Disc/Cpn Info on Slip"" IN"										
"[GenPosFunc.""Print Disc/Cpn Info on Slip""::""Summary information below Sub-total"","										
"GenPosFunc.""Print Disc/Cpn Info on Slip""::""Detail for each line and Sub-total"","										
"GenPosFunc.""Print Disc/Cpn Info on Slip""::""Detail information for each line""] THEN BEGIN"										
//LS7.1-12 +										
TransDiscountEntry.RESET;										
"TransDiscountEntry.SETRANGE(""Store No."",TransSalesEntry.""Store No."");"										
"TransDiscountEntry.SETRANGE(""POS Terminal No."",TransSalesEntry.""POS Terminal No."");"										
"TransDiscountEntry.SETRANGE(""Transaction No."",TransSalesEntry.""Transaction No."");"										
"TransDiscountEntry.SETRANGE(""Line No."",TransSalesEntry.""Line No."");"										
IF TransDiscountEntry.FINDSET THEN REPEAT										
//LS7.1-10 -										
"IF TransDiscountEntry.""Offer Type"" = TransDiscountEntry.""Offer Type""::Line THEN"										
DiscountText := Text084										
ELSE										
//LS7.1-10 +										
"DiscountText := FORMAT(TransDiscountEntry.""Offer Type"");"										
CLEAR(PeriodicDiscount);										
"IF TransDiscountEntry.""Offer Type"" = TransDiscountEntry.""Offer Type""::Coupon THEN BEGIN"										
"IF CouponHeader.GET(TransDiscountEntry.""Offer No."") THEN"										
DiscountText := CouponHeader.Description;										
END										
ELSE										
"IF PeriodicDiscount.GET(TransDiscountEntry.""Offer No."") THEN"										
DiscountText := PeriodicDiscount.Description										
ELSE										
{ //LS7.1-10 -										
"IF TransDiscountEntry.""Offer Type"" = TransDiscountEntry.""Offer Type""::Total THEN"										
DiscountText := Text024										
ELSE										
"DiscountText := FORMAT(TransDiscountEntry.""Offer Type"");"										
//LS7.1-10 + }										
//LS7.1-10-										
"CASE TransDiscountEntry.""Offer Type"" OF"										
"TransDiscountEntry.""Offer Type""::Total : DiscountText := Text024;"										
"TransDiscountEntry.""Offer Type""::Line : DiscountText := Text084;"										
ELSE										
"DiscountText := FORMAT(TransDiscountEntry.""Offer Type"");"										
END;										
//LS7.1-10 +										
"DiscountText := CONVERTSTR(DiscountText,'&','+');"										
//LS7.1-12 -										
"IF GenPosFunc.""Print Disc/Cpn Info on Slip"" ="										
"GenPosFunc.""Print Disc/Cpn Info on Slip""::""Detail for each line and Sub-total"" THEN"										
"IF TransDiscountEntry.""Offer Type"" <> TransDiscountEntry.""Offer Type""::Total THEN"										
"Subtot := Subtot + TransDiscountEntry.""Discount Amount"";"										
//LS7.1-12 +										
"IF GenPosFunc.""Print Disc/Cpn Info on Slip"" ="										
"GenPosFunc.""Print Disc/Cpn Info on Slip""::""Detail information for each line"" THEN BEGIN"										
"TotAmt := TotAmt + TransDiscountEntry.""Discount Amount"";"										
END										
ELSE BEGIN										
"IF TransDiscountEntry.""Discount Amount"" <> 0 THEN BEGIN"										
"IF NOT PeriodicDiscount.""Block Printing"" THEN BEGIN"										
"IF TransDiscountEntry.""Offer No."" <> '' THEN"										
"OfferCode := TransDiscountEntry.""Offer No."""										
ELSE										
"OfferCode := COPYSTR(FORMAT(TransDiscountEntry.""Offer Type""),1,MAXSTRLEN(OfferCode));"										
IF NOT PeriodicDiscountInfoTEMP.GET(OfferCode) THEN BEGIN										
PeriodicDiscountInfoTEMP := PeriodicDiscount;										
"PeriodicDiscountInfoTEMP.""No."" := OfferCode;"										
"PeriodicDiscountInfoTEMP.""Discount Amount Value"" := TransDiscountEntry.""Discount Amount"";"										
"PeriodicDiscountInfoTEMP.""Discount % Value"" := 0;"										
PeriodicDiscountInfoTEMP.Description := DiscountText;										
PeriodicDiscountInfoTEMP.INSERT;										
END										
ELSE BEGIN										
"PeriodicDiscountInfoTEMP.""Discount Amount Value"" := PeriodicDiscountInfoTEMP.""Discount Amount Value"" +"										
"TransDiscountEntry.""Discount Amount"";"										
PeriodicDiscountInfoTEMP.MODIFY;										
END;										
END										
ELSE										
"Subtotal := Subtotal + TransDiscountEntry.""Discount Amount"";"										
END;										
IF TransDiscountEntry.Points <> 0 THEN BEGIN										
"IF NOT PeriodicDiscountInfoTEMP.GET(TransDiscountEntry.""Offer No."") THEN BEGIN"										
PeriodicDiscountInfoTEMP := PeriodicDiscount;										
"PeriodicDiscountInfoTEMP.""No."" := TransDiscountEntry.""Offer No."";"										
"PeriodicDiscountInfoTEMP.""Discount Amount Value"" := 0;"										
"PeriodicDiscountInfoTEMP.""Discount % Value"" := TransDiscountEntry.Points;"										
PeriodicDiscountInfoTEMP.Description := DiscountText;										
PeriodicDiscountInfoTEMP.INSERT;										
END										
ELSE BEGIN										
"PeriodicDiscountInfoTEMP.""Discount % Value"" := PeriodicDiscountInfoTEMP.""Discount % Value"" +"										
TransDiscountEntry.Points;										
PeriodicDiscountInfoTEMP.MODIFY;										
END;										
END;										
END;										
UNTIL TransDiscountEntry.NEXT = 0;										
END;										
END;										
										
PROCEDURE ReturnDealDiscount@1100409028(TransSalesEntry@1100409000 : Record 99001473) DealDiscAmt : Decimal;										
VAR										
TransDiscountEntry@1100409002 : Record 99001642;										
BEGIN										
//ReturnDealDiscount										
DealDiscAmt := 0;										
"IF TransSalesEntry.""Deal Header Line No."" = 0 THEN"										
EXIT;										
TransSalesEntry.RESET;										
"TransSalesEntry.SETRANGE(""Store No."",TransSalesEntry.""Store No."");"										
"TransSalesEntry.SETRANGE(""POS Terminal No."",TransSalesEntry.""POS Terminal No."");"										
"TransSalesEntry.SETRANGE(""Transaction No."",TransSalesEntry.""Transaction No."");"										
"TransSalesEntry.SETRANGE(""Deal Header Line No."",TransSalesEntry.""Deal Header Line No."");"										
TransDiscountEntry.RESET;										
"TransDiscountEntry.SETRANGE(""Store No."",TransSalesEntry.""Store No."");"										
"TransDiscountEntry.SETRANGE(""POS Terminal No."",TransSalesEntry.""POS Terminal No."");"										
"TransDiscountEntry.SETRANGE(""Transaction No."",TransSalesEntry.""Transaction No."");"										
IF TransSalesEntry.FINDSET THEN REPEAT										
"TransDiscountEntry.SETRANGE(""Line No."",TransSalesEntry.""Line No."");"										
IF TransDiscountEntry.FINDSET THEN REPEAT										
"DealDiscAmt := DealDiscAmt + TransDiscountEntry.""Discount Amount"";"										
UNTIL TransDiscountEntry.NEXT = 0;										
UNTIL TransSalesEntry.NEXT = 0;										
END;										
										
PROCEDURE ReturnDiscountBlockPrinting@1100409030(TransSalesEntry@1100409000 : Record 99001473) DiscAmtOnBlockPrint : Decimal;										
VAR										
TransDiscountEntry@1100409001 : Record 99001642;										
PeriodicDiscount@1100409002 : Record 99001453;										
BEGIN										
//ReturnDiscountBlockPrinting										
DiscAmtOnBlockPrint := 0;										
TransDiscountEntry.RESET;										
"TransDiscountEntry.SETRANGE(""Store No."",TransSalesEntry.""Store No."");"										
"TransDiscountEntry.SETRANGE(""POS Terminal No."",TransSalesEntry.""POS Terminal No."");"										
"TransDiscountEntry.SETRANGE(""Transaction No."",TransSalesEntry.""Transaction No."");"										
"TransDiscountEntry.SETRANGE(""Line No."",TransSalesEntry.""Line No."");"										
"TransDiscountEntry.SETFILTER(""Offer No."",'<>%1','');"										
IF TransDiscountEntry.FINDSET THEN REPEAT										
"IF TransDiscountEntry.""Offer Type"" <> TransDiscountEntry.""Offer Type""::Coupon THEN"										
"IF PeriodicDiscount.GET(TransDiscountEntry.""Offer No."") THEN"										
"IF PeriodicDiscount.""Block Printing"" THEN"										
"DiscAmtOnBlockPrint := DiscAmtOnBlockPrint + TransDiscountEntry.""Discount Amount"";"										
UNTIL TransDiscountEntry.NEXT = 0;										
END;										
										
PROCEDURE PrintLineHospitality@1100409033(pTray@1100409001 : Integer;pSectionID@1100409012 : Integer;pMaxIndex@1100409004 : Integer;	pFi	eld	Na	me@	1100409011 : ARRAY [10] OF Text[50];pValue@1100409010 : ARRAY [10] OF Text[100];pDesign@1100409009 : Text[100];pWide@1100409008 : Boolean;pBold@1100409007 : Boolean;pHigh@1100409006 : Boolean;pItalic@1100409005 : Boolean;pTransSalesEntry@1100409002 : Record 99001473);					
VAR										
Infocode@1100409003 : Record 99001482;										
TxtLine@1100409000 : Text[100];										
BEGIN										
//PrintLIneHospitality										
//LS7.1-02										
										
"TxtLine := FormatLine(FormatStr(pValue,pDesign),pWide,pBold,pHigh,pItalic); //LS7.1-02"										
//LS7.1-02 -										
"Value[1] := FORMAT(pTransSalesEntry.""Line No."");"										
NodeName[1] := 'Line No.'; //LS7.1-02										
Value[2] := TxtLine;										
NodeName[2] := 'Extra Info Line'; //LS7.1-02										
//LS7.1-02 +										
"IF (pTransSalesEntry.""Orig. from Infocode"" <> '') AND"										
"(Infocode.GET(pTransSalesEntry.""Orig. from Infocode"")) THEN BEGIN"										
{//LS7.1-02										
"CASE Infocode.""Print Item Modifier on Receipt"" OF"										
"Infocode.""Print Item Modifier on Receipt""::""Print All"" : PrintLine(pTray,TxtLine);"										
"Infocode.""Print Item Modifier on Receipt""::""Skip Zero Price"" :"										
"IF pTransSalesEntry.""Net Amount"" + pTransSalesEntry.""VAT Amount"" <> 0 THEN"										
"PrintLine(pTray,TxtLine);"										
END;										
}//LS7.1-02										
//LS7.1-02 -										
"CASE Infocode.""Print Item Modifier on Receipt"" OF"										
"Infocode.""Print Item Modifier on Receipt""::""Print All"" :"										
BEGIN										
"PrintLine(pTray,TxtLine);"										
"AddPrintLine(350,2,NodeName,Value,pDesign,pWide,pBold,pHigh,pItalic,pTray); //LS7.1-02"										
END;										
"Infocode.""Print Item Modifier on Receipt""::""Skip Zero Price"" :"										
"IF pTransSalesEntry.""Net Amount"" + pTransSalesEntry.""VAT Amount"" <> 0 THEN BEGIN"										
"PrintLine(pTray,TxtLine);"										
"AddPrintLine(350,2,NodeName,Value,pDesign,pWide,pBold,pHigh,pItalic,pTray); //LS7.1-02"										
END;										
END;										
//LS7.1-02 +										
END										
//LS7.1-02 ELSE										
ELSE BEGIN //LS7.1-02										
"PrintLine(pTray,TxtLine);"										
"AddPrintLine(350,2,NodeName,Value,pDesign,pWide,pBold,pHigh,pItalic,pTray); //LS7.1-02"										
END; //LS7.1-02										
END;										
										
PROCEDURE InsertIntoRecipeBuffer@1100409038(TransSalesEntry@1100409000 : Record 99001473;VAR RecipeBufferTEMP@1100409004 : TEMPORARY	Re	cor	d	990	01473;ParentItemLine@1100409002 : Record 99001473;VAR RecipeBufferDetailTEMP_p@1100409005 : TEMPORARY Record 99001642);					
VAR										
EntryNoOfMasterLine@1100409003 : Integer;										
ItemInfocodeItemModifier@1100409001 : Record 99001482;										
TransDiscEntry_l@1100409006 : Record 99001642;										
BEGIN										
//InsertIntoRecipeBuffer										
"IF TransSalesEntry.""Parent Line No."" = 0 THEN BEGIN  //Recipe Item"										
RecipeBufferTEMP.RESET;										
"RecipeBufferTEMP.SETCURRENTKEY(""Item No."",""Variant Code"");"										
"RecipeBufferTEMP.SETRANGE(""Item No."",TransSalesEntry.""Item No."");"										
"RecipeBufferTEMP.SETFILTER(""Variant Code"",'%1',TransSalesEntry.""Variant Code"");"										
"RecipeBufferTEMP.SETFILTER(""Orig. from Infocode"",'%1',TransSalesEntry.""Orig. from Infocode"");"										
IF RecipeBufferTEMP.FINDFIRST THEN BEGIN										
RecipeBufferTEMP.Quantity := RecipeBufferTEMP.Quantity + TransSalesEntry.Quantity;										
"RecipeBufferTEMP.""Net Amount"" := RecipeBufferTEMP.""Net Amount"" + TransSalesEntry.""Net Amount"";"										
"RecipeBufferTEMP.""VAT Amount"" := RecipeBufferTEMP.""VAT Amount"" + TransSalesEntry.""VAT Amount"";"										
"RecipeBufferTEMP.""Discount Amount"" := RecipeBufferTEMP.""Discount Amount"" + TransSalesEntry.""Discount Amount""; //LS7.1-07"										
RecipeBufferTEMP.MODIFY;										
//LS7.1-07 -										
"//LS7.1-12    IF GenPosFunc.""Print Disc/Cpn Info on Slip"" = GenPosFunc.""Print Disc/Cpn Info on Slip""::""Detail information for each"	li	"ne"""	T	HEN						
//LS7.1-12 -										
"IF GenPosFunc.""Print Disc/Cpn Info on Slip"" IN"										
"[GenPosFunc.""Print Disc/Cpn Info on Slip""::""Detail for each line and Sub-total"","										
"GenPosFunc.""Print Disc/Cpn Info on Slip""::""Detail information for each line""] THEN"										
//LS7.1-12 +										
"BufferLineDiscountDetails(TransSalesEntry,RecipeBufferTEMP,RecipeBufferDetailTEMP_p);"										
//LS7.1-07 +										
END ELSE BEGIN										
CLEAR(RecipeBufferTEMP);										
RecipeBufferTEMP := TransSalesEntry;										
RecipeBufferTEMP.INSERT;										
//LS7.1-07 -										
"//LS7.1-12    IF GenPosFunc.""Print Disc/Cpn Info on Slip"" = GenPosFunc.""Print Disc/Cpn Info on Slip""::""Detail information for each"	li	"ne"""	T	HEN	BEGIN					
//LS7.1-12 -										
"IF GenPosFunc.""Print Disc/Cpn Info on Slip"" IN"										
"[GenPosFunc.""Print Disc/Cpn Info on Slip""::""Detail for each line and Sub-total"","										
"GenPosFunc.""Print Disc/Cpn Info on Slip""::""Detail information for each line""] THEN BEGIN"										
//LS7.1-12 +										
CLEAR(RecipeBufferDetailTEMP_p);										
"BufferLineDiscountDetails(TransSalesEntry,RecipeBufferTEMP,RecipeBufferDetailTEMP_p);"										
END;										
//LS7.1-07 +										
END;										
END										
ELSE BEGIN										
CLEAR(ItemInfocodeItemModifier);										
"IF TransSalesEntry.""Orig. from Infocode"" <> '' THEN"										
"IF ItemInfocodeItemModifier.GET(TransSalesEntry.""Orig. from Infocode"") THEN;"										
"IF (ItemInfocodeItemModifier.""Print Item Modifier on Receipt"" ="										
"ItemInfocodeItemModifier.""Print Item Modifier on Receipt""::""Print All"") OR"										
"((ItemInfocodeItemModifier.""Print Item Modifier on Receipt"" ="										
"ItemInfocodeItemModifier.""Print Item Modifier on Receipt""::""Skip Zero Price"") AND"										
"(TransSalesEntry.""Net Amount"" + TransSalesEntry.""VAT Amount"" <> 0)) THEN BEGIN"										
EntryNoOfMasterLine := 0;										
RecipeBufferTEMP.RESET;										
"RecipeBufferTEMP.SETCURRENTKEY(""Item No."",""Variant Code"");"										
"RecipeBufferTEMP.SETRANGE(""Item No."",ParentItemLine.""Item No."");"										
"RecipeBufferTEMP.SETFILTER(""Variant Code"",'%1',ParentItemLine.""Variant Code"");"										
"RecipeBufferTEMP.SETFILTER(""Orig. from Infocode"",'%1',ParentItemLine.""Orig. from Infocode"");"										
IF RecipeBufferTEMP.FINDFIRST THEN BEGIN										
"EntryNoOfMasterLine := RecipeBufferTEMP.""Line No."";"										
"RecipeBufferTEMP.SETRANGE(""Parent Line No."",EntryNoOfMasterLine);"										
"RecipeBufferTEMP.SETRANGE(""Item No."",TransSalesEntry.""Item No."");"										
"RecipeBufferTEMP.SETFILTER(""Variant Code"",'%1',TransSalesEntry.""Variant Code"");"										
"RecipeBufferTEMP.SETRANGE(""Orig. from Infocode"");"										
IF RecipeBufferTEMP.FINDFIRST THEN BEGIN										
RecipeBufferTEMP.Quantity := RecipeBufferTEMP.Quantity + TransSalesEntry.Quantity;										
"RecipeBufferTEMP.""Net Amount"" := RecipeBufferTEMP.""Net Amount"" + TransSalesEntry.""Net Amount"";"										
"RecipeBufferTEMP.""VAT Amount"" := RecipeBufferTEMP.""VAT Amount"" + TransSalesEntry.""VAT Amount"";"										
"RecipeBufferTEMP.""Discount Amount"" := RecipeBufferTEMP.""Discount Amount"" + TransSalesEntry.""Discount Amount""; //LS7.1-07"										
RecipeBufferTEMP.MODIFY;										
END										
ELSE BEGIN										
RecipeBufferTEMP := TransSalesEntry;										
"RecipeBufferTEMP.""Parent Line No."" := EntryNoOfMasterLine;"										
RecipeBufferTEMP.INSERT;										
END;										
END										
ELSE BEGIN										
RecipeBufferTEMP := TransSalesEntry;										
"RecipeBufferTEMP.""Parent Line No."" := EntryNoOfMasterLine;"										
RecipeBufferTEMP.INSERT;										
END;										
END;										
END;										
END;										
										
PROCEDURE PrintWarrantyHotelSlip@1100409043(WHRegistration@1100409003 : Record 99008977) : Boolean;										
VAR										
TransactionHeader@1200070005 : Record 99001472;										
POSPrintSetupHeader@1200070006 : Record 99001550;										
POSTerminal@1100409007 : Record 99001471;										
WHSetup@1100409000 : Record 99008970;										
Tray@1100409002 : Integer;										
Firstname@1100409006 : Text[30];										
LastName@1100409005 : Text[30];										
NewPwd@1100409004 : Text[12];										
BLOBRef@1100409001 : Record 99008535;										
FileMgt@1100409008 : Codeunit 419;										
BEGIN										
//PrintWarrantyHotelSlip										
IF NOT(WHSetup.GET) THEN										
EXIT(TRUE);										
										
"IF NOT(WHSetup.""Use Warranty Hotel"") THEN"										
EXIT(TRUE);										
										
"POSTerminal.GET(WHRegistration.""POS Terminal No."");"										
"IF POSTerminal.""Warranty Hotel Terminal GUID"" = '' THEN"										
EXIT(TRUE);										
										
"TransactionHeader.GET(WHRegistration.""Store No."",WHRegistration.""POS Terminal No."",WHRegistration.""Transaction No."");"										
										
Tray := 2;										
WHRegistration.CALCFIELDS(QRCode);										
CLEAR(NewPwd);										
CLEAR(Firstname);										
CLEAR(LastName);										
										
IF WHRegistration.RedeemCode <> ''  THEN BEGIN										
IF WHRegistration.QRCode.HASVALUE THEN BEGIN										
"IF NOT(POSPrintSetupHeader.GET(WHSetup.""USQR Slip"")) THEN"										
"IF NOT(POSPrintSetupHeader.GET(WHSetup.""WOQR Slip"")) THEN"										
EXIT(TRUE);										
END										
ELSE BEGIN										
"IF NOT(POSPrintSetupHeader.GET(WHSetup.""WOQR Slip"")) THEN"										
EXIT(TRUE);										
END;										
END										
ELSE BEGIN										
IF WHRegistration.CreateEmail <> '' THEN BEGIN										
"IF NOT(POSPrintSetupHeader.GET(WHSetup.""CACC Slip"")) THEN"										
EXIT(TRUE);										
END										
ELSE BEGIN										
IF WHRegistration.AccountID <> '' THEN BEGIN										
"IF NOT(POSPrintSetupHeader.GET(WHSetup.""FACC Slip"")) THEN"										
EXIT(TRUE);										
END										
ELSE										
EXIT(TRUE);										
END;										
END;										
										
WHRegistration.CALCFIELDS(QRCode); //LS7.1-06-										
										
IF WHRegistration.QRCode.HASVALUE THEN BEGIN										
//LS7.1-06-										
//QRPath := QRPath + 'QrBmpExp.bmp';										
BLOBRef.Blob := WHRegistration.QRCode;										
"QRPath := FileMgt.BLOBExport(BLOBRef, 'QrBmpExp.bmp', FALSE);"										
//LS7.1-06+										
END;										
										
"IF NOT PrintWHExtraSlip(TransactionHeader,POSPrintSetupHeader,WHRegistration) THEN"										
EXIT(FALSE);										
										
EXIT(TRUE);										
END;										
										
PROCEDURE PrintWHExtraSlip@1100409042(Transaction@1000 : Record 99001472;Header@1001 : Record 99001550;WHRegistration@1100409001 : R	eco	rd	99	8	977) : Boolean;					
VAR										
Line@1010 : Record 99001551;										
Tray@1013 : Integer;										
DSTR@1014 : Text[50];										
FieldName@1015 : ARRAY [6] OF Text[6];										
FieldValue@1016 : ARRAY [6] OF Text[40];										
Len@1017 : Integer;										
Pos@1018 : Integer;										
i@1019 : Integer;										
TmpStr@1020 : Text[100];										
DSTR1@1100409000 : Text[50];										
BEGIN										
//PrintWHExtraSlip										
Tray := 2;										
"IF NOT OpenReceiptPrinter(Tray, 'EXTRA', Header.""Setup ID"", Transaction.""Transaction No."", Transaction.""Receipt No."") THEN"										
EXIT(FALSE);										
										
Len := LineLen;										
										
PrintBuffer.INIT;										
"//LS7.1-13 PrintBuffer.""Transaction No."" := PrintBufferTransNo;"										
"PrintBuffer.""Buffer Index"" := PrintBufferIndex;"										
"PrintBuffer.""Station No."" := Tray;"										
"PrintBuffer.""Page No."" := PageNo;"										
"PrintBuffer.""Printed Line No."" := LinesPrinted;"										
PrintBuffer.LineType := PrintBuffer.LineType::Rotation;										
PrintBuffer.Width := Header.Rotation; //NOTE Use Width for Rotation value										
PrintBuffer.INSERT;										
//SavePrinterBufferRecord(PrintBuffer);  //LS7.1-35										
PrintBufferIndex += 1;										
										
"IF Header.""Print Header"" THEN BEGIN"										
"PrintHeader(Transaction,FALSE,Tray);"										
"PrintSubHeader(Transaction,Tray,Transaction.Date,Transaction.Time);"										
END;										
										
"IF Transaction.""Entry Status"" = Transaction.""Entry Status""::Training THEN"										
PrintTrainingText(Tray);										
										
FieldName[1] := 'QRCODE';										
FieldValue[1] := '';										
FieldName[2] := 'CODE';										
FieldValue[2] := WHRegistration.RedeemCode;										
FieldName[3] := 'FN';										
FieldValue[3] := WHRegistration.FirstName;										
FieldName[4] := 'LN';										
FieldValue[4] := WHRegistration.LastName;										
FieldName[5] := 'EMAIL';										
FieldValue[5] := WHRegistration.CreateEmail;										
FieldName[6] := 'PWD';										
FieldValue[6] := WHRegistration.CreatePassword;										
										
"Line.SETRANGE(""Setup ID"",Header.""Setup ID"");"										
IF Line.FIND('-') THEN REPEAT										
CASE Line.Align OF										
Line.Align::Left:										
IF Line.Wide THEN										
"DSTR := '#L' + StringPad('#',ROUND(Len / 2,1,'<') - 2)"										
ELSE										
"DSTR := '#L' + StringPad('#',Len - 2);"										
Line.Align::Center:										
IF Line.Wide THEN										
"DSTR := '#C' + StringPad('#',ROUND(Len / 2,1,'<') - 2)"										
ELSE										
"DSTR := '#C' + StringPad('#',Len - 2);"										
Line.Align::Right:										
IF Line.Wide THEN										
"DSTR := '#R' + StringPad('#',ROUND(Len / 2,1,'<') - 2)"										
ELSE										
"DSTR := '#R' + StringPad('#',Len - 2);"										
END;										
TmpStr := Line.Text;										
FOR i := 1 TO 6 DO BEGIN										
"Pos := STRPOS(TmpStr,'%WH_' + FieldName[i]);"										
IF Pos <> 0 THEN BEGIN										
IF Pos = 1 THEN										
"TmpStr := FieldValue[i] + COPYSTR(TmpStr,Pos + STRLEN(FieldName[i]) + 4)"										
ELSE										
"TmpStr := COPYSTR(TmpStr,1,Pos - 1) + FieldValue[i] + COPYSTR(TmpStr,Pos + STRLEN(FieldName[i]) + 4);"										
END;										
END;										
IF Line.Align <> Line.Align::Barcode THEN BEGIN										
Value[1] := TmpStr;										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR),Line.Wide,Line.Bold,Line.High,Line.Italic));"										
END										
ELSE										
"PrintBitmap(Tray, QRPath, 1); //LS7.1-06"										
UNTIL Line.NEXT = 0;										
										
"IF Header.""Print Footer"" THEN"										
"PrintFooter(Transaction,Tray);"										
										
PrintBuffer.INIT;										
"//LS7.1-13 PrintBuffer.""Transaction No."" := PrintBufferTransNo;"										
"PrintBuffer.""Buffer Index"" := PrintBufferIndex;"										
"PrintBuffer.""Station No."" := Tray;"										
"PrintBuffer.""Page No."" := PageNo;"										
"PrintBuffer.""Printed Line No."" := LinesPrinted;"										
PrintBuffer.LineType := PrintBuffer.LineType::Rotation;										
"PrintBuffer.Width := Header.Rotation::"" ""; //NOTE Use Width for Rotation value"										
PrintBuffer.INSERT;										
//SavePrinterBufferRecord(PrintBuffer);  //LS7.1-35										
PrintBufferIndex += 1;										
										
IF NOT ClosePrinter(Tray) THEN										
EXIT(FALSE);										
EXIT(TRUE);										
END;										
										
"PROCEDURE PrintBitmap@1100409031(Tray@1010 : Integer;ClientFilePath@1100409000 : Text;Alignment@1100409002 : 'Left,Center,Right') :"	Cod	e[2	0]	;						
BEGIN										
//PrintQRBitmap										
PrintBuffer.INIT;										
"//LS7.1-13 PrintBuffer.""Transaction No."" := PrintBufferTransNo;"										
"PrintBuffer.""Buffer Index"" := PrintBufferIndex;"										
"PrintBuffer.""Station No."" := Tray;"										
"PrintBuffer.""Page No."" := PageNo;"										
"PrintBuffer.""Printed Line No."" := LinesPrinted;"										
PrintBuffer.LineType := PrintBuffer.LineType::PrintBitmapFile;										
//LS7.1-06-										
PrintBuffer.Text := ClientFilePath;										
PrintBuffer.BCPos := Alignment;										
										
//LS7.1-06+										
PrintBuffer.INSERT;										
//SavePrinterBufferRecord(PrintBuffer);  //LS7.1-35										
PrintBufferIndex += 1;										
EXIT;										
END;										
										
PROCEDURE CompressHospitalityTransLines@1100409045(POSTransaction@1100409000 : Record 99008980;POSFunctionalityProfile@1100409003 :	Rec	ord	9	900	1515;VAR CompressedPOSTransLinesTEMP@1100409001 : TEMPORARY Record 99008981;GuestSeatNumberFilter@1100409005 : Text[30]);					
VAR										
lPOSTransLine@1100409002 : Record 99008981;										
lPOSTransLineParent@1100409006 : Record 99008981;										
lItem@1100409004 : Record 27;										
lPOSTransPeriodicDisc@1100409007 : Record 99008943;										
DiscountText@1100409008 : Text[30];										
PeriodicDiscount@1100409009 : Record 99001453;										
CouponHeader@1100409010 : Record 99001621;										
OfferCode@1100409011 : Code[20];										
BEGIN										
//CompressHospitalityTransLines										
CompressedPOSTransLinesTEMP.RESET;										
CompressedPOSTransLinesTEMP.DELETEALL;										
PeriodicDiscountInfoTEMP.RESET;										
PeriodicDiscountInfoTEMP.DELETEALL;										
POSTransPeriodicDiscTEMP.RESET;										
POSTransPeriodicDiscTEMP.DELETEALL;										
POSSlipTotAmt := 0;										
POSSlipSubTotAmt := 0;										
lPOSTransLine.RESET;										
"lPOSTransLine.SETRANGE(""Receipt No."",POSTransaction.""Receipt No."");"										
"lPOSTransLine.SETRANGE(""Entry Type"",lPOSTransLine.""Entry Type""::Item);"										
"lPOSTransLine.SETRANGE(""Entry Status"",lPOSTransLine.""Entry Status""::"" "");"										
IF GuestSeatNumberFilter <> '' THEN										
"lPOSTransLine.SETFILTER(""Guest/Seat No."",GuestSeatNumberFilter);"										
										
IF lPOSTransLine.FINDSET THEN REPEAT										
IF NOT lItem.GET(lPOSTransLine.Number) THEN										
CLEAR(lItem);										
										
"IF lPOSTransLine.""Parent Line"" <> lPOSTransLine.""Line No."" THEN"										
"IF lPOSTransLineParent.GET(lPOSTransLine.""Receipt No."",lPOSTransLine.""Parent Line"") THEN"										
IF lItem.GET(lPOSTransLineParent.Number) THEN;										
										
"IF NOT lItem.""Skip Compression When Printed"" THEN BEGIN"										
CompressedPOSTransLinesTEMP.RESET;										
"CompressedPOSTransLinesTEMP.""Receipt No."" := POSTransaction.""Receipt No."";"										
"CompressedPOSTransLinesTEMP.SETRANGE(""Entry Type"",lPOSTransLine.""Entry Type""::Item);"										
"CompressedPOSTransLinesTEMP.SETRANGE(Number,lPOSTransLine.Number);"										
"CompressedPOSTransLinesTEMP.SETRANGE(""Variant Code"",lPOSTransLine.""Variant Code"");"										
"CompressedPOSTransLinesTEMP.SETRANGE(""Unit of Measure"",lPOSTransLine.""Unit of Measure"");"										
"CompressedPOSTransLinesTEMP.SETRANGE(""Net Price"",lPOSTransLine.""Net Price"");"										
"CompressedPOSTransLinesTEMP.SETRANGE(""Discount %"",lPOSTransLine.""Discount %"");"										
"CompressedPOSTransLinesTEMP.SETRANGE(""Mix & Match Line No."",lPOSTransLine.""Mix & Match Line No."");"										
"CompressedPOSTransLinesTEMP.SETRANGE(""Tot. Disc Info Line No."",lPOSTransLine.""Tot. Disc Info Line No."");"										
"CompressedPOSTransLinesTEMP.SETRANGE(""Deal Line"",lPOSTransLine.""Deal Line"");"										
"CompressedPOSTransLinesTEMP.SETRANGE(""Sales Type"",lPOSTransLine.""Sales Type"");"										
"CompressedPOSTransLinesTEMP.SETRANGE(""Parent Line"",0);"										
IF CompressedPOSTransLinesTEMP.FINDFIRST THEN BEGIN										
CompressedPOSTransLinesTEMP.Quantity := CompressedPOSTransLinesTEMP.Quantity + lPOSTransLine.Quantity;										
"CompressedPOSTransLinesTEMP.""Discount Amount"" := CompressedPOSTransLinesTEMP.""Discount Amount"" +"										
"lPOSTransLine.""Discount Amount"";"										
"CompressedPOSTransLinesTEMP.""Net Amount"" := CompressedPOSTransLinesTEMP.""Net Amount"" + lPOSTransLine.""Net Amount"";"										
"CompressedPOSTransLinesTEMP.""VAT Amount"" := CompressedPOSTransLinesTEMP.""VAT Amount"" + lPOSTransLine.""VAT Amount"";"										
CompressedPOSTransLinesTEMP.Amount := CompressedPOSTransLinesTEMP.Amount + lPOSTransLine.Amount;										
"CompressedPOSTransLinesTEMP.""Amount In Currency"" := CompressedPOSTransLinesTEMP.""Amount In Currency"" +"										
"lPOSTransLine.""Amount In Currency"";"										
CompressedPOSTransLinesTEMP.MODIFY;										
END										
ELSE BEGIN										
CompressedPOSTransLinesTEMP := lPOSTransLine;										
"CompressedPOSTransLinesTEMP.""Parent Line"" := 0;"										
CompressedPOSTransLinesTEMP.INSERT;										
END;										
END										
ELSE BEGIN										
CompressedPOSTransLinesTEMP := lPOSTransLine;										
CompressedPOSTransLinesTEMP.INSERT;										
END;										
										
"IF GenPosFunc.""Print Disc/Cpn Info on Slip"" IN"										
"[GenPosFunc.""Print Disc/Cpn Info on Slip""::""Summary information below Sub-total"","										
"GenPosFunc.""Print Disc/Cpn Info on Slip""::""Detail for each line and Sub-total"", //LS7.1-12"										
"GenPosFunc.""Print Disc/Cpn Info on Slip""::""Detail information for each line""] THEN BEGIN"										
										
"IF GenPosFunc.""Print Disc/Cpn Info on Slip"" ="										
"GenPosFunc.""Print Disc/Cpn Info on Slip""::""Detail information for each line"" THEN"										
"POSSlipTotAmt := POSSlipTotAmt + lPOSTransPeriodicDisc.""Discount Amount"";"										
"IF GenPosFunc.""Print Disc/Cpn Info on Slip"" ="										
"GenPosFunc.""Print Disc/Cpn Info on Slip""::""Summary information below Sub-total"" THEN"										
"POSSlipSubTotAmt := POSSlipSubTotAmt + lPOSTransLine.Amount + lPOSTransLine.""Discount Amount"";"										
//LS7.1-12 -										
"IF GenPosFunc.""Print Disc/Cpn Info on Slip"" ="										
"GenPosFunc.""Print Disc/Cpn Info on Slip""::""Detail for each line and Sub-total"" THEN"										
"POSSlipSubTotAmt := POSSlipSubTotAmt + lPOSTransLine.Amount + lPOSTransLine.""Discount Amount"";"										
//LS7.1-12 +										
lPOSTransPeriodicDisc.RESET;										
"lPOSTransPeriodicDisc.SETRANGE(""Receipt No."",POSTransaction.""Receipt No."");"										
"lPOSTransPeriodicDisc.SETRANGE(""Line No."",lPOSTransLine.""Line No."");"										
IF lPOSTransPeriodicDisc.FINDSET THEN REPEAT										
CLEAR(PeriodicDiscount);										
										
"IF lPOSTransPeriodicDisc.""Periodic Disc. Type"" <> lPOSTransPeriodicDisc.""Periodic Disc. Type""::"" "" THEN"										
"DiscountText := FORMAT(lPOSTransPeriodicDisc.""Periodic Disc. Type"")"										
ELSE										
DiscountText := FORMAT(lPOSTransPeriodicDisc.DiscType) + ' ' + Text012;										
IF lPOSTransPeriodicDisc.DiscType <> lPOSTransPeriodicDisc.DiscType::Coupon THEN										
"IF PeriodicDiscount.GET(lPOSTransPeriodicDisc.""Offer No."") THEN"										
"IF GenPosFunc.""Print Disc/Cpn Info on Slip"" IN"										
"[GenPosFunc.""Print Disc/Cpn Info on Slip""::""Detail information for each line"","										
"GenPosFunc.""Print Disc/Cpn Info on Slip""::""Detail for each line and Sub-total"",  //LS7.1-12"										
"GenPosFunc.""Print Disc/Cpn Info on Slip""::""Summary information below Sub-total""] THEN"										
DiscountText := PeriodicDiscount.Description;										
										
IF lPOSTransPeriodicDisc.DiscType = lPOSTransPeriodicDisc.DiscType::Coupon THEN										
"IF CouponHeader.GET(lPOSTransPeriodicDisc.""Coupon Code"") THEN"										
DiscountText := CouponHeader.Description;										
"DiscountText := CONVERTSTR(DiscountText,'&','+');"										
										
"IF NOT PeriodicDiscount.""Block Printing"" THEN BEGIN"										
"IF lPOSTransPeriodicDisc.""Discount Amount"" <> 0 THEN BEGIN"										
"IF lPOSTransPeriodicDisc.""Offer No."" <> '' THEN"										
"OfferCode := lPOSTransPeriodicDisc.""Offer No."""										
ELSE										
"OfferCode := COPYSTR(FORMAT(lPOSTransPeriodicDisc.DiscType),1,MAXSTRLEN(OfferCode));"										
"//LS7.1-12       IF GenPosFunc.""Print Disc/Cpn Info on Slip"" ="										
"//LS7.1-12         GenPosFunc.""Print Disc/Cpn Info on Slip""::""Summary information below Sub-total"" THEN BEGIN"										
//LS7.1-12 -										
"IF GenPosFunc.""Print Disc/Cpn Info on Slip"" IN"										
"[GenPosFunc.""Print Disc/Cpn Info on Slip""::""Detail for each line and Sub-total"","										
"GenPosFunc.""Print Disc/Cpn Info on Slip""::""Summary information below Sub-total""] THEN BEGIN"										
//LS7.1-12 +										
IF NOT PeriodicDiscountInfoTEMP.GET(OfferCode) THEN BEGIN										
PeriodicDiscountInfoTEMP := PeriodicDiscount;										
"PeriodicDiscountInfoTEMP.""No."" := OfferCode;"										
"PeriodicDiscountInfoTEMP.""Discount Amount Value"" := lPOSTransPeriodicDisc.""Discount Amount"";"										
"PeriodicDiscountInfoTEMP.""Discount % Value"" := 0;"										
PeriodicDiscountInfoTEMP.Description := DiscountText;										
PeriodicDiscountInfoTEMP.INSERT;										
END										
ELSE BEGIN										
"PeriodicDiscountInfoTEMP.""Discount Amount Value"" := PeriodicDiscountInfoTEMP.""Discount Amount Value"" +"										
"lPOSTransPeriodicDisc.""Discount Amount"";"										
PeriodicDiscountInfoTEMP.MODIFY;										
END;										
END										
ELSE BEGIN										
"//GenPosFunc.""Print Disc/Cpn Info on Slip""::""Detail information for each line"""										
"POSTransPeriodicDiscTEMP.SETRANGE(""Line No."",CompressedPOSTransLinesTEMP.""Line No."");"										
"POSTransPeriodicDiscTEMP.SETRANGE(DiscType,lPOSTransPeriodicDisc.DiscType);"										
"POSTransPeriodicDiscTEMP.SETRANGE(""Offer No."",lPOSTransPeriodicDisc.""Offer No."");"										
"POSTransPeriodicDiscTEMP.SETRANGE(""Coupon Code"",lPOSTransPeriodicDisc.""Coupon Code"");"										
IF NOT POSTransPeriodicDiscTEMP.FINDFIRST THEN BEGIN										
POSTransPeriodicDiscTEMP := lPOSTransPeriodicDisc;										
"POSTransPeriodicDiscTEMP.""Line No."" := CompressedPOSTransLinesTEMP.""Line No."";"										
IF NOT POSTransPeriodicDiscTEMP.INSERT THEN REPEAT										
"POSTransPeriodicDiscTEMP.""No."" := POSTransPeriodicDiscTEMP.""No."" + 1;"										
UNTIL POSTransPeriodicDiscTEMP.INSERT;										
END										
ELSE BEGIN										
"POSTransPeriodicDiscTEMP.""Discount Amount"" := POSTransPeriodicDiscTEMP.""Discount Amount"" + lPOSTransPeriodicDisc.""Di"	sco	unt	A	mou	"nt"";"					
POSTransPeriodicDiscTEMP.MODIFY;										
END;										
END;										
END;										
										
IF lPOSTransPeriodicDisc.Points <> 0 THEN BEGIN										
"IF NOT PeriodicDiscountInfoTEMP.GET(lPOSTransPeriodicDisc.""Offer No."") THEN BEGIN"										
PeriodicDiscountInfoTEMP := PeriodicDiscount;										
"PeriodicDiscountInfoTEMP.""No."" := lPOSTransPeriodicDisc.""Offer No."";"										
"PeriodicDiscountInfoTEMP.""Discount Amount Value"" := 0;"										
"PeriodicDiscountInfoTEMP.""Discount % Value"" := lPOSTransPeriodicDisc.Points;"										
PeriodicDiscountInfoTEMP.Description := DiscountText;										
PeriodicDiscountInfoTEMP.INSERT;										
END										
ELSE BEGIN										
"PeriodicDiscountInfoTEMP.""Discount % Value"" := PeriodicDiscountInfoTEMP.""Discount % Value"" +"										
lPOSTransPeriodicDisc.Points;										
PeriodicDiscountInfoTEMP.MODIFY;										
END;										
END;										
END;										
										
UNTIL lPOSTransPeriodicDisc.NEXT = 0;										
END;										
										
UNTIL lPOSTransLine.NEXT = 0;										
CompressedPOSTransLinesTEMP.RESET;										
END;										
										
PROCEDURE GetPrintErrorTxt@38() : Text[250];										
BEGIN										
EXIT(PrintErrorTxt);										
END;										
										
PROCEDURE PrintToWindowsPrinter@1000000005(pPrinterName@1100409003 : Text) : Boolean;										
VAR										
PosReceipt@1000000000 : Report 99001528;										
PrinterSelection@1100409001 : Record 78;										
Printers@1100409000 : Record 2000000039;										
ReportNo@1100409002 : Integer;										
BEGIN										
COMMIT;										
CLEAR(PosReceipt);										
PosReceipt.SetLine(PrintBuffer);										
ReportNo := 99001528;										
PosReceipt.USEREQUESTPAGE(FALSE);										
//LS7.1-13-										
"IF PrinterSelection.GET(USERID,ReportNo) THEN BEGIN"										
"IF (PrinterSelection.""Printer Name"" <> pPrinterName) THEN BEGIN"										
"PrinterSelection.""Printer Name"" := pPrinterName;"										
PrinterSelection.MODIFY(TRUE);										
COMMIT;										
END;										
END ELSE BEGIN										
"PrinterSelection.""User ID"" := USERID;"										
"PrinterSelection.VALIDATE(""Report ID"",ReportNo);"										
"PrinterSelection.""Printer Name"" := pPrinterName;"										
PrinterSelection.INSERT(TRUE);										
COMMIT;										
END;										
//LS7.1-13+										
{//LS7.1-13-										
"Printers.SETRANGE(Name, pPrinterName);"										
IF Printers.GETFILTER(Name) <> '' THEN BEGIN										
IF Printers.FINDFIRST THEN BEGIN										
"IF PrinterSelection.GET(USERID,ReportNo) THEN BEGIN"										
"IF (PrinterSelection.""Printer Name"" <> Printers.ID) THEN BEGIN"										
"PrinterSelection.""Printer Name"" := Printers.ID;"										
PrinterSelection.MODIFY(TRUE);										
COMMIT;										
END;										
END ELSE BEGIN										
"PrinterSelection.""User ID"" := USERID;"										
"PrinterSelection.VALIDATE(""Report ID"",ReportNo);"										
"PrinterSelection.""Printer Name"" := Printers.ID;"										
PrinterSelection.INSERT(TRUE);										
COMMIT;										
END;										
END;										
END;										
} //LS7.1-13+										
PosReceipt.RUN();										
										
EXIT(TRUE);										
END;										
										
PROCEDURE GetWebTextLine@1100409064(VAR pText@1100409000 : Text;pFontType@1100409001 : Integer) : Text;										
BEGIN										
//LS7.1-13										
IF pFontType = ActiveFontType::Bold THEN										
EXIT('<b>'+pText+'</b><br/>')										
ELSE IF pFontType = ActiveFontType::Italic THEN										
EXIT('<i>'+pText+'</i><br/>')										
ELSE										
EXIT(pText + '<br/>'); //Finish Wide and High ?										
END;										
										
PROCEDURE SetWebPrinting@1100409047(pWebPrinting@1100409002 : Boolean;pMailRecipients@1100409000 : Text;pMailSubject@1100409001 : Te	xt)	;								
BEGIN										
WebPrinting := pWebPrinting;										
MailRecipients := pMailRecipients;										
MailSubject := pMailSubject;										
END;										
										
PROCEDURE AddPrintLine@1100409046(pSectionID@1100409004 : Integer;pMaxIndex@1100409020 : Integer;pNodeName@1100409008 : ARRAY [32] O	F T	ext	[5	0];	pValue@1100409006 : ARRAY [10] OF Text[100];pDesign@1100409005 : Text[100];pWide@1100409003 : Boolean;pBold@1100409002 : Boolean;pHigh@1100409001 : Boolean;pItalic@1100409000 : Boolean;pTray@1100409013 : Integer);					
VAR										
Field@1100409015 : Record 2000000041;										
WSFunc@1100409009 : Codeunit 99009512;										
RecRef@1100409011 : RecordRef;										
FieldRef@1100409014 : FieldRef;										
Index@1100409010 : Integer;										
FieldNo@1100409012 : Integer;										
LastLineNo@1100409007 : Integer;										
IntValue@1100409016 : Integer;										
DecValue@1100409017 : Decimal;										
DateValue@1100409018 : Date;										
TimeValue@1100409019 : Time;										
ValueText@1100409021 : Text[30];										
FieldIndex@1100409022 : Text[50];										
MappingID@1100409023 : Integer;										
BEGIN										
//AddPrintLine										
//LS7.1-02 New										
IF NOT WebPrinting THEN										
EXIT;										
										
IF CurrentPrintID = 0 THEN										
EXIT;										
										
"PrintBufferExt.SETRANGE(""Print ID"",CurrentPrintID);"										
"PrintBufferExt.SETRANGE(""Section ID"",pSectionID);"										
IF PrintBufferExt.FINDLAST THEN										
"LastLineNo := PrintBufferExt.""Section Line No."""										
ELSE										
LastLineNo := 0;										
										
LastLineNo := LastLineNo + 1;										
										
PrintBufferExt.INIT;										
"PrintBufferExt.""Print ID"" := CurrentPrintID;"										
"PrintBufferExt.""Section ID"" := pSectionID;"										
"PrintBufferExt.""Section Line No."" := LastLineNo;"										
PrintBufferExt.Layout := pDesign;										
PrintBufferExt.Wide := pWide;										
PrintBufferExt.Bold := pBold;										
PrintBufferExt.High := pHigh;										
PrintBufferExt.Italic := pItalic;										
PrintBufferExt.Tray := pTray;										
RecRef.GETTABLE(PrintBufferExt);										
Index := 1;										
WHILE((Index <= pMaxIndex) AND (pNodeName[Index] <> '')) DO BEGIN										
IF pNodeName[Index] <> 'x' THEN BEGIN										
"FieldNo := WSFunc.FindFieldNoByFieldName(RecRef.NUMBER,pNodeName[Index]);"										
FieldRef := RecRef.FIELD(FieldNo);										
"Field.GET(RecRef.NUMBER,FieldNo);"										
FieldIndex := FieldIndex + FORMAT(FieldNo) + ';';										
CASE Field.Type OF										
Field.Type::Integer:										
BEGIN										
IF pValue[Index] = '' THEN										
ValueText := '0'										
ELSE										
ValueText := pValue[Index];										
"EVALUATE(IntValue,ValueText);"										
FieldRef.VALUE := IntValue;										
END;										
Field.Type::Decimal:										
BEGIN										
IF pValue[Index] = '' THEN										
ValueText := '0'										
ELSE										
ValueText := pValue[Index];										
"EVALUATE(DecValue,ValueText);"										
FieldRef.VALUE := DecValue;										
END;										
Field.Type::Date:										
BEGIN										
IF pValue[Index] = '' THEN										
ValueText := '0D'										
ELSE										
ValueText := pValue[Index];										
"EVALUATE(DateValue,ValueText);"										
FieldRef.VALUE := DateValue;										
END;										
Field.Type::Time:										
BEGIN										
IF pValue[Index] = '' THEN										
ValueText := '0T'										
ELSE										
ValueText := pValue[Index];										
"EVALUATE(TimeValue,ValueText);"										
FieldRef.VALUE := TimeValue;										
END;										
ELSE										
FieldRef.VALUE := pValue[Index];										
END;										
IF MappingID = 0 THEN										
MappingID := FieldNo;										
END;										
Index := Index + 1;										
END;										
RecRef.SETTABLE(PrintBufferExt);										
"PrintBufferExt.""Mapping ID"" := MappingID;"										
"PrintBufferExt.""Field Index"" := FieldIndex;"										
PrintBufferExt.INSERT;										
END;										
										
PROCEDURE GetPrintBufferExt@1100409050(VAR pPrintBufferExt@1100409000 : Record 99008998);										
BEGIN										
//GetPrintBufferExt										
//LS7.1-02 New										
PrintBufferExt.RESET;										
IF PrintBufferExt.FIND('-') THEN										
REPEAT										
pPrintBufferExt.INIT;										
pPrintBufferExt := PrintBufferExt;										
pPrintBufferExt.INSERT;										
UNTIL PrintBufferExt.NEXT = 0;										
END;										
										
PROCEDURE PrintKDSChit@1100409008(KOTHeaderRouting@1000 : Record 10012133) : Boolean;										
VAR										
KDSProductionSection@1100409005 : Record 10012130;										
KDSDisplayStation@1100409008 : Record 10001228;										
KOTLineRouting@1100409004 : Record 10012127;										
KOTHeader@1100409006 : Record 10012125;										
KOTLine@1100409007 : Record 10012126;										
ProductionSectCode@1100409003 : Code[20];										
ProdSections@1100409002 : Code[1000];										
PositionOfComma@1100409001 : Integer;										
NoOfProductionTypes@1100409000 : Integer;										
PrintAllLines@1100409009 : Boolean;										
PrintDisplayStation@1100409010 : Code[20];										
CurrentDisplayStation@1100409011 : Code[20];										
CurrentDisplayStationDescr@1100409013 : Text;										
BEGIN										
//LS7.1-03 New										
"PrintAllLines := KOTHeaderRouting.""Print All Lines"";"										
CurrentPrintID := 300;										
"CurrentDisplayStation := KOTHeaderRouting.""Display Station ID"";"										
"IF KDSDisplayStation.GET(Globals.StoreNo,CurrentDisplayStation) THEN BEGIN"										
CurrentDisplayStationDescr := KDSDisplayStation.Description;										
"IF KDSDisplayStation.""Use Backup Printer Station"" THEN BEGIN"										
"IF KDSDisplayStation.GET(KDSDisplayStation.""Restaurant No."",KDSDisplayStation.""Backup Printer Station ID"") THEN"										
CurrentDisplayStationDescr += ' ' + Text334;										
END;										
"IF (KDSDisplayStation.""Display Station Type"" = KDSDisplayStation.""Display Station Type""::""Windows Printer"") AND"										
"(KDSDisplayStation.""Printer ID"" <> '')"										
THEN BEGIN										
"OverrideWindowPrinterName := KDSDisplayStation.""Printer ID"";//LS7.1-13"										
END;										
END;										
PrintDisplayStation := KDSDisplayStation.ID;										
										
"IF NOT OpenReceiptPrinter(2, 'KDS', PrintDisplayStation, 0, KOTHeaderRouting.""KOT No."") THEN"										
EXIT(FALSE);										
										
"IF KOTHeader.GET(KOTHeaderRouting.""KOT No."") THEN BEGIN"										
"PrintKDSHeader(CurrentDisplayStationDescr,2);"										
"PrintKOTHeader(KOTHeader,2);"										
"PrintKOTLine(KOTHeader,CurrentDisplayStation,2,PrintAllLines);"										
END;										
IF NOT ClosePrinter(2) THEN										
EXIT(FALSE);										
EXIT(TRUE);										
END;										
										
PROCEDURE PrintKDSHeader@1100409068(DisplayStation@10012003 : Text;Tray@1000 : Integer);										
VAR										
POSText@1001 : Record 99001492;										
DSTR1@1002 : Text[100];										
LineLength@1003 : Integer;										
Terminal@1004 : Record 99001471;										
ReceiptHeader@10012000 : Record 99001498;										
RetailUtil@10012002 : Codeunit 99001462;										
ReceiptNo@10012001 : Code[20];										
SeatNo@1100409001 : Integer;										
PosTrGuestInfo@1100409002 : Record 10012117;										
BEGIN										
//LS7.1-03 New										
IF Tray = 2 THEN										
LineLength := LineLen										
ELSE IF Tray = 4 THEN										
LineLength := InvLineLen;										
"DSTR1 := COPYSTR('#C################################################',1,LineLength-10); //LineLenth"										
										
Value[1] := COMPANYNAME;										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),TRUE,FALSE,TRUE,FALSE));"										
NodeName[1] := 'Header Line';										
"AddPrintLine(100,1,NodeName,Value,DSTR1,TRUE,FALSE,TRUE,FALSE,Tray);"										
										
"PrintLine(Tray,'');"										
"DSTR1 := COPYSTR('#C################################################',1,LineLength-10);"										
Value[1] := DisplayStation;										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
NodeName[1] := 'Description';										
"AddPrintLine(200,1,NodeName,Value,DSTR1,FALSE,TRUE,FALSE,FALSE,Tray);"										
										
"PrintLine(Tray,'');"										
PrintSeperator(Tray);										
END;										
										
PROCEDURE PrintKOTHeader@1100409069(VAR KOTHeader@10012003 : Record 10012125;Tray@1000 : Integer);										
VAR										
POSText@1001 : Record 99001492;										
DSTR1@1002 : Text[100];										
LineLength@1003 : Integer;										
Terminal@1004 : Record 99001471;										
ReceiptHeader@10012000 : Record 99001498;										
RetailUtil@10012002 : Codeunit 99001462;										
ReceiptNo@10012001 : Code[20];										
SeatNo@1100409001 : Integer;										
PosTrGuestInfo@1100409002 : Record 10012117;										
ResTbl@1100409000 : Record 10001206;										
lText001@1100409004 : TextConst 'ENU=%1 %2 %3;ESP=%1 %2 %3';										
lText002@1100409003 : TextConst 'ENU=%1 %2;ESP=%1 %2';										
BEGIN										
//LS7.1-03 New										
IF Tray = 2 THEN										
LineLength := LineLen										
ELSE IF Tray = 4 THEN										
LineLength := InvLineLen;										
										
"IF KOTHeader.""Training Mode"" THEN BEGIN"										
"DSTR1 := COPYSTR('#C################################################',1,LineLength-10);"										
Value[1] := Text047;										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
NodeName[1] := 'Print Info';										
"AddPrintLine(200,1,NodeName,Value,DSTR1,FALSE,TRUE,FALSE,FALSE,Tray);"										
END;										
										
IF KOTHeader.Voided THEN BEGIN										
"DSTR1 := COPYSTR('#C################################################',1,LineLength-10);"										
Value[1] := Text335;										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
NodeName[1] := 'Print Info';										
"AddPrintLine(200,1,NodeName,Value,DSTR1,FALSE,TRUE,FALSE,FALSE,Tray);"										
END;										
										
"KOTHeader.CALCFIELDS(""Table No."",""Order ID"",""Receipt No."");"										
										
DSTR1 := '#L################# #T###### #T######';										
Value[1] := Text323;										
Value[2] := FORMAT(TODAY);										
Value[3] := FORMAT(TIME);										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
NodeName[1] := 'x';										
NodeName[2] := 'x';										
NodeName[3] := 'x';										
"Value[3] := STRSUBSTNO(lText001,Value[1],Value[2],Value[3]);"										
NodeName[4] := 'Print Info';										
"AddPrintLine(250,4,NodeName,Value,DSTR1,FALSE,FALSE,FALSE,FALSE,Tray);"										
										
DSTR1 := '#L################# #L##################';										
Value[1] := Text324;										
"Value[2] := FORMAT(KOTHeader.""Receipt No."");"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
NodeName[1] := 'x';										
NodeName[2] := 'x';										
"Value[3] := STRSUBSTNO(lText002,Value[1],Value[2]);"										
NodeName[3] := 'Print Info';										
"AddPrintLine(250,3,NodeName,Value,DSTR1,FALSE,FALSE,FALSE,FALSE,Tray);"										
										
DSTR1 := '#L################# #T##################';										
Value[1] := Text325;										
"Value[2] := FORMAT(KOTHeader.""KOT No."");"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
NodeName[1] := 'x';										
NodeName[2] := 'x';										
"Value[3] := STRSUBSTNO(lText002,Value[1],Value[2]);"										
NodeName[3] := 'Print Info';										
"AddPrintLine(250,3,NodeName,Value,DSTR1,FALSE,FALSE,FALSE,FALSE,Tray);"										
										
Value[1] := Text326;										
Value[2] := Globals.TerminalNo;										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
NodeName[1] := 'x';										
NodeName[2] := 'x';										
"Value[3] := STRSUBSTNO(lText002,Value[1],Value[2]);"										
NodeName[3] := 'Print Info';										
"AddPrintLine(250,3,NodeName,Value,DSTR1,FALSE,FALSE,FALSE,FALSE,Tray);"										
										
Value[1] := Text327;										
"Value[2] := FORMAT(KOTHeader.""Time KOT Created"" + KOTHeader.""KOT Time in Minutes""*60*1000);"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
NodeName[1] := 'x';										
NodeName[2] := 'x';										
"Value[3] := STRSUBSTNO(lText002,Value[1],Value[2]);"										
NodeName[3] := 'Print Info';										
"AddPrintLine(250,3,NodeName,Value,DSTR1,FALSE,FALSE,FALSE,FALSE,Tray);"										
										
Value[1] := Text329;										
"KOTHeader.CALCFIELDS(""Staff ID"");"										
"Value[2] := KOTHeader.""Staff ID"";"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
NodeName[1] := 'x';										
NodeName[2] := 'x';										
"Value[3] := STRSUBSTNO(lText002,Value[1],Value[2]);"										
NodeName[3] := 'Print Info';										
"AddPrintLine(250,3,NodeName,Value,DSTR1,FALSE,FALSE,FALSE,FALSE,Tray);"										
										
Value[1] := Text330;										
"Value[2] := KOTHeader.""Employee Name"";"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
NodeName[1] := 'x';										
NodeName[2] := 'x';										
"Value[3] := STRSUBSTNO(lText002,Value[1],Value[2]);"										
NodeName[3] := 'Print Info';										
"AddPrintLine(250,3,NodeName,Value,DSTR1,FALSE,FALSE,FALSE,FALSE,Tray);"										
										
"IF KOTHeader.""Table No."" > 0 THEN"										
Value[1] := Text331										
ELSE										
Value[1] := Text333;										
"Value[2] := KOTHeader.""Order ID"";"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
NodeName[1] := 'x';										
NodeName[2] := 'x';										
"Value[3] := STRSUBSTNO(lText002,Value[1],Value[2]);"										
NodeName[3] := 'Print Info';										
"AddPrintLine(250,3,NodeName,Value,DSTR1,FALSE,FALSE,FALSE,FALSE,Tray);"										
										
Value[1] := Text336;										
"Value[2] := KOTHeader.""Sales Type"";"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
NodeName[1] := 'x';										
NodeName[2] := 'x';										
"Value[3] := STRSUBSTNO(lText002,Value[1],Value[2]);"										
NodeName[3] := 'Print Info';										
"AddPrintLine(250,3,NodeName,Value,DSTR1,FALSE,FALSE,FALSE,FALSE,Tray);"										
										
Value[1] := Text332;										
Value[2] := FORMAT(KOTHeader.Covers);										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
NodeName[1] := 'x';										
NodeName[2] := 'x';										
"Value[3] := STRSUBSTNO(lText002,Value[1],Value[2]);"										
NodeName[3] := 'Print Info';										
"AddPrintLine(250,3,NodeName,Value,DSTR1,FALSE,FALSE,FALSE,FALSE,Tray);"										
										
PrintSeperator(Tray);										
END;										
										
PROCEDURE PrintKOTLine@1100409070(VAR KOTHeader@10012003 : Record 10012125;DisplayStationID@1100409012 : Code[20];Tray@1000 : Intege	r;P	rin	tA	llL	ines@1100409011 : Boolean);					
VAR										
POSText@1001 : Record 99001492;										
DSTR1@1002 : Text[100];										
LineLength@1003 : Integer;										
Terminal@1004 : Record 99001471;										
ReceiptHeader@10012000 : Record 99001498;										
RetailUtil@10012002 : Codeunit 99001462;										
ReceiptNo@10012001 : Code[20];										
SeatNo@1100409001 : Integer;										
PosTrGuestInfo@1100409002 : Record 10012117;										
ResTbl@1100409000 : Record 10001206;										
KOTLineRouting@1100409003 : Record 10012127;										
KOTLineModifier@1100409008 : Record 10012128;										
KOTLine@1100409004 : Record 10012126;										
Quan@1100409005 : Text[30];										
Sts@1100409006 : Text[30];										
DelKOT@1100409007 : Text[30];										
KOTLineTEMP@1100409009 : TEMPORARY Record 10012126;										
LastMenuTypeDescription@1100409010 : Text[30];										
BEGIN										
//LS7.1-03 New										
IF Tray = 2 THEN										
LineLength := LineLen										
ELSE IF Tray = 4 THEN										
LineLength := InvLineLen;										
Value[1] := Text322;										
DSTR1 :='#L#######################################';										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
PrintSeperator(Tray);										
KOTLineRouting.RESET;										
"KOTLineRouting.SETCURRENTKEY(""KOT No."",""Display Station ID"",""Line Printed"");"										
"KOTLineRouting.SETRANGE(""KOT No."",KOTHeader.""KOT No."");"										
"KOTLineRouting.SETRANGE(""Display Station ID"",DisplayStationID);"										
IF NOT PrintAllLines THEN										
"KOTLineRouting.SETFILTER(""Line Printed"",'<>%1',KOTLineRouting.""Line Printed""::Yes);"										
										
KOTLineTEMP.RESET;										
KOTLineTEMP.DELETEALL;										
IF KOTLineRouting.FINDSET THEN REPEAT										
"IF KOTLine.GET(KOTLineRouting.""KOT No."",KOTLineRouting.""KOT Line No."") THEN BEGIN"										
KOTLineTEMP := KOTLine;										
"KOTLineTEMP.""Line Printed"" := KOTLineRouting.""Line Printed"";"										
IF KOTLineTEMP.INSERT THEN;										
END;										
UNTIL KOTLineRouting.NEXT = 0;										
										
"KOTLineRouting.MODIFYALL(""Line Printed"",KOTLineRouting.""Line Printed""::Yes);"										
										
COMMIT;										
										
KOTLineTEMP.RESET;										
"KOTLineTEMP.SETCURRENTKEY(""KOT No."",""Menu Type"");"										
LastMenuTypeDescription := '';										
IF KOTLineTEMP.FINDSET THEN REPEAT										
"IF KOTLineTEMP.""Menu Type Description"" <> LastMenuTypeDescription THEN BEGIN"										
"PrintLine(Tray,'');"										
"Value[1] := KOTLineTEMP.""Menu Type Description"";"										
DSTR1 :='#L#######################################';										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
"LastMenuTypeDescription := KOTLineTEMP.""Menu Type Description"";"										
END;										
//DSTR1 := '#L###################### #R####### #R###';										
DSTR1 := '#L############################ #R#######';										
Value[1] := '';										
"IF KOTLineTEMP.""Line Printed"" IN [KOTLineTEMP.""Line Printed""::Yes,KOTLineTEMP.""Line Printed""::""Reprint-Modifier""] THEN"										
Value[1] := '*';										
IF KOTLineTEMP.Voided THEN										
Value[1] += '(-)';										
Value[1] += KOTLineTEMP.Description;										
Value[2] := FORMAT(KOTLineTEMP.Quantity);										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
NodeName[1] := 'Item Description';										
NodeName[2] := 'Quantity';										
"AddPrintLine(300,2,NodeName,Value,DSTR1,FALSE,FALSE,FALSE,FALSE,2);"										
										
KOTLineModifier.RESET;										
"KOTLineModifier.SETRANGE(""KOT No."",KOTLineTEMP.""KOT No."");"										
"KOTLineModifier.SETRANGE(""KOT Line No."",KOTLineTEMP.""KOT Line No."");"										
"IF KOTLineModifier.FINDSET(TRUE,FALSE) THEN REPEAT"										
DSTR1 :=' #L####################################';										
Value[1] := '';										
"IF KOTLineModifier.""Line Printed"" = KOTLineModifier.""Line Printed""::Yes THEN"										
Value[1] := '*';										
IF KOTLineModifier.Voided THEN										
Value[1] += '(-)';										
Value[1] += KOTLineModifier.Description;										
"CASE KOTLineModifier.""Line Info Type"" OF"										
"KOTLineModifier.""Line Info Type""::Item : Value[2] := FORMAT(KOTLineModifier.Quantity);"										
"KOTLineModifier.""Line Info Type""::Text :"										
IF KOTLineModifier.Quantity > 1 THEN										
Value[2] := FORMAT(KOTLineModifier.Quantity)										
ELSE										
Value[2] := '';										
END;										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
NodeName[1] := 'Item Description';										
NodeName[2] := 'Quantity';										
"AddPrintLine(350,2,NodeName,Value,DSTR1,FALSE,FALSE,FALSE,FALSE,2);"										
"IF KOTLineModifier.""Line Printed"" <> KOTLineModifier.""Line Printed""::Yes THEN BEGIN"										
"KOTLineModifier.""Line Printed"" := KOTLineModifier.""Line Printed""::Yes;"										
KOTLineModifier.MODIFY;										
END;										
UNTIL KOTLineModifier.NEXT = 0;										
UNTIL KOTLineTEMP.NEXT = 0;										
COMMIT;										
END;										
										
PROCEDURE PrintStoresInLocationProfile@1100409057(LocationProfile@1100409000 : Code[30];InventoryLookupTable@1100409001 : Record 990	16	08)	:	Bo	olean;					
VAR										
lStore@1001 : Record 99001470;										
Staff@1100409002 : Record 99001461;										
Terminal@1100409003 : Record 99001471;										
Transaction@1100409004 : Record 99001472;										
lText001@1100409005 : TextConst 'ENU=Item No.;ESP=No. Producto';										
lText002@1100409006 : TextConst 'ENU=Variant;ESP=Variante';										
lText003@1100409007 : TextConst 'ENU=Descr.;ESP=Descr.';										
lItem@1100409008 : Record 27;										
lText004@1100409009 : TextConst 'ENU=Stores that might have item on hand;ESP=Tiendas que deben tener exist. disponibles del produc	to'	;								
lText005@1100409010 : TextConst 'ENU=Address;ESP=Direcci¢n';										
lText006@1100409011 : TextConst 'ENU=Phone No.;ESP=No. Telef.';										
lInvLookupTable@1100409012 : Record 99001608;										
lBLOBRef@1100409013 : Record 99008535;										
FileMgt@1100409014 : Codeunit 419;										
lQRPath@1100409015 : Text[250];										
lText007@1100409016 : TextConst 'ENU=This list doesn''t guarentee item;ESP=Esta lista no garantiza el producto';										
lText008@1100409017 : TextConst 'ENU=availability at the stores provided;ESP=disponibilidad en las tiendas prevista';										
Payment@1100409019 : Text[30];										
DSTR1@1100409018 : Text[100];										
i@1100409020 : Integer;										
NumberOfPrintedStores@1100409021 : Integer;										
lText009@1100409023 : TextConst 'ENU=Item %1 is not available in;ESP=El producto %1 no est† disponible en';										
lText010@1100409022 : TextConst 'ENU=Location Profile %1;ESP=Perfil AlmacÇn %1';										
lStoreLocationProfilesRec@1100409024 : Record 10000712;										
lText011@1100409025 : TextConst 'ENU=Scan QR-code to get directions;ESP=Escanear c¢digo QR para obtener instrucciones';										
lMinInventory@1100409026 : Integer;										
lProductGroupRec@1100409027 : Record 5723;										
lStoresInInvLookupProfile@1100409028 : Record 10000713;										
BEGIN										
//LS7.1-05 -										
IF NOT Staff.GET(Globals.StaffID) THEN										
EXIT(TRUE);										
IF NOT Terminal.GET(Globals.TerminalNo) THEN										
EXIT(TRUE);										
										
"IF NOT OpenReceiptPrinter(2, 'STORESINLP', '', 0, '') THEN"										
EXIT(FALSE);										
										
"IF NOT Terminal.""Terminal Statement"" THEN"										
"Terminal.""Statement Method"" := Store.""Statement Method"";"										
										
//Print Header info										
DSTR1 := '#L######## #L#########';										
Value[1] := Text078 + ':';										
"Value[2] := Store.""No."";"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
										
"IF Terminal.""Statement Method"" = Terminal.""Statement Method""::""POS Terminal"" THEN BEGIN"										
DSTR1:='#L####### #L########';										
Value[1] := Text079 + ':';										
"Value[2] := Terminal.""No."";"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
END;										
										
Transaction.Date := TODAY;										
Transaction.Time := TIME;										
PrintLogo(2); //LS7.1-06										
"PrintHeader(Transaction,FALSE,2);"										
										
DSTR1 := '#L#### #T###### #T#### ';										
Value[1] := Text048 + ':';										
Value[2] := FORMAT(TODAY());										
"Value[3] := FORMAT(TIME(),5);"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
										
DSTR1 := '#L######## #L########################';										
Value[1] := Text051 + ':';										
"IF Staff.""Name on Receipt""<>'' THEN"										
"Value[2] := Staff.""Name on Receipt"""										
ELSE										
Value[2] := Globals.StaffID;										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
										
DSTR1 := '#L######## #L########################';										
Value[1] := lText001 + ':';										
"Value[2] := InventoryLookupTable.""Item No."";"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
										
"lItem.SETRANGE(""No."",InventoryLookupTable.""Item No."");"										
lItem.FINDFIRST;										
IF lItem.Description <> '' THEN BEGIN										
DSTR1 := '#L######## #L########################';										
Value[1] := lText003 + ':';										
Value[2] := lItem.Description;										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
END;										
										
"IF InventoryLookupTable.""Variant Code"" <> '' THEN BEGIN"										
DSTR1 := '#L######## #L########################';										
Value[1] := lText002 + ':';										
"Value[2] := InventoryLookupTable.""Variant Code"";"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
END;										
										
PrintSeperator(2);										
										
lProductGroupRec.RESET;										
"lProductGroupRec.SETRANGE(Code,lItem.""Product Group Code"");"										
lProductGroupRec.FINDFIRST;										
"IF lProductGroupRec.""Min Loc. Prof. Inventoy"" > 0 THEN"										
"lMinInventory := lProductGroupRec.""Min Loc. Prof. Inventoy"""										
ELSE BEGIN										
lStoreLocationProfilesRec.RESET;										
"lStoreLocationProfilesRec.SETRANGE(ProfileID,LocationProfile);"										
lStoreLocationProfilesRec.FINDFIRST;										
"lMinInventory := lStoreLocationProfilesRec.""Min Inventory"";"										
END;										
										
"lInvLookupTable.SETRANGE(""Item No."", InventoryLookupTable.""Item No."");"										
"IF InventoryLookupTable.""Variant Code"" <> '' THEN"										
"lInvLookupTable.SETRANGE(""Variant Code"",InventoryLookupTable.""Variant Code"");"										
										
NumberOfPrintedStores := 0;										
"lStoresInInvLookupProfile.SETRANGE(""Inventory Lookup Profile"",LocationProfile);"										
IF lStoresInInvLookupProfile.FINDSET THEN BEGIN										
DSTR1 := '#L##################################';										
Value[1] := lText004 + ':';										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
										
PrintSeperator(2);										
REPEAT										
"Store.SETRANGE(""No."",lStoresInInvLookupProfile.""Store No."");"										
Store.FINDFIRST;										
"lInvLookupTable.SETRANGE(""Store No."",Store.""No."");"										
IF lInvLookupTable.FINDFIRST THEN BEGIN										
"lInvLookupTable.UpdateInventory(GenPosFunc.""TS Inv. Lookup"");"										
"IF (lInvLookupTable.""Net Inventory"" > lMinInventory) AND (Store.""No."" <> Globals.StoreNo) THEN BEGIN"										
DSTR1 := '#L######## #L#########';										
Value[1] := Text078 + ':';										
"Value[2] := Store.""No."";"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
DSTR1 := '#L######## #L########################';										
Value[1] := lText005 + ':';										
Value[2] := Store.Address;										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
DSTR1 := '#L######## #L########################';										
Value[1] := lText006 + ':';										
"Value[2] := Store.""Phone No."";"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
Store.CALCFIELDS(LocationQRCode);										
IF Store.LocationQRCode.HASVALUE THEN BEGIN										
lBLOBRef.Blob := Store.LocationQRCode;										
"QRPath := FileMgt.BLOBExport(lBLOBRef, 'QrBmpExp.bmp', FALSE);"										
"PrintBitmap(2,QRPath,1);"										
DSTR1 := '#L######################################';										
Value[1] := lText011;										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
END;										
PrintSeperator(2);										
NumberOfPrintedStores += 1;										
END;										
END;										
UNTIL (lStoresInInvLookupProfile.NEXT = 0);										
IF NumberOfPrintedStores > 0 THEN BEGIN										
DSTR1 := '#L######################################';										
Value[1] := lText007;										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
Value[1] := lText008 + '.';										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
END ELSE BEGIN										
DSTR1 := '#L######################################';										
"Value[1] := STRSUBSTNO(lText009,lItem.""No."");"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
"Value[1] := STRSUBSTNO(lText010,LocationProfile) + '.';"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
END;										
										
IF NOT ClosePrinter(2) THEN										
EXIT(FALSE);										
										
END;										
										
EXIT(TRUE);										
//LS7.1-05 +										
END;										
										
PROCEDURE BufferLineDiscountDetails@1100409052(TransSalesEntry_p@1100409001 : Record 99001473;RecipeBufferTEMP_p@1100409003 : TEMPOR	ARY	Re	co	rd	99001473;VAR RecipeBufferDetailTEMP_p@1100409002 : TEMPORARY Record 99001642);					
VAR										
TransDiscEntry_l@1100409000 : Record 99001642;										
BEGIN										
//LS7.1-07 New function										
"TransDiscEntry_l.SETRANGE(""Store No."",TransSalesEntry_p.""Store No."");"										
"TransDiscEntry_l.SETRANGE(""POS Terminal No."",TransSalesEntry_p.""POS Terminal No."");"										
"TransDiscEntry_l.SETRANGE(""Transaction No."",TransSalesEntry_p.""Transaction No."");"										
"TransDiscEntry_l.SETRANGE(""Line No."",TransSalesEntry_p.""Line No."");"										
IF TransDiscEntry_l.FINDSET THEN										
REPEAT										
"IF RecipeBufferDetailTEMP_p.GET(TransDiscEntry_l.""Store No."",TransDiscEntry_l.""POS Terminal No."","										
"TransDiscEntry_l.""Transaction No."",RecipeBufferTEMP_p.""Line No."",TransDiscEntry_l.""Offer Type"","										
"TransDiscEntry_l.""Offer No."")"										
THEN BEGIN										
"RecipeBufferDetailTEMP_p.""Discount Amount"" := RecipeBufferDetailTEMP_p.""Discount Amount"" + TransDiscEntry_l.""Discount Amount"	""";"									
RecipeBufferDetailTEMP_p.MODIFY;										
END ELSE BEGIN										
RecipeBufferDetailTEMP_p := TransDiscEntry_l;										
"RecipeBufferDetailTEMP_p.RecipeLineNo := RecipeBufferTEMP_p.""Line No."";"										
RecipeBufferDetailTEMP_p.INSERT;										
END;										
UNTIL TransDiscEntry_l.NEXT = 0;										
END;										
										
PROCEDURE SendEmail@1100409059() : Boolean;										
VAR										
PosReceipt@1100409012 : Report 99001528;										
PrinterSelection@1100409011 : Record 78;										
Printers@1100409010 : Record 2000000039;										
SMTPMailSetup@1100409009 : Record 409;										
ReportNo@1100409008 : Integer;										
ServerFileName@1100409007 : Text;										
ClientTempFileName@1100409006 : Text;										
ClientFileName@1100409005 : Text;										
ReadBuffer@1100409004 : Text[1024];										
BodyBuffer@1100409003 : Text;										
Mail@1100409002 : Codeunit 400;										
FileHandler@1100409001 : File;										
InStr@1100409000 : InStream;										
BEGIN										
IF MailRecipients = '' THEN BEGIN										
LastErrorText := Text352;										
EXIT(FALSE);										
END;										
										
CLEAR(PosReceipt);										
PosReceipt.SetLine(PrintBuffer);										
ReportNo := 99001528;										
PosReceipt.USEREQUESTPAGE(FALSE);										
										
SMTPMailSetup.GET;										
"ClientFileName := DELCHR(MailSubject + '_D'+ FORMAT(CURRENTDATETIME,0,9),'=','-.:\@') +'.pdf';"										
//ServerFileName := TEMPORARYPATH+'\'+ ClientFileName; LS7.1-04										
ServerFileName := TEMPORARYPATH + ClientFileName; //LS7.1-04										
PosReceipt.SAVEASPDF(ServerFileName);										
"BodyBuffer := '<pre style=""font-family:Courier New"">';"										
//PrintBuffer.RESET; //LS7.1-13										
"PrintBuffer.SETRANGE(LineType,PrintBuffer.LineType::PrintLine);"										
IF PrintBuffer.FIND('-') THEN										
REPEAT										
//LS7.1-13-										
"//BodyBuffer := BodyBuffer + COPYSTR(PrintBuffer.Text,3) + '<br/>';"										
IF PrintBuffer.FontType > 0 THEN										
"BodyBuffer += GetWebTextLine(PrintBuffer.Text, PrintBuffer.FontType)"										
ELSE										
BodyBuffer += PrintBuffer.Text + '<br/>';										
//LS7.1-13+										
UNTIL PrintBuffer.NEXT = 0;										
BodyBuffer := BodyBuffer + '</pre>';										
CLEAR(Mail);										
"Mail.CreateMessage('LS e-Receipt',SMTPMailSetup.""User ID"",MailRecipients,MailSubject,BodyBuffer,TRUE);"										
{ //LS7.1-04 -										
FileHandler.OPEN(ServerFileName);										
FileHandler.CREATEINSTREAM(InStr);										
"Mail.AddAttachmentStream(InStr,ClientFileName);"										
} //LS7.1-04										
Mail.AddAttachment(ServerFileName); //LS7.1-04										
IF NOT Mail.TrySend THEN BEGIN										
//ERROR(Mail.GetLastSendMailErrorText);  //LS7.1-13										
LastErrorText := Mail.GetLastSendMailErrorText;										
EXIT(FALSE);										
END;										
										
IF ERASE(ServerFileName) THEN;										
										
EXIT(TRUE);										
END;										
										
"PROCEDURE FiscalPrintXZReport@1100409067(RunType@1100409000 : 'X,Z,Y');"										
BEGIN										
//LS7.1-13										
										
IF RunType = RunType::Y THEN										
EXIT;										
										
PrintBuffer.INIT;										
"PrintBuffer.""Buffer Index"" := PrintBufferIndex;"										
PrintBuffer.LineType := PrintBuffer.LineType::Fiscal;										
IF RunType = RunType::Z THEN										
PrintBuffer.FiscalLineType := PrintBuffer.FiscalLineType::ZReport										
ELSE IF RunType = RunType::X THEN										
PrintBuffer.FiscalLineType := PrintBuffer.FiscalLineType::XReport;										
PrintBuffer.Training := ActivePrintHeader.Training;										
PrintBuffer.INSERT;										
										
PrintBufferIndex += 1;										
END;										
										
"PROCEDURE FiscalPrint@1100409007(VAR pTransactionHeader@1100409000 : Record 99001472;pFiscalPrintType@1100409003 : 'Sale,Refund,Floa"	tTe	nde	"r,"	Rem	"oveTender,XReport,ZReport,TenderDecl') : Boolean;"					
VAR										
FiscalSaleXml@1100409001 : XMLport 10012880;										
ostream@1100409002 : OutStream;										
BEGIN										
//LS7.1-13										
										
PrintBuffer.INIT;										
"PrintBuffer.""Buffer Index"" := PrintBufferIndex;"										
PrintBuffer.LineType := PrintBuffer.LineType::Fiscal;										
PrintBuffer.FiscalLineType := pFiscalPrintType;										
PrintBuffer.Training := ActivePrintHeader.Training;										
PrintBuffer.INSERT;										
PrintBufferIndex += 1;										
										
//pTransactionHeader.SETRECFILTER										
PrintBuffer.CALCFIELDS(Xml);										
PrintBuffer.Xml.CREATEOUTSTREAM(ostream);										
										
pTransactionHeader.SETRECFILTER;										
FiscalSaleXml.SETTABLEVIEW(pTransactionHeader);										
FiscalSaleXml.SETDESTINATION(ostream);										
IF NOT FiscalSaleXml.EXPORT THEN BEGIN										
LastErrorText := 'Error in FiscalTransaction XmlPort: ' + GETLASTERRORTEXT;										
EXIT(FALSE)										
END;										
PrintBuffer.MODIFY;										
EXIT(TRUE);										
END;										
										
PROCEDURE TextHundMilion@1000000006(Hundreds@1000000000 : Integer;Ten@1000000001 : Integer;Units@1000000002 : Integer;Masc@100000000	3:00	Bo	ol	ean	) : Text[250];					
BEGIN										
										
IF Hundreds <> 0 THEN										
"EXIT(TextHundreds(Hundreds,Ten,Units,TRUE));"										
END;										
										
PROCEDURE TextTenUnitsMilion@1000000007(Hundreds@1000000003 : Integer;Ten@1000000002 : Integer;Units@1000000001 : Integer;Masc@10000	0	0	:	Boo	lean) : Text[250];					
BEGIN										
										
IF (Hundreds <> 0) AND (Ten = 0) AND (Units = 0) THEN										
EXIT(Text10701);										
IF (Hundreds = 0) AND (Ten = 0) AND (Units = 1) THEN										
EXIT(Text10702);										
IF (Ten <> 0) OR (Units <> 0) THEN										
"EXIT(TextTensUnits(Ten,Units,Masc) + Text10701);"										
END;										
										
PROCEDURE TextHundThousands@1000000008(Hundreds@1000000003 : Integer;Ten@1000000002 : Integer;Units@1000000001 : Integer;Masc@100000	0	0:00	B	ool	ean) : Text[250];					
BEGIN										
										
IF Hundreds <> 0 THEN										
"EXIT(TextHundreds(Hundreds,Ten,Units,Masc))"										
END;										
										
PROCEDURE TextTenUnitsThousands@1000000009(Hundreds@1000000003 : Integer;Ten@1000000002 : Integer;Units@1000000001 : Integer;Masc@10	0	0	0	:	Boolean) : Text[250];					
BEGIN										
										
IF (Hundreds <> 0) AND (Ten = 0) AND (Units = 0) THEN										
EXIT(Text10703);										
IF (Hundreds = 0) AND (Ten = 0) AND (Units = 1) THEN										
EXIT(Text10703);										
IF (Ten <> 0) OR (Units <> 0) THEN										
"EXIT(TextTensUnits(Ten,Units,Masc) + Text10703);"										
END;										
										
PROCEDURE TextHundreds@1000000010(Hundreds@1000000003 : Integer;Tens@1000000002 : Integer;Units@1000000001 : Integer;Masc@1000000000	:	Boo	le	an)	: Text[250];					
BEGIN										
										
IF Hundreds = 0 THEN										
EXIT('');										
IF Masc THEN										
CASE Hundreds OF										
1: IF (Tens = 0) AND (Units = 0) THEN										
EXIT(Text10704)										
ELSE										
EXIT(Text10705);										
2: EXIT(Text10706);										
3: EXIT(Text10707);										
4: EXIT(Text10708);										
5: EXIT(Text10709);										
6: EXIT(Text10710);										
7: EXIT(Text10711);										
8: EXIT(Text10712);										
9: EXIT(Text10713);										
END										
ELSE										
CASE Hundreds OF										
1: IF (Tens = 0) AND (Units = 0) THEN										
EXIT(Text10704)										
ELSE										
EXIT(Text10705);										
2: EXIT(Text10714);										
3: EXIT(Text10715);										
4: EXIT(Text10716);										
5: EXIT(Text10717);										
6: EXIT(Text10718);										
7: EXIT(Text10719);										
8: EXIT(Text10720);										
9: EXIT(Text10721);										
END;										
END;										
										
PROCEDURE TextTensUnits@1000000011(Tens@1000000002 : Integer;Units@1000000001 : Integer;Masc@1000000000 : Boolean) : Text[250];										
BEGIN										
										
CASE Tens OF										
"0: EXIT(TextUnits(Units,Masc));"										
1: CASE Units OF										
0: EXIT(Text10722);										
1: EXIT(Text10723);										
2: EXIT(Text10724);										
3: EXIT(Text10725);										
4: EXIT(Text10726);										
5: EXIT(Text10727);										
ELSE										
"EXIT(Text10728 + TextUnits(Units,Masc));"										
END;										
2: IF Units = 0 THEN										
EXIT(Text10729)										
ELSE										
"EXIT(Text10730 + TextUnits(Units,Masc));"										
3: IF Units = 0 THEN										
EXIT(Text10731)										
ELSE										
"EXIT(Text10732 + TextUnits(Units,Masc));"										
4: IF Units = 0 THEN										
EXIT(Text10733)										
ELSE										
"EXIT(Text10734 + TextUnits(Units,Masc));"										
5: IF Units = 0 THEN										
EXIT(Text10735)										
ELSE										
"EXIT(Text10736 + TextUnits(Units,Masc));"										
6: IF Units = 0 THEN										
EXIT(Text10737)										
ELSE										
"EXIT(Text10738 + TextUnits(Units,Masc));"										
7: IF Units = 0 THEN										
EXIT(Text10739)										
ELSE										
"EXIT(Text10740 + TextUnits(Units,Masc));"										
8: IF Units = 0 THEN										
EXIT(Text10741)										
ELSE										
"EXIT(Text10742 + TextUnits(Units,Masc));"										
9: IF Units = 0 THEN										
EXIT(Text10743)										
ELSE										
"EXIT(Text10744 + TextUnits(Units,Masc));"										
END;										
END;										
										
PROCEDURE TextUnits@1000000012(Units@1000000001 : Integer;Masc@1000000000 : Boolean) : Text[250];										
BEGIN										
										
CASE Units OF										
0: EXIT('');										
1: IF Masc THEN										
EXIT(Text10745)										
ELSE										
EXIT(Text10746);										
2: EXIT(Text10747);										
3: EXIT(Text10748);										
4: EXIT(Text10749);										
5: EXIT(Text10750);										
6: EXIT(Text10751);										
7: EXIT(Text10752);										
8: EXIT(Text10753);										
9: EXIT(Text10754);										
END;										
END;										
										
PROCEDURE TextNoDecimals@1000000013(NoDecimals@1000000000 : Integer) : Text[15];										
BEGIN										
										
IF Decimals > 1 THEN										
CASE NoDecimals OF										
0: EXIT('');										
1: EXIT(Text10755);										
2: EXIT(Text10756);										
3: EXIT(Text10757);										
4: EXIT(Text10758);										
END										
ELSE										
CASE NoDecimals OF										
0: EXIT('');										
1: EXIT(Text10759);										
2: EXIT(Text10760);										
3: EXIT(Text10761);										
4: EXIT(Text10762);										
END;										
END;										
										
PROCEDURE FormatNoText1@1000000014(NoText@1000000000 : ARRAY [2] OF Text[75];No@1000000001 : Decimal);										
VAR										
ImpriExponent@1000000002 : Boolean;										
Udades@1000000003 : Integer;										
Decenas@1000000004 : Integer;										
Centenas@1000000005 : Integer;										
Exponente@1000000006 : Integer;										
NoTextInd@1000000007 : Integer;										
PosicionDecimal@1000000008 : Integer;										
Decimales@1000000009 : Text[30];										
BEGIN										
										
CLEAR(NoText);										
CLEAR(TextImporteCheque);										
TextImporteCheque:=FORMAT(No);										
NoTextInd := 1;										
										
IF No > 999999999 THEN										
"ERROR('%1 es demasiado grande para convertir a texto',No);"										
										
"IF ROUND(No,1,'<') = 0 THEN"										
"AddToNoText(NoText,NoTextInd,'CERO');"										
										
"CentenaMillom := ROUND(No,1,'<') DIV 100000000;"										
"Recordar := ROUND(No,1,'<') MOD 100000000;"										
DecenaMilon := Recordar DIV 10000000;										
Recordar := Recordar MOD 10000000;										
UdadMillon := Recordar DIV 1000000;										
Recordar := Recordar MOD 1000000;										
CentenaMiles := Recordar DIV 100000;										
Recordar := Recordar MOD 100000;										
DecenaMiles := Recordar DIV 10000;										
Recordar := Recordar MOD 10000;										
UdadsMiles := Recordar DIV 1000;										
Recordar := Recordar MOD 1000;										
Centenas := Recordar DIV 100;										
Recordar := Recordar MOD 100;										
Decenas := Recordar DIV 10;										
Cantidades := Recordar MOD 10;										
"NroDecimales := STRLEN(FORMAT(No,1,'<decimals>'));"										
//IF NroDecimales >0 THEN										
//  NroDecimales := NroDecimales - 1;										
										
"AddToNoText(NoText,NoTextInd,TextoCentenasMillon(CentenaMillom,DecenaMilon,UdadMillon,TRUE));"										
"AddToNoText(NoText,NoTextInd,TextoDecenasMillon(CentenaMillom,DecenaMilon,UdadMillon,TRUE));"										
"AddToNoText(NoText,NoTextInd,TextoCientosMIles(CentenaMiles,DecenaMiles,UdadsMiles,FALSE));"										
"AddToNoText(NoText,NoTextInd,TextoDecenasMiles(CentenaMiles,DecenaMiles,UdadsMiles,FALSE));"										
"AddToNoText(NoText,NoTextInd,TextoCentenas(Centenas,Decenas,Cantidades,FALSE));"										
"AddToNoText(NoText,NoTextInd,TextDecenasUdads(Decenas,Cantidades,FALSE));"										
										
Longitud := STRLEN(TextImporteCheque);										
"PosicionDecimal:=STRPOS(TextImporteCheque,'.');"										
IF PosicionDecimal = 0 THEN Decimales := '00' ELSE										
"Decimales:=COPYSTR(TextImporteCheque,PosicionDecimal+1,Longitud-PosicionDecimal);"										
IF STRLEN(Decimales)=1 THEN										
Decimales:=Decimales+'0';										
										
//CSPNT150116										
"AddToNoText(NoText,NoTextInd,'');"										
//CSPNT150116										
vDecimalesTextoFactura := 'CON ' + Decimales +'/100';										
END;										
										
PROCEDURE TextoCentenasMillon@1000000015(Centenas@1000000000 : Integer;Decena@1000000001 : Integer;Cantidades@1000000002 : Integer;M	asc	@10	0	0	003 : Boolean) : Text[250];					
BEGIN										
										
IF Centenas <> 0 THEN										
"EXIT(TextoCentenas(Centenas,Decena,Cantidades,TRUE));"										
END;										
										
PROCEDURE TextoDecenasMillon@1000000016(Centenas@1000000003 : Integer;Decena@1000000002 : Integer;Cantidades@1000000001 : Integer;Ma	sc@	100	0	0	00 : Boolean) : Text[250];					
BEGIN										
										
IF (Centenas <> 0) AND (Decena = 0) AND (Cantidades = 0) THEN										
EXIT('MILLONES ');										
IF (Centenas = 0) AND (Decena = 0) AND (Cantidades = 1) THEN										
EXIT('UN MILLON ');										
IF (Decena <> 0) OR (Cantidades <> 0) THEN										
"EXIT(TextDecenasUdads(Decena,Cantidades,Masc) + 'MILLONES ');"										
END;										
										
PROCEDURE TextoCientosMIles@1000000017(Centenas@1000000003 : Integer;Decena@1000000002 : Integer;Cantidades@1000000001 : Integer;Mas	c@1	0	0	0	0 : Boolean) : Text[250];					
BEGIN										
										
IF Centenas <> 0 THEN										
"EXIT(TextoCentenas(Centenas,Decena,Cantidades,Masc))"										
END;										
										
PROCEDURE TextoDecenasMiles@1000000018(Centenas@1000000003 : Integer;Decena@1000000002 : Integer;Cantidades@1000000001 : Integer;Mas	c@1	0	0	0	0 : Boolean) : Text[250];					
BEGIN										
										
IF (Centenas <> 0) AND (Decena = 0) AND (Cantidades = 0) THEN										
EXIT('MIL ');										
IF (Centenas = 0) AND (Decena = 0) AND (Cantidades = 1) THEN										
EXIT('MIL ');										
IF (Decena <> 0) OR (Cantidades <> 0) THEN										
"EXIT(TextDecenasUdads(Decena,Cantidades,Masc) + 'MIL ');"										
END;										
										
PROCEDURE TextoCentenas@1000000019(Centenas@1000000003 : Integer;Decena@1000000002 : Integer;Cantidades@1000000001 : Integer;Masc@10	0	0	0	:	Boolean) : Text[250];					
BEGIN										
										
IF Centenas = 0 THEN										
EXIT('');										
IF Masc THEN										
CASE Centenas OF										
1: IF (Decenas = 0) AND (Cantidades = 0) THEN										
EXIT('CIEN ')										
ELSE										
EXIT('CIENTO ');										
2: EXIT('DOSCIENTOS ');										
3: EXIT('TRESCIENTOS ');										
4: EXIT('CUATROCIENTOS ');										
5: EXIT('QUINIENTOS ');										
6: EXIT('SEISCIENTOS ');										
7: EXIT('SETECIENTOS ');										
8: EXIT('OCHOCIENTOS ');										
9: EXIT('NOVECIENTOS ');										
END										
ELSE										
CASE Centenas OF										
1: IF (Decenas = 0) AND (Cantidades = 0) THEN										
EXIT('CIEN ')										
ELSE										
EXIT('CIENTO ');										
2: EXIT('DOSCIENTOS ');										
3: EXIT('TRESCIENTOS ');										
4: EXIT('CUATROCIENTOS ');										
5: EXIT('QUINIENTOS ');										
6: EXIT('SEISCIENTOS ');										
7: EXIT('SETECIENTOS ');										
8: EXIT('OCHOCIENTOS ');										
9: EXIT('NOVECIENTOS ');										
END;										
END;										
										
PROCEDURE TextDecenasUdads@1000000020(Decenas@1000000002 : Integer;Cantidades@1000000001 : Integer;Masc@1000000000 : Boolean) : Text	[25	0];								
BEGIN										
										
CASE Decenas OF										
"0: EXIT(TextoUdads(Cantidades,Masc));"										
1: CASE Cantidades OF										
0: EXIT('DIEZ ');										
1: EXIT('ONCE ');										
2: EXIT('DOCE ');										
3: EXIT('TRECE ');										
4: EXIT('CATORCE ');										
5: EXIT('QUINCE ');										
ELSE										
"EXIT('DIECI' + TextoUdads(Cantidades,Masc));"										
END;										
2: IF Cantidades = 0 THEN										
EXIT('VEINTE ')										
ELSE										
"EXIT('VEINTI' + TextoUdads(Cantidades,Masc));"										
3: IF Cantidades = 0 THEN										
EXIT('TREINTA ')										
ELSE										
"EXIT('TREINTA Y ' + TextoUdads(Cantidades,Masc));"										
4: IF Cantidades = 0 THEN										
EXIT('CUARENTA ')										
ELSE										
"EXIT('CUARENTA Y ' + TextoUdads(Cantidades,Masc));"										
5: IF Cantidades = 0 THEN										
EXIT('CINCUENTA ')										
ELSE										
"EXIT('CINCUENTA Y ' + TextoUdads(Cantidades,Masc));"										
6: IF Cantidades = 0 THEN										
EXIT('SESENTA ')										
ELSE										
"EXIT('SESENTA Y ' + TextoUdads(Cantidades,Masc));"										
7: IF Cantidades = 0 THEN										
EXIT('SETENTA ')										
ELSE										
"EXIT('SETENTA Y ' + TextoUdads(Cantidades,Masc));"										
8: IF Cantidades = 0 THEN										
EXIT('OCHENTA ')										
ELSE										
"EXIT('OCHENTA Y ' + TextoUdads(Cantidades,Masc));"										
9: IF Cantidades = 0 THEN										
EXIT('NOVENTA ')										
ELSE										
"EXIT('NOVENTA Y ' + TextoUdads(Cantidades,Masc));"										
END;										
END;										
										
PROCEDURE TextoUdads@1000000021(Cantidades@1000000001 : Integer;Masc@1000000000 : Boolean) : Text[250];										
BEGIN										
										
CASE Cantidades OF										
0: EXIT('');										
1: IF Masc THEN										
EXIT('UN ')										
ELSE										
EXIT('UNO ');										
2: EXIT('DOS ');										
3: EXIT('TRES ');										
4: EXIT('CUATRO ');										
5: EXIT('CINCO ');										
6: EXIT('SEIS ');										
7: EXIT('SIETE ');										
8: EXIT('OCHO ');										
9: EXIT('NUEVE ');										
END;										
END;										
										
PROCEDURE AddToNoText@1000000022(NoText@1000000000 : ARRAY [2] OF Text[75];NoTextInd@1000000001 : Integer;SumaTexto@1000000002 : Tex	t[3	0])	;							
BEGIN										
										
WHILE STRLEN(NoText[NoTextInd] + SumaTexto) > MAXSTRLEN(NoText[1]) DO BEGIN										
NoTextInd := NoTextInd + 1;										
IF NoTextInd > ARRAYLEN(NoText) THEN										
"ERROR('%1 \ es un n£mero demasiado largo.',SumaTexto);"										
END;										
										
"TotFac:=DELCHR(TotFac + SumaTexto,'<');"										
"NoText[NoTextInd] := DELCHR(NoText[NoTextInd] + SumaTexto,'<');"										
END;										
										
PROCEDURE DiaATexto@1000000023(num@1000000000 : Integer) : Text[50];										
BEGIN										
										
CASE num OF										
1:00										
EXIT('uno');										
2:00										
EXIT('dos');										
3:00										
EXIT('tres');										
4:00										
EXIT('cuatro');										
5:00										
EXIT('cinco');										
6:00										
EXIT('seis');										
7:00										
EXIT('siete');										
8:00										
EXIT('ocho');										
9:00										
EXIT('nueve');										
10:00										
EXIT('diez');										
11:00										
EXIT('once');										
12:00										
EXIT('doce');										
13:00										
EXIT('trece');										
14:00										
EXIT('catorce');										
15:00										
EXIT('quince');										
16:00										
EXIT('dieciseis');										
17:00										
EXIT('diecisiete');										
18:00										
EXIT('dieciocho');										
19:00										
EXIT('diecinueve');										
20:00										
EXIT('veinte');										
21:00										
EXIT('veintiuno');										
22:00										
EXIT('veintidos');										
23:00										
EXIT('veintitres');										
24:00:00										
EXIT('veinticuatro');										
25:00:00										
EXIT('veinticinco');										
26:00:00										
EXIT('veintiseis');										
27:00:00										
EXIT('veintisiete');										
28:00:00										
EXIT('veintiocho');										
29:00:00										
EXIT('veintinueve');										
30:00:00										
EXIT('treinta');										
31:00:00										
EXIT('treinta y uno');										
END;										
END;										
										
PROCEDURE PrintXZReportSV@1000000000(DoZ@1000000000 : Boolean) : Boolean;										
VAR										
Staff@1000000001 : Record 99001461;										
Terminal@1000000002 : Record 99001471;										
SCode@1000000003 : Code[20];										
Transaction@1000000004 : Record 99001472;										
DSTR1@1000000005 : Text[80];										
TextEncXParcial@1000000006 : TextConst 'ENU=<XXXXXXXXX CORTE X PARCIAL XXXXXXXXX>;ESN=CORTE X PARCIAL';										
TextEncZParcial@1000000007 : TextConst 'ENU=<ZZZZZZZZZZZZZ CORTE Z ZZZZZZZZZZZZZ>';										
TextNRC@1000000008 : TextConst 'ENU=NRC.';										
TextRNC@1000000009 : TextConst 'ENU=NIT';										
TextGIRO@1000000010 : TextConst 'ENU=GIRO';										
TextCodTienda@1000000011 : TextConst 'ENU=Cod.Tienda:';										
TextCaja@1000000012 : TextConst 'ENU=Caja:';										
DSTR2@1000000072 : Text;										
rCompanyInfo@1000000013 : Record 79;										
rNoSeries@1000000014 : Record 308;										
rNoSeriesLn@1000000015 : Record 309;										
Transaction2@1000000016 : Record 99001472;										
PaymTrans3@1000000017 : Record 99001474;										
RemoveTotal@1000000018 : Decimal;										
FloatTotal@1000000019 : Decimal;										
FirstTicket@1000000020 : Code[20];										
LastTicket@1000000021 : Code[20];										
Venta@1000000022 : Decimal;										
Iva@1000000023 : Decimal;										
vTotal@1000000024 : Decimal;										
rSalesEntry@1000000025 : Record 99001473;										
rImpuestos@1000000026 : Record 50005;										
VentasG@1000000027 : Decimal;										
VentasE@1000000028 : Decimal;										
VentasNoSu@1000000029 : Decimal;										
TotalIva@1000000030 : Decimal;										
TotalVentNcr@1000000031 : Decimal;										
TotalIvaNcr@1000000032 : Decimal;										
VentasEDev@1000000033 : Decimal;										
VentasNoSuDev@1000000034 : Decimal;										
Percepcion@1000000035 : Decimal;										
Retencion@1000000036 : Decimal;										
PercepcionDev@1000000037 : Decimal;										
RetencionDev@1000000038 : Decimal;										
Percibido@1000000039 : Decimal;										
Retenido@1000000040 : Decimal;										
Correlativo@1000000041 : Integer;										
TmpTender@1000000042 : Record 50004;										
rTenderTypeSetup@1000000043 : Record 99001466;										
rTransPaymentEntry@1000000044 : Record 99001474;										
VFondoFijo@1000000045 : Decimal;										
VRetiroEfectivo@1000000046 : Decimal;										
VEfectivoRetiro@1000000047 : Decimal;										
VTarjetaManualRetiro@1000000048 : Decimal;										
VTarjetaRetiro@1000000049 : Decimal;										
vChequeRetiro@1000000050 : Decimal;										
VCreditoRetiro@1000000051 : Decimal;										
VLealtadRetiro@1000000052 : Decimal;										
VTarjetaRegaloRetiro@1000000053 : Decimal;										
IncExpAccount@1000000054 : Record 99001476;										
IncExpEntry@1000000055 : Record 99001475;										
PaymTemp@1000000056 : Record 99001474;										
RecCount@1000000057 : Integer;										
SuspTrans@1000000058 : Record 99008980;										
NoSuspended@1000000059 : Integer;										
NoSuspPrepayment@1000000060 : Integer;										
SuspPrepayment@1000000061 : Integer;										
SuspTransLine@1000000062 : Record 99008981;										
ZReportID@1000000063 : Code[10];										
TransServerWorkTable@1000000064 : Record 99001615;										
TransNotSent@1000000065 : Integer;										
PaymTrans2@1000000066 : Record 99001474;										
TendDeclEntry2@1000000067 : Record 99001465;										
IncExpEntry2@1000000068 : Record 99001475;										
Transaction3@1000000069 : Record 99001472;										
NoCorrelativoXZ@1000000070 : Code[20];										
ZReportHist@1000000071 : Record 50006;										
FirstFactCrf@1000000073 : Code[20];										
LastFactCrf@1000000074 : Code[20];										
FirstFactCf@1000000075 : Code[20];										
LastFactCf@1000000076 : Code[20];										
BEGIN										
										
//PrintXZReport										
IF NOT Staff.GET(Globals.StaffID) THEN										
EXIT(TRUE);										
IF NOT Terminal.GET(Globals.TerminalNo) THEN										
EXIT(TRUE);										
										
"IF NOT OpenReceiptPrinter(2, 'TENDER', 'ZXREPORT', 0, '') THEN"										
EXIT(FALSE);										
										
"IF NOT Terminal.""Terminal Statement"" THEN"										
"Terminal.""Statement Method"" := Store.""Statement Method"";"										
										
SCode := POSFunctions.GetStatementCode;										
										
Transaction.Date := TODAY;										
Transaction.Time := TIME;										
										
//CONSISA ENCABEZADO....										
DSTR1 := '#C######################################';										
IF DoZ THEN										
Value[1]:= TextEncZParcial										
ELSE										
Value[1]:= TextEncXParcial;										
										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//Imprimir Linea en blanco...										
"DSTR1 :=     COPYSTR('                     ',1);"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//CONSISA IMPRIMIR DATOS FECHA ENCABEZADO PARA REPORTE X										
//IF NOT DoZ THEN BEGIN //CSRM19092013										
DSTR1 := '#L######################################';										
"Value[1] := 'Fecha: ' + FORMAT(TODAY,0,'<Day,2>/<Month,2>/<Year4>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
DSTR1 := '#L######################################';										
"Value[1] := 'Hora: ' + FORMAT(TIME(),0,'<Hours12>:<Minutes,2><AM/PM>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
//END;     //CSRM19092013										
										
//Imprimir Linea en blanco...										
"DSTR1 :=     COPYSTR('                     ',1);"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//CONSISA-Imprimir Nombre de la empresa...										
rCompanyInfo.GET();										
"DSTR1 := COPYSTR('#C######################################',1);"										
Value[1] := rCompanyInfo.Name;										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//CONSISA-Imprimir Codigo Tipo Contribuyente y  No. Reg. Contribuyente de la empresa...										
rCompanyInfo.GET();										
"DSTR1 := COPYSTR('#C######################################',1);"										
"Value[1] := rCompanyInfo.""Tipo de Contibuyente"" + ' ' + TextNRC + ' ' + rCompanyInfo.NRC;"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//CONSISA-Imprimir NIT de la empresa...										
rCompanyInfo.GET();										
"DSTR1 := COPYSTR('#C######################################',1);"										
"Value[1] := TextRNC + ' ' + rCompanyInfo.""VAT Registration No."";"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//CONSISA-Imprimir Giro de la empresa...										
rCompanyInfo.GET();										
"DSTR1 := COPYSTR('#C######################################',1);"										
Value[1] := TextGIRO + ':' + rCompanyInfo.Giro;										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//Imprimir Linea en blanco...										
"DSTR1 :=     COPYSTR('                     ',1);"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//CONSISA-Imprimir Nombre de la tienda.										
"DSTR1 := COPYSTR('#L######################################',1);"										
Value[1] := Store.Name;										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//CONSISA-Imprimir 1era. direccion de la tienda.										
"DSTR1 := COPYSTR('#L######################################',1);"										
Value[1] := Store.Address;										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//CONSISA-Imprimir 2da. direccion de la tienda.										
"IF Store.""Address 2"" <> '' THEN BEGIN"										
"DSTR1 := COPYSTR('#L######################################',1);"										
"Value[1] := Store.""Address 2"";"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
										
//CONSISA-Imprimir el No. de la Caja..										
"DSTR1 := COPYSTR('#L################## #R#################',1);"										
"Value[1] := TextCodTienda + ' ' + Store.""No."";"										
"Value[2] := TextCaja + ' ' + Terminal.""No."";"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
rNoSeries.RESET;										
"IF rNoSeries.GET(Terminal.""No. Serie NCF Ticket"") THEN BEGIN"										
rNoSeriesLn.RESET;										
"rNoSeriesLn.SETRANGE(""Series Code"",rNoSeries.Code);"										
IF rNoSeriesLn.FINDFIRST THEN BEGIN										
"DSTR1 := COPYSTR('#L######################################',1);"										
Value[1] := 'Autorizacion Fiscal: ' + ' ' + UPPERCASE(rNoSeriesLn.Autorizacion);										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//CONSISA-Imprimir el rango de ticket..										
"DSTR1 := COPYSTR('#L################# #R##################',1);"										
"Value[1] := 'Del ' + rNoSeriesLn.""Starting No."";"										
"Value[2] := 'al  ' + rNoSeriesLn.""Ending No."";"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
END;										
										
IF NOT DoZ THEN BEGIN										
//Imprimir Linea en blanco...										
"DSTR1 :=     COPYSTR('                     ',1);"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//CONSISA-Toma el correlativo de la misma serie de Ticket										
"DSTR1 := COPYSTR('#C######################################',1);"										
"Value[1] := 'Corte X No.: ' + INCSTR(Terminal.""Last X-Report"");"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
										
//CSRM19092013										
{										
//CONSISA-Toma el correlativo de la misma serie de Ticket										
"DSTR1 := COPYSTR('#L######################################',1);"										
"NoCorrelativoXZ := cNoSeriesMgt.GetNextNo(Terminal.""No. Serie NCF Ticket"",TODAY,TRUE);"										
Value[1] := 'Correlativo Fiscal: ' + NoCorrelativoXZ;										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
}										
										
IF DoZ THEN BEGIN										
//Imprimir Linea en blanco...										
"DSTR1 :=     COPYSTR('                     ',1);"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//CONSISA-Corte No.:										
"DSTR1 := COPYSTR('#C######################################',1);"										
"//Value[1] := 'Corte Z No.: ' + COPYSTR(INCSTR(Terminal.""Last Z-Report""),2);"										
"Value[1] := 'Corte Z No.: ' + INCSTR(Terminal.""Last Z-Report""); //CSRM19092013"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//CSRM19092013										
{										
//CONSISA-Corte No.:										
"DSTR1 := COPYSTR('#L###############   #R##################',1);"										
Value[1] := 'CORTE Z DIARIO:';										
"Value[2] := 'Hora:' + FORMAT(TIME(),0,'<Hours12>:<Minutes,2><AM/PM>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
}										
										
//Imprimir Linea en blanco...										
"DSTR1 :=     COPYSTR('                     ',1);"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//Modificado por Consisa para que se imprima la ultima fecha de las transacciones encontradas										
Transaction2.RESET;										
"//TransactionHeader.SETCURRENTKEY(""Statement Code"",""Z-Report ID"",""Transaction Type"",""Entry Status"");  //CS06032013"										
Transaction2.SETCURRENTKEY(Date);										
"Transaction2.SETRANGE(""Statement Code"",SCode);"										
"Transaction2.SETRANGE(""Z-Report ID"",'');"										
"Transaction2.SETFILTER(""Entry Status"",'%1|%2',Transaction2.""Entry Status""::"" "",Transaction2.""Entry Status""::Posted);"										
IF  Transaction2.FINDLAST THEN BEGIN										
DSTR1 :='#L####################';										
"Value[1] := 'Fecha:' + FORMAT(Transaction2.Date,0,'<Day,2>/<Month,2>/<Year4>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
END;										
										
"IF GenPosFunc.""TS Floating Cashier"" AND"										
"(Terminal.""Statement Method"" = Terminal.""Statement Method""::Staff) AND"										
(Globals.GetValue('TS_ERROR') <> '') THEN BEGIN										
										
END;										
										
CLEAR(PaymEntry);										
"PaymEntry.SETCURRENTKEY(""Statement Code"",""Z-Report ID"",""Tender Type"",""Currency Code"",""Card No."");"										
"PaymEntry.SETRANGE(""Statement Code"",SCode);"										
"PaymEntry.SETRANGE(""Z-Report ID"",'');"										
PaymTrans3.COPYFILTERS(PaymEntry);										
										
"TenderType.SETCURRENTKEY(""Store No."");"										
"TenderType.SETRANGE(""Store No."",Globals.StoreNo);"										
"TenderType.SETFILTER(TenderType.""Function"",'<>%1',TenderType.""Function""::""Tender Remove/Float"");"										
"TenderType.SETRANGE(""Foreign Currency"",FALSE);"										
LocalTotal := 0;										
"TenderType.SETRANGE(""Foreign Currency"",TRUE);"										
LocalTotal := 0;										
										
"TenderType.SETRANGE(""Foreign Currency"");"										
"TenderType.SETRANGE(TenderType.""Function"",TenderType.""Function""::""Tender Remove/Float"");"										
IF TenderType.FIND('-') THEN BEGIN										
REPEAT										
"PaymEntry.SETRANGE(""Currency Code"");"										
"PaymEntry.SETRANGE(""Card No."");"										
"PaymEntry.SETRANGE(""Tender Type"",TenderType.Code);"										
IF PaymEntry.FIND('-') THEN										
REPEAT										
"Transaction.GET(PaymEntry.""Store No."",PaymEntry.""POS Terminal No."",PaymEntry.""Transaction No."");"										
"CASE Transaction.""Transaction Type"" OF"										
"Transaction.""Transaction Type""::""Remove Tender"" : RemoveTotal := RemoveTotal + PaymEntry.""Amount Tendered"";"										
"Transaction.""Transaction Type""::""Float Entry"" : FloatTotal := FloatTotal + PaymEntry.""Amount Tendered"";"										
END;										
UNTIL PaymEntry.NEXT = 0;										
UNTIL TenderType.NEXT = 0;										
END;										
										
"Transaction.""Transaction No."" := 0;"										
"TendDeclEntry.SETCURRENTKEY(""Statement Code"",""Z-Report ID"",""Tender Type"",""Currency Code"",""Card No."");"										
"TendDeclEntry.SETRANGE(""Statement Code"",SCode);"										
"TendDeclEntry.SETRANGE(""Z-Report ID"",'');"										
"IF Store.""Tend. Decl. Calculation"" = Store.""Tend. Decl. Calculation""::Sum THEN BEGIN"										
BufferTendDeclEntry;										
IF TendDeclEntry.FIND('-') THEN										
"Transaction.""Transaction No."" := TendDeclEntry.""Transaction No."";"										
END										
ELSE BEGIN										
IF TendDeclEntry.FIND('-') THEN										
REPEAT										
"IF TendDeclEntry.""Transaction No."" > Transaction.""Transaction No."" THEN"										
"Transaction.GET(TendDeclEntry.""Store No."",TendDeclEntry.""POS Terminal No."",TendDeclEntry.""Transaction No."")"										
UNTIL TendDeclEntry.NEXT=0;										
END;										
										
"IF Transaction.""Transaction No."" <> 0 THEN BEGIN"										
CLEAR(TendDeclEntry);										
LocalTotal := 0;										
"IF Store.""Tend. Decl. Calculation"" = Store.""Tend. Decl. Calculation""::Last THEN BEGIN"										
"TendDeclEntry.SETCURRENTKEY(""Store No."",""POS Terminal No."",""Transaction No."");"										
"TendDeclEntry.SETRANGE(""Store No."",Transaction.""Store No."");"										
"TendDeclEntry.SETRANGE(""POS Terminal No."",Transaction.""POS Terminal No."");"										
"TendDeclEntry.SETRANGE(""Transaction No."",Transaction.""Transaction No."");"										
BufferTendDeclEntry;										
END;										
"TempTendDeclEntry.SETFILTER(""Currency Code"",'=%1','');"										
"Transaction.""Gross Amount"" := -LocalTotal;"										
"TempTendDeclEntry.SETFILTER(""Currency Code"",'<>%1','');"										
END;										
										
//CONSISA BUSCO LOS TICKETS Y LAS DEVOLUCIONES PARA EL REPORTE X...										
IF NOT DoZ THEN BEGIN										
//CSRM19092013										
//Imprimir Linea en blanco...										
"DSTR1 :=     COPYSTR('                     ',1);"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
Transaction2.RESET;										
"Transaction2.SETCURRENTKEY(""Statement Code"",""Z-Report ID"",""Transaction Type"",""Entry Status"");"										
"Transaction2.SETRANGE(""Statement Code"",SCode);"										
"Transaction2.SETRANGE(""Z-Report ID"",'');"										
"Transaction2.SETRANGE(""Transaction Type"",Transaction2.""Transaction Type""::Sales);"										
"Transaction2.SETFILTER(""Entry Status"",'%1|%2',Transaction2.""Entry Status""::"" "",Transaction2.""Entry Status""::Posted);"										
"Transaction2.SETRANGE(""No. Serie NCF"",Terminal.""No. Serie NCF Ticket"");"										
IF  Transaction2.FINDLAST THEN BEGIN										
DSTR1 := '#L######################################';										
"Value[1] := 'Fecha:' + FORMAT(Transaction2.Date,0,'<Day,2>/<Month,2>/<Year4>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
//CSRM19092013										
										
//ENCABEZADO PARA EL TIPO DE COMPROBANTE										
"DSTR1 := COPYSTR('#C############################',1);"										
Value[1] := '1- Ticket de Consumidor Final';										
//CSPNT231015										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
										
DSTR1 :='#L###         #R###       #R#      #R###';										
Value[1] := 'Folio';										
Value[2] := 'Venta';										
Value[3] := 'IVA';										
Value[4] := 'Total';										
										
Transaction2.RESET;										
"Transaction2.SETCURRENTKEY(""Statement Code"",""Z-Report ID"",""Transaction Type"",""Entry Status"");"										
"Transaction2.SETRANGE(""Statement Code"",SCode);"										
"Transaction2.SETRANGE(""Z-Report ID"",'');"										
"Transaction2.SETRANGE(""Transaction Type"",Transaction2.""Transaction Type""::Sales);"										
"Transaction2.SETFILTER(""Entry Status"",'%1|%2',Transaction2.""Entry Status""::"" "",Transaction2.""Entry Status""::Posted);"										
"Transaction2.SETRANGE(""No. Serie NCF"",Terminal.""No. Serie NCF Ticket"");"										
IF Transaction2.FINDFIRST THEN BEGIN										
rNoSeries.RESET;										
"IF rNoSeries.GET(Terminal.""No. Serie NCF Ticket"") THEN BEGIN"										
rNoSeriesLn.RESET;										
"rNoSeriesLn.SETRANGE(""Series Code"",rNoSeries.Code);"										
IF rNoSeriesLn.FINDFIRST THEN BEGIN										
"DSTR1 := COPYSTR('#L######################################',1);"										
Value[1] := 'Autorizacion: ' + UPPERCASE(rNoSeriesLn.Autorizacion);										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
//CONSISA-Imprimir el rango de ticket..										
"DSTR1 := COPYSTR('#L#################  #R#################',1);"										
"Value[1] := 'Del ' + rNoSeriesLn.""Starting No."";"										
"Value[2] := 'al  ' + rNoSeriesLn.""Ending No."";"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
END;										
FirstTicket := Transaction2.NCF;										
REPEAT										
//IMPRIMO EL NO. DE TICKET										
"IF NOT Transaction2.""Sale Is Return Sale"" THEN"										
DSTR1 := '#L######## #R######   #R#####  #R#######'										
ELSE										
DSTR1 := '#L########  #R######   #R#####  #R#######';										
										
Value[1] := Transaction2.NCF;										
										
CLEAR(Venta);										
CLEAR(Iva);										
CLEAR(vTotal);										
										
"rSalesEntry.SETRANGE(""Store No."",Transaction2.""Store No."");"										
"rSalesEntry.SETRANGE(""POS Terminal No."",Transaction2.""POS Terminal No."");"										
"rSalesEntry.SETRANGE(""Transaction No."",Transaction2.""Transaction No."");"										
IF rSalesEntry.FIND('-') THEN										
REPEAT										
rImpuestos.RESET;										
"rImpuestos.SETRANGE(""VAT Bus. Posting Group"",rSalesEntry.""VAT Bus. Posting Group"");"										
"rImpuestos.SETRANGE(""VAT Prod. Posting Group"",rSalesEntry.""VAT Prod. Posting Group"");"										
IF rImpuestos.FINDFIRST THEN BEGIN										
"Venta    += ABS(rSalesEntry.""Net Amount"");"										
"Iva      += ABS(rSalesEntry.""VAT Amount"");"										
"vTotal   += ABS(rSalesEntry.""Net Amount"") + ABS(rSalesEntry.""VAT Amount"");"										
IF rImpuestos.Impuesto=rImpuestos.Impuesto::Gravado THEN BEGIN										
"IF NOT Transaction2.""Sale Is Return Sale"" THEN BEGIN"										
"VentasG  += ABS(rSalesEntry.""Net Amount"");"										
"TotalIva += ABS(rSalesEntry.""VAT Amount"");"										
END										
ELSE BEGIN										
"TotalVentNcr += ABS(rSalesEntry.""Net Amount"");"										
"TotalIvaNcr  += ABS(rSalesEntry.""VAT Amount"");"										
END;										
END										
ELSE BEGIN										
IF rImpuestos.Impuesto=rImpuestos.Impuesto::Exento THEN BEGIN										
"IF NOT Transaction2.""Sale Is Return Sale"" THEN"										
"VentasE  += ABS(rSalesEntry.""Net Amount"")"										
ELSE										
"VentasEDev  += ABS(rSalesEntry.""Net Amount"")"										
END										
"ELSE IF NOT Transaction2.""Sale Is Return Sale"" THEN"										
"VentasNoSu  += ABS(rSalesEntry.""Net Amount"")"										
ELSE										
"VentasNoSuDev  += ABS(rSalesEntry.""Net Amount"")"										
END										
END;										
UNTIL rSalesEntry.NEXT = 0;										
										
//CSRM16102013										
{										
"IF NOT Transaction2.""Sale Is Return Sale"" THEN BEGIN"										
"Value[2] := '$' + FORMAT(Venta,0,'<Integer Thousand><Decimals,3>');"										
"Value[3] := '$' + FORMAT(Iva,0,'<Integer Thousand><Decimals,3>');"										
"Value[4] := '$' + FORMAT(vTotal,0,'<Integer Thousand><Decimals,3>');"										
"//PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END										
ELSE BEGIN										
"Value[2] := '(' + '$' + FORMAT(Venta,0,'<Integer Thousand><Decimals,3>') + ')';"										
"Value[3] := '(' + '$' + FORMAT(Iva,0,'<Integer Thousand><Decimals,3>') + ')';"										
"Value[4] := '(' + '$' + FORMAT(vTotal,0,'<Integer Thousand><Decimals,3>') + ')';"										
"//PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
}										
//CSRM16102013										
LastTicket := Transaction2.NCF;										
UNTIL Transaction2.NEXT = 0;										
END;										
										
//CONSISA IMPRIMO LOS RANGOS DE TICKETS ENCONTRADOS EN EL REPORTE X										
//1er. Ticket.										
"DSTR1 := COPYSTR('#L######################################',1);"										
Value[1] := 'Del No.: ' + FirstTicket;										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//Ult. Ticket.										
"DSTR1 := COPYSTR('#L######################################',1);"										
Value[1] := 'Al  No.: ' + LastTicket;										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//Imprimir Linea en blanco...										
"DSTR1 :=     COPYSTR('                     ',1);"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//ENCABEZADO DE VENTAS TOTALES...										
"DSTR1 := COPYSTR('    #L#############',1);"										
Value[1] := 'VENTAS TOTALES:';										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
VentasG := VentasG - TotalVentNcr;										
										
//VENTAS GRAVADAS...										
"DSTR1 := COPYSTR('#L################    #R################',1);"										
Value[1] := 'Ventas Gravadas:';										
"Value[2] := '$' + FORMAT(VentasG,0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
TotalIva := TotalIva - TotalIvaNcr;										
										
//IMPUESTO IVA...										
"DSTR1 := COPYSTR('#L#############       #R################',1);"										
Value[1] := 'Impuesto IVA:';										
"Value[2] := '$' + FORMAT(TotalIva,0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//Total Gravado...										
"DSTR1 := COPYSTR('#L##############      #R################',1);"										
Value[1] := 'Total Gravado:';										
"Value[2] := '$' + FORMAT(VentasG + TotalIva,0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//VENTAS EXENTAS...										
"DSTR1 := COPYSTR('#L###############     #R################',1);"										
Value[1] := 'Ventas Exentas:';										
"Value[2] := '$' + FORMAT((VentasE-VentasEDev),0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//VENTAS NO SUJETAS...										
"DSTR1 := COPYSTR('#L##################  #R################',1);"										
Value[1] := 'Ventas No Sujetas:';										
"Value[2] := '$' + FORMAT((VentasNoSu-VentasNoSuDev),0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//VENTAS TOTALES										
"DSTR1 := COPYSTR('#L###############     #R################',1);"										
Value[1] := 'Ventas Totales:';										
Value[2] := '$' + FORMAT((VentasG + TotalIva + VentasE + VentasNoSu)										
"-(VentasEDev+VentasNoSuDev),0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//Imprimir Linea en blanco...										
"DSTR1 :=     COPYSTR('                     ',1);"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
CLEAR(FirstTicket);										
CLEAR(LastTicket);										
CLEAR(Venta);										
CLEAR(Iva);										
CLEAR(vTotal);										
CLEAR(VentasG);										
CLEAR(TotalIva);										
CLEAR(TotalVentNcr);										
CLEAR(TotalIvaNcr);										
CLEAR(VentasE);										
CLEAR(VentasNoSu);										
CLEAR(VentasEDev);										
CLEAR(VentasNoSuDev);										
										
//ENCABEZADO PARA EL TIPO DE COMPROBANTE										
"DSTR1 := COPYSTR('#C############################',1);"										
Value[1] := '2- Comprobante de CrÇdito Fiscal';										
//CSPNT231015										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
										
DSTR1 :='#L###       #R###       #R#        #R###';										
Value[1] := 'Folio';										
Value[2] := 'Venta';										
Value[3] := 'IVA';										
Value[4] := 'Total';										
"//PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//CSRM16102013 Se quito que imprimiera los rango de facturas porq no es un solo pos en la tienda										
//CSPNT231015 Se agrego el rango de facturas										
rTransaction.RESET;										
"rTransaction.SETCURRENTKEY(""Statement Code"",""Z-Report ID"",""Transaction Type"",""Entry Status"");"										
"rTransaction.SETRANGE(""Statement Code"",SCode);"										
"rTransaction.SETRANGE(""Z-Report ID"",'');"										
"rTransaction.SETRANGE(""Transaction Type"",Transaction2.""Transaction Type""::Sales);"										
"rTransaction.SETFILTER(""Entry Status"",'%1|%2',Transaction2.""Entry Status""::"" "",Transaction2.""Entry Status""::Posted);"										
"rTransaction.SETRANGE(""No. Serie NCF"",Terminal.""No. Serie NCF Credito Fiscal"");"										
										
//CSRM16102013 Se quito que imprimiera los rango de facturas porq no es un solo pos en la tienda										
										
Transaction2.RESET;										
"Transaction2.SETCURRENTKEY(""Statement Code"",""Z-Report ID"",""Transaction Type"",""Entry Status"");"										
"Transaction2.SETRANGE(""Statement Code"",SCode);"										
"Transaction2.SETRANGE(""Z-Report ID"",'');"										
"Transaction2.SETRANGE(""Transaction Type"",Transaction2.""Transaction Type""::Sales);"										
"Transaction2.SETFILTER(""Entry Status"",'%1|%2',Transaction2.""Entry Status""::"" "",Transaction2.""Entry Status""::Posted);"										
//CSRM16102013										
"Transaction2.SETFILTER(""No. Serie NCF"",'%1|%2',Terminal.""No. Serie NCF Credito Fiscal"",Terminal.""No. Serie NCF Nota de Credito"")"	;									
"//Transaction2.SETRANGE(""No. Serie NCF"",Terminal.""No. Serie NCF Credito Fiscal"");"										
"//Transaction2.SETRANGE(""No. Serie NCF"",Terminal.""No. Serie NCF Nota de Credito"");"										
IF  Transaction2.FINDFIRST THEN BEGIN										
//CSPNT231015										
"//    DSTR1 := COPYSTR('#L######################################',1);"										
"//    Value[1] := 'Autorizaci¢n:' + ' ' + UPPERCASE(Store.""Cod. Aut. Fiscal CRF"");"										
"//    PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
rNoSeries.RESET;										
"IF rNoSeries.GET(Terminal.""No. Serie NCF Credito Fiscal"") THEN BEGIN"										
rNoSeriesLn.RESET;										
"rNoSeriesLn.SETRANGE(""Series Code"",rNoSeries.Code);"										
IF rNoSeriesLn.FINDFIRST THEN BEGIN										
"DSTR1 := COPYSTR('#L######################################',1);"										
Value[1] := 'Autorizacion:' + ' ' + UPPERCASE(FORMAT(rNoSeriesLn.Autorizacion));										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
END;										
//CSRM16102013 Se quito que imprimiera los rango de facturas porq no es un solo pos en la tienda										
										
IF rTransaction.FINDFIRST THEN BEGIN										
//CSPNT241015										
FirstTicket := Transaction2.NCF;										
END;										
										
//CSRM16102013 Se quito que imprimiera los rango de facturas porq no es un solo pos en la tienda										
										
REPEAT										
//IMPRIMO EL NO. DE TICKET										
"IF NOT Transaction2.""Sale Is Return Sale"" THEN"										
DSTR1 :='#L####### #R######   #R#####  #R######'										
ELSE										
DSTR1 :='#L#######  #R######   #R#####  #R######';										
										
"Value[1] := Transaction2.""Correlativo Facturas"";"										
										
CLEAR(Venta);										
CLEAR(Iva);										
CLEAR(vTotal);										
CLEAR(Percepcion);										
										
"rSalesEntry.SETRANGE(""Store No."",Transaction2.""Store No."");"										
"rSalesEntry.SETRANGE(""POS Terminal No."",Transaction2.""POS Terminal No."");"										
"rSalesEntry.SETRANGE(""Transaction No."",Transaction2.""Transaction No."");"										
IF rSalesEntry.FIND('-') THEN										
REPEAT										
rImpuestos.RESET;										
"rImpuestos.SETRANGE(""VAT Bus. Posting Group"",rSalesEntry.""VAT Bus. Posting Group"");"										
"rImpuestos.SETRANGE(""VAT Prod. Posting Group"",rSalesEntry.""VAT Prod. Posting Group"");"										
IF rImpuestos.FINDFIRST THEN BEGIN										
"Venta       += ABS(rSalesEntry.""Net Amount"");"										
"Iva         += ABS(rSalesEntry.""VAT Amount"");"										
"vTotal      += ABS(rSalesEntry.""Net Amount"") + ABS(rSalesEntry.""VAT Amount"");"										
										
"IF NOT Transaction2.""Sale Is Return Sale"" THEN"										
"Percepcion  += ABS(Transaction2.""Percepcion Amount"")"										
ELSE										
"PercepcionDev  += -(Transaction2.""Percepcion Amount"");"										
										
IF rImpuestos.Impuesto=rImpuestos.Impuesto::Gravado THEN BEGIN										
"IF NOT Transaction2.""Sale Is Return Sale"" THEN BEGIN"										
"VentasG  += ABS(rSalesEntry.""Net Amount"");"										
"TotalIva += ABS(rSalesEntry.""VAT Amount"");"										
END										
ELSE BEGIN										
"TotalVentNcr += ABS(rSalesEntry.""Net Amount"");"										
"TotalIvaNcr  += ABS(rSalesEntry.""VAT Amount"");"										
END;										
END										
ELSE BEGIN										
IF rImpuestos.Impuesto=rImpuestos.Impuesto::Exento THEN BEGIN										
"IF NOT Transaction2.""Sale Is Return Sale"" THEN"										
"VentasE  += ABS(rSalesEntry.""Net Amount"")"										
ELSE										
"VentasEDev  += ABS(rSalesEntry.""Net Amount"")"										
END										
"ELSE IF NOT Transaction2.""Sale Is Return Sale"" THEN"										
"VentasNoSu  += ABS(rSalesEntry.""Net Amount"")"										
ELSE										
"VentasNoSuDev  += ABS(rSalesEntry.""Net Amount"")"										
END										
END;										
UNTIL rSalesEntry.NEXT = 0;										
										
										
//CSRM16102013 Se quito que imprimiera los rango de facturas porq no es un solo pos en la tienda										
{										
"IF NOT Transaction2.""Sale Is Return Sale"" THEN BEGIN"										
"Value[2] := '$' + FORMAT(Venta,0,'<Integer Thousand><Decimals,3>');"										
"Value[3] := '$' + FORMAT(Iva,0,'<Integer Thousand><Decimals,3>');"										
"Value[4] := '$' + FORMAT(vTotal,0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END										
ELSE BEGIN										
"Value[2] := '(' + '$' + FORMAT(Venta,0,'<Integer Thousand><Decimals,3>') + ')';"										
"Value[3] := '(' + '$' + FORMAT(Iva,0,'<Integer Thousand><Decimals,3>') + ')';"										
"Value[4] := '(' + '$' + FORMAT(vTotal,0,'<Integer Thousand><Decimals,3>') + ')';"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
}										
//CSPNT241015 se agrego rango de facturas										
IF  rTransaction.FINDLAST THEN BEGIN										
LastTicket := rTransaction.NCF;										
END;										
										
//CSRM16102013 Se quito que imprimiera los rango de facturas porq no es un solo pos en la tienda										
UNTIL Transaction2.NEXT = 0;										
END;										
										
//CSRM16102013 Se quito que imprimiera los rango de facturas porq no es un solo pos en la tienda										
//CSPNT231015 Se agrego que imprima el rango de facturas										
//CONSISA IMPRIMO LOS RANGOS DE TICKETS ENCONTRADOS EN EL REPORTE X										
//1er. Ticket.										
"DSTR1 := COPYSTR('#L######################################',1);"										
Value[1] := 'Del No.: ' + FirstTicket;										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//2do. Ticket.										
"DSTR1 := COPYSTR('#L######################################',1);"										
Value[1] := 'Al No.: ' + LastTicket;										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//CSRM16102013 Se quito que imprimiera los rango de facturas porq no es un solo pos en la tienda										
										
//Imprimir Linea en blanco...										
"DSTR1 :=     COPYSTR('                     ',1);"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//ENCABEZADO DE VENTAS TOTALES...										
"DSTR1 := COPYSTR('    #L#############',1);"										
Value[1] := 'VENTAS TOTALES:';										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
VentasG := VentasG - TotalVentNcr;										
										
//VENTAS GRAVADAS...										
"DSTR1 := COPYSTR('#L################    #R################',1);"										
Value[1] := 'Ventas Gravadas:';										
"Value[2] := '$' + FORMAT(VentasG,0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
TotalIva := TotalIva - TotalIvaNcr;										
										
//IMPUESTO IVA...										
"DSTR1 := COPYSTR('#L#############       #R################',1);"										
Value[1] := 'Impuesto IVA:';										
"Value[2] := '$' + FORMAT(TotalIva,0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//Total Gravado...										
"DSTR1 := COPYSTR('#L##############      #R################',1);"										
Value[1] := 'Total Gravado:';										
"Value[2] := '$' + FORMAT(VentasG + TotalIva,0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
CLEAR(Percibido);										
//PERCEPCION...										
"DSTR1 := COPYSTR('#L################### #R################',1);"										
Value[1] := '(+) IVA Percibido:';										
"Value[2] := '$' + FORMAT(Percepcion-PercepcionDev,0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//VENTAS EXENTAS...										
"DSTR1 := COPYSTR('#L###############     #R################',1);"										
Value[1] := 'Ventas Exentas:';										
"Value[2] := '$' + FORMAT((VentasE-VentasEDev),0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//VENTAS NO SUJETAS...										
"DSTR1 := COPYSTR('#L#################  #R#################',1);"										
Value[1] := 'Ventas No Sujetas:';										
"Value[2] := '$' + FORMAT((VentasNoSu-VentasNoSuDev),0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//VENTAS TOTALES										
"DSTR1 := COPYSTR('#L###############     #R################',1);"										
Value[1] := 'Ventas Totales:';										
Value[2] := '$' + FORMAT((VentasG + TotalIva + VentasE + VentasNoSu+Percepcion)										
"-(VentasEDev+VentasNoSuDev),0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//Imprimir Linea en blanco...										
"DSTR1 :=     COPYSTR('                     ',1);"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
CLEAR(FirstTicket);										
CLEAR(LastTicket);										
CLEAR(Venta);										
CLEAR(Iva);										
CLEAR(vTotal);										
CLEAR(VentasG);										
CLEAR(TotalIva);										
CLEAR(TotalVentNcr);										
CLEAR(TotalIvaNcr);										
CLEAR(VentasE);										
CLEAR(VentasNoSu);										
CLEAR(VentasEDev);										
CLEAR(VentasNoSuDev);										
CLEAR(Retencion);										
										
//ENCABEZADO PARA EL TIPO DE COMPROBANTE										
"DSTR1 := COPYSTR('#C############################',1);"										
Value[1] := '3- Facturas Consumidor Final';										
//CSPNT231015										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
										
DSTR1 :='#L###         #R###       #R#      #R###';										
Value[1] := 'Folio';										
Value[2] := 'Venta';										
Value[3] := 'IVA';										
Value[4] := 'Total';										
"//PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
Transaction2.RESET;										
"Transaction2.SETCURRENTKEY(""Statement Code"",""Z-Report ID"",""Transaction Type"",""Entry Status"");"										
"Transaction2.SETRANGE(""Statement Code"",SCode);"										
"Transaction2.SETRANGE(""Z-Report ID"",'');"										
"Transaction2.SETRANGE(""Transaction Type"",Transaction2.""Transaction Type""::Sales);"										
"Transaction2.SETFILTER(""Entry Status"",'%1|%2',Transaction2.""Entry Status""::"" "",Transaction2.""Entry Status""::Posted);"										
"Transaction2.SETRANGE(""No. Serie NCF"",Terminal.""No. Serie NCF Cons. Final"");"										
IF  Transaction2.FINDFIRST THEN BEGIN										
"//    DSTR1 := COPYSTR('#L############################',1);"										
"//    Value[1] := 'Autorizacion:' + ' ' + UPPERCASE(Store.""Cod. Aut. Fiscal CF"");"										
"//    PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
rNoSeries.RESET;										
"IF rNoSeries.GET(Terminal.""No. Serie NCF Cons. Final"") THEN BEGIN"										
rNoSeriesLn.RESET;										
"rNoSeriesLn.SETRANGE(""Series Code"",rNoSeries.Code);"										
IF rNoSeriesLn.FINDFIRST THEN BEGIN										
"DSTR1 := COPYSTR('#L######################################',1);"										
Value[1] := 'Autorizacion:' + ' ' + UPPERCASE(FORMAT(rNoSeriesLn.Autorizacion));										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
END;										
										
//CSRM16102013 Se quito que imprimiera los rango de facturas porq no es un solo pos en la tienda										
//CSPNT231015 Se agrego que imprimiera rango de facturas										
FirstTicket := Transaction2.NCF;										
REPEAT										
//IMPRIMO EL NO. DE TICKET										
"IF NOT Transaction2.""Sale Is Return Sale"" THEN"										
DSTR1 :='#L####### #R######   #R#####  #R######'										
ELSE										
DSTR1 :='#L#######  #R######   #R#####  #R######';										
										
Value[1] := Transaction2.NCF;										
										
CLEAR(Venta);										
CLEAR(Iva);										
CLEAR(vTotal);										
										
"rSalesEntry.SETRANGE(""Store No."",Transaction2.""Store No."");"										
"rSalesEntry.SETRANGE(""POS Terminal No."",Transaction2.""POS Terminal No."");"										
"rSalesEntry.SETRANGE(""Transaction No."",Transaction2.""Transaction No."");"										
IF rSalesEntry.FIND('-') THEN										
REPEAT										
rImpuestos.RESET;										
"rImpuestos.SETRANGE(""VAT Bus. Posting Group"",rSalesEntry.""VAT Bus. Posting Group"");"										
"rImpuestos.SETRANGE(""VAT Prod. Posting Group"",rSalesEntry.""VAT Prod. Posting Group"");"										
IF rImpuestos.FINDFIRST THEN BEGIN										
"Venta       += ABS(rSalesEntry.""Net Amount"");"										
"Iva         += ABS(rSalesEntry.""VAT Amount"");"										
"vTotal      += ABS(rSalesEntry.""Net Amount"") + ABS(rSalesEntry.""VAT Amount"");"										
										
"IF NOT Transaction2.""Sale Is Return Sale"" THEN"										
"Retencion   += ABS(Transaction2.""Retencion Amount"")"										
ELSE										
"RetencionDev  += -(Transaction2.""Retencion Amount"");"										
										
IF rImpuestos.Impuesto=rImpuestos.Impuesto::Gravado THEN BEGIN										
"IF NOT Transaction2.""Sale Is Return Sale"" THEN BEGIN"										
"VentasG  += ABS(rSalesEntry.""Net Amount"");"										
"TotalIva += ABS(rSalesEntry.""VAT Amount"");"										
END										
ELSE BEGIN										
"TotalVentNcr += ABS(rSalesEntry.""Net Amount"");"										
"TotalIvaNcr  += ABS(rSalesEntry.""VAT Amount"");"										
END;										
END										
ELSE BEGIN										
IF rImpuestos.Impuesto=rImpuestos.Impuesto::Exento THEN BEGIN										
"IF NOT Transaction2.""Sale Is Return Sale"" THEN"										
"VentasE  += ABS(rSalesEntry.""Net Amount"")"										
ELSE										
"VentasEDev  += ABS(rSalesEntry.""Net Amount"")"										
END										
"ELSE IF NOT Transaction2.""Sale Is Return Sale"" THEN"										
"VentasNoSu  += ABS(rSalesEntry.""Net Amount"")"										
ELSE										
"VentasNoSuDev  += ABS(rSalesEntry.""Net Amount"")"										
END										
END;										
UNTIL rSalesEntry.NEXT = 0;										
										
//CSRM16102013 Se quito que imprimiera los rango de facturas porq no es un solo pos en la tienda										
{										
"IF NOT Transaction2.""Sale Is Return Sale"" THEN BEGIN"										
"Value[2] := '$' + FORMAT(Venta,0,'<Integer Thousand><Decimals,3>');"										
"Value[3] := '$' + FORMAT(Iva,0,'<Integer Thousand><Decimals,3>');"										
"Value[4] := '$' + FORMAT(vTotal,0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END										
ELSE BEGIN										
"Value[2] := '(' + '$' + FORMAT(Venta,0,'<Integer Thousand><Decimals,3>') + ')';"										
"Value[3] := '(' + '$' + FORMAT(Iva,0,'<Integer Thousand><Decimals,3>') + ')';"										
"Value[4] := '(' + '$' + FORMAT(vTotal,0,'<Integer Thousand><Decimals,3>') + ')';"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
}										
//CSPNT241015 se agrego rango de facturas										
LastTicket := Transaction2.NCF;										
										
//CSRM16102013 Se quito que imprimiera los rango de facturas porq no es un solo pos en la tienda										
UNTIL Transaction2.NEXT = 0;										
END;										
										
//CSRM16102013 Se quito que imprimiera los rango de facturas porq no es un solo pos en la tienda										
//CSPNT231015  Se agrego rango de facturas										
//CONSISA IMPRIMO LOS RANGOS DE TICKETS ENCONTRADOS EN EL REPORTE X										
//1er. Ticket.										
"DSTR1 := COPYSTR('#L######################################',1);"										
Value[1] := 'Del No.: ' + FirstTicket;										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//2do. Ticket.										
"DSTR1 := COPYSTR('#L######################################',1);"										
Value[1] := 'Al No.: ' + LastTicket;										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//Imprimir Linea en blanco...										
"DSTR1 :=     COPYSTR('                     ',1);"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//ENCABEZADO DE VENTAS TOTALES...										
"DSTR1 := COPYSTR('    #L#############',1);"										
Value[1] := 'VENTAS TOTALES:';										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
VentasG := VentasG - TotalVentNcr;										
										
//VENTAS GRAVADAS...										
"DSTR1 := COPYSTR('#L################    #R################',1);"										
Value[1] := 'Ventas Gravadas:';										
"Value[2] := '$' + FORMAT(VentasG,0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//VENTAS GRAVADAS...										
"DSTR1 := COPYSTR('#L################### #R################',1);"										
Value[1] := '(-) IVA Retenido:';										
"Value[2] := '$' + FORMAT(Retencion-RetencionDev,0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
TotalIva := TotalIva - TotalIvaNcr;										
										
//IMPUESTO IVA...										
"DSTR1 := COPYSTR('#L##############       #R###############',1);"										
Value[1] := 'Impuesto IVA:';										
"Value[2] := '$' + FORMAT(TotalIva,0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//Total Gravado...										
"DSTR1 := COPYSTR('#L###############      #R###############',1);"										
Value[1] := 'Total Gravado:';										
"Value[2] := '$' + FORMAT(VentasG + TotalIva,0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//VENTAS EXENTAS...										
"DSTR1 := COPYSTR('#L###############     #R################',1);"										
Value[1] := 'Ventas Exentas:';										
"Value[2] := '$' + FORMAT((VentasE-VentasEDev),0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//VENTAS NO SUJETAS...										
"DSTR1 := COPYSTR('#L##################  #R################',1);"										
Value[1] := 'Ventas No Sujetas:';										
"Value[2] := '$' + FORMAT((VentasNoSu-VentasNoSuDev),0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//VENTAS TOTALES										
"DSTR1 := COPYSTR('#L###############     #R################',1);"										
Value[1] := 'Ventas Totales:';										
Value[2] := '$' + FORMAT((VentasG + TotalIva + VentasE + VentasNoSu)										
"-(VentasEDev+VentasNoSuDev),0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//CSRM16102013										
										
//Imprimir Linea en blanco...										
"DSTR1 :=     COPYSTR('                     ',1);"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
CLEAR(FirstTicket);										
CLEAR(LastTicket);										
CLEAR(Venta);										
CLEAR(Iva);										
CLEAR(vTotal);										
CLEAR(VentasG);										
CLEAR(TotalIva);										
CLEAR(TotalVentNcr);										
CLEAR(TotalIvaNcr);										
CLEAR(VentasE);										
CLEAR(VentasNoSu);										
CLEAR(VentasEDev);										
CLEAR(VentasNoSuDev);										
//CSPNT231015 FACTURAS DE EXPORTACI‡N NO SE UTILIZARµN										
{										
//ENCABEZADO PARA EL TIPO DE COMPROBANTE										
"DSTR1 := COPYSTR('#L######################################',1);"										
Value[1] := '4- Facturas De Exportacion';										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
DSTR1 :='#L###       #R###       #R#        #R###';										
Value[1] := 'Folio';										
Value[2] := 'Venta';										
Value[3] := 'IVA';										
Value[4] := 'Total';										
"//PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
Transaction2.RESET;										
"Transaction2.SETCURRENTKEY(""Statement Code"",""Z-Report ID"",""Transaction Type"",""Entry Status"");"										
"Transaction2.SETRANGE(""Statement Code"",SCode);"										
"Transaction2.SETRANGE(""Z-Report ID"",'');"										
"Transaction2.SETRANGE(""Transaction Type"",Transaction2.""Transaction Type""::Sales);"										
"Transaction2.SETFILTER(""Entry Status"",'%1|%2',Transaction2.""Entry Status""::"" "",Transaction2.""Entry Status""::Posted);"										
"Transaction2.SETRANGE(""No. Serie NCF"",Terminal.""No. Serie NCF Exportacion"");"										
IF  Transaction2.FINDFIRST THEN BEGIN										
"//DSTR1 := COPYSTR('  #L#######################',1);"										
"//Value[1] := 'Autorizacion:' + ' ' + UPPERCASE(Store.""Cod. Aut. Fiscal CF"");"										
"//PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
//CSRM16102013 Se quito que imprimiera los rango de facturas porq no es un solo pos en la tienda										
"//FirstTicket := Transaction2.""Correlativo Facturas"";"										
REPEAT										
//IMPRIMO EL NO. DE TICKET										
"IF NOT Transaction2.""Sale Is Return Sale"" THEN"										
DSTR1 :='#L####### #R######   #R#####  #R######'										
ELSE										
DSTR1 :='#L#######  #R######   #R#####  #R######';										
										
Value[1] := Transaction2.NCF;										
										
CLEAR(Venta);										
CLEAR(Iva);										
CLEAR(vTotal);										
										
"rSalesEntry.SETRANGE(""Store No."",Transaction2.""Store No."");"										
"rSalesEntry.SETRANGE(""POS Terminal No."",Transaction2.""POS Terminal No."");"										
"rSalesEntry.SETRANGE(""Transaction No."",Transaction2.""Transaction No."");"										
IF rSalesEntry.FIND('-') THEN										
REPEAT										
rImpuestos.RESET;										
"rImpuestos.SETRANGE(""VAT Bus. Posting Group"",rSalesEntry.""VAT Bus. Posting Group"");"										
"rImpuestos.SETRANGE(""VAT Prod. Posting Group"",rSalesEntry.""VAT Prod. Posting Group"");"										
IF rImpuestos.FINDFIRST THEN BEGIN										
"Venta    += ABS(rSalesEntry.""Net Amount"");"										
"Iva      += ABS(rSalesEntry.""VAT Amount"");"										
"vTotal   += ABS(rSalesEntry.""Net Amount"") + ABS(rSalesEntry.""VAT Amount"");"										
										
IF rImpuestos.Impuesto=rImpuestos.Impuesto::Gravado THEN BEGIN										
"IF NOT Transaction2.""Sale Is Return Sale"" THEN BEGIN"										
"VentasG  += ABS(rSalesEntry.""Net Amount"");"										
"TotalIva += ABS(rSalesEntry.""VAT Amount"");"										
END										
ELSE BEGIN										
"TotalVentNcr += ABS(rSalesEntry.""Net Amount"");"										
"TotalIvaNcr  += ABS(rSalesEntry.""VAT Amount"");"										
END;										
END										
ELSE BEGIN										
IF rImpuestos.Impuesto=rImpuestos.Impuesto::Exento THEN BEGIN										
"IF NOT Transaction2.""Sale Is Return Sale"" THEN"										
"VentasE  += ABS(rSalesEntry.""Net Amount"")"										
ELSE										
"VentasEDev  += ABS(rSalesEntry.""Net Amount"")"										
END										
"ELSE IF NOT Transaction2.""Sale Is Return Sale"" THEN"										
"VentasNoSu  += ABS(rSalesEntry.""Net Amount"")"										
ELSE										
"VentasNoSuDev  += ABS(rSalesEntry.""Net Amount"")"										
END										
END;										
UNTIL rSalesEntry.NEXT = 0;										
										
//CSRM16102013 Se quito que imprimiera los rango de facturas porq no es un solo pos en la tienda										
{										
"IF NOT Transaction2.""Sale Is Return Sale"" THEN BEGIN"										
"Value[2] := '$' + FORMAT(Venta,0,'<Integer Thousand><Decimals,3>');"										
"Value[3] := '$' + FORMAT(Iva,0,'<Integer Thousand><Decimals,3>');"										
"Value[4] := '$' + FORMAT(vTotal,0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END										
ELSE BEGIN										
"Value[2] := '(' + '$' + FORMAT(Venta,0,'<Integer Thousand><Decimals,3>') + ')';"										
"Value[3] := '(' + '$' + FORMAT(Iva,0,'<Integer Thousand><Decimals,3>') + ')';"										
"Value[4] := '(' + '$' + FORMAT(vTotal,0,'<Integer Thousand><Decimals,3>') + ')';"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
"LastTicket := Transaction2.""Correlativo Facturas"";"										
}										
//CSRM16102013 Se quito que imprimiera los rango de facturas porq no es un solo pos en la tienda										
UNTIL Transaction2.NEXT = 0;										
END;										
										
//CSRM16102013 Se quito que imprimiera los rango de facturas porq no es un solo pos en la tienda										
{										
//CONSISA IMPRIMO LOS RANGOS DE TICKETS ENCONTRADOS EN EL REPORTE X										
//1er. Ticket.										
"DSTR1 := COPYSTR('#L######################################',1);"										
Value[1] := 'Del No.: ' + FirstTicket;										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//2do. Ticket.										
"DSTR1 := COPYSTR('#L######################################',1);"										
Value[1] := 'Al No.: ' + LastTicket;										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
}										
//CSRM16102013 Se quito que imprimiera los rango de facturas porq no es un solo pos en la tienda										
										
//Imprimir Linea en blanco...										
"DSTR1 :=     COPYSTR('                     ',1);"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//ENCABEZADO DE VENTAS TOTALES...										
"DSTR1 := COPYSTR('    #L#############',1);"										
Value[1] := 'VENTAS TOTALES:';										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
VentasG := VentasG - TotalVentNcr;										
										
//VENTAS GRAVADAS...										
"DSTR1 := COPYSTR('#L################    #R################',1);"										
Value[1] := 'Ventas Gravadas:';										
"Value[2] := '$' + FORMAT(VentasG,0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
TotalIva := TotalIva - TotalIvaNcr;										
										
//IMPUESTO IVA...										
"DSTR1 := COPYSTR('#L#############       #R################',1);"										
Value[1] := 'Impuesto IVA:';										
"Value[2] := '$' + FORMAT(TotalIva,0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//Total Gravado...										
"DSTR1 := COPYSTR('#L##############      #R################',1);"										
Value[1] := 'Total Gravado:';										
"Value[2] := '$' + FORMAT(VentasG + TotalIva,0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//VENTAS EXENTAS...										
"DSTR1 := COPYSTR('#L################     #R###############',1);"										
Value[1] := 'Ventas Exentas:';										
"Value[2] := '$' + FORMAT((VentasE-VentasEDev),0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//VENTAS NO SUJETAS...										
"DSTR1 := COPYSTR('#L###################  #R###############',1);"										
Value[1] := 'Ventas No Sujetas:';										
"Value[2] := '$' + FORMAT((VentasNoSu-VentasNoSuDev),0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//VENTAS TOTALES										
"DSTR1 := COPYSTR('#L################     #R###############',1);"										
Value[1] := 'Ventas Totales:';										
Value[2] := '$' + FORMAT((VentasG + TotalIva + VentasE + VentasNoSu)										
"-(VentasNoSuDev+VentasEDev),0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//CSRM16102013										
//Imprimir Linea en blanco...										
"DSTR1 :=     COPYSTR('                     ',1);"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
}										
//CSPNT231015 DETALLES DE MEDIOS DE PAGO QUITADOS										
{										
//CSRM17122013										
//IMPRIME MONTO DE VENTAS EN EFECTIVO										
"DSTR1 := COPYSTR('#L######################################',1);"										
Value[1] := 'DETALLE DE MEDIOS DE PAGO' ;										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//Inserta todos los medios de pago en la tabla temporal para sumar										
TmpTender.DELETEALL;										
COMMIT;										
TmpTender.INIT;										
rTenderTypeSetup.RESET;										
										
rTenderTypeSetup.SETCURRENTKEY(Code);										
IF rTenderTypeSetup.FINDFIRST THEN BEGIN										
REPEAT										
TmpTender.Code:=rTenderTypeSetup.Code;										
TmpTender.Descripcion:=rTenderTypeSetup.Description;										
TmpTender.INSERT;										
UNTIL rTenderTypeSetup.NEXT = 0;										
END;										
										
//CSRM11122013										
Transaction2.RESET;										
"Transaction2.SETCURRENTKEY(""Statement Code"",""Z-Report ID"",""Transaction Type"",""Entry Status"");"										
"Transaction2.SETRANGE(""Statement Code"",SCode);"										
"Transaction2.SETRANGE(""Z-Report ID"",'');"										
"Transaction2.SETRANGE(""Transaction Type"",Transaction2.""Transaction Type""::Sales);"										
"Transaction2.SETFILTER(""Entry Status"",'%1|%2',Transaction2.""Entry Status""::"" "",Transaction2.""Entry Status""::Posted);"										
IF Transaction2.FINDFIRST THEN BEGIN										
REPEAT										
rTransPaymentEntry.RESET;										
"rTransPaymentEntry.SETCURRENTKEY(""Store No."",""POS Terminal No."",""Transaction No."",""Line No."");"										
"rTransPaymentEntry.SETRANGE(""POS Terminal No."",Globals.TerminalNo);"										
"rTransPaymentEntry.SETRANGE(""Store No."",Globals.StoreNo);"										
"rTransPaymentEntry.SETRANGE(""Transaction No."",Transaction2.""Transaction No."");"										
IF rTransPaymentEntry.FINDFIRST THEN BEGIN										
REPEAT										
TmpTender.RESET;										
TmpTender.SETCURRENTKEY(Code);										
"TmpTender.SETRANGE(Code,rTransPaymentEntry.""Tender Type"");"										
IF TmpTender.FINDFIRST THEN BEGIN										
"TmpTender.Monto+=rTransPaymentEntry.""Amount Tendered"";"										
TmpTender.MODIFY;										
END;										
UNTIL rTransPaymentEntry.NEXT = 0;										
END;										
UNTIL Transaction2.NEXT = 0;										
END;										
										
CLEAR(Correlativo);										
Correlativo:=0;										
TmpTender.RESET;										
TmpTender.SETCURRENTKEY(Code);										
IF TmpTender.FINDFIRST THEN BEGIN										
REPEAT										
IF TmpTender.Monto > 0 THEN BEGIN										
Correlativo+=1;										
//IMPRIME MONTO DE VENTAS EN EFECTIVO										
"DSTR1 := COPYSTR('#L###################### #R#############',1);"										
Value[1] := FORMAT(Correlativo)+'- '+ TmpTender.Descripcion;										
Value[2] := POSFunctions.FormatAmount(TmpTender.Monto);										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
UNTIL TmpTender.NEXT = 0;										
END;										
										
//IMPRIME MONTO DE VENTAS EN EFECTIVO										
"DSTR1 := COPYSTR('#L######################################',1);"										
Value[1] := 'DETALLE DE FONDO FIJO' ;										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//ACUMULA LOS FONDOS FIJOS										
Transaction2.RESET;										
"Transaction2.SETCURRENTKEY(""Statement Code"",""Z-Report ID"",""Transaction Type"",""Entry Status"");"										
"Transaction2.SETRANGE(""Statement Code"",SCode);"										
"Transaction2.SETRANGE(""Z-Report ID"",'');"										
"Transaction2.SETRANGE(""Transaction Type"",Transaction2.""Transaction Type""::""Float Entry"");"										
"Transaction2.SETFILTER(""Entry Status"",'%1|%2',Transaction2.""Entry Status""::"" "",Transaction2.""Entry Status""::Posted);"										
IF  Transaction2.FINDFIRST THEN BEGIN										
REPEAT										
rTransPaymentEntry.RESET;										
"rTransPaymentEntry.SETCURRENTKEY(""Store No."",""POS Terminal No."",""Transaction No."",""Line No."");"										
"rTransPaymentEntry.SETRANGE(""POS Terminal No."",Globals.TerminalNo);"										
"rTransPaymentEntry.SETRANGE(""Store No."",Globals.StoreNo);"										
"rTransPaymentEntry.SETRANGE(""Transaction No."",Transaction2.""Transaction No."");"										
IF rTransPaymentEntry.FINDFIRST THEN BEGIN										
REPEAT										
"IF rTransPaymentEntry.""Tender Type""='11' THEN BEGIN"										
"VFondoFijo+=-rTransPaymentEntry.""Amount Tendered"";"										
END;										
UNTIL rTransPaymentEntry.NEXT = 0;										
END;										
UNTIL Transaction2.NEXT = 0;										
END;										
										
CLEAR(Correlativo);										
IF VFondoFijo >0 THEN BEGIN										
Correlativo+=1;										
//IMPRIME MONTO DE VENTAS CON TARJETA MANUAL										
"DSTR1 := COPYSTR('#L#################### #R###############',1);"										
Value[1] := FORMAT(Correlativo)+'- FONDO FIJO ';										
Value[2] := POSFunctions.FormatAmount(VFondoFijo);										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
										
//Inserta todos los medios de pago en la tabla temporal para sumar										
TmpTender.DELETEALL;										
COMMIT;										
TmpTender.INIT;										
rTenderTypeSetup.RESET;										
rTenderTypeSetup.SETCURRENTKEY(Code);										
IF rTenderTypeSetup.FINDFIRST THEN BEGIN										
REPEAT										
TmpTender.Code:=rTenderTypeSetup.Code;										
TmpTender.Descripcion:=rTenderTypeSetup.Description;										
TmpTender.INSERT;										
UNTIL rTenderTypeSetup.NEXT = 0;										
END;										
										
//IMPRIME MONTO DE VENTAS EN EFECTIVO										
"DSTR1 := COPYSTR('#L######################################',1);"										
Value[1] := 'DETALLE DE RETIROS' ;										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//ACUMULA LOS RETIROS DE EFECTIVO										
Transaction2.RESET;										
"Transaction2.SETCURRENTKEY(""Statement Code"",""Z-Report ID"",""Transaction Type"",""Entry Status"");"										
"Transaction2.SETRANGE(""Statement Code"",SCode);"										
"Transaction2.SETRANGE(""Z-Report ID"",'');"										
"Transaction2.SETRANGE(""Transaction Type"",Transaction2.""Transaction Type""::""Remove Tender"");"										
"Transaction2.SETFILTER(""Entry Status"",'%1|%2',Transaction2.""Entry Status""::"" "",Transaction2.""Entry Status""::Posted);"										
IF Transaction2.FINDFIRST THEN BEGIN										
REPEAT										
rTransPaymentEntry.RESET;										
"rTransPaymentEntry.SETCURRENTKEY(""Store No."",""POS Terminal No."",""Transaction No."",""Line No."");"										
"rTransPaymentEntry.SETRANGE(""POS Terminal No."",Globals.TerminalNo);"										
"rTransPaymentEntry.SETRANGE(""Store No."",Globals.StoreNo);"										
"rTransPaymentEntry.SETRANGE(""Transaction No."",Transaction2.""Transaction No."");"										
IF rTransPaymentEntry.FINDFIRST THEN BEGIN										
REPEAT										
TmpTender.RESET;										
TmpTender.SETCURRENTKEY(Code);										
"TmpTender.SETRANGE(Code,rTransPaymentEntry.""Tender Type"");"										
IF TmpTender.FINDFIRST THEN BEGIN										
"TmpTender.Monto+=rTransPaymentEntry.""Amount Tendered"";"										
TmpTender.MODIFY;										
END;										
UNTIL rTransPaymentEntry.NEXT = 0;										
END;										
UNTIL Transaction2.NEXT = 0;										
END;										
										
CLEAR(Correlativo);										
Correlativo:=0;										
TmpTender.RESET;										
TmpTender.SETCURRENTKEY(Code);										
IF TmpTender.FINDFIRST THEN BEGIN										
REPEAT										
IF TmpTender.Monto <> 0 THEN BEGIN										
Correlativo+=1;										
//IMPRIME MONTO DE VENTAS EN EFECTIVO										
"DSTR1 := COPYSTR('#L##################### #R##############',1);"										
Value[1] := FORMAT(Correlativo)+'- '+ TmpTender.Descripcion;										
Value[2] := POSFunctions.FormatAmount(TmpTender.Monto);										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
UNTIL TmpTender.NEXT = 0;										
END;										
}										
END										
ELSE IF DoZ THEN BEGIN										
//BUSCO PRIMERO LOS NCF PARA LOS TICKETS CONNSUMIDORES FINALES										
										
//ENCABEZADO PARA EL TIPO DE COMPROBANTE										
"DSTR1 := COPYSTR('#C############################',1);"										
Value[1] := '1- Ticket de Consumidor Final';										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
										
Transaction2.RESET;										
"Transaction2.SETCURRENTKEY(""Statement Code"",""Z-Report ID"",""Transaction Type"",""Entry Status"");"										
"Transaction2.SETRANGE(""Statement Code"",SCode);"										
"Transaction2.SETRANGE(""Z-Report ID"",'');"										
"Transaction2.SETRANGE(""Transaction Type"",Transaction2.""Transaction Type""::Sales);"										
"Transaction2.SETFILTER(""Entry Status"",'%1|%2',Transaction2.""Entry Status""::"" "",Transaction2.""Entry Status""::Posted);"										
"Transaction2.SETRANGE(""No. Serie NCF"",Terminal.""No. Serie NCF Ticket"");"										
IF Transaction2.FINDFIRST THEN BEGIN										
rNoSeries.RESET;										
"IF rNoSeries.GET(Transaction2.""No. Serie NCF"") THEN BEGIN"										
rNoSeriesLn.RESET;										
"rNoSeriesLn.SETRANGE(""Series Code"",rNoSeries.Code);"										
IF rNoSeriesLn.FINDFIRST THEN BEGIN										
"DSTR1 := COPYSTR('#L######################################',1);"										
Value[1] := 'Autorizacion:' + ' ' + UPPERCASE(rNoSeriesLn.Autorizacion);										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//CONSISA-Imprimir el rango de ticket..										
"DSTR1 := COPYSTR('#L##########     #R###########',1);"										
"Value[1] := 'Del ' + rNoSeriesLn.""Starting No."";"										
"Value[2] := 'al  ' + rNoSeriesLn.""Ending No."";"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
END;										
										
FirstTicket := Transaction2.NCF;										
										
REPEAT										
"rSalesEntry.SETRANGE(""Store No."",Transaction2.""Store No."");"										
"rSalesEntry.SETRANGE(""POS Terminal No."",Transaction2.""POS Terminal No."");"										
"rSalesEntry.SETRANGE(""Transaction No."",Transaction2.""Transaction No."");"										
IF rSalesEntry.FIND('-') THEN										
REPEAT										
rImpuestos.RESET;										
"rImpuestos.SETRANGE(""VAT Bus. Posting Group"",rSalesEntry.""VAT Bus. Posting Group"");"										
"rImpuestos.SETRANGE(""VAT Prod. Posting Group"",rSalesEntry.""VAT Prod. Posting Group"");"										
IF rImpuestos.FINDFIRST THEN BEGIN										
"Venta    += ABS(rSalesEntry.""Net Amount"");"										
"Iva      += ABS(rSalesEntry.""VAT Amount"");"										
"vTotal   += ABS(rSalesEntry.""Net Amount"") + ABS(rSalesEntry.""VAT Amount"");"										
										
IF rImpuestos.Impuesto=rImpuestos.Impuesto::Gravado THEN BEGIN										
"IF NOT Transaction2.""Sale Is Return Sale"" THEN BEGIN"										
"VentasG  += ABS(rSalesEntry.""Net Amount"");"										
"TotalIva += ABS(rSalesEntry.""VAT Amount"");"										
END										
ELSE BEGIN										
"TotalVentNcr += ABS(rSalesEntry.""Net Amount"");"										
"TotalIvaNcr  += ABS(rSalesEntry.""VAT Amount"");"										
END;										
END										
ELSE BEGIN										
IF rImpuestos.Impuesto=rImpuestos.Impuesto::Exento THEN BEGIN										
"IF NOT Transaction2.""Sale Is Return Sale"" THEN"										
"VentasE  += ABS(rSalesEntry.""Net Amount"")"										
ELSE										
"VentasEDev  += ABS(rSalesEntry.""Net Amount"")"										
END										
"ELSE IF NOT Transaction2.""Sale Is Return Sale"" THEN"										
"VentasNoSu  += ABS(rSalesEntry.""Net Amount"")"										
ELSE										
"VentasNoSuDev  += ABS(rSalesEntry.""Net Amount"")"										
END										
END;										
UNTIL rSalesEntry.NEXT = 0;										
LastTicket := Transaction2.NCF;										
UNTIL Transaction2.NEXT = 0;										
END;										
										
//Del No.										
"DSTR1 := COPYSTR('#L######################################',1);"										
Value[1] := 'Del No.: ' + FirstTicket;										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//Al No.										
"DSTR1 := COPYSTR('#L######################################',1);"										
Value[1] := 'Al No.: ' + LastTicket;										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//Imprimir Linea en blanco...										
"DSTR1 :=     COPYSTR('                     ',1);"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//ENCABEZADO DE VENTAS TOTALES...										
"DSTR1 := COPYSTR('    #L#############',1);"										
Value[1] := 'VENTAS TOTALES:';										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
VentasG := VentasG - TotalVentNcr;										
										
//VENTAS GRAVADAS...										
"DSTR1 := COPYSTR('#L##############         #R#############',1);"										
Value[1] := 'Ventas Gravadas:';										
"Value[2] := '$' + FORMAT(VentasG,0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
TotalIva := TotalIva - TotalIvaNcr;										
										
//IMPUESTO IVA...										
"DSTR1 := COPYSTR('#L###########            #R#############',1);"										
Value[1] := 'Impuesto IVA:';										
"Value[2] := '$' + FORMAT(TotalIva,0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//Total Gravado...										
"DSTR1 := COPYSTR('#L############           #R#############',1);"										
Value[1] := 'Total Gravado:';										
"Value[2] := '$' + FORMAT(VentasG + TotalIva,0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//VENTAS EXENTAS...										
"DSTR1 := COPYSTR('#L#############          #R#############',1);"										
Value[1] := 'Ventas Exentas:';										
"Value[2] := '$' + FORMAT((VentasE-VentasEDev),0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//VENTAS NO SUJETAS...										
"DSTR1 := COPYSTR('#L################       #R#############',1);"										
Value[1] := 'Ventas No Sujetas:';										
"Value[2] := '$' + FORMAT((VentasNoSu-VentasNoSuDev),0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//VENTAS TOTALES										
"DSTR1 := COPYSTR('#L#############          #R#############',1);"										
Value[1] := 'Ventas Totales:';										
Value[2] := '$' + FORMAT((VentasG + TotalIva + VentasE + VentasNoSu)										
"-(VentasEDev+VentasNoSuDev),0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//LIMPIO LAS VARIABLES QUE MUESTRAN LOS TOTALES DE LAS VENTAS POR TIPO DE COMPROBANTES.										
CLEAR(Venta);										
CLEAR(Iva);										
CLEAR(vTotal);										
CLEAR(VentasG);										
CLEAR(TotalIva);										
CLEAR(TotalVentNcr);										
CLEAR(TotalIvaNcr);										
CLEAR(VentasE);										
CLEAR(VentasNoSu);										
CLEAR(VentasEDev);										
CLEAR(VentasNoSuDev);										
CLEAR(Percepcion);										
CLEAR(PercepcionDev);										
										
//Imprimir Linea en blanco...										
"DSTR1 :=     COPYSTR('                     ',1);"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//ENCABEZADO PARA EL TIPO DE COMPROBANTE										
"DSTR1 := COPYSTR('#C############################',1);"										
Value[1] := '2- Comprobante de CrÇdito Fiscal';										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
										
//CSRM16102013 Se quito que imprimiera los rango de facturas porq no es un solo pos en la tienda										
{										
rTransaction.RESET;										
"rTransaction.SETCURRENTKEY(""Statement Code"",""Z-Report ID"",""Transaction Type"",""Entry Status"");"										
"rTransaction.SETRANGE(""Statement Code"",SCode);"										
"rTransaction.SETRANGE(""Z-Report ID"",'');"										
"rTransaction.SETRANGE(""Transaction Type"",Transaction2.""Transaction Type""::Sales);"										
"rTransaction.SETFILTER(""Entry Status"",'%1|%2',Transaction2.""Entry Status""::"" "",Transaction2.""Entry Status""::Posted);"										
"rTransaction.SETRANGE(""No. Serie NCF"",Terminal.""No. Serie NCF Credito Fiscal"");"										
}										
//CSRM16102013 Se quito que imprimiera los rango de facturas porq no es un solo pos en la tienda										
										
//BUSCO PRIMERO LOS NCF PARA CREDITO FISCALES										
Transaction2.RESET;										
"Transaction2.SETCURRENTKEY(""Statement Code"",""Z-Report ID"",""Transaction Type"",""Entry Status"");"										
"Transaction2.SETRANGE(""Statement Code"",SCode);"										
"Transaction2.SETRANGE(""Z-Report ID"",'');"										
"Transaction2.SETRANGE(""Transaction Type"",Transaction2.""Transaction Type""::Sales);"										
"Transaction2.SETFILTER(""Entry Status"",'%1|%2',Transaction2.""Entry Status""::"" "",Transaction2.""Entry Status""::Posted);"										
"Transaction2.SETFILTER(""No. Serie NCF"",'%1|%2',Terminal.""No. Serie NCF Credito Fiscal"",Terminal.""No. Serie NCF Nota de Credito"")"	;									
IF Transaction2.FINDFIRST THEN BEGIN										
"DSTR1 := COPYSTR('  #L#######################',1);"										
"//YA    Value[1] := 'Autorizacion:' + ' ' + UPPERCASE(Store.""Cod. Aut. Fiscal CRF"");"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
//CSRM16102013 Se quito que imprimiera los rango de facturas porq no es un solo pos en la tienda										
//CSPNT241015 se agrego rango de facturas										
IF rTransaction.FINDFIRST THEN BEGIN										
FirstFactCrf := rTransaction.NCF;										
END;										
										
//CSRM16102013 Se quito que imprimiera los rango de facturas porq no es un solo pos en la tienda										
REPEAT										
"rSalesEntry.SETRANGE(""Store No."",Transaction2.""Store No."");"										
"rSalesEntry.SETRANGE(""POS Terminal No."",Transaction2.""POS Terminal No."");"										
"rSalesEntry.SETRANGE(""Transaction No."",Transaction2.""Transaction No."");"										
IF rSalesEntry.FIND('-') THEN										
REPEAT										
rImpuestos.RESET;										
"rImpuestos.SETRANGE(""VAT Bus. Posting Group"",rSalesEntry.""VAT Bus. Posting Group"");"										
"rImpuestos.SETRANGE(""VAT Prod. Posting Group"",rSalesEntry.""VAT Prod. Posting Group"");"										
IF rImpuestos.FINDFIRST THEN BEGIN										
"Venta    += ABS(rSalesEntry.""Net Amount"");"										
"Iva      += ABS(rSalesEntry.""VAT Amount"");"										
"vTotal   += ABS(rSalesEntry.""Net Amount"") + ABS(rSalesEntry.""VAT Amount"");"										
										
"IF NOT Transaction2.""Sale Is Return Sale"" THEN"										
"Percepcion  += ABS(Transaction2.""Percepcion Amount"")"										
ELSE										
"PercepcionDev  += -(Transaction2.""Percepcion Amount"");"										
										
IF rImpuestos.Impuesto=rImpuestos.Impuesto::Gravado THEN BEGIN										
"IF NOT Transaction2.""Sale Is Return Sale"" THEN BEGIN"										
"VentasG  += ABS(rSalesEntry.""Net Amount"");"										
"TotalIva += ABS(rSalesEntry.""VAT Amount"");"										
END										
ELSE BEGIN										
"TotalVentNcr += ABS(rSalesEntry.""Net Amount"");"										
"TotalIvaNcr  += ABS(rSalesEntry.""VAT Amount"");"										
END;										
END										
ELSE BEGIN										
IF rImpuestos.Impuesto=rImpuestos.Impuesto::Exento THEN BEGIN										
"IF NOT Transaction2.""Sale Is Return Sale"" THEN"										
"VentasE  += ABS(rSalesEntry.""Net Amount"")"										
ELSE										
"VentasEDev  += ABS(rSalesEntry.""Net Amount"")"										
END										
"ELSE IF NOT Transaction2.""Sale Is Return Sale"" THEN"										
"VentasNoSu  += ABS(rSalesEntry.""Net Amount"")"										
ELSE										
"VentasNoSuDev  += ABS(rSalesEntry.""Net Amount"")"										
END										
END;										
UNTIL rSalesEntry.NEXT = 0;										
//CSRM16102013 Se quito que imprimiera los rango de facturas porq no es un solo pos en la tienda										
//CSPNT241015 se agrego rango de facturas										
IF rTransaction.FINDLAST THEN BEGIN										
LastFactCrf := rTransaction.NCF;										
END;										
										
//CSRM16102013 Se quito que imprimiera los rango de facturas porq no es un solo pos en la tienda										
UNTIL Transaction2.NEXT = 0;										
END;										
										
//CSRM16102013 Se quito que imprimiera los rango de facturas porq no es un solo pos en la tienda										
//CSPNT241015 se agrego rango de facturas										
//Del No.										
"DSTR1 := COPYSTR('#L#################################',1);"										
Value[1] := 'Del No.: ' + FirstFactCrf;										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//Al No.										
"DSTR1 := COPYSTR('#L#################################',1);"										
Value[1] := 'Al No.: ' + LastFactCrf;										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//CSRM16102013 Se quito que imprimiera los rango de facturas porq no es un solo pos en la tienda										
										
//Imprimir Linea en blanco...										
"DSTR1 :=     COPYSTR('                     ',1);"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//ENCABEZADO DE VENTAS TOTALES...										
"DSTR1 := COPYSTR('    #L#############',1);"										
Value[1] := 'VENTAS TOTALES:';										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
VentasG := VentasG - TotalVentNcr;										
										
//VENTAS GRAVADAS...										
"DSTR1 := COPYSTR('#L##############    #R##################',1);"										
Value[1] := 'Ventas Gravadas:';										
"Value[2] := '$' + FORMAT(VentasG,0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
TotalIva := TotalIva - TotalIvaNcr;										
										
//IMPUESTO IVA...										
"DSTR1 := COPYSTR('#L###########       #R##################',1);"										
Value[1] := 'Impuesto IVA:';										
"Value[2] := '$' + FORMAT(TotalIva,0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//Total Gravado...										
"DSTR1 := COPYSTR('#L############      #R##################',1);"										
Value[1] := 'Total Gravado:';										
"Value[2] := '$' + FORMAT(VentasG + TotalIva,0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
CLEAR(Percibido);										
//PERCEPCION...										
"DSTR1 := COPYSTR('#L################# #R##################',1);"										
Value[1] := '(+) IVA Percibido:';										
//Percibido:=  Percepcion-PercepcionDev;										
//IF Percibido =0 THEN										
//  Percibido:=0.0 ;										
"Value[2] := '$' + FORMAT((Percepcion-PercepcionDev),0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//VENTAS EXENTAS...										
"DSTR1 := COPYSTR('#L#############     #R##################',1);"										
Value[1] := 'Ventas Exentas:';										
"Value[2] := '$' + FORMAT((VentasE-VentasEDev),0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//VENTAS NO SUJETAS...										
"DSTR1 := COPYSTR('#L################  #R##################',1);"										
Value[1] := 'Ventas No Sujetas:';										
"Value[2] := '$' + FORMAT((VentasNoSu-VentasNoSuDev),0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//VENTAS TOTALES										
"DSTR1 := COPYSTR('#L#############     #R##################',1);"										
Value[1] := 'Ventas Totales:';										
Value[2] := '$' + FORMAT((VentasG + TotalIva + VentasE + VentasNoSu)										
"-(VentasEDev+VentasNoSuDev),0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//LIMPIO LAS VARIABLES QUE MUESTRAN LOS TOTALES DE LAS VENTAS POR TIPO DE COMPROBANTES.										
CLEAR(Venta);										
CLEAR(Iva);										
CLEAR(vTotal);										
CLEAR(VentasG);										
CLEAR(TotalIva);										
CLEAR(TotalVentNcr);										
CLEAR(TotalIvaNcr);										
CLEAR(VentasE);										
CLEAR(VentasNoSu);										
CLEAR(VentasEDev);										
CLEAR(VentasNoSuDev);										
										
//Imprimir Linea en blanco...										
"DSTR1 :=     COPYSTR('                     ',1);"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//ENCABEZADO PARA EL TIPO DE COMPROBANTE										
"DSTR1 := COPYSTR('#C############################',1);"										
Value[1] := '3- Factura De Consumidor Final';										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
										
//BUSCO PRIMERO LOS NCF PARA FACTURAS DE CONSUMIDORES FINALES										
Transaction2.RESET;										
"Transaction2.SETCURRENTKEY(""Statement Code"",""Z-Report ID"",""Transaction Type"",""Entry Status"");"										
"Transaction2.SETRANGE(""Statement Code"",SCode);"										
"Transaction2.SETRANGE(""Z-Report ID"",'');"										
"Transaction2.SETRANGE(""Transaction Type"",Transaction2.""Transaction Type""::Sales);"										
"Transaction2.SETFILTER(""Entry Status"",'%1|%2',Transaction2.""Entry Status""::"" "",Transaction2.""Entry Status""::Posted);"										
"Transaction2.SETRANGE(""No. Serie NCF"",Terminal.""No. Serie NCF Cons. Final"");"										
IF  Transaction2.FINDFIRST THEN BEGIN										
"//DSTR1 := COPYSTR('  #L#######################',1);"										
"//Value[1] := 'Autorizacion:' + ' ' + UPPERCASE(Store.""Cod. Aut. Fiscal CF"");"										
"//PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
//CSRM16102013 Se quito que imprimiera los rango de facturas porq no es un solo pos en la tienda										
//CSPNT241015 se agrego rango de facturas										
FirstFactCf := Transaction2.NCF;										
REPEAT										
"rSalesEntry.SETRANGE(""Store No."",Transaction2.""Store No."");"										
"rSalesEntry.SETRANGE(""POS Terminal No."",Transaction2.""POS Terminal No."");"										
"rSalesEntry.SETRANGE(""Transaction No."",Transaction2.""Transaction No."");"										
IF rSalesEntry.FIND('-') THEN										
REPEAT										
rImpuestos.RESET;										
"rImpuestos.SETRANGE(""VAT Bus. Posting Group"",rSalesEntry.""VAT Bus. Posting Group"");"										
"rImpuestos.SETRANGE(""VAT Prod. Posting Group"",rSalesEntry.""VAT Prod. Posting Group"");"										
IF rImpuestos.FINDFIRST THEN BEGIN										
"Venta    += ABS(rSalesEntry.""Net Amount"");"										
"Iva      += ABS(rSalesEntry.""VAT Amount"");"										
"vTotal   += ABS(rSalesEntry.""Net Amount"") + ABS(rSalesEntry.""VAT Amount"");"										
										
"IF NOT Transaction2.""Sale Is Return Sale"" THEN"										
"Retencion  += ABS(Transaction2.""Retencion Amount"")"										
ELSE										
"RetencionDev  += -(Transaction2.""Retencion Amount"");"										
										
IF rImpuestos.Impuesto=rImpuestos.Impuesto::Gravado THEN BEGIN										
"IF NOT Transaction2.""Sale Is Return Sale"" THEN BEGIN"										
"VentasG  += ABS(rSalesEntry.""Net Amount"");"										
"TotalIva += ABS(rSalesEntry.""VAT Amount"");"										
END										
ELSE BEGIN										
"TotalVentNcr += ABS(rSalesEntry.""Net Amount"");"										
"TotalIvaNcr  += ABS(rSalesEntry.""VAT Amount"");"										
END;										
END										
ELSE BEGIN										
IF rImpuestos.Impuesto=rImpuestos.Impuesto::Exento THEN BEGIN										
"IF NOT Transaction2.""Sale Is Return Sale"" THEN"										
"VentasE  += ABS(rSalesEntry.""Net Amount"")"										
ELSE										
"VentasEDev  += ABS(rSalesEntry.""Net Amount"")"										
END										
"ELSE IF NOT Transaction2.""Sale Is Return Sale"" THEN"										
"VentasNoSu  += ABS(rSalesEntry.""Net Amount"")"										
ELSE										
"VentasNoSuDev  += ABS(rSalesEntry.""Net Amount"")"										
END										
END;										
UNTIL rSalesEntry.NEXT = 0;										
										
//CSRM16102013 Se quito que imprimiera los rango de facturas porq no es un solo pos en la tienda										
//CSPNT241015 se agrego rango de facturas										
LastFactCf := Transaction2.NCF;										
UNTIL Transaction2.NEXT = 0;										
END;										
										
//CSRM16102013 Se quito que imprimiera los rango de facturas porq no es un solo pos en la tienda										
//CSPNT241015 se agrego rango de facturas										
//Del No.										
"DSTR1 := COPYSTR('#L#################################',1);"										
Value[1] := 'Del No.: ' + FirstFactCf;										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//Al No.										
"DSTR1 := COPYSTR('#L#################################',1);"										
Value[1] := 'Al No.: ' + LastFactCf;										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//CSRM16102013 Se quito que imprimiera los rango de facturas porq no es un solo pos en la tienda										
//Imprimir Linea en blanco...										
"DSTR1 :=     COPYSTR('                     ',1);"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//ENCABEZADO DE VENTAS TOTALES...										
"DSTR1 := COPYSTR('    #L#############',1);"										
Value[1] := 'VENTAS TOTALES:';										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
VentasG := VentasG - TotalVentNcr;										
										
//VENTAS GRAVADAS...										
"DSTR1 := COPYSTR('#L##############    #R##################',1);"										
Value[1] := 'Ventas Gravadas:';										
"Value[2] := '$' + FORMAT(VentasG,0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
TotalIva := TotalIva - TotalIvaNcr;										
										
//IMPUESTO IVA...										
"DSTR1 := COPYSTR('#L###########       #R##################',1);"										
Value[1] := 'Impuesto IVA:';										
"Value[2] := '$' + FORMAT(TotalIva,0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//Total Gravado...										
"DSTR1 := COPYSTR('#L############      #R##################',1);"										
Value[1] := 'Total Gravado:';										
"Value[2] := '$' + FORMAT(VentasG + TotalIva,0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//PERCEPCION...										
"DSTR1 := COPYSTR('#L################# #R##################',1);"										
Value[1] := '(-) IVA Retenido:';										
"Value[2] := '$' + FORMAT((Retencion-RetencionDev),0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//VENTAS EXENTAS...										
"DSTR1 := COPYSTR('#L#############     #R##################',1);"										
Value[1] := 'Ventas Exentas:';										
"Value[2] := '$' + FORMAT((VentasE-VentasEDev),0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//VENTAS NO SUJETAS...										
"DSTR1 := COPYSTR('#L################  #R##################',1);"										
Value[1] := 'Ventas No Sujetas:';										
"Value[2] := '$' + FORMAT((VentasNoSu-VentasNoSuDev),0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//VENTAS TOTALES										
"DSTR1 := COPYSTR('#L#############     #R##################',1);"										
Value[1] := 'Ventas Totales:';										
Value[2] := '$' + FORMAT((VentasG + TotalIva + VentasE + VentasNoSu)										
"-(VentasEDev+VentasNoSuDev),0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//CSRM16102013										
//LIMPIO LAS VARIABLES QUE MUESTRAN LOS TOTALES DE LAS VENTAS POR TIPO DE COMPROBANTES.										
CLEAR(Venta);										
CLEAR(Iva);										
CLEAR(vTotal);										
CLEAR(VentasG);										
CLEAR(TotalIva);										
CLEAR(TotalVentNcr);										
CLEAR(TotalIvaNcr);										
CLEAR(VentasE);										
CLEAR(VentasNoSu);										
CLEAR(VentasEDev);										
CLEAR(VentasNoSuDev);										
										
//Imprimir Linea en blanco...										
"DSTR1 :=     COPYSTR('                     ',1);"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
//CSPNT241015 se quita facturas de exportacion										
{										
//ENCABEZADO PARA EL TIPO DE COMPROBANTE										
"DSTR1 := COPYSTR('#L######################################',1);"										
Value[1] := '3- Factura De Exportacion';										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//BUSCO PRIMERO LOS NCF PARA FACTURAS DE CONSUMIDORES FINALES										
Transaction2.RESET;										
"Transaction2.SETCURRENTKEY(""Statement Code"",""Z-Report ID"",""Transaction Type"",""Entry Status"");"										
"Transaction2.SETRANGE(""Statement Code"",SCode);"										
"Transaction2.SETRANGE(""Z-Report ID"",'');"										
"Transaction2.SETRANGE(""Transaction Type"",Transaction2.""Transaction Type""::Sales);"										
"Transaction2.SETFILTER(""Entry Status"",'%1|%2',Transaction2.""Entry Status""::"" "",Transaction2.""Entry Status""::Posted);"										
"Transaction2.SETRANGE(""No. Serie NCF"",Terminal.""No. Serie NCF Exportacion"");"										
IF  Transaction2.FINDFIRST THEN BEGIN										
"//DSTR1 := COPYSTR('  #L#######################',1);"										
"//Value[1] := 'Autorizacion:' + ' ' + UPPERCASE(Store.""Cod. Aut. Fiscal CF"");"										
"//PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
//CSRM16102013 Se quito que imprimiera los rango de facturas porq no es un solo pos en la tienda										
"//FirstFactCf := Transaction2.""Correlativo Facturas"";"										
REPEAT										
"rSalesEntry.SETRANGE(""Store No."",Transaction2.""Store No."");"										
"rSalesEntry.SETRANGE(""POS Terminal No."",Transaction2.""POS Terminal No."");"										
"rSalesEntry.SETRANGE(""Transaction No."",Transaction2.""Transaction No."");"										
IF rSalesEntry.FIND('-') THEN										
REPEAT										
rImpuestos.RESET;										
"rImpuestos.SETRANGE(""VAT Bus. Posting Group"",rSalesEntry.""VAT Bus. Posting Group"");"										
"rImpuestos.SETRANGE(""VAT Prod. Posting Group"",rSalesEntry.""VAT Prod. Posting Group"");"										
IF rImpuestos.FINDFIRST THEN BEGIN										
"Venta    += ABS(rSalesEntry.""Net Amount"");"										
"Iva      += ABS(rSalesEntry.""VAT Amount"");"										
"vTotal   += ABS(rSalesEntry.""Net Amount"") + ABS(rSalesEntry.""VAT Amount"");"										
										
IF rImpuestos.Impuesto=rImpuestos.Impuesto::Gravado THEN BEGIN										
"IF NOT Transaction2.""Sale Is Return Sale"" THEN BEGIN"										
"VentasG  += ABS(rSalesEntry.""Net Amount"");"										
"TotalIva += ABS(rSalesEntry.""VAT Amount"");"										
END										
ELSE BEGIN										
"TotalVentNcr += ABS(rSalesEntry.""Net Amount"");"										
"TotalIvaNcr  += ABS(rSalesEntry.""VAT Amount"");"										
END;										
END										
ELSE BEGIN										
IF rImpuestos.Impuesto=rImpuestos.Impuesto::Exento THEN BEGIN										
"IF NOT Transaction2.""Sale Is Return Sale"" THEN"										
"VentasE  += ABS(rSalesEntry.""Net Amount"")"										
ELSE										
"VentasEDev  += ABS(rSalesEntry.""Net Amount"")"										
END										
"ELSE IF NOT Transaction2.""Sale Is Return Sale"" THEN"										
"VentasNoSu  += ABS(rSalesEntry.""Net Amount"")"										
ELSE										
"VentasNoSuDev  += ABS(rSalesEntry.""Net Amount"")"										
END										
END;										
UNTIL rSalesEntry.NEXT = 0;										
//CSRM16102013 Se quito que imprimiera los rango de facturas porq no es un solo pos en la tienda										
"//LastFactCf := Transaction2.""Correlativo Facturas"";"										
UNTIL Transaction2.NEXT = 0;										
END;										
										
//CSRM16102013 Se quito que imprimiera los rango de facturas porq no es un solo pos en la tienda										
{										
//Del No.										
"DSTR1 := COPYSTR('#L#################################',1);"										
Value[1] := 'Del No.: ' + FirstFactCf;										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//Al No.										
"DSTR1 := COPYSTR('#L#################################',1);"										
Value[1] := 'Al No.: ' + LastFactCf;										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
}										
//CSRM16102013 Se quito que imprimiera los rango de facturas porq no es un solo pos en la tienda										
										
//Imprimir Linea en blanco...										
"DSTR1 :=     COPYSTR('                     ',1);"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//ENCABEZADO DE VENTAS TOTALES...										
"DSTR1 := COPYSTR('    #L#############',1);"										
Value[1] := 'VENTAS TOTALES:';										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
VentasG := VentasG - TotalVentNcr;										
										
//VENTAS GRAVADAS...										
"DSTR1 := COPYSTR('#L##############    #R##################',1);"										
Value[1] := 'Ventas Gravadas:';										
"Value[2] := '$' + FORMAT(VentasG,0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
TotalIva := TotalIva - TotalIvaNcr;										
										
//IMPUESTO IVA...										
"DSTR1 := COPYSTR('#L###########       #R##################',1);"										
Value[1] := 'Impuesto IVA:';										
"Value[2] := '$' + FORMAT(TotalIva,0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//Total Gravado...										
"DSTR1 := COPYSTR('#L############      #R##################',1);"										
Value[1] := 'Total Gravado:';										
"Value[2] := '$' + FORMAT(VentasG + TotalIva,0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//VENTAS EXENTAS...										
"DSTR1 := COPYSTR('#L#############     #R##################',1);"										
Value[1] := 'Ventas Exentas:';										
"Value[2] := '$' + FORMAT((VentasE-VentasEDev),0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//VENTAS NO SUJETAS...										
"DSTR1 := COPYSTR('#L################  #R##################',1);"										
Value[1] := 'Ventas No Sujetas:';										
"Value[2] := '$' + FORMAT((VentasNoSu-VentasNoSuDev),0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//VENTAS TOTALES										
"DSTR1 := COPYSTR('#L#############     #R##################',1);"										
Value[1] := 'Ventas Totales:';										
Value[2] := '$' + FORMAT((VentasG + TotalIva + VentasE + VentasNoSu)										
"-(VentasEDev+VentasNoSuDev),0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//CSRM16102013										
}										
END;										
										
IF NOT DoZ THEN BEGIN										
//Imprimir Linea en blanco...										
"DSTR1 :=     COPYSTR('                     ',1);"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//CONSISA ENCABEZADO....										
DSTR1:='#C######################################';										
IF DoZ THEN										
Value[1]:= TextEncZParcial										
ELSE										
Value[1]:= TextEncXParcial;										
										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//Imprimir Linea en blanco...										
"DSTR1 :=     COPYSTR('                     ',1);"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//CONSISA OBSERVACIONES....										
DSTR1 := '#L######################################';										
Value[1] := 'Observaciones: ' + '__________________________';										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//Imprimir Linea en blanco...										
"DSTR1 :=     COPYSTR('                     ',1);"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
DSTR1 := '#L######################################';										
Value[1] := '________________________________________';										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//Imprimir Linea en blanco...										
"DSTR1 :=     COPYSTR('                     ',1);"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
										
//CONSISA NOMBRE RESPONSABLE....										
DSTR1 := '#L######################################';										
Value[1] := 'Nombre Responsable: ' + '____________________';										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//Imprimir Linea en blanco...										
"DSTR1 :=     COPYSTR('                     ',1);"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
										
//CONSISA FIRMA RESPONSABLE....										
DSTR1:='#L######################################';										
Value[1] := 'Firma Responsable: '+ '_____________________';										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END										
ELSE IF DoZ THEN BEGIN										
//CSPNT241015 quito parte del final reporte Z										
{  //Imprimir Linea en blanco...										
"DSTR1 :=     COPYSTR('                     ',1);"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
DSTR1:='#C######################################';										
Value[1]:= 'ZZZZZZZZZZZ ZZZZZZZ ZZZZZZZZZZ';										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//Imprimir Linea en blanco...										
"DSTR1 :=     COPYSTR('                     ',1);"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
DSTR1:='#C######################################';										
Value[1]:= 'ULTIMO NUMERO UTILIZADO';										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//Imprimir Linea en blanco...										
"DSTR1 :=     COPYSTR('                     ',1);"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
"DSTR1 := COPYSTR('#C######################################',1);"										
//Value[1] := 'Ticket No.: ' + NoCorrelativoXZ; SE TIENE QUE UTILIZAR EL ULTIMO NUMERO DE TICKET										
Value[1] := 'Ticket No.: ' + LastTicket;										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//Imprimir Linea en blanco...										
"DSTR1 :=     COPYSTR('                     ',1);"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//Imprimir Linea en blanco...										
"DSTR1 :=     COPYSTR('                     ',1);"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//Imprimir Linea en blanco...										
"DSTR1 :=     COPYSTR('                     ',1);"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
}										
//Imprimir Linea en blanco...										
"DSTR1 :=     COPYSTR('                     ',1);"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
										
//CONSISA ENCABEZADO....										
DSTR1:='#C######################################';										
Value[1]:= TextEncZParcial;										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
//CSPNT241015 DSTR1 para informaci¢n impresa despues de Z										
DSTR1:='#L######################################';										
END;										
										
"Transaction.""Transaction No."" := 0;"										
"TendDeclEntry.SETCURRENTKEY(""Statement Code"",""Z-Report ID"",""Tender Type"",""Currency Code"",""Card No."");"										
"TendDeclEntry.SETRANGE(""Statement Code"",SCode);"										
"TendDeclEntry.SETRANGE(""Z-Report ID"",'');"										
"IF Store.""Tend. Decl. Calculation"" = Store.""Tend. Decl. Calculation""::Sum THEN BEGIN"										
BufferTendDeclEntry;										
IF TendDeclEntry.FIND('-') THEN										
"Transaction.""Transaction No."" := TendDeclEntry.""Transaction No."";"										
END										
ELSE BEGIN										
IF TendDeclEntry.FIND('-') THEN										
REPEAT										
"IF TendDeclEntry.""Transaction No."" > Transaction.""Transaction No."" THEN"										
"Transaction.GET(TendDeclEntry.""Store No."",TendDeclEntry.""POS Terminal No."",TendDeclEntry.""Transaction No."")"										
UNTIL TendDeclEntry.NEXT=0;										
END;										
										
"IF Transaction.""Transaction No."" <> 0 THEN BEGIN"										
"PrintLine(2,FormatLine(Text112,FALSE,TRUE,FALSE,FALSE));"										
CLEAR(TendDeclEntry);										
LocalTotal := 0;										
"IF Store.""Tend. Decl. Calculation"" = Store.""Tend. Decl. Calculation""::Last THEN BEGIN"										
"TendDeclEntry.SETCURRENTKEY(""Store No."",""POS Terminal No."",""Transaction No."");"										
"TendDeclEntry.SETRANGE(""Store No."",Transaction.""Store No."");"										
"TendDeclEntry.SETRANGE(""POS Terminal No."",Transaction.""POS Terminal No."");"										
"TendDeclEntry.SETRANGE(""Transaction No."",Transaction.""Transaction No."");"										
BufferTendDeclEntry;										
END;										
"TempTendDeclEntry.SETFILTER(""Currency Code"",'=%1','');"										
PrintTenderDeclLines;										
"Transaction.""Gross Amount"" := -LocalTotal;"										
"PrintTotal(Transaction,2,0);"										
"PrintLine(2,'');"										
"TempTendDeclEntry.SETFILTER(""Currency Code"",'<>%1','');"										
PrintTenderDeclLines;										
END;										
										
"Transaction.SETCURRENTKEY(""Statement Code"",""Z-Report ID"",""Transaction Type"",""Entry Status"");"										
"Transaction.SETRANGE(""Statement Code"",SCode);"										
"Transaction.SETRANGE(""Z-Report ID"",'');"										
"Transaction.SETRANGE(""Transaction Type"",Transaction.""Transaction Type""::Sales);"										
"Transaction.SETFILTER(""Entry Status"",'%1|%2',Transaction.""Entry Status""::"" "",Transaction.""Entry Status""::Posted);"										
"Transaction.CALCSUMS(""Gross Amount"",""Discount Amount"",""Total Discount"",Rounded,""No. of Items"");"										
										
"IncExpAccount.SETRANGE(IncExpAccount.""Store No."",Globals.StoreNo);"										
IF IncExpAccount.FIND('-') THEN BEGIN										
"IncExpEntry.SETCURRENTKEY(""Statement Code"",""Z-Report ID"",""No."");"										
"IncExpEntry.SETRANGE(""Statement Code"",SCode);"										
"IncExpEntry.SETRANGE(""Z-Report ID"",'');"										
IF IncExpEntry.FIND('-') THEN BEGIN										
PrintSeperator(2);										
REPEAT										
"IncExpEntry.SETRANGE(""No."",IncExpAccount.""No."");"										
IF IncExpEntry.FIND('-') THEN BEGIN										
Value[1] := IncExpAccount.Description;										
IncExpEntry.CALCSUMS(Amount);										
Value[2] := POSFunctions.FormatAmount(IncExpEntry.Amount);										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
UNTIL IncExpAccount.NEXT = 0;										
END;										
END;										
										
IF PaymTrans3.FIND('-') THEN										
REPEAT										
"IF NOT PaymTemp.GET(PaymTrans3.""Store No."",PaymTrans3.""POS Terminal No."",PaymTrans3.""Transaction No."") THEN BEGIN"										
"Transaction2.GET(PaymTrans3.""Store No."",PaymTrans3.""POS Terminal No."",PaymTrans3.""Transaction No."");"										
"IF Transaction2.""Transaction Type"" = Transaction2.""Transaction Type""::Sales THEN"										
RecCount := RecCount + 1;										
"PaymTemp.""Store No."" := PaymTrans3.""Store No."";"										
"PaymTemp.""POS Terminal No."" := PaymTrans3.""POS Terminal No."";"										
"PaymTemp.""Transaction No."" := PaymTrans3.""Transaction No."";"										
//cspntpaym    PaymTemp.INSERT;										
END;										
UNTIL PaymTrans3.NEXT = 0;										
										
//CSPNT211015 XZ										
PrintSeperator(2);										
										
DSTR1 := '#L######################### #R##########';										
										
Value[1] := 'Ventas brutas:';										
//CSPNT100316										
"Value[2] := POSFunctions.FormatAmount(-Transaction.""Gross Amount"" + Transaction.""Discount Amount"" +vIVAS);"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
Value[1] := 'Descuentos:';										
"Value[2] := POSFunctions.FormatAmount(-Transaction.""Discount Amount"");"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
//CSPNT191115										
{Value[1] := 'Redondeo:';										
Value[2] := POSFunctions.FormatAmount(Transaction.Rounded);										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));}"										
										
//CSPNT231015										
DSTR2 := '#L################# #R########';										
										
PrintSeperator(2);										
Value[1] := 'Ventas netas:';										
"Value[2] := POSFunctions.FormatAmount(-Transaction.""Gross Amount"" + Transaction.Rounded);"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR2),FALSE,TRUE,FALSE,FALSE));"										
PrintSeperator(2);										
										
//CSPNT231015										
DSTR2 := '#L###################### #R###';										
										
Value[1] := 'Clientes que pagaron:';										
Value[2] := FORMAT(RecCount);										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR2),FALSE,TRUE,FALSE,FALSE));"										
										
Value[1] := 'N£mero de transacciones:';										
"Value[2] := FORMAT(Transaction.COUNT,0,'<Integer>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR2),FALSE,TRUE,FALSE,FALSE));"										
										
Value[1] := 'Items vendidos: ';										
"Value[2] := FORMAT(Transaction.""No. of Items"",0,'<Integer>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR2),FALSE,TRUE,FALSE,FALSE));"										
										
"Transaction.SETRANGE(Transaction.""Sale Is Return Sale"",TRUE);"										
Value[1] := 'N£mero de devoluciones';										
"Value[2] := FORMAT(Transaction.COUNT,0,'<Integer>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR2),FALSE,TRUE,FALSE,FALSE));"										
"Transaction.SETRANGE(Transaction.""Sale Is Return Sale"");"										
										
"SuspTrans.SETRANGE(""Store No."",Store.""No."");"										
"SuspTrans.SETRANGE(""Entry Status"",SuspTrans.""Entry Status""::Suspended);"										
NoSuspended := SuspTrans.COUNT;										
Value[1] := 'N£mero de suspendidas:';										
"Value[2] := FORMAT(NoSuspended,0,'<Integer>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR2),FALSE,TRUE,FALSE,FALSE));"										
"SuspTrans.SETRANGE(""Store No."");"										
										
"Transaction.SETRANGE(""Entry Status"",Transaction.""Entry Status""::Voided);"										
Value[1] := 'N£mero de anulaciones:';										
"Value[2] := FORMAT(Transaction.COUNT,0,'<Integer>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR2),FALSE,TRUE,FALSE,FALSE));"										
//CSPNT211015 XZ										
										
"Transaction.SETRANGE(Transaction.""Sale Is Return Sale"",TRUE);"										
"Transaction.SETRANGE(Transaction.""Sale Is Return Sale"");"										
										
"SuspTrans.SETRANGE(""Store No."",Store.""No."");"										
"SuspTrans.SETRANGE(""Entry Status"",SuspTrans.""Entry Status""::Suspended);"										
NoSuspended := SuspTrans.COUNT;										
"SuspTrans.SETRANGE(""Store No."");"										
										
IF NOT DoZ AND (NoSuspended > 0) THEN BEGIN										
"IF Terminal.""Print Suspend with Prepayment"" THEN BEGIN"										
NoSuspPrepayment := 0;										
SuspPrepayment := 0;										
										
SuspTransLine.RESET;										
"SuspTransLine.SETCURRENTKEY(""Receipt No."",""Entry Type"",""Entry Status"");"										
"SuspTransLine.SETRANGE(""Entry Type"",SuspTransLine.""Entry Type""::IncomeExpense);"										
IF SuspTransLine.FIND('-') THEN BEGIN										
REPEAT										
"IF (SuspTransLine.""POS Terminal No."" = '0') THEN BEGIN"										
NoSuspPrepayment := NoSuspPrepayment + 1;										
SuspPrepayment := SuspPrepayment + SuspTransLine.Amount;										
END;										
UNTIL SuspTransLine.NEXT = 0;										
END;										
SuspPrepayment := ABS(SuspPrepayment);										
IF (NoSuspPrepayment > 0) THEN BEGIN										
END;										
IF (SuspPrepayment > 0) THEN BEGIN										
END;										
END;										
END;										
										
"Transaction.SETRANGE(""Entry Status"",Transaction.""Entry Status""::Voided);"										
"Transaction.SETRANGE(""Entry Status"",Transaction.""Entry Status""::Training);"										
"Transaction.SETRANGE(""Entry Status"");"										
"Transaction.SETFILTER(""Transaction Type"",'%1|%2',"										
"Transaction.""Transaction Type""::Sales,Transaction.""Transaction Type""::""Open Drawer"");"										
"Transaction.SETRANGE(""Open Drawer"",TRUE);"										
"Transaction.SETRANGE(""Open Drawer"");"										
"Transaction.SETRANGE(""Transaction Type"",Transaction.""Transaction Type""::Logon);"										
"Transaction.SETRANGE(""Transaction Type"");"										
										
IF DoZ THEN BEGIN										
"IF Terminal.""Statement Method"" = Terminal.""Statement Method""::""POS Terminal"" THEN BEGIN"										
"IF Terminal.""Last Z-Report"" <> '' THEN"										
"Terminal.""Last Z-Report"" := INCSTR(Terminal.""Last Z-Report"")"										
ELSE										
"Terminal.""Last Z-Report"" :='T000000001';"										
"ZReportID := Terminal.""Last Z-Report"";"										
END										
ELSE BEGIN										
"IF Staff.""Last Z-Report"" <> '' THEN"										
"Staff.""Last Z-Report"" := INCSTR(Staff.""Last Z-Report"")"										
ELSE										
"Staff.""Last Z-Report"" :='S000000001';"										
"ZReportID := Staff.""Last Z-Report"";"										
END;										
IF (Globals.GetValue('TS_ERROR') <> '') THEN										
"ZReportID := 'X' + COPYSTR(ZReportID,2);"										
END;										
										
IF NOT DoZ THEN BEGIN										
"IF GenPosFunc.""TS Send Transactions"" AND (GenPosFunc.""Send Transaction"" <> '') THEN BEGIN"										
TransServerWorkTable.RESET;										
"TransServerWorkTable.SETRANGE(Table,DATABASE::""Transaction Header"");"										
"TransServerWorkTable.SETRANGE(""Store No."",Globals.StoreNo);"										
"TransServerWorkTable.SETRANGE(""POS Terminal No."",Globals.TerminalNo);"										
TransNotSent := TransServerWorkTable.COUNT;										
IF TransNotSent > 0 THEN BEGIN										
END;										
END;										
END;										
										
IF NOT ClosePrinter(2) THEN										
EXIT(FALSE);										
										
IF DoZ THEN BEGIN										
"IF Terminal.""Statement Method"" = Terminal.""Statement Method""::""POS Terminal"" THEN"										
Terminal.MODIFY										
ELSE BEGIN										
Staff.MODIFY;										
END;										
										
"PaymEntry.SETRANGE(""Currency Code"");"										
"PaymEntry.SETRANGE(""Card No."");"										
"PaymEntry.SETRANGE(""Tender Type"");"										
IF PaymEntry.FIND('-') THEN REPEAT										
PaymTrans2 := PaymEntry;										
"PaymTrans2.""Z-Report ID"" := ZReportID;"										
PaymTrans2.MODIFY(TRUE);										
UNTIL PaymEntry.NEXT = 0;										
										
CLEAR(TendDeclEntry);										
"TendDeclEntry.SETCURRENTKEY(""Statement Code"",""Z-Report ID"",""Tender Type"",""Currency Code"",""Card No."");"										
"TendDeclEntry.SETRANGE(""Statement Code"",SCode);"										
"TendDeclEntry.SETRANGE(""Z-Report ID"",'');"										
IF TendDeclEntry.FIND('-') THEN REPEAT										
TendDeclEntry2 :=  TendDeclEntry;										
"TendDeclEntry2.""Z-Report ID"" := ZReportID;"										
TendDeclEntry2.MODIFY(TRUE);										
UNTIL TendDeclEntry.NEXT=0;										
										
CLEAR(IncExpEntry);										
"IncExpEntry.SETCURRENTKEY(""Statement Code"",""Z-Report ID"");"										
"IncExpEntry.SETRANGE(""Statement Code"",SCode);"										
"IncExpEntry.SETRANGE(""Z-Report ID"",'');"										
IF IncExpEntry.FIND('-') THEN REPEAT										
IncExpEntry2 := IncExpEntry;										
"IncExpEntry2.""Z-Report ID"" := ZReportID;"										
IncExpEntry2.MODIFY(TRUE);										
UNTIL IncExpEntry.NEXT = 0;										
										
IF Transaction.FIND('-') THEN REPEAT										
Transaction3 := Transaction;										
"Transaction3.""Z-Report ID""            := ZReportID;"										
"Transaction3.""Correlativo Reporte-Z""  := NoCorrelativoXZ; //CONSISA PARA GUARDAR EL CORRELATIVO FISCAL EN EL TRANS. HEADER."										
Transaction3.MODIFY(TRUE);										
UNTIL Transaction.NEXT = 0;										
										
"Globals.SetValue('LAST_ZID',ZReportID);"										
										
ZReportHist.INIT;										
"ZReportHist.""Store No.""           := Store.""No."";"										
"ZReportHist.""POS Terminal No.""    := Terminal.""No."";"										
"ZReportHist.""Z-Report ID""         := ZReportID;"										
"ZReportHist.""Correlativo Fiscal""  := NoCorrelativoXZ;"										
ZReportHist.INSERT;										
COMMIT;     //CSRG01										
										
//CSRG01+										
										
PAGE.RUNMODAL(50001);										
//CSRG01-										
END;										
										
//CSRM19092013										
IF NOT DoZ THEN BEGIN										
"Terminal.""Last X-Report"" := INCSTR(Terminal.""Last X-Report"");"										
Terminal.MODIFY;										
END;										
										
EXIT(TRUE);										
END;										
										
PROCEDURE SaveRolloAuditor@1000000002(FechaIni@1000000000 : Date;Zid@1000000001 : Code[20]);										
VAR										
VZid@1000000002 : Code[20];										
BEGIN										
										
//CSRG01+										
"PrintingCopyRollo.SETRANGE(""Store No."",Globals.StoreNo);"										
"PrintingCopyRollo.SETRANGE(""Pos Terminal No."",Globals.TerminalNo);"										
Fecha := FechaIni;										
"PrintingCopyRollo.SETRANGE(Date,Fecha);"										
										
CLEAR(AuditorRoll_lrep);										
AuditorRoll_lrep.USEREQUESTPAGE(FALSE);										
AuditorRoll_lrep.SETTABLEVIEW(PrintingCopyRollo);										
RetailSetup.GET;										
"RetailSetup.TESTFIELD(""Printing File Path"");"										
"IF COPYSTR(RetailSetup.""Printing File Path"", STRLEN(RetailSetup.""Printing File Path"")) <> '\' THEN"										
"RetailSetup.""Printing File Path"" += '\';"										
										
//AuditorRoll_lrep.SAVEASPDF('C:\Temp\Rollo.PDF');										
										
"AuditorRoll_lrep.SAVEASPDF(RetailSetup.""Printing File Path"" + 'RolloAuditorMH' + '-' +"										
"DELCHR(FORMAT(Fecha),'=','/') +'-' + Globals.StoreNo + '-'  + Globals.TerminalNo +'.PDF');"										
//CSRG01-										
END;										
										
PROCEDURE InsertPrintingCopy@1000000003(Txt@1000000000 : Text[100];Wide@1000000001 : Boolean;Bold@1000000002 : Boolean;High@10000000	3	: B	oo	lea	n;Italic@1000000004 : Boolean);					
BEGIN										
										
IF										
PrintingCopy.FINDLAST THEN										
"PrintingCopyLastRecord := PrintingCopy.""Entry No."";"										
										
PrintingCopy.INIT;										
"PrintingCopy.""Entry No."" := PrintingCopyLastRecord + 1;"										
"PrintingCopy.""Printing Type"" := CurrPrintType;"										
"PrintingCopy.""Printing No."" := CurrPrintNo;"										
"PrintingCopy.""Line Printed"" := Txt;"										
PrintingCopy.Wide := Wide;										
PrintingCopy.Bold := Bold;										
PrintingCopy.High := High;										
PrintingCopy.Italic := Italic;										
PrintingCopy.Date := TODAY;   //CSRG01										
PrintingCopy.Time := TIME;    //CSRG01										
"PrintingCopy.""Pos Terminal No."" :=  Globals.TerminalNo;  //CSRG01"										
"PrintingCopy.""Store No.""        :=  Globals.StoreNo;         //CSRG01"										
PrintingCopy.INSERT;										
END;										
										
PROCEDURE PrintZReportMensualSV@1000000004(DoZ@1000000000 : Boolean) : Boolean;										
VAR										
Staff@1000000065 : Record 99001461;										
Terminal@1000000064 : Record 99001471;										
SCode@1000000063 : Code[20];										
Transaction@1000000062 : Record 99001472;										
DSTR1@1000000061 : Text[80];										
rCompanyInfo@1000000060 : Record 79;										
rNoSeries@1000000059 : Record 308;										
rNoSeriesLn@1000000058 : Record 309;										
Transaction2@1000000057 : Record 99001472;										
PaymTrans3@1000000056 : Record 99001474;										
RemoveTotal@1000000055 : Decimal;										
FloatTotal@1000000054 : Decimal;										
FirstTicket@1000000053 : Code[20];										
LastTicket@1000000052 : Code[20];										
Venta@1000000051 : Decimal;										
Iva@1000000050 : Decimal;										
vTotal@1000000049 : Decimal;										
rSalesEntry@1000000048 : Record 99001473;										
rImpuestos@1000000047 : Record 50005;										
VentasG@1000000046 : Decimal;										
VentasE@1000000045 : Decimal;										
VentasNoSu@1000000044 : Decimal;										
TotalIva@1000000043 : Decimal;										
TotalVentNcr@1000000042 : Decimal;										
TotalIvaNcr@1000000041 : Decimal;										
VentasEDev@1000000040 : Decimal;										
VentasNoSuDev@1000000039 : Decimal;										
Percepcion@1000000038 : Decimal;										
Retencion@1000000037 : Decimal;										
PercepcionDev@1000000036 : Decimal;										
RetencionDev@1000000035 : Decimal;										
Percibido@1000000034 : Decimal;										
Retenido@1000000033 : Decimal;										
Correlativo@1000000032 : Integer;										
TmpTender@1000000031 : Record 50004;										
rTenderTypeSetup@1000000030 : Record 99001466;										
rTransPaymentEntry@1000000029 : Record 99001474;										
VFondoFijo@1000000028 : Decimal;										
VRetiroEfectivo@1000000027 : Decimal;										
VEfectivoRetiro@1000000026 : Decimal;										
VTarjetaManualRetiro@1000000025 : Decimal;										
VTarjetaRetiro@1000000024 : Decimal;										
vChequeRetiro@1000000023 : Decimal;										
VCreditoRetiro@1000000022 : Decimal;										
VLealtadRetiro@1000000021 : Decimal;										
VTarjetaRegaloRetiro@1000000020 : Decimal;										
IncExpAccount@1000000019 : Record 99001476;										
IncExpEntry@1000000018 : Record 99001475;										
PaymTemp@1000000017 : Record 99001474;										
RecCount@1000000016 : Integer;										
SuspTrans@1000000015 : Record 99008980;										
NoSuspended@1000000014 : Integer;										
NoSuspPrepayment@1000000013 : Integer;										
SuspPrepayment@1000000012 : Integer;										
SuspTransLine@1000000011 : Record 99008981;										
ZReportID@1000000010 : Code[10];										
TransServerWorkTable@1000000009 : Record 99001615;										
TransNotSent@1000000008 : Integer;										
PaymTrans2@1000000007 : Record 99001474;										
TendDeclEntry2@1000000006 : Record 99001465;										
IncExpEntry2@1000000005 : Record 99001475;										
Transaction3@1000000004 : Record 99001472;										
NoCorrelativoXZ@1000000003 : Code[20];										
ZReportHist@1000000002 : Record 50006;										
TextEncXMensual@1000000066 : TextConst 'ENU=XXXXXXXXX CORTE X PARCIAL XXXXXXXXX';										
TextEncZMensual@1000000067 : TextConst 'ENU=CORTE Z MENSUAL';										
TextNRC@1000000068 : TextConst 'ENU=NRC.';										
TextRNC@1000000069 : TextConst 'ENU=NIT';										
TextGIRO@1000000070 : TextConst 'ENU=GIRO';										
TextCodTienda@1000000071 : TextConst 'ENU=Cod.Tienda:';										
TextCaja@1000000072 : TextConst 'ENU=Caja:';										
rFecha@1000000073 : Record 2000000007;										
InicPeriodo@1000000074 : Date;										
FinPeriodo@1000000075 : Date;										
FirstFactCf@1000000076 : Code[20];										
LastFactCf@1000000077 : Code[20];										
FirstFactCrf@1000000078 : Code[20];										
LastFactCrf@1000000079 : Code[20];										
vVentasGravadasTotales@1000000085 : Decimal;										
vImpuestosTotales@1000000084 : Decimal;										
vTotalGravadoTotales@1000000083 : Decimal;										
vVentasExentasTotales@1000000082 : Decimal;										
vVentasNoSujetasTotales@1000000081 : Decimal;										
vVentasTotalesTotales@1000000080 : Decimal;										
vImpuestoIVATotales@1000000001 : Decimal;										
vIVAPercibidoTotales@1000000101 : Decimal;										
vIVAPercibidoDevTotales@1000000100 : Decimal;										
vIVARetenidoTotales@1000000099 : Decimal;										
vFirstFactCredAut@1000000098 : Text[20];										
vLastFactCredAut@1000000097 : Text[20];										
FirstFactCrfDev@1000000096 : Code[20];										
LastFactCrfDev@1000000095 : Code[20];										
FirstFactCfDev@1000000094 : Code[20];										
LastFactCfDev@1000000093 : Code[20];										
vTotalDocDevolucion@1000000092 : Decimal;										
vTotalIvaDocDevolucion@1000000091 : Decimal;										
vTotalRetencionDev@1000000090 : Decimal;										
VentasEDevDocDev@1000000089 : Decimal;										
vFirstFactCFAut@1000000088 : Text[20];										
vLastFactCFAut@1000000087 : Text[20];										
vNoDevoluciones@1000000086 : Integer;										
rFechaAuxiliar@1000000103 : Record 50046;										
vMesNo@1000000102 : Integer;										
vFirstFechaCref@1000000109 : Date;										
vLastFechaCref@1000000108 : Date;										
vFirstFechaNocre@1000000107 : Date;										
vLastFechaNocre@1000000106 : Date;										
vFirstFechaFac@1000000105 : Date;										
vLastFechaFac@1000000104 : Date;										
rRecargasElectronicas@1000000110 : Record 50040;										
vCESC@1000000111 : Decimal;										
vCESCTotales@1000000112 : Decimal;										
BEGIN										
										
//PrintXZReport										
IF NOT Staff.GET(Globals.StaffID) THEN										
EXIT(TRUE);										
IF NOT Terminal.GET(Globals.TerminalNo) THEN										
EXIT(TRUE);										
"IF NOT OpenReceiptPrinter(2, 'TENDER', 'ZXREPORTM', 0, '') THEN"										
EXIT(FALSE);										
										
"IF NOT Terminal.""Terminal Statement"" THEN"										
"Terminal.""Statement Method"" := Store.""Statement Method"";"										
										
SCode := POSFunctions.GetStatementCode;										
										
Transaction.Date := TODAY;										
Transaction.Time := TIME;										
										
//CSPNT170516										
PrintSeperator(2);										
//CONSISA ENCABEZADO....										
DSTR1:='#C######################################';										
Value[1]:= TextEncZMensual;										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//CSPNT240816										
rFechaAuxiliar.RESET;										
rFechaAuxiliar.FINDLAST;										
DSTR1:='#C######################################';										
Value[1]:= 'Mes: ' + FORMAT(rFechaAuxiliar.Mes) + ' ' + FORMAT(rFechaAuxiliar.Anio);										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//CSPNT170516										
PrintSeperator(2);										
										
//CSPNT170516 informaci¢n general										
DSTR1 := '#L######################################';										
"Value[1] := 'Fecha: ' + FORMAT(TODAY,0,'<Day,2>/<Month,2>/<Year4>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
DSTR1 := '#L######################################';										
"Value[1] := 'Hora: ' + FORMAT(TIME(),0,'<Hours12>:<Minutes,2> <AM/PM>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//Imprimir Linea en blanco...										
"DSTR1 :=     COPYSTR('                     ',1);"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//CONSISA-Imprimir Nombre de la empresa...										
rCompanyInfo.GET();										
"DSTR1 := COPYSTR('#C######################################',1);"										
Value[1] := rCompanyInfo.Name;										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//CONSISA-Imprimir Codigo Tipo Contribuyente y  No. Reg. Contribuyente de la empresa...										
rCompanyInfo.GET();										
"DSTR1 := COPYSTR('#C######################################',1);"										
"Value[1] := rCompanyInfo.""Tipo de Contibuyente"" + ' ' + TextNRC + ' ' + rCompanyInfo.NRC;"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//CONSISA-Imprimir NIT de la empresa...										
rCompanyInfo.GET();										
"DSTR1 := COPYSTR('#C######################################',1);"										
"Value[1] := TextRNC + ' ' + rCompanyInfo.""VAT Registration No."";"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//CONSISA-Imprimir Giro de la empresa...										
rCompanyInfo.GET();										
"DSTR1 := COPYSTR('#L################################################',1);"										
Value[1] := TextGIRO + ':' + rCompanyInfo.Giro;										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//Imprimir Linea en blanco...										
"DSTR1 :=     COPYSTR('                     ',1);"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//CONSISA-Imprimir Nombre de la tienda.										
"DSTR1 := COPYSTR('#L######################################',1);"										
Value[1] := Store.Name;										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//CONSISA-Imprimir 1era. direccion de la tienda.										
"DSTR1 := COPYSTR('#L######################################',1);"										
Value[1] := Store.Address;										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//CONSISA-Imprimir 2da. direccion de la tienda.										
"IF Store.""Address 2"" <> '' THEN BEGIN"										
"DSTR1 := COPYSTR('#L######################################',1);"										
"Value[1] := Store.""Address 2"";"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
										
//CONSISA-Imprimir el No. de la Caja..										
"DSTR1 := COPYSTR('#L################## #R#################',1);"										
"Value[1] := TextCodTienda + ' ' + Store.""No."";"										
"Value[2] := TextCaja + ' ' + Terminal.""No."";"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//Imprimir Linea en blanco...										
"DSTR1 :=     COPYSTR('                     ',1);"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//CSPNT170516										
PrintSeperator(2);										
//CONSISA-Corte No.:										
"DSTR1 := COPYSTR('#C######################################',1);"										
"Value[1] := 'Corte Z Mensual No.: ' + INCSTR(Terminal.""Last Z-ReportM"");"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//Imprimir Linea en blanco...										
"DSTR1 :=     COPYSTR('                     ',1);"										
Value[1] := '';										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//CSPNT240816rFecha.RESET;										
"{rFecha.SETRANGE(""Period Type"",rFecha.""Period Type""::Month);"										
"rFecha.SETRANGE(""Period Start"",DMY2DATE(1,DATE2DMY(TODAY,2),DATE2DMY(TODAY,3)));"										
IF rFecha.FINDFIRST THEN BEGIN										
"InicPeriodo := rFecha.""Period Start"";"										
FinPeriodo  := TODAY;										
"//FinPeriodo  := NORMALDATE(rFecha.""Period End""); YA NO MOSTRARA EL MES COMPLETO, SI NO, QUE SE MOSTRARA DESDE EL INICIO DEL MES"										
//HASTA LA FECHA EN QUE SE ESTA GENERANDO.										
END;}										
										
//CSPNT240816										
CASE rFechaAuxiliar.Mes OF										
"rFechaAuxiliar.Mes::""1"" : vMesNo := 1;"										
"rFechaAuxiliar.Mes::""2"" : vMesNo := 2;"										
"rFechaAuxiliar.Mes::""3"" : vMesNo := 3;"										
"rFechaAuxiliar.Mes::""4"" : vMesNo := 4;"										
"rFechaAuxiliar.Mes::""5"" : vMesNo := 5;"										
"rFechaAuxiliar.Mes::""6"" : vMesNo := 6;"										
"rFechaAuxiliar.Mes::""7"" : vMesNo := 7;"										
"rFechaAuxiliar.Mes::""8"" : vMesNo := 8;"										
"rFechaAuxiliar.Mes::""9"" : vMesNo := 9;"										
"rFechaAuxiliar.Mes::""10"" : vMesNo := 10;"										
"rFechaAuxiliar.Mes::""11"" : vMesNo := 11;"										
"rFechaAuxiliar.Mes::""12"" : vMesNo := 12;"										
END;										
"InicPeriodo := DMY2DATE(1,vMesNo,rFechaAuxiliar.Anio);"										
//CSPNT101016										
"FinPeriodo  := CALCDATE('PM',InicPeriodo);"										
										
//Modificado por Consisa para que se imprima la ultima fecha de las transacciones encontradas										
Transaction2.RESET;										
"Transaction2.SETCURRENTKEY(""Statement Code"",""Z-Report ID"",""Transaction Type"",""Entry Status"");"										
"Transaction2.SETRANGE(""Statement Code"",SCode);"										
"Transaction2.SETFILTER(""Z-Report ID"",'<>%1','');"										
"Transaction2.SETRANGE(""Transaction Type"",Transaction.""Transaction Type""::Sales);"										
"Transaction2.SETFILTER(""Entry Status"",'%1|%2',Transaction.""Entry Status""::"" "",Transaction.""Entry Status""::Posted);"										
"//CSPNT240816Transaction2.SETRANGE(Date,rFecha.""Period Start"",FinPeriodo);"										
"Transaction2.SETRANGE(Date,InicPeriodo,FinPeriodo);"										
										
IF  Transaction2.FINDLAST THEN BEGIN										
//CSPNT290816										
DSTR1 :='#L################## #L#################';										
"Value[1] := 'Del:' + FORMAT(InicPeriodo,0,'<Day,2>/<Month,2>/<Year4>');"										
"Value[2] := 'Al:' + FORMAT(Transaction2.Date,0,'<Day,2>/<Month,2>/<Year4>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
										
//CSPNT170516										
PrintSeperator(2);										
										
//Imprimir Linea en blanco...										
"DSTR1 :=     COPYSTR('                     ',1);"										
Value[1] := '';										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
"IF GenPosFunc.""TS Floating Cashier"" AND"										
"(Terminal.""Statement Method"" = Terminal.""Statement Method""::Staff) AND"										
(Globals.GetValue('TS_ERROR') <> '') THEN BEGIN										
END;										
										
CLEAR(PaymEntry);										
"PaymEntry.SETCURRENTKEY(""Statement Code"",""Z-Report ID"",""Tender Type"",""Currency Code"",""Card No."");"										
"PaymEntry.SETRANGE(""Statement Code"",SCode);"										
"PaymEntry.SETRANGE(""Z-Report ID"",'');"										
PaymTrans3.COPYFILTERS(PaymEntry);										
										
"TenderType.SETCURRENTKEY(""Store No."");"										
"TenderType.SETRANGE(""Store No."",Globals.StoreNo);"										
"TenderType.SETFILTER(TenderType.""Function"",'<>%1',TenderType.""Function""::""Tender Remove/Float"");"										
"TenderType.SETRANGE(""Foreign Currency"",FALSE);"										
LocalTotal := 0;										
"TenderType.SETRANGE(""Foreign Currency"",TRUE);"										
LocalTotal := 0;										
										
"TenderType.SETRANGE(""Foreign Currency"");"										
"TenderType.SETRANGE(TenderType.""Function"",TenderType.""Function""::""Tender Remove/Float"");"										
IF TenderType.FIND('-') THEN BEGIN										
REPEAT										
"PaymEntry.SETRANGE(""Currency Code"");"										
"PaymEntry.SETRANGE(""Card No."");"										
"PaymEntry.SETRANGE(""Tender Type"",TenderType.Code);"										
IF PaymEntry.FIND('-') THEN										
REPEAT										
"Transaction.GET(PaymEntry.""Store No."",PaymEntry.""POS Terminal No."",PaymEntry.""Transaction No."");"										
"CASE Transaction.""Transaction Type"" OF"										
"Transaction.""Transaction Type""::""Remove Tender"" :"										
"RemoveTotal := RemoveTotal + PaymEntry.""Amount Tendered"";"										
"Transaction.""Transaction Type""::""Float Entry"" :"										
"FloatTotal := FloatTotal + PaymEntry.""Amount Tendered"";"										
END;										
UNTIL PaymEntry.NEXT = 0;										
UNTIL TenderType.NEXT = 0;										
END;										
										
"Transaction.""Transaction No."" := 0;"										
"TendDeclEntry.SETCURRENTKEY(""Statement Code"",""Z-Report ID"",""Tender Type"",""Currency Code"",""Card No."");"										
"TendDeclEntry.SETRANGE(""Statement Code"",SCode);"										
"TendDeclEntry.SETRANGE(""Z-Report ID"",'');"										
"IF Store.""Tend. Decl. Calculation"" = Store.""Tend. Decl. Calculation""::Sum THEN BEGIN"										
BufferTendDeclEntry;										
IF TendDeclEntry.FIND('-') THEN										
"Transaction.""Transaction No."" := TendDeclEntry.""Transaction No."";"										
END ELSE BEGIN										
IF TendDeclEntry.FIND('-') THEN										
REPEAT										
"IF TendDeclEntry.""Transaction No."" > Transaction.""Transaction No."" THEN"										
"Transaction.GET(TendDeclEntry.""Store No."",TendDeclEntry.""POS Terminal No."",TendDeclEntry.""Transaction No."")"										
UNTIL TendDeclEntry.NEXT=0;										
END;										
										
"IF Transaction.""Transaction No."" <> 0 THEN BEGIN"										
CLEAR(TendDeclEntry);										
LocalTotal := 0;										
"IF Store.""Tend. Decl. Calculation"" = Store.""Tend. Decl. Calculation""::Last THEN BEGIN"										
"TendDeclEntry.SETCURRENTKEY(""Store No."",""POS Terminal No."",""Transaction No."");"										
"TendDeclEntry.SETRANGE(""Store No."",Transaction.""Store No."");"										
"TendDeclEntry.SETRANGE(""POS Terminal No."",Transaction.""POS Terminal No."");"										
"TendDeclEntry.SETRANGE(""Transaction No."",Transaction.""Transaction No."");"										
BufferTendDeclEntry;										
END;										
"TempTendDeclEntry.SETFILTER(""Currency Code"",'=%1','');"										
"Transaction.""Gross Amount"" := -LocalTotal;"										
"TempTendDeclEntry.SETFILTER(""Currency Code"",'<>%1','');"										
END;										
										
//CONSISA BUSCO LOS TICKETS Y LAS DEVOLUCIONES PARA EL REPORTE X...										
IF DoZ THEN BEGIN										
//CSPNT170516										
vVentasGravadasTotales := 0;										
vImpuestoIVATotales := 0;										
vTotalGravadoTotales := 0;										
vVentasExentasTotales := 0;										
vVentasNoSujetasTotales := 0;										
vVentasTotalesTotales := 0;										
vIVAPercibidoTotales := 0;										
vIVAPercibidoDevTotales := 0;										
vIVARetenidoTotales := 0;										
										
//ENCABEZADO PARA EL TIPO DE COMPROBANTE										
"DSTR1 := COPYSTR('#C######################################',1);"										
Value[1] := '1- Ticket';										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
Transaction2.RESET;										
"Transaction2.SETCURRENTKEY(""Statement Code"",""Z-Report ID"",""Transaction Type"",""Entry Status"");"										
"Transaction2.SETRANGE(""Statement Code"",SCode);"										
"Transaction2.SETFILTER(""Z-Report ID"",'<>%1','');"										
"Transaction2.SETRANGE(""Transaction Type"",Transaction2.""Transaction Type""::Sales);"										
"//CSPNT170516  Transaction2.SETFILTER(""Entry Status"",'%1|%2',Transaction2.""Entry Status""::"" "",Transaction2.""Entry Status""::Posted)"	;									
"Transaction2.SETFILTER(""Entry Status"",'%1|%2|%3',Transaction2.""Entry Status""::"" "",Transaction2.""Entry Status""::Posted,Transactio"	n2.	"""En"	tr	y S	"tatus""::Voided);"					
"//CSPNT240816Transaction2.SETRANGE(Date,rFecha.""Period Start"",FinPeriodo);"										
"Transaction2.SETRANGE(Date,InicPeriodo,FinPeriodo);"										
"Transaction2.SETRANGE(""No. Serie NCF"",Terminal.""No. Serie NCF Ticket"");"										
IF  Transaction2.FINDFIRST THEN BEGIN										
rNoSeries.RESET;										
"//CSPNT170516    IF rNoSeries.GET(Transaction2.""No. Serie NCF"") THEN BEGIN"										
"IF rNoSeries.GET(Terminal.""No. Serie NCF Ticket"") THEN BEGIN"										
rNoSeriesLn.RESET;										
"rNoSeriesLn.SETRANGE(""Series Code"",rNoSeries.Code);"										
IF rNoSeriesLn.FINDFIRST THEN BEGIN										
//CSPNT170516										
"DSTR1 := COPYSTR('#L######################################',1);"										
Value[1] := 'Autorizacion: ' + UPPERCASE(rNoSeriesLn.Autorizacion);										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
//CONSISA-Imprimir el rango de ticket..										
"DSTR1 := COPYSTR('#L######################################',1);"										
"Value[1] := 'Del ' + rNoSeriesLn.""Starting No."";"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
"DSTR1 := COPYSTR('#L######################################',1);"										
"Value[1] := 'al  ' + rNoSeriesLn.""Ending No."";"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
END;										
										
FirstTicket := Transaction2.NCF;										
										
REPEAT										
//CSPNT170516										
CLEAR(Venta);										
CLEAR(Iva);										
CLEAR(vTotal);										
"rSalesEntry.SETRANGE(""Store No."",Transaction2.""Store No."");"										
"rSalesEntry.SETRANGE(""POS Terminal No."",Transaction2.""POS Terminal No."");"										
"rSalesEntry.SETRANGE(""Transaction No."",Transaction2.""Transaction No."");"										
IF rSalesEntry.FIND('-') THEN										
REPEAT										
rImpuestos.RESET;										
"rImpuestos.SETRANGE(""VAT Bus. Posting Group"",rSalesEntry.""VAT Bus. Posting Group"");"										
"rImpuestos.SETRANGE(""VAT Prod. Posting Group"",rSalesEntry.""VAT Prod. Posting Group"");"										
IF rImpuestos.FINDFIRST THEN BEGIN										
"Venta    += ABS(rSalesEntry.""Net Amount"");"										
"Iva      += ABS(rSalesEntry.""VAT Amount"");"										
"vTotal   += ABS(rSalesEntry.""Net Amount"") + ABS(rSalesEntry.""VAT Amount"");"										
										
IF rImpuestos.Impuesto=rImpuestos.Impuesto::Gravado THEN BEGIN										
"IF NOT Transaction2.""Sale Is Return Sale"" THEN BEGIN"										
"VentasG  += ABS(rSalesEntry.""Net Amount"");"										
"TotalIva += ABS(rSalesEntry.""VAT Amount"");"										
END										
ELSE BEGIN										
"TotalVentNcr += ABS(rSalesEntry.""Net Amount"");"										
"TotalIvaNcr  += ABS(rSalesEntry.""VAT Amount"");"										
END;										
END										
ELSE BEGIN										
IF rImpuestos.Impuesto=rImpuestos.Impuesto::Exento THEN BEGIN										
"IF NOT Transaction2.""Sale Is Return Sale"" THEN"										
"VentasE  += ABS(rSalesEntry.""Net Amount"")"										
ELSE										
"VentasEDev  += ABS(rSalesEntry.""Net Amount"")"										
END										
"ELSE IF NOT Transaction2.""Sale Is Return Sale"" THEN"										
"VentasNoSu  += ABS(rSalesEntry.""Net Amount"")"										
ELSE										
"VentasNoSuDev  += ABS(rSalesEntry.""Net Amount"")"										
END										
END;										
UNTIL rSalesEntry.NEXT = 0;										
										
LastTicket := Transaction2.NCF;										
										
//CSPNT010916										
rRecargasElectronicas.RESET;										
"rRecargasElectronicas.SETRANGE(""Store No."", Transaction2.""Store No."");"										
"rRecargasElectronicas.SETRANGE(""POS Terminal No."", Transaction2.""POS Terminal No."");"										
"rRecargasElectronicas.SETRANGE(""Receipt No."", Transaction2.""Receipt No."");"										
IF rRecargasElectronicas.FINDFIRST THEN										
vCESC := vCESC + rRecargasElectronicas.CESC;										
										
UNTIL Transaction2.NEXT = 0;										
END;										
										
//CSPNT170516										
//CSPNT070916										
IF (FirstTicket <> '') OR (LastTicket <> '') THEN BEGIN										
"DSTR1 := COPYSTR('#L######################################',1);"										
Value[1] := 'Del No.: ' + FirstTicket;										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
"DSTR1 := COPYSTR('#L######################################',1);"										
Value[1] := 'Al No.: ' + LastTicket;										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
										
//Imprimir Linea en blanco...										
"DSTR1 :=     COPYSTR('                     ',1);"										
Value[1] := '';										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//CSPNT050216										
{  //ENCABEZADO DE VENTAS TOTALES...										
"DSTR1 := COPYSTR('    #L#############',1);"										
Value[1] := 'VENTAS TOTALES:';										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
}										
VentasG := VentasG - TotalVentNcr;										
										
//VENTAS GRAVADAS...										
"DSTR1 := COPYSTR('#L##############    #R##################',1);"										
Value[1] := 'Ventas Gravadas:';										
"Value[2] := '$' + FORMAT(VentasG,0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
TotalIva := TotalIva - TotalIvaNcr;										
										
//IMPUESTO IVA...										
"DSTR1 := COPYSTR('#L###########       #R##################',1);"										
Value[1] := 'Impuesto IVA:';										
//CSPNT010916										
"Value[2] := '$' + FORMAT(TotalIva - vCESC,0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//CSPNT010916 IMPUESTO CESC...										
"DSTR1 := COPYSTR('#L############           #R#############',1);"										
Value[1] := 'Impuesto CESC:';										
"Value[2] := '$' + FORMAT(vCESC,0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//Total Gravado...										
"DSTR1 := COPYSTR('#L############      #R##################',1);"										
Value[1] := 'Total Gravado:';										
"Value[2] := '$' + FORMAT(VentasG + TotalIva,0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//VENTAS EXENTAS...										
"DSTR1 := COPYSTR('#L#############     #R##################',1);"										
Value[1] := 'Ventas Exentas:';										
"Value[2] := '$' + FORMAT((VentasE-VentasEDev),0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//VENTAS NO SUJETAS...										
"DSTR1 := COPYSTR('#L################  #R##################',1);"										
Value[1] := 'Ventas No Sujetas:';										
"Value[2] := '$' + FORMAT((VentasNoSu-VentasNoSuDev),0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//VENTAS TOTALES										
"DSTR1 := COPYSTR('#L#############     #R##################',1);"										
Value[1] := 'Ventas Totales:';										
"Value[2] := '$' + FORMAT((VentasG + TotalIva + VentasE + VentasNoSu)-(VentasEDev+VentasNoSuDev),0,'<Integer Thousand><Decimals,3"	>')	;								
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//CSPNT050216										
vVentasGravadasTotales := vVentasGravadasTotales + VentasG;										
//CSPNT010916										
vImpuestoIVATotales := vImpuestoIVATotales + TotalIva - vCESC;										
vCESCTotales := vCESCTotales + vCESC;										
vTotalGravadoTotales := vTotalGravadoTotales + (VentasG + TotalIva);										
vVentasExentasTotales := vVentasExentasTotales + (VentasE-VentasEDev);										
vVentasNoSujetasTotales := vVentasNoSujetasTotales + (VentasNoSu-VentasNoSuDev);										
vVentasTotalesTotales := vVentasTotalesTotales + ((VentasG + TotalIva + VentasE + VentasNoSu)-(VentasEDev+VentasNoSuDev));										
										
//LIMPIO LAS VARIABLES QUE MUESTRAN LOS TOTALES DE LAS VENTAS POR TIPO DE COMPROBANTES.										
//CSPNT170516										
CLEAR(FirstTicket);										
CLEAR(LastTicket);										
CLEAR(Venta);										
CLEAR(Iva);										
CLEAR(vTotal);										
CLEAR(VentasG);										
CLEAR(TotalIva);										
CLEAR(TotalVentNcr);										
CLEAR(TotalIvaNcr);										
CLEAR(VentasE);										
CLEAR(VentasNoSu);										
CLEAR(VentasEDev);										
CLEAR(VentasNoSuDev);										
//CSPNT010916										
CLEAR(vCESC);										
										
//Imprimir Linea en blanco...										
"DSTR1 :=     COPYSTR('                     ',1);"										
Value[1] := '';										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//ENCABEZADO PARA EL TIPO DE COMPROBANTE										
"DSTR1 := COPYSTR('#C######################################',1);"										
Value[1] := '2- Comprobante de CrÇdito Fiscal';										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//BUSCO PRIMERO LOS NCF PARA CREDITO FISCALES										
Transaction2.RESET;										
"Transaction2.SETCURRENTKEY(""Statement Code"",""Z-Report ID"",""Transaction Type"",""Entry Status"");"										
"Transaction2.SETRANGE(""Statement Code"",SCode);"										
"Transaction2.SETFILTER(""Z-Report ID"",'<>%1','');"										
"Transaction2.SETRANGE(""Transaction Type"",Transaction2.""Transaction Type""::Sales);"										
"//CSPNT170516  Transaction2.SETFILTER(""Entry Status"",'%1|%2',Transaction2.""Entry Status""::"" "",Transaction2.""Entry Status""::Posted)"	;									
"Transaction2.SETFILTER(""Entry Status"",'%1|%2|%3',Transaction2.""Entry Status""::"" "",Transaction2.""Entry Status""::Posted,Transactio"	n2.	"""En"	tr	y S	"tatus""::Voided);"					
"Transaction2.SETRANGE(""No. Serie NCF"",Terminal.""No. Serie NCF Credito Fiscal"");"										
"//CSPNT240816Transaction2.SETRANGE(Date,rFecha.""Period Start"",FinPeriodo);"										
"Transaction2.SETRANGE(Date,InicPeriodo,FinPeriodo);"										
IF  Transaction2.FINDFIRST THEN BEGIN										
//CSPNT170516										
rNoSeries.RESET;										
"IF rNoSeries.GET(Terminal.""No. Serie NCF Credito Fiscal"") THEN BEGIN"										
rNoSeriesLn.RESET;										
"rNoSeriesLn.SETRANGE(""Series Code"",rNoSeries.Code);"										
IF rNoSeriesLn.FINDFIRST THEN BEGIN										
"DSTR1 := COPYSTR('#L######################################',1);"										
Value[1] := 'Autorizacion: ' + UPPERCASE(rNoSeriesLn.Autorizacion);										
"//CSPNT070416          PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
"DSTR1 := COPYSTR('#L#################  #R#################',1);"										
"Value[1] := 'Del ' + rNoSeriesLn.""Starting No."";"										
"Value[2] := 'al  ' + rNoSeriesLn.""Ending No."";"										
"//CSPNT070416          PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
END;										
										
//CSPNT170516										
"FirstFactCrf := Transaction2.""Correlativo Facturas"";"										
//CSPNT290816										
vFirstFechaCref := Transaction2.Date;										
										
REPEAT										
//CSPNT170516										
CLEAR(Venta);										
CLEAR(Iva);										
CLEAR(vTotal);										
"rSalesEntry.SETRANGE(""Store No."",Transaction2.""Store No."");"										
"rSalesEntry.SETRANGE(""POS Terminal No."",Transaction2.""POS Terminal No."");"										
"rSalesEntry.SETRANGE(""Transaction No."",Transaction2.""Transaction No."");"										
IF rSalesEntry.FIND('-') THEN										
REPEAT										
rImpuestos.RESET;										
"rImpuestos.SETRANGE(""VAT Bus. Posting Group"",rSalesEntry.""VAT Bus. Posting Group"");"										
"rImpuestos.SETRANGE(""VAT Prod. Posting Group"",rSalesEntry.""VAT Prod. Posting Group"");"										
IF rImpuestos.FINDFIRST THEN BEGIN										
"Venta    += ABS(rSalesEntry.""Net Amount"");"										
"Iva      += ABS(rSalesEntry.""VAT Amount"");"										
"vTotal   += ABS(rSalesEntry.""Net Amount"") + ABS(rSalesEntry.""VAT Amount"");"										
										
IF rImpuestos.Impuesto=rImpuestos.Impuesto::Gravado THEN BEGIN										
"IF NOT Transaction2.""Sale Is Return Sale"" THEN BEGIN"										
"VentasG  += ABS(rSalesEntry.""Net Amount"");"										
"TotalIva += ABS(rSalesEntry.""VAT Amount"");"										
END										
ELSE BEGIN										
"TotalVentNcr += ABS(rSalesEntry.""Net Amount"");"										
"TotalIvaNcr  += ABS(rSalesEntry.""VAT Amount"");"										
END;										
END										
ELSE BEGIN										
IF rImpuestos.Impuesto=rImpuestos.Impuesto::Exento THEN BEGIN										
"IF NOT Transaction2.""Sale Is Return Sale"" THEN"										
"VentasE  += ABS(rSalesEntry.""Net Amount"")"										
ELSE										
"VentasEDev  += ABS(rSalesEntry.""Net Amount"")"										
END										
"ELSE IF NOT Transaction2.""Sale Is Return Sale"" THEN"										
"VentasNoSu  += ABS(rSalesEntry.""Net Amount"")"										
ELSE										
"VentasNoSuDev  += ABS(rSalesEntry.""Net Amount"")"										
END										
END;										
UNTIL rSalesEntry.NEXT = 0;										
//CSRM16102013 Se quito que imprimiera los rango de facturas porq no es un solo pos en la tienda										
//CSPNT170516										
//CSPNT241015 se agrego rango de facturas										
"LastFactCrf := Transaction2.""Correlativo Facturas"";"										
//CSPNT290816										
vLastFechaCref := Transaction2.Date;										
//CSRM16102013 Se quito que imprimiera los rango de facturas porq no es un solo pos en la tienda										
//CSPNT090316										
"//CSPNT270416        IF (Transaction2.""Refund Receipt No."" = '') THEN BEGIN"										
"IF NOT Transaction2.""Sale Is Return Sale"" THEN"										
"Percepcion  += ABS(Transaction2.""Percepcion Amount"")"										
ELSE										
"PercepcionDev  += -(Transaction2.""Percepcion Amount"");"										
										
//CSPNT010916										
rRecargasElectronicas.RESET;										
"rRecargasElectronicas.SETRANGE(""Store No."", Transaction2.""Store No."");"										
"rRecargasElectronicas.SETRANGE(""POS Terminal No."", Transaction2.""POS Terminal No."");"										
"rRecargasElectronicas.SETRANGE(""Receipt No."", Transaction2.""Receipt No."");"										
IF rRecargasElectronicas.FINDFIRST THEN										
vCESC := vCESC + rRecargasElectronicas.CESC;										
										
UNTIL Transaction2.NEXT = 0;										
END;										
										
//CSRM16102013 Se quito que imprimiera los rango de facturas porq no es un solo pos en la tienda										
//CSPNT241015 se agrego rango de facturas										
//CSPNT271015										
//CSPNT070916										
IF (FirstFactCrf <> '') OR (LastFactCrf <> '') THEN BEGIN										
//CSPNT070416										
rNoSeriesLn.RESET;										
"rNoSeriesLn.SETRANGE(""Series Code"",rNoSeries.Code);"										
IF rNoSeriesLn.FINDFIRST THEN										
REPEAT										
//CSPNT290816										
"IF ((rNoSeriesLn.""Starting No."" <= FirstFactCrf) AND (rNoSeriesLn.""Ending No."" >= FirstFactCrf)) AND"										
"((rNoSeriesLn.""Starting Date"" <= vFirstFechaCref) AND (rNoSeriesLn.""Last Date Used"" >= vFirstFechaCref)) THEN"										
vFirstFactCredAut := UPPERCASE(rNoSeriesLn.Autorizacion);										
"IF ((rNoSeriesLn.""Starting No."" <= LastFactCrf) AND (rNoSeriesLn.""Ending No."" >= LastFactCrf)) AND"										
"((rNoSeriesLn.""Starting Date"" <= vLastFechaCref) AND (rNoSeriesLn.""Last Date Used"" >= vLastFechaCref)) THEN"										
vLastFactCredAut := UPPERCASE(rNoSeriesLn.Autorizacion);										
UNTIL rNoSeriesLn.NEXT = 0;										
										
//CSPNT290816										
"DSTR1 := COPYSTR('#L######################################',1);"										
//CSPNT070416										
Value[1] := 'Del No.: ' + vFirstFactCredAut + ' ' + FirstFactCrf;										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
//CSPNT290816										
"DSTR1 := COPYSTR('#L######################################',1);"										
//CSPNT070416										
Value[1] := 'Al No.: ' + vLastFactCredAut + ' ' + LastFactCrf;										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
										
//Imprimir Linea en blanco...										
"DSTR1 :=     COPYSTR('                     ',1);"										
Value[1] := '';										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//CSPNT060216										
{  //ENCABEZADO DE VENTAS TOTALES...										
"DSTR1 := COPYSTR('    #L#############',1);"										
Value[1] := 'VENTAS TOTALES:';										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
}										
VentasG := VentasG - TotalVentNcr;										
										
//VENTAS GRAVADAS...										
"DSTR1 := COPYSTR('#L##############    #R##################',1);"										
Value[1] := 'Ventas Gravadas:';										
"Value[2] := '$' + FORMAT(VentasG,0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
TotalIva := TotalIva - TotalIvaNcr;										
										
//IMPUESTO IVA...										
"DSTR1 := COPYSTR('#L###########       #R##################',1);"										
Value[1] := 'Impuesto IVA:';										
//CSPNT010916										
"Value[2] := '$' + FORMAT(TotalIva - vCESC,0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//CSPNT010916 IMPUESTO CESC...										
"DSTR1 := COPYSTR('#L############           #R#############',1);"										
Value[1] := 'Impuesto CESC:';										
"Value[2] := '$' + FORMAT(vCESC,0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//Total Gravado...										
"DSTR1 := COPYSTR('#L############      #R##################',1);"										
Value[1] := 'Total Gravado:';										
"Value[2] := '$' + FORMAT(VentasG + TotalIva,0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
CLEAR(Percibido);										
//PERCEPCION...										
"DSTR1 := COPYSTR('#L################# #R##################',1);"										
Value[1] := '(+) IVA Percibido:';										
"//CSPNT270416    Value[2] := '$' + FORMAT((Percepcion-PercepcionDev),0,'<Integer Thousand><Decimals,3>');"										
"Value[2] := '$' + FORMAT((Percepcion),0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//VENTAS EXENTAS...										
"DSTR1 := COPYSTR('#L#############     #R##################',1);"										
Value[1] := 'Ventas Exentas:';										
"//CSPNT170516  Value[2] := '$' + FORMAT((VentasE-VentasEDev),0,'<Integer Thousand><Decimals,3>');"										
"Value[2] := '$' + FORMAT((VentasE),0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//VENTAS NO SUJETAS...										
"DSTR1 := COPYSTR('#L################  #R##################',1);"										
Value[1] := 'Ventas No Sujetas:';										
"//CSPNT170516  Value[2] := '$' + FORMAT((VentasNoSu-VentasNoSuDev),0,'<Integer Thousand><Decimals,3>');"										
"Value[2] := '$' + FORMAT((VentasNoSu),0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//VENTAS TOTALES										
"DSTR1 := COPYSTR('#L#############     #R##################',1);"										
Value[1] := 'Ventas Totales:';										
"//CSPNT170516  Value[2] := '$' + FORMAT((VentasG + TotalIva + VentasE + VentasNoSu)-(VentasEDev+VentasNoSuDev),0,'<Integer Thousan"	d><	Dec	im	als	",3>');"					
"Value[2] := '$' + FORMAT((VentasG + TotalIva + VentasE + VentasNoSu + Percepcion),0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//CSPNT050216										
vVentasGravadasTotales := vVentasGravadasTotales + VentasG;										
//CSPNT010916										
vImpuestoIVATotales := vImpuestoIVATotales + TotalIva - vCESC;										
vCESCTotales := vCESCTotales + vCESC;										
vTotalGravadoTotales := vTotalGravadoTotales + (VentasG + TotalIva);										
vVentasExentasTotales := vVentasExentasTotales + (VentasE-VentasEDev);										
vVentasNoSujetasTotales := vVentasNoSujetasTotales + (VentasNoSu-VentasNoSuDev);										
//CSPNT170516  vVentasTotalesTotales := vVentasTotalesTotales + ((VentasG + TotalIva + VentasE + VentasNoSu)-(VentasEDev+VentasNoS	uDe	v))	;							
vVentasTotalesTotales := vVentasTotalesTotales + ((VentasG + TotalIva + VentasE + VentasNoSu + (Percepcion-PercepcionDev))-(Vent	asE	Dev	#NAME?	ent	asNoSuDev));					
//CSPNT270416										
vIVAPercibidoTotales := vIVAPercibidoTotales + (Percepcion);										
										
//LIMPIO LAS VARIABLES QUE MUESTRAN LOS TOTALES DE LAS VENTAS POR TIPO DE COMPROBANTES.										
CLEAR(Venta);										
CLEAR(Iva);										
CLEAR(vTotal);										
CLEAR(VentasG);										
CLEAR(TotalIva);										
CLEAR(TotalVentNcr);										
CLEAR(TotalIvaNcr);										
CLEAR(VentasE);										
CLEAR(VentasNoSu);										
CLEAR(VentasEDev);										
CLEAR(VentasNoSuDev);										
//CSPNT170516										
CLEAR(Retencion);										
//CSPNT090316										
CLEAR(Percepcion);										
//CSPNT010916										
CLEAR(vCESC);										
										
//Imprimir Linea en blanco...										
"DSTR1 :=     COPYSTR('                     ',1);"										
Value[1] := '';										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//CSPNT170516 Se agrego nota de credito y documento devolucion										
										
//ENCABEZADO PARA EL TIPO DE COMPROBANTE										
"DSTR1 := COPYSTR('#C######################################',1);"										
Value[1] := '3- Nota de CrÇdito';										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//CSRM16102013 Se quito que imprimiera los rango de facturas porq no es un solo pos en la tienda										
//CSPNT271015 se agrego rango de facturas										
//CSPNT281015										
Transaction2.RESET;										
"Transaction2.SETCURRENTKEY(""Statement Code"",""Z-Report ID"",""Transaction Type"",""Entry Status"");"										
"Transaction2.SETRANGE(""Statement Code"",SCode);"										
"//CSPNT180516    Transaction2.SETRANGE(""Z-Report ID"",'');"										
"Transaction2.SETFILTER(""Z-Report ID"",'<>%1','');"										
"Transaction2.SETRANGE(""Transaction Type"",Transaction2.""Transaction Type""::Sales);"										
//CSPNT270216										
"Transaction2.SETFILTER(""Entry Status"",'%1|%2|%3',Transaction2.""Entry Status""::"" "",Transaction2.""Entry Status""::Posted,Transact"	ion	"2."""	En	try	"Status""::Voided);"					
"Transaction2.SETRANGE(""No. Serie NCF"",Terminal.""No. Serie NCF Nota de Credito"");"										
//CSPNT170516										
"//CSPNT240816Transaction2.SETRANGE(Date,rFecha.""Period Start"",FinPeriodo);"										
"Transaction2.SETRANGE(Date,InicPeriodo,FinPeriodo);"										
IF Transaction2.FINDFIRST THEN BEGIN										
rNoSeries.RESET;										
"IF rNoSeries.GET(Terminal.""No. Serie NCF Nota de Credito"") THEN BEGIN"										
rNoSeriesLn.RESET;										
"rNoSeriesLn.SETRANGE(""Series Code"",rNoSeries.Code);"										
IF rNoSeriesLn.FINDFIRST THEN BEGIN										
"DSTR1 := COPYSTR('#L######################################',1);"										
Value[1] := 'Autorizacion: ' + UPPERCASE(rNoSeriesLn.Autorizacion);										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
"DSTR1 := COPYSTR('#L#################  #R#################',1);"										
"Value[1] := 'Del ' + rNoSeriesLn.""Starting No."";"										
"Value[2] := 'al  ' + rNoSeriesLn.""Ending No."";"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
END;										
//CSRM16102013 Se quito que imprimiera los rango de facturas porq no es un solo pos en la tienda										
//CSPNT241015 se agrego rango de facturas										
FirstFactCrfDev := Transaction2.NCF;										
//CSPNT290816										
vFirstFechaNocre := Transaction2.Date;										
//CSRM16102013 Se quito que imprimiera los rango de facturas porq no es un solo pos en la tienda										
										
REPEAT										
CLEAR(Venta);										
CLEAR(Iva);										
CLEAR(vTotal);										
//CSPNT090316        CLEAR(Percepcion);										
"rSalesEntry.SETRANGE(""Store No."",Transaction2.""Store No."");"										
"rSalesEntry.SETRANGE(""POS Terminal No."",Transaction2.""POS Terminal No."");"										
"rSalesEntry.SETRANGE(""Transaction No."",Transaction2.""Transaction No."");"										
IF rSalesEntry.FIND('-') THEN										
REPEAT										
rImpuestos.RESET;										
"rImpuestos.SETRANGE(""VAT Bus. Posting Group"",rSalesEntry.""VAT Bus. Posting Group"");"										
"rImpuestos.SETRANGE(""VAT Prod. Posting Group"",rSalesEntry.""VAT Prod. Posting Group"");"										
IF rImpuestos.FINDFIRST THEN BEGIN										
"Venta    += ABS(rSalesEntry.""Net Amount"");"										
"Iva      += ABS(rSalesEntry.""VAT Amount"");"										
"vTotal   += ABS(rSalesEntry.""Net Amount"") + ABS(rSalesEntry.""VAT Amount"");"										
										
"//CSPNT090316              IF NOT Transaction2.""Sale Is Return Sale"" THEN"										
"{                Percepcion  += ABS(Transaction2.""Percepcion Amount"")"										
ELSE										
"PercepcionDev  += -(Transaction2.""Percepcion Amount"");"										
}										
IF rImpuestos.Impuesto=rImpuestos.Impuesto::Gravado THEN BEGIN										
"IF NOT Transaction2.""Sale Is Return Sale"" THEN BEGIN"										
"VentasG  += ABS(rSalesEntry.""Net Amount"");"										
"TotalIva += ABS(rSalesEntry.""VAT Amount"");"										
END										
ELSE BEGIN										
"TotalVentNcr += ABS(rSalesEntry.""Net Amount"");"										
"TotalIvaNcr  += ABS(rSalesEntry.""VAT Amount"");"										
END;										
END										
ELSE BEGIN										
IF rImpuestos.Impuesto=rImpuestos.Impuesto::Exento THEN BEGIN										
"IF NOT Transaction2.""Sale Is Return Sale"" THEN"										
"VentasE  += ABS(rSalesEntry.""Net Amount"")"										
ELSE										
"VentasEDev  += ABS(rSalesEntry.""Net Amount"")"										
END										
"ELSE IF NOT Transaction2.""Sale Is Return Sale"" THEN"										
"VentasNoSu  += ABS(rSalesEntry.""Net Amount"")"										
ELSE										
"VentasNoSuDev  += ABS(rSalesEntry.""Net Amount"")"										
END										
END;										
UNTIL rSalesEntry.NEXT = 0;										
//CSRM16102013 Se quito que imprimiera los rango de facturas porq no es un solo pos en la tienda										
//CSPNT241015 se agrego rango de facturas										
LastFactCrfDev := Transaction2.NCF;										
//CSPNT290816										
vLastFechaNocre := Transaction2.Date;										
//CSRM16102013 Se quito que imprimiera los rango de facturas porq no es un solo pos en la tienda										
//CSPNT090316										
"IF NOT Transaction2.""Sale Is Return Sale"" THEN"										
"Percepcion  += ABS(Transaction2.""Percepcion Amount"")"										
ELSE										
"PercepcionDev  += -(Transaction2.""Percepcion Amount"");"										
UNTIL Transaction2.NEXT = 0;										
END;										
										
//CSRM16102013 Se quito que imprimiera los rango de facturas porq no es un solo pos en la tienda										
//CSPNT241015 se agrego rango de facturas										
//CSPNT271015										
//CSPNT290816										
//CSPNT070916										
IF (FirstFactCrfDev <> '') OR (LastFactCrfDev <> '') THEN BEGIN										
rNoSeriesLn.RESET;										
"rNoSeriesLn.SETRANGE(""Series Code"",rNoSeries.Code);"										
IF rNoSeriesLn.FINDFIRST THEN										
REPEAT										
"IF ((rNoSeriesLn.""Starting No."" <= FirstFactCrfDev) AND (rNoSeriesLn.""Ending No."" >= FirstFactCrfDev)) AND"										
"((rNoSeriesLn.""Starting Date"" <= vFirstFechaNocre) AND (rNoSeriesLn.""Last Date Used"" >= vFirstFechaNocre)) THEN"										
vFirstFactCredAut := UPPERCASE(rNoSeriesLn.Autorizacion);										
"IF ((rNoSeriesLn.""Starting No."" <= LastFactCrfDev) AND (rNoSeriesLn.""Ending No."" >= LastFactCrfDev)) AND"										
"((rNoSeriesLn.""Starting Date"" <= vLastFechaNocre) AND (rNoSeriesLn.""Last Date Used"" >= vLastFechaNocre)) THEN"										
vLastFactCredAut := UPPERCASE(rNoSeriesLn.Autorizacion);										
UNTIL rNoSeriesLn.NEXT = 0;										
"DSTR1 := COPYSTR('#L######################################',1);"										
Value[1] := 'Del No.: ' + vFirstFactCredAut + ' ' + FirstFactCrfDev;										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
"DSTR1 := COPYSTR('#L######################################',1);"										
Value[1] := 'Al No.: ' + vLastFactCredAut + ' ' + LastFactCrfDev;										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
										
//CSRM16102013 Se quito que imprimiera los rango de facturas porq no es un solo pos en la tienda										
										
//Imprimir Linea en blanco...										
"DSTR1 :=     COPYSTR('                     ',1);"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
//CSPNT150116										
{    //ENCABEZADO DE VENTAS TOTALES...										
"DSTR1 := COPYSTR('    #L#############',1);"										
Value[1] := 'VENTAS TOTALES:';										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
}										
VentasG := VentasG - TotalVentNcr;										
										
//VENTAS GRAVADAS...										
"DSTR1 := COPYSTR('#L##############    #R##################',1);"										
Value[1] := 'Ventas Gravadas:';										
"Value[2] := '$' + FORMAT(VentasG,0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
TotalIva := TotalIva - TotalIvaNcr;										
										
//IMPUESTO IVA...										
"DSTR1 := COPYSTR('#L###########       #R##################',1);"										
Value[1] := 'Impuesto IVA:';										
"Value[2] := '$' + FORMAT(TotalIva,0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//Total Gravado...										
"DSTR1 := COPYSTR('#L############      #R##################',1);"										
Value[1] := 'Total Gravado:';										
"Value[2] := '$' + FORMAT(VentasG + TotalIva,0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
CLEAR(Percibido);										
//PERCEPCION...										
"DSTR1 := COPYSTR('#L################# #R##################',1);"										
Value[1] := '(+) IVA Percibido:';										
"//CSPNT270416    Value[2] := '$' + FORMAT((Percepcion-PercepcionDev),0,'<Integer Thousand><Decimals,3>');"										
"Value[2] := '$' + FORMAT((-PercepcionDev),0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//VENTAS EXENTAS...										
"DSTR1 := COPYSTR('#L#############     #R##################',1);"										
Value[1] := 'Ventas Exentas:';										
"Value[2] := '$' + FORMAT((VentasE-VentasEDev),0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//VENTAS NO SUJETAS...										
"DSTR1 := COPYSTR('#L################  #R##################',1);"										
Value[1] := 'Ventas No Sujetas:';										
"Value[2] := '$' + FORMAT((VentasNoSu-VentasNoSuDev),0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//VENTAS TOTALES										
"DSTR1 := COPYSTR('#L#############     #R##################',1);"										
Value[1] := 'Ventas Totales:';										
"//CSPNT090316    Value[2] := '$' + FORMAT((VentasG + TotalIva + VentasE + VentasNoSu)-(VentasEDev+VentasNoSuDev),0,'<Integer Thous"	and	><D	ec	ima	"ls,3>');"					
//CSPNT270416										
"Value[2] := '$' + FORMAT((VentasG + TotalIva + VentasE + VentasNoSu + (PercepcionDev+Percepcion))-(VentasEDev+VentasNoSuDev),0"	",'<"	Int	eg	er	"Thousand><Decimals,3>');"					
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//CSPNT140116										
//CSPNT150116										
vVentasGravadasTotales := vVentasGravadasTotales + VentasG;										
vImpuestoIVATotales := vImpuestoIVATotales + TotalIva;										
vTotalGravadoTotales := vTotalGravadoTotales + (VentasG + TotalIva);										
vVentasExentasTotales := vVentasExentasTotales + (VentasE-VentasEDev);										
vVentasNoSujetasTotales := vVentasNoSujetasTotales + (VentasNoSu-VentasNoSuDev);										
//CSPNT090316										
//CSPNT270416										
vVentasTotalesTotales := vVentasTotalesTotales + ((VentasG + TotalIva + VentasE + VentasNoSu + (PercepcionDev+Percepcion))-(Ve	nta	sED	ev	#NAME?	ntasNoSuDev));					
//CSPNT270416										
vIVAPercibidoDevTotales := vIVAPercibidoDevTotales + (-PercepcionDev);										
										
//LIMPIO LAS VARIABLES QUE MUESTRAN LOS TOTALES DE LAS VENTAS POR TIPO DE COMPROBANTES.										
CLEAR(Venta);										
CLEAR(Iva);										
CLEAR(vTotal);										
CLEAR(VentasG);										
CLEAR(TotalIva);										
CLEAR(TotalVentNcr);										
CLEAR(TotalIvaNcr);										
CLEAR(VentasE);										
CLEAR(VentasNoSu);										
CLEAR(VentasEDev);										
CLEAR(VentasNoSuDev);										
CLEAR(Retencion);										
										
//Imprimir Linea en blanco...										
"DSTR1 :=     COPYSTR('                     ',1);"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//CSPNT251115 Solo aparece el valor total de documentos de devoluci¢n en detalle de factura de consumidor final										
//ENCABEZADO PARA EL TIPO DE COMPROBANTE										
"{    DSTR1 := COPYSTR('#C######################################',1);"										
Value[1] := '5- Documento de Devoluci¢n';										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
}										
//BUSCO PRIMERO LOS NCF PARA FACTURAS DE CONSUMIDORES FINALES										
Transaction2.RESET;										
"Transaction2.SETCURRENTKEY(""Statement Code"",""Z-Report ID"",""Transaction Type"",""Entry Status"");"										
"Transaction2.SETRANGE(""Statement Code"",SCode);"										
"//CSPNT180516    Transaction2.SETRANGE(""Z-Report ID"",'');"										
"Transaction2.SETFILTER(""Z-Report ID"",'<>%1','');"										
"Transaction2.SETRANGE(""Transaction Type"",Transaction2.""Transaction Type""::Sales);"										
"Transaction2.SETFILTER(""Entry Status"",'%1|%2',Transaction2.""Entry Status""::"" "",Transaction2.""Entry Status""::Posted);"										
"Transaction2.SETRANGE(""No. Serie NCF"",Terminal.""No. Serie Documento Devolucion"");"										
"//CSPNT240816Transaction2.SETRANGE(Date,rFecha.""Period Start"",FinPeriodo);"										
"Transaction2.SETRANGE(Date,InicPeriodo,FinPeriodo);"										
IF Transaction2.FINDFIRST THEN BEGIN										
{      rNoSeries.RESET;										
"IF rNoSeries.GET(Terminal.""No. Serie Documento Devolucion"") THEN BEGIN"										
rNoSeriesLn.RESET;										
"rNoSeriesLn.SETRANGE(""Series Code"",rNoSeries.Code);"										
IF rNoSeriesLn.FINDFIRST THEN BEGIN										
"DSTR1 := COPYSTR('#L######################################',1);"										
Value[1] := 'Autorizacion: ' + UPPERCASE(rNoSeriesLn.Autorizacion);										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
"DSTR1 := COPYSTR('#L#################  #R#################',1);"										
"Value[1] := 'Del ' + rNoSeriesLn.""Starting No."";"										
"Value[2] := 'al  ' + rNoSeriesLn.""Ending No."";"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
END;										
}										
//CSRM16102013 Se quito que imprimiera los rango de facturas porq no es un solo pos en la tienda										
//CSPNT241015 se agrego rango de facturas										
FirstFactCfDev := Transaction2.NCF;										
REPEAT										
CLEAR(Venta);										
CLEAR(Iva);										
CLEAR(vTotal);										
"rSalesEntry.SETRANGE(""Store No."",Transaction2.""Store No."");"										
"rSalesEntry.SETRANGE(""POS Terminal No."",Transaction2.""POS Terminal No."");"										
"rSalesEntry.SETRANGE(""Transaction No."",Transaction2.""Transaction No."");"										
IF rSalesEntry.FIND('-') THEN										
REPEAT										
rImpuestos.RESET;										
"rImpuestos.SETRANGE(""VAT Bus. Posting Group"",rSalesEntry.""VAT Bus. Posting Group"");"										
"rImpuestos.SETRANGE(""VAT Prod. Posting Group"",rSalesEntry.""VAT Prod. Posting Group"");"										
IF rImpuestos.FINDFIRST THEN BEGIN										
"Venta    += ABS(rSalesEntry.""Net Amount"");"										
"Iva      += ABS(rSalesEntry.""VAT Amount"");"										
"vTotal   += ABS(rSalesEntry.""Net Amount"") + ABS(rSalesEntry.""VAT Amount"");"										
//CSPNT210416										
"{              IF NOT Transaction2.""Sale Is Return Sale"" THEN"										
"Retencion  += ABS(Transaction2.""Retencion Amount"")"										
ELSE										
"RetencionDev  += -(Transaction2.""Retencion Amount"");"										
}										
IF rImpuestos.Impuesto=rImpuestos.Impuesto::Gravado THEN BEGIN										
"IF NOT Transaction2.""Sale Is Return Sale"" THEN BEGIN"										
"VentasG  += ABS(rSalesEntry.""Net Amount"");"										
"TotalIva += ABS(rSalesEntry.""VAT Amount"");"										
END										
ELSE BEGIN										
"TotalVentNcr += ABS(rSalesEntry.""Net Amount"");"										
"TotalIvaNcr  += ABS(rSalesEntry.""VAT Amount"");"										
END;										
END										
ELSE BEGIN										
IF rImpuestos.Impuesto=rImpuestos.Impuesto::Exento THEN BEGIN										
"IF NOT Transaction2.""Sale Is Return Sale"" THEN"										
"VentasE  += ABS(rSalesEntry.""Net Amount"")"										
ELSE										
"VentasEDev  += ABS(rSalesEntry.""Net Amount"")"										
END										
"ELSE IF NOT Transaction2.""Sale Is Return Sale"" THEN"										
"VentasNoSu  += ABS(rSalesEntry.""Net Amount"")"										
ELSE										
"VentasNoSuDev  += ABS(rSalesEntry.""Net Amount"")"										
END										
END;										
UNTIL rSalesEntry.NEXT = 0;										
										
//CSRM16102013 Se quito que imprimiera los rango de facturas porq no es un solo pos en la tienda										
//CSPNT241015 se agrego rango de facturas										
LastFactCfDev := Transaction2.NCF;										
										
//CSPNT210416										
"IF NOT Transaction2.""Sale Is Return Sale"" THEN"										
"Retencion  += ABS(Transaction2.""Retencion Amount"")"										
ELSE										
"RetencionDev  += -(Transaction2.""Retencion Amount"");"										
										
UNTIL Transaction2.NEXT = 0;										
END;										
										
//CSRM16102013 Se quito que imprimiera los rango de facturas porq no es un solo pos en la tienda										
//CSPNT241015 se agrego rango de facturas										
//CSPNT271015										
{    IF (FirstFactCfDev <> '') AND (LastFactCfDev <> '') THEN BEGIN										
//Del No.										
"DSTR1 := COPYSTR('#L#################################',1);"										
Value[1] := 'Del No.: ' + FirstFactCfDev;										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
//Al No.										
"DSTR1 := COPYSTR('#L#################################',1);"										
Value[1] := 'Al No.: ' + LastFactCfDev;										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
										
//CSRM16102013 Se quito que imprimiera los rango de facturas porq no es un solo pos en la tienda										
//Imprimir Linea en blanco...										
"DSTR1 :=     COPYSTR('                     ',1);"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//ENCABEZADO DE VENTAS TOTALES...										
"DSTR1 := COPYSTR('    #L#############',1);"										
Value[1] := 'VENTAS TOTALES:';										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
}										
VentasG := VentasG - TotalVentNcr;										
{										
//VENTAS GRAVADAS...										
"DSTR1 := COPYSTR('#L##############    #R##################',1);"										
Value[1] := 'Ventas Gravadas:';										
"Value[2] := '$' + FORMAT(VentasG,0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
}										
TotalIva := TotalIva - TotalIvaNcr;										
{										
//IMPUESTO IVA...										
"DSTR1 := COPYSTR('#L###########       #R##################',1);"										
Value[1] := 'Impuesto IVA:';										
"Value[2] := '$' + FORMAT(TotalIva,0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//Total Gravado...										
"DSTR1 := COPYSTR('#L############      #R##################',1);"										
Value[1] := 'Total Gravado:';										
"Value[2] := '$' + FORMAT(VentasG + TotalIva,0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//PERCEPCION...										
"DSTR1 := COPYSTR('#L################# #R##################',1);"										
Value[1] := '(-) IVA Retenido:';										
"Value[2] := '$' + FORMAT((Retencion-RetencionDev),0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//VENTAS EXENTAS...										
"DSTR1 := COPYSTR('#L#############     #R##################',1);"										
Value[1] := 'Ventas Exentas:';										
"Value[2] := '$' + FORMAT((VentasE-VentasEDev),0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//VENTAS NO SUJETAS...										
"DSTR1 := COPYSTR('#L################  #R##################',1);"										
Value[1] := 'Ventas No Sujetas:';										
"Value[2] := '$' + FORMAT((VentasNoSu-VentasNoSuDev),0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//VENTAS TOTALES										
"DSTR1 := COPYSTR('#L#############     #R##################',1);"										
Value[1] := 'Ventas Totales:';										
"Value[2] := '$' + FORMAT((VentasG + TotalIva + VentasE + VentasNoSu)-(VentasEDev+VentasNoSuDev),0,'<Integer Thousand><Decimals"	",3>"	');								
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
}										
//CSPNT251115 TOTAL documentos devolucion										
//CSPNT090316    vTotalDocDevolucion := (VentasG + TotalIva + VentasE + VentasNoSu)-(VentasEDev+VentasNoSuDev);										
vTotalDocDevolucion := (VentasG + VentasE + VentasNoSu)-(VentasEDev+VentasNoSuDev);										
vTotalIvaDocDevolucion := TotalIva;										
										
//CSPNT210416										
vTotalRetencionDev := RetencionDev;										
//CSPNT270416										
VentasEDevDocDev := VentasEDev;										
vVentasExentasTotales := vVentasExentasTotales + (VentasE-VentasEDev);										
										
//CSRM16102013										
//LIMPIO LAS VARIABLES QUE MUESTRAN LOS TOTALES DE LAS VENTAS POR TIPO DE COMPROBANTES.										
CLEAR(Venta);										
CLEAR(Iva);										
CLEAR(vTotal);										
CLEAR(VentasG);										
CLEAR(TotalIva);										
CLEAR(TotalVentNcr);										
CLEAR(TotalIvaNcr);										
CLEAR(VentasE);										
CLEAR(VentasNoSu);										
CLEAR(VentasEDev);										
CLEAR(VentasNoSuDev);										
										
{    //Imprimir Linea en blanco...										
"DSTR1 :=     COPYSTR('                     ',1);"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
}										
										
//ENCABEZADO PARA EL TIPO DE COMPROBANTE										
"DSTR1 := COPYSTR('#L######################################',1);"										
Value[1] := '4- Factura Consumidor Final';										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//BUSCO PRIMERO LOS NCF PARA FACTURAS DE CONSUMIDORES FINALES										
Transaction2.RESET;										
"Transaction2.SETCURRENTKEY(""Statement Code"",""Z-Report ID"",""Transaction Type"",""Entry Status"");"										
"Transaction2.SETRANGE(""Statement Code"",SCode);"										
"Transaction2.SETFILTER(""Z-Report ID"",'<>%1','');"										
"Transaction2.SETRANGE(""Transaction Type"",Transaction2.""Transaction Type""::Sales);"										
"//CSPNT170516  Transaction2.SETFILTER(""Entry Status"",'%1|%2',Transaction2.""Entry Status""::"" "",Transaction2.""Entry Status""::Posted)"	;									
"Transaction2.SETFILTER(""Entry Status"",'%1|%2|%3',Transaction2.""Entry Status""::"" "",Transaction2.""Entry Status""::Posted,Transactio"	n2.	"""En"	tr	y S	"tatus""::Voided);"					
"Transaction2.SETRANGE(""No. Serie NCF"",Terminal.""No. Serie NCF Cons. Final"");"										
"//CSPNT240816Transaction2.SETRANGE(Date,rFecha.""Period Start"",FinPeriodo);"										
"Transaction2.SETRANGE(Date,InicPeriodo,FinPeriodo);"										
IF Transaction2.FINDFIRST THEN BEGIN										
rNoSeries.RESET;										
"IF rNoSeries.GET(Terminal.""No. Serie NCF Cons. Final"") THEN BEGIN"										
rNoSeriesLn.RESET;										
"rNoSeriesLn.SETRANGE(""Series Code"",rNoSeries.Code);"										
IF rNoSeriesLn.FINDFIRST THEN BEGIN										
"DSTR1 := COPYSTR('#L######################################',1);"										
Value[1] := 'Autorizacion: ' + UPPERCASE(rNoSeriesLn.Autorizacion);										
"//CSPNT070416          PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
"DSTR1 := COPYSTR('#L#################  #R#################',1);"										
"Value[1] := 'Del ' + rNoSeriesLn.""Starting No."";"										
"Value[2] := 'al  ' + rNoSeriesLn.""Ending No."";"										
"//CSPNT070416          PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
END;										
										
//CSRM16102013 Se quito que imprimiera los rango de facturas porq no es un solo pos en la tienda										
//CSPNT241015 se agrego rango de facturas										
"FirstFactCf := Transaction2.""Correlativo Facturas"";"										
//CSPNT290816										
vFirstFechaFac := Transaction2.Date;										
REPEAT										
//CSPNT170516										
CLEAR(Venta);										
CLEAR(Iva);										
CLEAR(vTotal);										
"rSalesEntry.SETRANGE(""Store No."",Transaction2.""Store No."");"										
"rSalesEntry.SETRANGE(""POS Terminal No."",Transaction2.""POS Terminal No."");"										
"rSalesEntry.SETRANGE(""Transaction No."",Transaction2.""Transaction No."");"										
IF rSalesEntry.FIND('-') THEN										
REPEAT										
rImpuestos.RESET;										
"rImpuestos.SETRANGE(""VAT Bus. Posting Group"",rSalesEntry.""VAT Bus. Posting Group"");"										
"rImpuestos.SETRANGE(""VAT Prod. Posting Group"",rSalesEntry.""VAT Prod. Posting Group"");"										
IF rImpuestos.FINDFIRST THEN BEGIN										
"Venta    += ABS(rSalesEntry.""Net Amount"");"										
"Iva      += ABS(rSalesEntry.""VAT Amount"");"										
"vTotal   += ABS(rSalesEntry.""Net Amount"") + ABS(rSalesEntry.""VAT Amount"");"										
										
IF rImpuestos.Impuesto=rImpuestos.Impuesto::Gravado THEN BEGIN										
"IF NOT Transaction2.""Sale Is Return Sale"" THEN BEGIN"										
"VentasG  += ABS(rSalesEntry.""Net Amount"");"										
"TotalIva += ABS(rSalesEntry.""VAT Amount"");"										
END										
ELSE BEGIN										
"TotalVentNcr += ABS(rSalesEntry.""Net Amount"");"										
"TotalIvaNcr  += ABS(rSalesEntry.""VAT Amount"");"										
END;										
END										
ELSE BEGIN										
IF rImpuestos.Impuesto=rImpuestos.Impuesto::Exento THEN BEGIN										
"IF NOT Transaction2.""Sale Is Return Sale"" THEN"										
"VentasE  += ABS(rSalesEntry.""Net Amount"")"										
ELSE										
"VentasEDev  += ABS(rSalesEntry.""Net Amount"")"										
END										
"ELSE IF NOT Transaction2.""Sale Is Return Sale"" THEN"										
"VentasNoSu  += ABS(rSalesEntry.""Net Amount"")"										
ELSE										
"VentasNoSuDev  += ABS(rSalesEntry.""Net Amount"")"										
END										
END;										
UNTIL rSalesEntry.NEXT = 0;										
										
//CSRM16102013 Se quito que imprimiera los rango de facturas porq no es un solo pos en la tienda										
"LastFactCf := Transaction2.""Correlativo Facturas"";"										
//CSPNT290816										
vLastFechaFac := Transaction2.Date;										
//CSPNT170516										
"IF NOT Transaction2.""Sale Is Return Sale"" THEN"										
"Retencion  += ABS(Transaction2.""Retencion Amount"")"										
ELSE										
"RetencionDev  += -(Transaction2.""Retencion Amount"");"										
										
//CSPNT010916										
rRecargasElectronicas.RESET;										
"rRecargasElectronicas.SETRANGE(""Store No."", Transaction2.""Store No."");"										
"rRecargasElectronicas.SETRANGE(""POS Terminal No."", Transaction2.""POS Terminal No."");"										
"rRecargasElectronicas.SETRANGE(""Receipt No."", Transaction2.""Receipt No."");"										
IF rRecargasElectronicas.FINDFIRST THEN										
vCESC := vCESC + rRecargasElectronicas.CESC;										
										
UNTIL Transaction2.NEXT = 0;										
END;										
										
//CSPNT170516										
//CSRM16102013 Se quito que imprimiera los rango de facturas porq no es un solo pos en la tienda										
//CSPNT241015 se agrego rango de facturas										
//CSPNT271015										
//CSPNT070916										
IF (FirstFactCf <> '') OR (LastFactCf <> '') THEN BEGIN										
//CSPNT070416										
rNoSeriesLn.RESET;										
"rNoSeriesLn.SETRANGE(""Series Code"",rNoSeries.Code);"										
IF rNoSeriesLn.FINDFIRST THEN										
REPEAT										
"IF (rNoSeriesLn.""Starting No."" <= FirstFactCf) AND (rNoSeriesLn.""Ending No."" >= FirstFactCf) THEN"										
vFirstFactCFAut := UPPERCASE(rNoSeriesLn.Autorizacion);										
"IF (rNoSeriesLn.""Starting No."" <= LastFactCf) AND (rNoSeriesLn.""Ending No."" >= LastFactCf) THEN"										
vLastFactCFAut := UPPERCASE(rNoSeriesLn.Autorizacion);										
UNTIL rNoSeriesLn.NEXT = 0;										
										
//CSPNT290816										
"DSTR1 := COPYSTR('#L######################################',1);"										
//CSPNT070416										
Value[1] := 'Del No.: ' + vFirstFactCFAut + ' ' + FirstFactCf;										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
//CSPNT290816										
"DSTR1 := COPYSTR('#L######################################',1);"										
//CSPNT070416										
Value[1] := 'Al No.: ' + vLastFactCFAut + ' ' + LastFactCf;										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
										
//CSRM16102013 Se quito que imprimiera los rango de facturas porq no es un solo pos en la tienda										
//Imprimir Linea en blanco...										
"DSTR1 :=     COPYSTR('                     ',1);"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//CSPNT050216										
{  //ENCABEZADO DE VENTAS TOTALES...										
"DSTR1 := COPYSTR('    #L#############',1);"										
Value[1] := 'VENTAS TOTALES:';										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
}										
//CSPNT170516  VentasG := VentasG - TotalVentNcr;										
VentasG := VentasG - TotalVentNcr + vTotalDocDevolucion + VentasEDevDocDev;										
										
//VENTAS GRAVADAS...										
"DSTR1 := COPYSTR('#L##############    #R##################',1);"										
Value[1] := 'Ventas Gravadas:';										
"Value[2] := '$' + FORMAT(VentasG,0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//CSPNT170516  TotalIva := TotalIva - TotalIvaNcr;										
TotalIva := TotalIva - TotalIvaNcr + vTotalIvaDocDevolucion;										
										
//IMPUESTO IVA...										
"DSTR1 := COPYSTR('#L###########       #R##################',1);"										
Value[1] := 'Impuesto IVA:';										
//CSPNT010916										
"Value[2] := '$' + FORMAT(TotalIva - vCESC,0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//CSPNT010916 IMPUESTO CESC...										
"DSTR1 := COPYSTR('#L############           #R#############',1);"										
Value[1] := 'Impuesto CESC:';										
"Value[2] := '$' + FORMAT(vCESC,0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//Total Gravado...										
"DSTR1 := COPYSTR('#L############      #R##################',1);"										
Value[1] := 'Total Gravado:';										
"Value[2] := '$' + FORMAT(VentasG + TotalIva,0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//CSPNT170516										
//PERCEPCION...										
"DSTR1 := COPYSTR('#L################# #R##################',1);"										
Value[1] := '(-) IVA Retenido:';										
"//CSPNT210416    Value[2] := '$' + FORMAT((Retencion-RetencionDev),0,'<Integer Thousand><Decimals,3>');"										
"Value[2] := '$' + FORMAT((Retencion-vTotalRetencionDev),0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//VENTAS EXENTAS...										
"DSTR1 := COPYSTR('#L#############     #R##################',1);"										
Value[1] := 'Ventas Exentas:';										
"//CSPNT170516  Value[2] := '$' + FORMAT((VentasE-VentasEDev),0,'<Integer Thousand><Decimals,3>');"										
"Value[2] := '$' + FORMAT((VentasE-VentasEDev-VentasEDevDocDev),0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//VENTAS NO SUJETAS...										
"DSTR1 := COPYSTR('#L################  #R##################',1);"										
Value[1] := 'Ventas No Sujetas:';										
"Value[2] := '$' + FORMAT((VentasNoSu-VentasNoSuDev),0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//VENTAS TOTALES										
"DSTR1 := COPYSTR('#L#############     #R##################',1);"										
Value[1] := 'Ventas Totales:';										
"//CSPNT170516  Value[2] := '$' + FORMAT((VentasG + TotalIva + VentasE + VentasNoSu)-(VentasEDev+VentasNoSuDev),0,'<Integer Thousan"	d><	Dec	im	als	",3>');"					
Value[2] := '$' + FORMAT((VentasG + TotalIva + VentasE + VentasNoSu)-(VentasEDev+VentasNoSuDev+(Retencion-RetencionDev)+VentasED	evD	ocD	ev	"),0"	",'<Integer Thousand><Decimals,3>');"					
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//CSPNT050216										
vVentasGravadasTotales := vVentasGravadasTotales + VentasG;										
//CSPNT010916										
vImpuestoIVATotales := vImpuestoIVATotales + TotalIva - vCESC;										
vCESCTotales := vCESCTotales + vCESC;										
vTotalGravadoTotales := vTotalGravadoTotales + (VentasG + TotalIva);										
vVentasExentasTotales := vVentasExentasTotales + (VentasE-VentasEDev);										
vVentasNoSujetasTotales := vVentasNoSujetasTotales + (VentasNoSu-VentasNoSuDev);										
//CSPNT170516  vVentasTotalesTotales := vVentasTotalesTotales + ((VentasG + TotalIva + VentasE + VentasNoSu)-(VentasEDev+VentasNoS	uDe	v))	;							
vVentasTotalesTotales := vVentasTotalesTotales + ((VentasG + TotalIva + VentasE + VentasNoSu)-(VentasEDev+VentasNoSuDev+(Retenci	on-	Ret	en	cio	nDev)+VentasEDevDocDev));					
vIVARetenidoTotales := vIVARetenidoTotales + (Retencion-RetencionDev);										
										
//CSRM16102013										
//LIMPIO LAS VARIABLES QUE MUESTRAN LOS TOTALES DE LAS VENTAS POR TIPO DE COMPROBANTES.										
CLEAR(Venta);										
CLEAR(Iva);										
CLEAR(vTotal);										
CLEAR(VentasG);										
CLEAR(TotalIva);										
CLEAR(TotalVentNcr);										
CLEAR(TotalIvaNcr);										
CLEAR(VentasE);										
CLEAR(VentasNoSu);										
//CSPNT170516										
CLEAR(VentasEDev);										
CLEAR(VentasNoSuDev);										
//CSPNT251115										
CLEAR(vTotalDocDevolucion);										
										
//CSPNT050216										
//Imprimir Linea en blanco...										
"DSTR1 :=     COPYSTR('                     ',1);"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//CSPNT140116										
"DSTR1 := COPYSTR('#C######################################',1);"										
Value[1] := 'VENTAS TOTALES';										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//Imprimir Linea en blanco...										
"DSTR1 :=     COPYSTR('                     ',1);"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//CSPNT150116										
//VENTAS GRAVADAS TOTALES										
"DSTR1 := COPYSTR('#L###################### #R#############',1);"										
Value[1] := 'Ventas Gravadas:';										
"Value[2] := '$' + FORMAT(vVentasGravadasTotales,0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//IMPUESTO IVA TOTALES										
"DSTR1 := COPYSTR('#L###################### #R#############',1);"										
Value[1] := 'Impuesto IVA:';										
"Value[2] := '$' + FORMAT(vImpuestoIVATotales,0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//CSPNT010916IMPUESTO CESC TOTALES										
"DSTR1 := COPYSTR('#L###################### #R#############',1);"										
Value[1] := 'Impuesto CESC:';										
"Value[2] := '$' + FORMAT(vCESCTotales,0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//TOTAL GRAVADO TOTALES										
"DSTR1 := COPYSTR('#L###################### #R#############',1);"										
Value[1] := 'Total Gravado:';										
"Value[2] := '$' + FORMAT(vTotalGravadoTotales,0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//VENTAS EXENTAS TOTALES										
"DSTR1 := COPYSTR('#L###################### #R#############',1);"										
Value[1] := 'Ventas Exentas:';										
"Value[2] := '$' + FORMAT(vVentasExentasTotales,0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//VENTAS NO SUJETAS TOTALES										
"DSTR1 := COPYSTR('#L###################### #R#############',1);"										
Value[1] := 'Ventas No Sujetas:';										
"Value[2] := '$' + FORMAT(vVentasNoSujetasTotales,0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//IVA PERCIBIDO TOTALES										
"DSTR1 := COPYSTR('#L###################### #R#############',1);"										
Value[1] := '(+) IVA Percebido:';										
//CSPNT270416										
"Value[2] := '$' + FORMAT(vIVAPercibidoTotales-vIVAPercibidoDevTotales,0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//IVA RETENIDO TOTALES										
"DSTR1 := COPYSTR('#L###################### #R#############',1);"										
Value[1] := '(-) IVA Retenido:';										
"Value[2] := '$' + FORMAT(vIVARetenidoTotales,0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//VENTAS TOTALES TOTALES										
"DSTR1 := COPYSTR('#L###################### #R#############',1);"										
Value[1] := 'Ventas Totales:';										
"Value[2] := '$' + FORMAT(vVentasTotalesTotales,0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//CSPNT170516 se agregaron devoluciones										
//Imprimir Linea en blanco...										
"DSTR1 :=     COPYSTR('                     ',1);"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//CSPNT130116 TOTAL DEVOLUCIONES										
										
//ENCABEZADO PARA EL TIPO DE COMPROBANTE										
"DSTR1 := COPYSTR('#C######################################',1);"										
Value[1] := 'DEVOLUCIONES';										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//CSPNT281015										
Transaction2.RESET;										
"Transaction2.SETCURRENTKEY(""Statement Code"",""Z-Report ID"",""Transaction Type"",""Entry Status"");"										
"Transaction2.SETRANGE(""Statement Code"",SCode);"										
"//CSPNT180516    Transaction2.SETRANGE(""Z-Report ID"",'');"										
"Transaction2.SETFILTER(""Z-Report ID"",'<>%1','');"										
"Transaction2.SETRANGE(""Transaction Type"",Transaction2.""Transaction Type""::Sales);"										
"Transaction2.SETFILTER(""Entry Status"",'%1|%2',Transaction2.""Entry Status""::"" "",Transaction2.""Entry Status""::Posted);"										
"Transaction2.SETRANGE(""Sale Is Return Sale"", TRUE);"										
//CSPNT170516										
"//CSPNT240816Transaction2.SETRANGE(Date,rFecha.""Period Start"",FinPeriodo);"										
"Transaction2.SETRANGE(Date,InicPeriodo,FinPeriodo);"										
vNoDevoluciones := 0;										
IF Transaction2.FINDFIRST THEN BEGIN										
REPEAT										
vNoDevoluciones := (vNoDevoluciones + 1);										
CLEAR(Venta);										
CLEAR(Iva);										
CLEAR(vTotal);										
"rSalesEntry.SETRANGE(""Store No."",Transaction2.""Store No."");"										
"rSalesEntry.SETRANGE(""POS Terminal No."",Transaction2.""POS Terminal No."");"										
"rSalesEntry.SETRANGE(""Transaction No."",Transaction2.""Transaction No."");"										
IF rSalesEntry.FIND('-') THEN										
REPEAT										
rImpuestos.RESET;										
"rImpuestos.SETRANGE(""VAT Bus. Posting Group"",rSalesEntry.""VAT Bus. Posting Group"");"										
"rImpuestos.SETRANGE(""VAT Prod. Posting Group"",rSalesEntry.""VAT Prod. Posting Group"");"										
IF rImpuestos.FINDFIRST THEN BEGIN										
"Venta    += ABS(rSalesEntry.""Net Amount"");"										
"Iva      += ABS(rSalesEntry.""VAT Amount"");"										
"vTotal   += ABS(rSalesEntry.""Net Amount"") + ABS(rSalesEntry.""VAT Amount"");"										
										
IF rImpuestos.Impuesto=rImpuestos.Impuesto::Gravado THEN BEGIN										
"IF NOT Transaction2.""Sale Is Return Sale"" THEN BEGIN"										
"VentasG  += ABS(rSalesEntry.""Net Amount"");"										
"TotalIva += ABS(rSalesEntry.""VAT Amount"");"										
END										
ELSE BEGIN										
"TotalVentNcr += ABS(rSalesEntry.""Net Amount"");"										
"TotalIvaNcr  += ABS(rSalesEntry.""VAT Amount"");"										
END;										
END										
ELSE BEGIN										
IF rImpuestos.Impuesto=rImpuestos.Impuesto::Exento THEN BEGIN										
"IF NOT Transaction2.""Sale Is Return Sale"" THEN"										
"VentasE  += ABS(rSalesEntry.""Net Amount"")"										
ELSE										
"VentasEDev  += ABS(rSalesEntry.""Net Amount"")"										
END										
"ELSE IF NOT Transaction2.""Sale Is Return Sale"" THEN"										
"VentasNoSu  += ABS(rSalesEntry.""Net Amount"")"										
ELSE										
"VentasNoSuDev  += ABS(rSalesEntry.""Net Amount"")"										
END										
END;										
UNTIL rSalesEntry.NEXT = 0;										
UNTIL Transaction2.NEXT = 0;										
END;										
										
//DEVOLUCIONES...										
"DSTR1 := COPYSTR('#L#################### #L#############',1);"										
Value[1] := 'Cantidad devoluciones:';										
Value[2] := FORMAT(vNoDevoluciones);										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//Imprimir Linea en blanco...										
"DSTR1 :=     COPYSTR('                     ',1);"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
VentasG := VentasG - TotalVentNcr;										
TotalIva := TotalIva - TotalIvaNcr;										
										
//VENTAS TOTALES										
"DSTR1 := COPYSTR('#L################### #R################',1);"										
Value[1] := 'Devoluciones Totales:';										
"//CSPNT270416    Value[2] := '$' + FORMAT((VentasG + TotalIva + VentasE + VentasNoSu)-(VentasEDev+VentasNoSuDev),0,'<Integer Thous"	and	><D	ec	ima	"ls,3>');"					
Value[2] := '$' + FORMAT((VentasG + TotalIva + VentasE + VentasNoSu)-(VentasEDev+VentasNoSuDev)+vTotalRetencionDev-vIVAPercibi	doD	evT	ot	ale	"s,0,'<Integer Thousand><Decimals,3>');"					
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//LIMPIO LAS VARIABLES QUE MUESTRAN LOS TOTALES DE LAS VENTAS POR TIPO DE COMPROBANTES.										
CLEAR(FirstTicket);										
CLEAR(LastTicket);										
CLEAR(Venta);										
CLEAR(Iva);										
CLEAR(vTotal);										
CLEAR(VentasG);										
CLEAR(TotalIva);										
CLEAR(TotalVentNcr);										
CLEAR(TotalIvaNcr);										
CLEAR(VentasE);										
CLEAR(VentasNoSu);										
CLEAR(VentasEDev);										
CLEAR(VentasNoSuDev);										
										
//Imprimir Linea en blanco...										
"DSTR1 :=     COPYSTR('                     ',1);"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
										
//CSRM19092013										
IF  DoZ THEN BEGIN										
"Terminal.""Last Z-ReportM"" := INCSTR(Terminal.""Last Z-ReportM"");"										
Terminal.MODIFY;										
END;										
										
IF NOT ClosePrinter(2) THEN										
EXIT(FALSE);										
										
EXIT(TRUE);										
END;										
										
PROCEDURE PrintZReportMensual@1000000024(NoSuspPOSTransactionsVoided@1000000000 : Integer) : Boolean;										
BEGIN										
gNoSuspPOSTransactionsVoided := NoSuspPOSTransactionsVoided;										
EXIT(PrintZReportMensualSV(TRUE));										
END;										
										
PROCEDURE PrintFactura@1000000025(VAR Transaction@1000000000 : Record 99001472);										
VAR										
Staff_pt@1000000001 : Text[20];										
Staff_lt@1000000002 : Text[20];										
SCode@1000000003 : Code[20];										
Staff@1000000004 : Record 99001461;										
DSTR1@1000000005 : Text[80];										
BEGIN										
										
Staff_lt := Globals.StaffID;										
IF  (Staff_lt <> '') THEN BEGIN										
"Staff.SETRANGE(ID,Staff_lt);"										
IF Staff.FIND('-') THEN BEGIN										
"Staff_pt:=Staff.""First Name"" + ' ' + Staff.""Last Name"";"										
END;										
END;										
										
										
"PrintLine(2,'');"										
"PrintBitmap(2,QRPath,1);"										
"PrintHeader(Transaction,FALSE,2);"										
										
"PrintSubHeader(Transaction,2,Transaction.Date,Transaction.Time);"										
										
"//IF Staff.""Name on Receipt""<>'' THEN"										
"Staff_lt := Staff.""Name on Receipt"" ;"										
//ELSE										
//  Staff_lt := Globals.StaffID;										
										
SCode := POSFunctions.GetStatementCode; //Asignacion de caja en variable pruebas jf										
PrintSeperator(1);										
										
"DSTR1 := COPYSTR('#C####################', 1, LineLen/2);"										
Value[1] := '**** PREMIO ****';										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),TRUE,TRUE,TRUE,FALSE));"										
										
PrintSeperator(2);										
										
										
//PrintSeperator(2);										
"PrintLine(2,'');"										
END;										
										
"PROCEDURE PrintXZReportSV_1@1000000026(RunType@1100409025 : 'X,Z,Y') : Boolean;"										
VAR										
PaymTrans2@1001 : Record 99001474;										
PaymTrans3@1018 : Record 99001474;										
PaymTemp@1019 : TEMPORARY Record 99001474;										
Terminal@1002 : Record 99001471;										
Staff@1003 : Record 99001461;										
SCode@1200070000 : Code[20];										
Transaction@1005 : Record 99001472;										
Transaction2@1100409016 : Record 99001472;										
IncExpAccount@1006 : Record 99001476;										
IncExpEntry@1007 : Record 99001475;										
SuspTrans@1016 : Record 99008980;										
DSTR1@1008 : Text[80];										
YReportID@1100409032 : Code[10];										
ZReportID@1009 : Code[10];										
FloatTotal@1011 : Decimal;										
RemoveTotal@1012 : Decimal;										
SalesTotal@1013 : Decimal;										
TendDeclEntry2@1014 : Record 99001465;										
IncExpEntry2@1015 : Record 99001475;										
RecCount@1020 : Integer;										
TSUtil@1200070001 : Codeunit 99008909;										
POSGUI@1100409007 : Codeunit 99001575;										
TransServerWorkTable@1100409000 : Record 99001615;										
TransNotSent@1100409001 : Integer;										
SuspTransLine@1100409002 : Record 99008981;										
POSTransactionSuspend@1100409008 : Record 99008980;										
POSTransactionSuspendTEMP@1100409011 : TEMPORARY Record 99008980;										
POSTransactionSuspendMM@1100409013 : Record 99008980;										
POSTransLineSuspend@1100409010 : Record 99008981;										
POSTransaction@1100409014 : Codeunit 99001570;										
NoSuspended@1100409003 : Integer;										
NoSuspPrepayment@1100409004 : Integer;										
SuspPrepayment@1100409005 : Decimal;										
PrintHeaderLines@1100409006 : Boolean;										
TSErr@1100409012 : Integer;										
YReportStats@1100409031 : Record 99008956;										
ZReportStats@1100409015 : Record 99008955;										
lText001@1100409017 : TextConst 'ENU=No of Trans. not on Z-report';										
"lText002@1100409018 : TextConst 'ENU=""    Date of oldest Trans.""';"										
lText003@1100409019 : TextConst 'ENU=Total Trans not on Z-report';										
OldestDate@1100409020 : Date;										
NoTables@1100409021 : Integer;										
NoSplitTrans@1100409022 : Integer;										
lText004@1100409023 : TextConst 'ENU=Unsent WarrHotel entries';										
WHBatchQueue@1100409024 : Record 99008979;										
LineFound@1100409030 : Boolean;										
lSafeType@1100409029 : Integer;										
NoOfLines@1100409028 : Integer;										
HeaderText@1100409027 : Text[50];										
TotalSafeType@1100409026 : Decimal;										
nada@1000000000 : Text;										
BEGIN										
//PrintXZReport										
IF NOT Staff.GET(Globals.StaffID) THEN										
EXIT(TRUE);										
IF NOT Terminal.GET(Globals.TerminalNo) THEN										
EXIT(TRUE);										
										
"IF NOT OpenReceiptPrinter(2, 'TENDER', 'ZXREPORT', 0, '') THEN"										
EXIT(FALSE);										
										
//LS7.1-13-										
IF FiscalON THEN BEGIN										
FiscalPrintXZReport(RunType);										
IF OnlyFiscal THEN										
EXIT( ClosePrinter(2) );										
END;										
//LS7.1-13+										
										
"IF NOT Terminal.""Terminal Statement"" THEN"										
"Terminal.""Statement Method"" := Store.""Statement Method"";"										
										
//Print Header info										
DSTR1 := '#L######## #L#########';										
Value[1] := Text078 + ':';										
"Value[2] := Store.""No."";"										
"//PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
										
"IF Terminal.""Statement Method"" = Terminal.""Statement Method""::""POS Terminal"" THEN BEGIN"										
DSTR1:='#L####### #L########';										
Value[1] := Text079 + ':';										
"Value[2] := Terminal.""No."";"										
"//PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
END;										
										
SCode := POSFunctions.GetStatementCode;										
										
Transaction.Date := TODAY;										
Transaction.Time := TIME;										
PrintLogo(2); //LS7.1-06										
"PrintHeader(Transaction,FALSE,2);"										
										
DSTR1 := '#L#### #T###### #T#### ';										
Value[1] := Text048 + ':';										
Value[2] := FORMAT(TODAY());										
"Value[3] := FORMAT(TIME(),5);"										
"//PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
										
DSTR1 := '#L###### #L############';										
Value[1] := Text051 + ':';										
"IF Staff.""Name on Receipt""<>'' THEN"										
"Value[2] := Staff.""Name on Receipt"""										
ELSE										
Value[2] := Globals.StaffID;										
										
"//PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
PrintSeperator(2);										
										
//X or Z Report..										
DSTR1:='#C###################';										
										
CASE RunType OF										
RunType::Z:										
Value[1] := Text106;										
RunType::X:										
Value[1] := Text107;										
RunType::Y:										
Value[1] := Text108;										
END;										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),TRUE,TRUE,TRUE,FALSE));"										
"IF GenPosFunc.""TS Floating Cashier"" AND"										
"(Terminal.""Statement Method"" = Terminal.""Statement Method""::Staff) AND"										
(Globals.GetValue('TS_ERROR') <> '') THEN BEGIN										
"//PrintLine(2,'');"										
"//PrintLine(2,FormatLine(STRSUBSTNO(Text141,Terminal.""No.""),FALSE,TRUE,FALSE,FALSE));"										
END;										
										
PrintSeperator(2);										
										
// Report Body										
//  Line per Tender Type										
CLEAR(PaymEntry);										
"PaymEntry.SETCURRENTKEY(""Statement Code"",""Z-Report ID"",""Tender Type"",""Currency Code"",""Card No."");"										
"PaymEntry.SETRANGE(""Statement Code"",SCode);"										
"PaymEntry.SETRANGE(""Z-Report ID"",'');"										
IF RunType = RunType::Y THEN										
"PaymEntry.SETRANGE(""Y-Report ID"",'');"										
PaymTrans3.COPYFILTERS(PaymEntry);										
										
"TenderType.SETCURRENTKEY(""Store No."");"										
"TenderType.SETRANGE(""Store No."",Globals.StoreNo);"										
"TenderType.SETFILTER(TenderType.""Function"",'<>%1',TenderType.""Function""::""Tender Remove/Float"");"										
"TenderType.SETRANGE(""Foreign Currency"",FALSE);"										
LocalTotal := 0;										
PrintXZLines();										
										
//  Totals for LCY										
IF LocalTotal <> 0 THEN BEGIN										
PrintSeperator(2);										
//CSPNT011015										
DSTR1    := '#L############    #R####################';										
Value[1] := Text005 + ':';										
Value[2] := POSFunctions.FormatAmount(LocalTotal);										
"//PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
END;										
										
//  Totals for FCY										
"PrintLine(2,'');"										
"TenderType.SETRANGE(""Foreign Currency"",TRUE);"										
										
TotalLCYInCurrency := 0;										
//PrintXZLines();										
IF TotalLCYInCurrency <> 0 THEN BEGIN										
PrintSeperator(2);										
DSTR1    := '#L##################### #R##############';										
Value[1] := Text300;										
Value[2] := POSFunctions.FormatAmount(TotalLCYInCurrency);										
"//PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
"//PrintLine(2,'');"										
PrintSeperator(2);										
DSTR1    := '#L##################### #R##############';										
Value[1] := Text301;										
Value[2] := POSFunctions.FormatAmount(LocalTotal);										
"//PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
//PrintSeperator(2);										
END;										
										
//  Floating and Removal Totals										
"TenderType.SETRANGE(""Foreign Currency"");"										
"TenderType.SETRANGE(TenderType.""Function"",TenderType.""Function""::""Tender Remove/Float"");"										
IF TenderType.FIND('-') THEN BEGIN										
PrintSeperator(2);										
REPEAT										
FOR lSafeType := 0 TO 3 DO BEGIN										
NoOfLines := 0;										
TotalSafeType := 0;										
"PaymEntry.SETRANGE(""Safe type"",lSafeType);"										
"PaymEntry.SETRANGE(""Currency Code"");"										
"PaymEntry.SETRANGE(""Card No."");"										
"PaymEntry.SETRANGE(""Tender Type"",TenderType.Code);"										
IF PaymEntry.FIND('-') THEN REPEAT										
IF NoOfLines = 0 THEN BEGIN										
IF lSafeType = 0 THEN										
HeaderText := Text320										
ELSE										
"HeaderText := FORMAT(PaymEntry.""Safe type"");"										
DSTR1 := '#C######################################';										
Value[1] := HeaderText;										
"//PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
NoOfLines := NoOfLines + 1;										
"Transaction.GET(PaymEntry.""Store No."",PaymEntry.""POS Terminal No."",PaymEntry.""Transaction No."");"										
"IF PaymEntry.""Amount Tendered"" > 0 THEN BEGIN"										
"RemoveTotal := RemoveTotal + PaymEntry.""Amount Tendered"";"										
DSTR1    := '#L############## #L###### #R############';										
"Value[1] := STRSUBSTNO('%1',Transaction.""Transaction Type"");"										
"Value[2] := Transaction.""Staff ID"";"										
"Value[3] := POSFunctions.FormatAmount(PaymEntry.""Amount Tendered"");"										
"//PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END										
ELSE BEGIN										
"FloatTotal := FloatTotal + PaymEntry.""Amount Tendered"";"										
DSTR1    := '#L############## #L###### #R############';;										
"Value[1] := STRSUBSTNO('%1',Transaction.""Transaction Type"");"										
"Value[2] := Transaction.""Staff ID"";"										
"Value[3] := POSFunctions.FormatAmount(-PaymEntry.""Amount Tendered"");"										
"//PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
"TotalSafeType := TotalSafeType + PaymEntry.""Amount Tendered"";"										
LineFound := TRUE;										
UNTIL PaymEntry.NEXT = 0;										
IF NoOfLines > 0 THEN BEGIN										
IF NoOfLines > 1 THEN BEGIN										
"//PrintLine(2,'');"										
DSTR1    := '#L############## #L###### #R############';;										
Value[1] := Text005;										
Value[2] := '';										
Value[3] := POSFunctions.FormatAmount(TotalSafeType);										
"//PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
//PrintSeperator(2);										
END										
ELSE										
nada:='';										
//PrintSeperator(2);										
END;										
END;										
UNTIL TenderType.NEXT = 0;										
END;										
"PaymEntry.SETRANGE(""Safe type"");"										
										
IF FloatTotal <> 0 THEN BEGIN										
DSTR1    := '#L##############    #R##################';										
Value[1] := Text009 + ':';										
Value[2] := POSFunctions.FormatAmount(-FloatTotal);										
"//PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
										
IF RemoveTotal <> 0 THEN BEGIN										
DSTR1    := '#L##############    #R##################';										
Value[1] := Text010 + ':';										
Value[2] := POSFunctions.FormatAmount(RemoveTotal);										
"//PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
										
IF (LocalTotal<>0) OR (FloatTotal<>0) OR (RemoveTotal<>0) THEN										
///PrintSeperator(2);										
										
//  Tender Declaration										
"Transaction.""Transaction No."" := 0;"										
"TendDeclEntry.SETCURRENTKEY(""Statement Code"",""Z-Report ID"",""Tender Type"",""Currency Code"",""Card No."");"										
"TendDeclEntry.SETRANGE(""Statement Code"",SCode);"										
"TendDeclEntry.SETRANGE(""Z-Report ID"",'');"										
IF RunType = RunType::Y THEN										
"TendDeclEntry.SETRANGE(""Y-Report ID"",'')"										
ELSE										
"TendDeclEntry.SETRANGE(""Y-Report ID"");"										
"IF Store.""Tend. Decl. Calculation"" = Store.""Tend. Decl. Calculation""::Sum THEN BEGIN"										
BufferTendDeclEntry;										
IF TendDeclEntry.FIND('-') THEN										
"Transaction.""Transaction No."" := TendDeclEntry.""Transaction No."";"										
END ELSE BEGIN										
IF TendDeclEntry.FIND('-') THEN										
REPEAT										
"IF TendDeclEntry.""Transaction No."" > Transaction.""Transaction No."" THEN"										
"Transaction.GET(TendDeclEntry.""Store No."",TendDeclEntry.""POS Terminal No."",TendDeclEntry.""Transaction No."")"										
UNTIL TendDeclEntry.NEXT=0;										
END;										
										
"IF Transaction.""Transaction No."" <> 0 THEN BEGIN"										
"PrintLine(2,FormatLine(Text112,FALSE,TRUE,FALSE,FALSE));"										
CLEAR(TendDeclEntry);										
LocalTotal := 0;										
"IF Store.""Tend. Decl. Calculation"" = Store.""Tend. Decl. Calculation""::Last THEN BEGIN"										
"TendDeclEntry.SETCURRENTKEY(""Store No."",""POS Terminal No."",""Transaction No."");"										
"TendDeclEntry.SETRANGE(""Store No."",Transaction.""Store No."");"										
"TendDeclEntry.SETRANGE(""POS Terminal No."",Transaction.""POS Terminal No."");"										
"TendDeclEntry.SETRANGE(""Transaction No."",Transaction.""Transaction No."");"										
BufferTendDeclEntry;										
END;										
"TempTendDeclEntry.SETFILTER(""Currency Code"",'=%1','');"										
//PrintTenderDeclLines;										
"Transaction.""Gross Amount"" := -LocalTotal;"										
"//PrintTotal(Transaction,2,0);"										
"//PrintLine(2,'');"										
"TempTendDeclEntry.SETFILTER(""Currency Code"",'<>%1','');"										
//PrintTenderDeclLines;										
END;										
										
//PrintSeperator(2);										
										
// Sales and Discount Totals										
"Transaction.SETCURRENTKEY(""Statement Code"",""Z-Report ID"",""Transaction Type"",""Entry Status"");"										
"Transaction.SETRANGE(""Statement Code"",SCode);"										
"Transaction.SETRANGE(""Z-Report ID"",'');"										
"Transaction.SETRANGE(""Transaction Type"",Transaction.""Transaction Type""::Sales);"										
"Transaction.SETFILTER(""Entry Status"",'%1|%2',Transaction.""Entry Status""::"" "",Transaction.""Entry Status""::Posted);"										
IF RunType = RunType::Y THEN										
"Transaction.SETRANGE(""Y-Report ID"",'');"										
"Transaction.CALCSUMS(""Gross Amount"",""Discount Amount"",""Total Discount"",Rounded,""No. of Items"","										
"""No. of Covers"");"										
										
"IF Transaction.""Entry Status"" <> Transaction.""Entry Status""::Training THEN BEGIN  //LS7.1-09"										
CASE RunType OF										
RunType::Z:										
BEGIN										
ZReportStats.INIT;										
"ZReportStats.""Store No."" := Globals.StoreNo;"										
"ZReportStats.""POS Terminal No."" := Globals.TerminalNo;"										
ZReportStats.Date := TODAY;										
"ZReportStats.""Sales Amount"":= -Transaction.""Gross Amount"" + Transaction.Rounded;"										
ZReportStats.INSERT(TRUE);										
END;										
RunType::Y:										
BEGIN										
YReportStats.INIT;										
"YReportStats.""Store No."" := Globals.StoreNo;"										
"YReportStats.""POS Terminal No."" := Globals.TerminalNo;"										
YReportStats.Date := TODAY;										
"YReportStats.""Sales Amount"":= -Transaction.""Gross Amount"" + Transaction.Rounded;"										
YReportStats.INSERT(TRUE);										
END;										
END;										
END;  //LS7.1-09										
										
DSTR1 := '#L######################### #R##########';										
"Value[2] := POSFunctions.FormatAmount(-Transaction.""Gross Amount"" + Transaction.""Discount Amount"");"										
Value[1] := Text011;										
"//PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
"Value[2] := POSFunctions.FormatAmount(-Transaction.""Discount Amount"");"										
Value[1] := Text012;										
"//PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
Value[2] := POSFunctions.FormatAmount(Transaction.Rounded);										
Value[1] := Text093;										
"//PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//PrintSeperator(2);										
Value[1] := Text027;										
"Value[2] := POSFunctions.FormatAmount(-Transaction.""Gross Amount"" + Transaction.Rounded);"										
"//PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
										
"IncExpAccount.SETRANGE(IncExpAccount.""Store No."",Globals.StoreNo);"										
IF IncExpAccount.FIND('-') THEN BEGIN										
"IncExpEntry.SETCURRENTKEY(""Statement Code"",""Z-Report ID"",""No."");"										
"IncExpEntry.SETRANGE(""Statement Code"",SCode);"										
"IncExpEntry.SETRANGE(""Z-Report ID"",'');"										
IF RunType = RunType::Y THEN										
"IncExpEntry.SETRANGE(""Z-Report ID"",'');"										
IF IncExpEntry.FIND('-') THEN BEGIN										
//PrintSeperator(2);										
REPEAT										
"IncExpEntry.SETRANGE(""No."",IncExpAccount.""No."");"										
IF IncExpEntry.FIND('-') THEN BEGIN										
Value[1] := IncExpAccount.Description;										
IncExpEntry.CALCSUMS(Amount);										
Value[2] := POSFunctions.FormatAmount(IncExpEntry.Amount);										
"//PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
UNTIL IncExpAccount.NEXT = 0;										
END;										
END;										
										
//PrintSeperator(2);										
										
//Transaction counting										
IF PaymTrans3.FIND('-') THEN										
REPEAT										
"IF NOT PaymTemp.GET(PaymTrans3.""Store No."",PaymTrans3.""POS Terminal No."",PaymTrans3.""Transaction No."") THEN BEGIN"										
"Transaction2.GET(PaymTrans3.""Store No."",PaymTrans3.""POS Terminal No."",PaymTrans3.""Transaction No."");"										
"IF Transaction2.""Transaction Type"" = Transaction2.""Transaction Type""::Sales THEN"										
RecCount := RecCount + 1;										
"PaymTemp.""Store No."" := PaymTrans3.""Store No."";"										
"PaymTemp.""POS Terminal No."" := PaymTrans3.""POS Terminal No."";"										
"PaymTemp.""Transaction No."" := PaymTrans3.""Transaction No."";"										
PaymTemp.INSERT;										
END;										
UNTIL PaymTrans3.NEXT = 0;										
Value[1] := Text134 + ':';										
Value[2] := FORMAT(RecCount);										
"//PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
										
Value[1] := Text028;										
"Value[2] := FORMAT(Transaction.COUNT,0,'<Integer>');"										
"//PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
										
Value[1] := Text029;										
"Value[2] := FORMAT(Transaction.""No. of Items"",0,'<Integer>');"										
"//PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
										
"Transaction.SETRANGE(Transaction.""Sale Is Return Sale"",TRUE);"										
Value[1] := Text030;										
"Value[2] := FORMAT(Transaction.COUNT,0,'<Integer>');"										
"//PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
"Transaction.SETRANGE(Transaction.""Sale Is Return Sale"");"										
										
"SuspTrans.SETRANGE(""Store No."",Store.""No."");"										
"SuspTrans.SETRANGE(""Entry Status"",SuspTrans.""Entry Status""::Suspended);"										
NoSuspended := SuspTrans.COUNT;										
Value[1] := Text031;										
"Value[2] := FORMAT(NoSuspended,0,'<Integer>');"										
"//PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
"SuspTrans.SETRANGE(""Store No."");"										
										
IF RunType = RunType::Z THEN BEGIN										
"IF Terminal.""Print Suspend with Prepayment"" THEN BEGIN"										
NoSuspPrepayment := 0;										
SuspPrepayment := 0;										
										
SuspTransLine.RESET;										
"SuspTransLine.SETCURRENTKEY(""Receipt No."",""Entry Type"",""Entry Status"");"										
"SuspTransLine.SETRANGE(""Entry Type"",SuspTransLine.""Entry Type""::IncomeExpense);"										
IF SuspTransLine.FIND('-') THEN BEGIN										
REPEAT										
"IF (SuspTransLine.""POS Terminal No."" = '0') THEN BEGIN"										
NoSuspPrepayment := NoSuspPrepayment + 1;										
SuspPrepayment := SuspPrepayment + SuspTransLine.Amount;										
END;										
UNTIL SuspTransLine.NEXT = 0;										
END;										
SuspPrepayment := ABS(SuspPrepayment);										
IF (NoSuspPrepayment > 0) THEN BEGIN										
Value[1] := '  ' + Text154;										
"Value[2] := FORMAT(NoSuspPrepayment,0,'<Integer>');"										
"//PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
END;										
IF (SuspPrepayment > 0) THEN BEGIN										
Value[1] := '  ' + Text155;										
Value[2] := POSFunctions.FormatAmount(SuspPrepayment);										
"//PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
END;										
END;										
END;										
										
IF RunType = RunType::Y THEN BEGIN										
"IF Terminal.""Print Suspend with Prepayment"" THEN BEGIN"										
NoSuspPrepayment := 0;										
SuspPrepayment := 0;										
										
SuspTransLine.RESET;										
"SuspTransLine.SETCURRENTKEY(""Receipt No."",""Entry Type"",""Entry Status"");"										
"SuspTransLine.SETRANGE(""Entry Type"",SuspTransLine.""Entry Type""::IncomeExpense);"										
IF SuspTransLine.FIND('-') THEN BEGIN										
REPEAT										
"IF (SuspTransLine.""POS Terminal No."" = '0') THEN BEGIN"										
NoSuspPrepayment := NoSuspPrepayment + 1;										
SuspPrepayment := SuspPrepayment + SuspTransLine.Amount;										
END;										
UNTIL SuspTransLine.NEXT = 0;										
END;										
SuspPrepayment := ABS(SuspPrepayment);										
IF (NoSuspPrepayment > 0) THEN BEGIN										
Value[1] := '  ' + Text154;										
"Value[2] := FORMAT(NoSuspPrepayment,0,'<Integer>');"										
"//PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
END;										
IF (SuspPrepayment > 0) THEN BEGIN										
Value[1] := '  ' + Text155;										
Value[2] := POSFunctions.FormatAmount(SuspPrepayment);										
"//PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
END;										
END;										
END;										
										
"Transaction.SETRANGE(""Entry Status"",Transaction.""Entry Status""::Voided);"										
Value[1] := Text032;										
"Value[2] := FORMAT(Transaction.COUNT,0,'<Integer>');"										
"//PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
										
IF gNoSuspPOSTransactionsVoided <> 0 THEN BEGIN										
Value[1] := '  ' + Text230;										
"Value[2] := FORMAT(gNoSuspPOSTransactionsVoided,0,'<Integer>');"										
"//PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
END;										
										
"Transaction.SETRANGE(""Entry Status"",Transaction.""Entry Status""::Training);"										
Value[1] := Text034;										
"Value[2] := FORMAT(Transaction.COUNT,0,'<Integer>');"										
"//PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
"Transaction.SETRANGE(""Entry Status"");"										
										
"Transaction.SETFILTER(""Transaction Type"",'%1|%2',"										
"Transaction.""Transaction Type""::Sales,Transaction.""Transaction Type""::""Open Drawer"");"										
"Transaction.SETRANGE(""Open Drawer"",TRUE);"										
Value[1] := Text037;										
"Value[2] := FORMAT(Transaction.COUNT,0,'<Integer>');"										
"//PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
"Transaction.SETRANGE(""Open Drawer"");"										
										
"Transaction.SETRANGE(""Transaction Type"",Transaction.""Transaction Type""::Logon);"										
Value[1] := Text139;										
"Value[2] := FORMAT(Transaction.COUNT,0,'<Integer>');"										
"//PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
"Transaction.SETRANGE(""Transaction Type"");"										
										
"IF Transaction.""No. of Covers"" <> 0 THEN BEGIN"										
Value[1] := Text235;										
"Value[2] := FORMAT(Transaction.""No. of Covers"",0,'<Integer>');"										
"//PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
										
"Transaction.SETFILTER(""Split Number"",'<>%1',0);"										
NoSplitTrans := Transaction.COUNT;										
Value[1] := Text236;										
"Value[2] := FORMAT(NoSplitTrans,0,'<Integer>');"										
"//PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
"Transaction.SETRANGE(""Split Number"");"										
										
NoTables:= RecCount - NoSplitTrans;										
										
Value[1] := Text237;										
"Value[2] := FORMAT(Transaction.""No. of Covers""/NoTables,0,'<Integer>');"										
"//PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
										
Value[1] := Text238;										
"Value[2] := FORMAT(RecCount/NoTables,0,'<Integer>');"										
"//PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
END;										
										
IF WHBatchQueue.COUNT > 0 THEN BEGIN										
Value[1] := lText004;										
"Value[2] := FORMAT(WHBatchQueue.COUNT,0,'<Integer>');"										
"//PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
END;										
										
										
IF RunType = RunType::Z THEN BEGIN										
"IF Terminal.""Statement Method"" = Terminal.""Statement Method""::""POS Terminal"" THEN BEGIN"										
"IF Terminal.""Last Z-Report"" <> '' THEN"										
"Terminal.""Last Z-Report"" := INCSTR(Terminal.""Last Z-Report"")"										
ELSE										
"Terminal.""Last Z-Report"" :='T000000001';"										
"ZReportID := Terminal.""Last Z-Report"";"										
END ELSE BEGIN										
"IF Staff.""Last Z-Report"" <> '' THEN"										
"Staff.""Last Z-Report"" := INCSTR(Staff.""Last Z-Report"")"										
ELSE										
"Staff.""Last Z-Report"" :='S000000001';"										
"ZReportID := Staff.""Last Z-Report"";"										
END;										
IF (Globals.GetValue('TS_ERROR') <> '') THEN										
"ZReportID := 'X' + COPYSTR(ZReportID,2);"										
//PrintSeperator(2);										
"//PrintLine(2,Text116 + ZReportID);"										
//PrintSeperator(2);										
END;										
										
IF RunType = RunType::Y THEN BEGIN										
"IF Terminal.""Statement Method"" = Terminal.""Statement Method""::""POS Terminal"" THEN BEGIN"										
"IF Terminal.""Last Y-Report"" <> '' THEN"										
"Terminal.""Last Y-Report"" := INCSTR(Terminal.""Last Y-Report"")"										
ELSE										
"Terminal.""Last Y-Report"" :='T000000001';"										
"YReportID := Terminal.""Last Y-Report"";"										
END ELSE BEGIN										
"IF Staff.""Last Y-Report"" <> '' THEN"										
"Staff.""Last Y-Report"" := INCSTR(Staff.""Last Y-Report"")"										
ELSE										
"Staff.""Last Y-Report"" :='S000000001';"										
"YReportID := Staff.""Last Y-Report"";"										
END;										
IF (Globals.GetValue('TS_ERROR') <> '') THEN										
"YReportID := 'X' + COPYSTR(YReportID,2);"										
//PrintSeperator(2);										
"//PrintLine(2,Text117 + YReportID);"										
//PrintSeperator(2);										
END;										
										
										
IF RunType = RunType::X THEN BEGIN										
"IF GenPosFunc.""TS Send Transactions"" AND (GenPosFunc.""Send Transaction"" <> '') THEN BEGIN"										
TransServerWorkTable.RESET;										
"TransServerWorkTable.SETRANGE(Table,DATABASE::""Transaction Header"");"										
"TransServerWorkTable.SETRANGE(""Store No."",Globals.StoreNo);"										
"TransServerWorkTable.SETRANGE(""POS Terminal No."",Globals.TerminalNo);"										
TransNotSent := TransServerWorkTable.COUNT;										
IF TransNotSent > 0 THEN BEGIN										
//PrintSeperator(2);										
CLEAR(Value);										
DSTR1 := '#L######################################';										
Value[1] := Text153;										
"//PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
"Value[1] := STRSUBSTNO(Text161,TransNotSent);"										
"//PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
//PrintSeperator(2);										
END;										
END;										
END;										
										
										
IF (RunType = RunType::Z) OR (RunType = RunType::Y) THEN BEGIN										
DSTR1 := '#L##################### #R##############';										
Value[1] := Text035;										
										
IF RunType = RunType::Y THEN										
"Value[2] := POSFunctions.FormatAmount(YReportStats.""Cumulative Sales Amount"")"										
ELSE										
"Value[2] := POSFunctions.FormatAmount(ZReportStats.""Cumulative Sales Amount"");"										
"//PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
										
//Count not z-printed entries in the database										
"Transaction2.SETCURRENTKEY(""Statement Code"",""Z-Report ID"",""Transaction Type"",""Entry Status"");"										
"Transaction2.SETFILTER(""Statement Code"",'<>%1',SCode);"										
"Transaction2.SETRANGE(""Z-Report ID"",'');"										
"Transaction2.SETRANGE(""Transaction Type"",Transaction.""Transaction Type""::Sales);"										
"Transaction2.SETFILTER(""Entry Status"",'%1|%2',Transaction.""Entry Status""::"" "",Transaction.""Entry Status""::Posted);"										
IF RunType = RunType::Y THEN										
"Transaction2.SETRANGE(""Y-Report ID"",'');"										
IF Transaction2.FIND('-') THEN BEGIN										
Value[1] := lText001;										
"Value[2] := FORMAT(Transaction2.COUNT,0,'<Integer>');"										
"//PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
OldestDate := Transaction2.Date;										
REPEAT										
IF Transaction2.Date < OldestDate THEN										
OldestDate := Transaction2.Date;										
UNTIL Transaction2.NEXT = 0;										
Value[1] := lText002;										
Value[2] := FORMAT(OldestDate);										
"//PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
										
"Transaction2.CALCSUMS(""Gross Amount"",""Discount Amount"",""Total Discount"",Rounded,""No. of Items"");"										
Value[1] := lText003;										
"Value[2] := POSFunctions.FormatAmount(-Transaction2.""Gross Amount"" + Transaction2.Rounded);"										
"//PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
END;										
Transaction2.RESET;										
//PrintSeperator(2);										
END;										
										
IF NOT ClosePrinter(2) THEN										
EXIT(FALSE);										
										
//LS7.1-09-										
"IF Transaction.""Entry Status"" = Transaction.""Entry Status""::Training THEN"										
EXIT(TRUE);										
//LS7.1-09+										
										
//Mark every entry included in the report with Z or Y report code.										
IF (RunType = RunType::Z) OR (RunType = RunType::Y) THEN BEGIN										
"IF Terminal.""Statement Method"" = Terminal.""Statement Method""::""POS Terminal"" THEN"										
Terminal.MODIFY										
ELSE BEGIN										
Staff.MODIFY;										
END;										
										
"PaymEntry.SETRANGE(""Currency Code"");"										
"PaymEntry.SETRANGE(""Card No."");"										
"PaymEntry.SETRANGE(""Tender Type"");"										
IF PaymEntry.FIND('-') THEN REPEAT										
PaymTrans2 := PaymEntry;										
IF RunType = RunType::Y THEN										
"PaymTrans2.""Y-Report ID"" := YReportID"										
ELSE										
"PaymTrans2.""Z-Report ID"" := ZReportID;"										
PaymTrans2.MODIFY(TRUE);										
UNTIL PaymEntry.NEXT = 0;										
										
CLEAR(TendDeclEntry);										
"TendDeclEntry.SETCURRENTKEY(""Statement Code"",""Z-Report ID"",""Tender Type"",""Currency Code"",""Card No."");"										
"TendDeclEntry.SETRANGE(""Statement Code"",SCode);"										
"TendDeclEntry.SETRANGE(""Z-Report ID"",'');"										
IF RunType = RunType::Y THEN										
"TendDeclEntry.SETRANGE(""Y-Report ID"",'');"										
IF TendDeclEntry.FIND('-') THEN REPEAT										
TendDeclEntry2 :=  TendDeclEntry;										
IF RunType = RunType::Y THEN										
"TendDeclEntry2.""Y-Report ID"" := YReportID"										
ELSE										
"TendDeclEntry2.""Z-Report ID"" := ZReportID;"										
TendDeclEntry2.MODIFY(TRUE);										
UNTIL TendDeclEntry.NEXT=0;										
										
CLEAR(IncExpEntry);										
"IncExpEntry.SETCURRENTKEY(""Statement Code"",""Z-Report ID"");"										
"IncExpEntry.SETRANGE(""Statement Code"",SCode);"										
"IncExpEntry.SETRANGE(""Z-Report ID"",'');"										
IF RunType = RunType::Y THEN										
"IncExpEntry.SETRANGE(""Y-Report ID"",'');"										
IF IncExpEntry.FIND('-') THEN REPEAT										
IncExpEntry2 := IncExpEntry;										
"IncExpEntry2.""Z-Report ID"" := ZReportID;"										
IncExpEntry2.MODIFY(TRUE);										
UNTIL IncExpEntry.NEXT = 0;										
										
IF Transaction.FIND('-') THEN REPEAT										
Transaction2 := Transaction;										
IF RunType = RunType::Y THEN										
"Transaction2.""Y-Report ID"" := YReportID"										
ELSE										
"Transaction2.""Z-Report ID"" := ZReportID;"										
Transaction2.MODIFY(TRUE);										
UNTIL Transaction.NEXT = 0;										
										
IF RunType = RunType::Y THEN BEGIN										
"YReportStats.""Y-Report Id"" := YReportID;"										
YReportStats.MODIFY(TRUE);										
"Globals.SetValue('LAST_YID',YReportID);"										
END										
ELSE BEGIN										
"ZReportStats.""Z-Report Id"" := ZReportID;"										
ZReportStats.MODIFY(TRUE);										
"Globals.SetValue('LAST_ZID',ZReportID);"										
END;										
END;										
										
EXIT(TRUE);										
END;										
										
"PROCEDURE PrintXZReportSV_2@1000000027(RunType@1100409025 : 'X,Z,Y') : Boolean;"										
VAR										
PaymTrans2@1001 : Record 99001474;										
PaymTrans3@1018 : Record 99001474;										
PaymTemp@1019 : TEMPORARY Record 99001474;										
Terminal@1002 : Record 99001471;										
Staff@1003 : Record 99001461;										
SCode@1200070000 : Code[20];										
Transaction@1005 : Record 99001472;										
Transaction2@1100409016 : Record 99001472;										
IncExpAccount@1006 : Record 99001476;										
IncExpEntry@1007 : Record 99001475;										
SuspTrans@1016 : Record 99008980;										
DSTR1@1008 : Text[80];										
YReportID@1100409032 : Code[10];										
ZReportID@1009 : Code[10];										
FloatTotal@1011 : Decimal;										
RemoveTotal@1012 : Decimal;										
SalesTotal@1013 : Decimal;										
TendDeclEntry2@1014 : Record 99001465;										
IncExpEntry2@1015 : Record 99001475;										
RecCount@1020 : Integer;										
TSUtil@1200070001 : Codeunit 99008909;										
POSGUI@1100409007 : Codeunit 99001575;										
TransServerWorkTable@1100409000 : Record 99001615;										
TransNotSent@1100409001 : Integer;										
SuspTransLine@1100409002 : Record 99008981;										
POSTransactionSuspend@1100409008 : Record 99008980;										
POSTransactionSuspendTEMP@1100409011 : TEMPORARY Record 99008980;										
POSTransactionSuspendMM@1100409013 : Record 99008980;										
POSTransLineSuspend@1100409010 : Record 99008981;										
POSTransaction@1100409014 : Codeunit 99001570;										
NoSuspended@1100409003 : Integer;										
NoSuspPrepayment@1100409004 : Integer;										
SuspPrepayment@1100409005 : Decimal;										
PrintHeaderLines@1100409006 : Boolean;										
TSErr@1100409012 : Integer;										
YReportStats@1100409031 : Record 99008956;										
ZReportStats@1100409015 : Record 99008955;										
lText001@1100409017 : TextConst 'ENU=No of Trans. not on Z-report';										
lText002@1100409018 : TextConst 'ENU=Date of oldest Trans.';										
lText003@1100409019 : TextConst 'ENU=Total Trans not on Z-report';										
OldestDate@1100409020 : Date;										
NoTables@1100409021 : Integer;										
NoSplitTrans@1100409022 : Integer;										
lText004@1100409023 : TextConst 'ENU=Unsent WarrHotel entries';										
WHBatchQueue@1100409024 : Record 99008979;										
LineFound@1100409030 : Boolean;										
lSafeType@1100409029 : Integer;										
NoOfLines@1100409028 : Integer;										
HeaderText@1100409027 : Text[50];										
TotalSafeType@1100409026 : Decimal;										
rCompanyInfo@1000000000 : Record 79;										
rNoSeries@1000000001 : Record 308;										
rNoSeriesLn@1000000002 : Record 309;										
FirstTicket@1000000003 : Code[20];										
LastTicket@1000000004 : Code[20];										
rSalesEntry@1000000005 : Record 99001473;										
rImpuestos@1000000006 : Record 50005;										
Venta@1000000007 : Decimal;										
Iva@1000000008 : Decimal;										
vTotal@1000000009 : Decimal;										
VentasG@1000000010 : Decimal;										
TotalIva@1000000011 : Decimal;										
TotalVentNcr@1000000012 : Decimal;										
TotalIvaNcr@1000000013 : Decimal;										
VentasE@1000000014 : Decimal;										
VentasEDev@1000000015 : Decimal;										
VentasNoSu@1000000016 : Decimal;										
VentasNoSuDev@1000000017 : Decimal;										
Percepcion@1000000018 : Decimal;										
PercepcionDev@1000000019 : Decimal;										
FirstFactCrf@1000000020 : Code[20];										
LastFactCrf@1000000021 : Code[20];										
Percibido@1000000022 : Decimal;										
FirstFactCf@1000000023 : Code[20];										
LastFactCf@1000000024 : Code[20];										
Retencion@1000000025 : Decimal;										
RetencionDev@1000000026 : Decimal;										
Transaction3@1000000027 : Record 99001472;										
NoCorrelativoXZ@1000000028 : Code[20];										
ZReportHist@1000000029 : Record 50006;										
FirstTicketDev@1000000030 : Code[20];										
LastTicketDev@1000000031 : Code[20];										
FirstFactCrfDev@1000000032 : Code[20];										
LastFactCrfDev@1000000033 : Code[20];										
FirstFactCfDev@1000000034 : Code[20];										
LastFactCfDev@1000000035 : Code[20];										
vTotalDocDevolucion@1000000036 : Decimal;										
vTotalIvaDocDevolucion@1000000052 : Decimal;										
vVentasGravadasTotales@1000000037 : Decimal;										
vImpuestoIVATotales@1000000038 : Decimal;										
vTotalGravadoTotales@1000000039 : Decimal;										
vVentasExentasTotales@1000000040 : Decimal;										
vVentasNoSujetasTotales@1000000041 : Decimal;										
vVentasTotalesTotales@1000000042 : Decimal;										
vIVAPercibidoTotales@1000000043 : Decimal;										
vIVAPercibidoDevTotales@1000000058 : Decimal;										
vIVARetenidoTotales@1000000044 : Decimal;										
vNoDevoluciones@1000000045 : Integer;										
vEfectivoRetirado@1000000047 : Decimal;										
vChequeRetirado@1000000048 : Decimal;										
TextEfectivoRetirado@1000000049 : TextConst 'ENU=Efectivo Retirado';										
TextChequeRetirado@1000000050 : TextConst 'ENU=Cheque Retirado';										
TextEfectivoARetirar@1000000046 : TextConst 'ENU=Efectivo A Retirar';										
TextChequeARetirar@1000000051 : TextConst 'ENU=Cheque A Retirar';										
vFirstFactCredAut@1000000056 : Text[30];										
vLastFactCredAut@1000000055 : Text[30];										
vFirstFactCFAut@1000000054 : Text[30];										
vLastFactCFAut@1000000053 : Text[30];										
vTotalRetencionDev@1000000057 : Decimal;										
VentasEDevDocDev@1000000059 : Decimal;										
Transaction4@1000000060 : Record 99001472;										
vFirstFechaCref@1000000066 : Date;										
vLastFechaCref@1000000065 : Date;										
vFirstFechaNocre@1000000064 : Date;										
vLastFechaNocre@1000000063 : Date;										
vFirstFechaFac@1000000062 : Date;										
vLastFechaFac@1000000061 : Date;										
rRecargasElectronicas@1000000068 : Record 50040;										
vCESC@1000000069 : Decimal;										
vCESCTotales@1000000067 : Decimal;										
BEGIN										
										
//CSPNT290816 longitud campos texto autorizacion 20a30										
										
IF NOT Staff.GET(Globals.StaffID) THEN										
EXIT(TRUE);										
IF NOT Terminal.GET(Globals.TerminalNo) THEN										
EXIT(TRUE);										
"IF NOT OpenReceiptPrinter(2, 'TENDER', 'ZXREPORT', 0, '') THEN"										
EXIT(FALSE);										
										
//LS7.1-13-										
IF FiscalON THEN BEGIN										
FiscalPrintXZReport(RunType);										
IF OnlyFiscal THEN										
EXIT( ClosePrinter(2) );										
END;										
//LS7.1-13+										
										
"IF NOT Terminal.""Terminal Statement"" THEN"										
"Terminal.""Statement Method"" := Store.""Statement Method"";"										
										
//Print Header info										
//CSPNT261015										
{DSTR1 := '#L######## #L#########';										
Value[1] := Text078 + ':';										
"Value[2] := Store.""No."";"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
										
"IF Terminal.""Statement Method"" = Terminal.""Statement Method""::""POS Terminal"" THEN BEGIN"										
DSTR1:='#L####### #L########';										
Value[1] := Text079 + ':';										
"Value[2] := Terminal.""No."";"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
END;}										
										
SCode := POSFunctions.GetStatementCode;										
										
Transaction.Date := TODAY;										
Transaction.Time := TIME;										
//CSPNT281015										
{PrintLogo(2); //LS7.1-06										
"PrintHeader(Transaction,FALSE,2);}"										
//CSPNT261015										
{DSTR1 := '#L#### #T###### #T#### ';										
Value[1] := Text048 + ':';										
Value[2] := FORMAT(TODAY());										
"Value[3] := FORMAT(TIME(),5);"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));}"										
										
//CSPNT261015										
{DSTR1 := '#L###### #L############';										
Value[1] := Text051 + ':';										
"IF Staff.""Name on Receipt""<>'' THEN"										
"Value[2] := Staff.""Name on Receipt"""										
ELSE										
Value[2] := Globals.StaffID;										
										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));}"										
PrintSeperator(2);										
										
//X or Z Report..										
DSTR1 := '#C############################';										
										
CASE RunType OF										
RunType::X:										
Value[1] := Text107;										
RunType::Z:										
Value[1] := Text106;										
RunType::Y:										
Value[1] := Text108;										
END;										
										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
										
"IF GenPosFunc.""TS Floating Cashier"" AND"										
"(Terminal.""Statement Method"" = Terminal.""Statement Method""::Staff) AND"										
(Globals.GetValue('TS_ERROR') <> '') THEN BEGIN										
//CSPNT281015										
"{  PrintLine(2,'');"										
"PrintLine(2,FormatLine(STRSUBSTNO(Text141,Terminal.""No.""),FALSE,TRUE,FALSE,FALSE));}"										
END;										
										
PrintSeperator(2);										
										
// Report Body										
										
//CSPNT261015 informaci¢n general										
										
DSTR1 := '#L######################################';										
"Value[1] := 'Fecha: ' + FORMAT(TODAY,0,'<Day,2>/<Month,2>/<Year4>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
DSTR1 := '#L######################################';										
"Value[1] := 'Hora: ' + FORMAT(TIME(),0,'<Hours12>:<Minutes,2> <AM/PM>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//Imprimir Linea en blanco...										
"DSTR1 :=     COPYSTR('                     ',1);"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//CONSISA-Imprimir Nombre de la empresa...										
rCompanyInfo.GET();										
"DSTR1 := COPYSTR('#C######################################',1);"										
Value[1] := rCompanyInfo.Name;										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//CONSISA-Imprimir Codigo Tipo Contribuyente y  No. Reg. Contribuyente de la empresa...										
rCompanyInfo.GET();										
"DSTR1 := COPYSTR('#C######################################',1);"										
"Value[1] := rCompanyInfo.""Tipo de Contibuyente"" + ' ' + TextNRC + ' ' + rCompanyInfo.NRC;"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//CONSISA-Imprimir NIT de la empresa...										
rCompanyInfo.GET();										
"DSTR1 := COPYSTR('#C######################################',1);"										
"Value[1] := TextRNC + ' ' + rCompanyInfo.""VAT Registration No."";"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//CONSISA-Imprimir Giro de la empresa...										
rCompanyInfo.GET();										
"DSTR1 := COPYSTR('#L################################################',1);"										
Value[1] := TextGIRO + ':' + rCompanyInfo.Giro;										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//Imprimir Linea en blanco...										
"DSTR1 :=     COPYSTR('                     ',1);"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//CONSISA-Imprimir Nombre de la tienda.										
"DSTR1 := COPYSTR('#L######################################',1);"										
Value[1] := Store.Name;										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//CONSISA-Imprimir 1era. direccion de la tienda.										
"DSTR1 := COPYSTR('#L######################################',1);"										
Value[1] := Store.Address;										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//CONSISA-Imprimir 2da. direccion de la tienda.										
"IF Store.""Address 2"" <> '' THEN BEGIN"										
"DSTR1 := COPYSTR('#L######################################',1);"										
"Value[1] := Store.""Address 2"";"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
										
//CONSISA-Imprimir el No. de la Caja..										
"DSTR1 := COPYSTR('#L################## #R#################',1);"										
"Value[1] := TextCodTienda + ' ' + Store.""No."";"										
"Value[2] := TextCaja + ' ' + Terminal.""No."";"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//Imprimir Linea en blanco...										
"DSTR1 :=     COPYSTR('                     ',1);"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//CSPNT210116										
PrintSeperator(2);										
CASE RunType OF										
RunType::X: BEGIN										
"DSTR1 := COPYSTR('#C######################################',1);"										
"Value[1] := 'Corte X No.: ' + INCSTR(Terminal.""Last X-Report"");"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
RunType::Z: BEGIN										
"DSTR1 := COPYSTR('#C######################################',1);"										
"Value[1] := 'Corte Z No.: ' + INCSTR(Terminal.""Last Z-Report""); //CSRM19092013"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
END;										
										
//CSPNT271015										
//CSPNT210116										
PrintSeperator(2);										
										
//  Totals for LCY										
IF LocalTotal <> 0 THEN BEGIN										
PrintSeperator(2);										
DSTR1    := '#L########              #R##############';										
Value[1] := Text005 + ':';										
Value[2] := POSFunctions.FormatAmount(LocalTotal);										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
END;										
										
//  Totals for FCY										
"PrintLine(2,'');"										
"TenderType.SETRANGE(""Foreign Currency"",TRUE);"										
										
TotalLCYInCurrency := 0;										
PrintXZLines();										
IF TotalLCYInCurrency <> 0 THEN BEGIN										
PrintSeperator(2);										
DSTR1    := '#L##################### #R##############';										
Value[1] := Text300;										
Value[2] := POSFunctions.FormatAmount(TotalLCYInCurrency);										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
"PrintLine(2,'');"										
PrintSeperator(2);										
DSTR1    := '#L##################### #R##############';										
Value[1] := Text301;										
Value[2] := POSFunctions.FormatAmount(LocalTotal);										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
PrintSeperator(2);										
END;										
										
{										
//CSPNT281015										
"TenderType.SETRANGE(""Foreign Currency"");"										
"TenderType.SETRANGE(TenderType.""Function"",TenderType.""Function""::""Tender Remove/Float"");"										
IF TenderType.FIND('-') THEN BEGIN										
REPEAT										
"PaymEntry.SETRANGE(""Currency Code"");"										
"PaymEntry.SETRANGE(""Card No."");"										
"PaymEntry.SETRANGE(""Tender Type"",TenderType.Code);"										
IF PaymEntry.FIND('-') THEN										
REPEAT										
"Transaction.GET(PaymEntry.""Store No."",PaymEntry.""POS Terminal No."",PaymEntry.""Transaction No."");"										
"CASE Transaction.""Transaction Type"" OF"										
"Transaction.""Transaction Type""::""Remove Tender"" :"										
"RemoveTotal := RemoveTotal + PaymEntry.""Amount Tendered"";"										
"Transaction.""Transaction Type""::""Float Entry"" :"										
"FloatTotal := FloatTotal + PaymEntry.""Amount Tendered"";"										
END;										
UNTIL PaymEntry.NEXT = 0;										
UNTIL TenderType.NEXT = 0;										
END;										
}										
										
//  Tender Declaration										
"Transaction.""Transaction No."" := 0;"										
"TendDeclEntry.SETCURRENTKEY(""Statement Code"",""Z-Report ID"",""Tender Type"",""Currency Code"",""Card No."");"										
"TendDeclEntry.SETRANGE(""Statement Code"",SCode);"										
"TendDeclEntry.SETRANGE(""Z-Report ID"",'');"										
//CSPNT281015										
{IF RunType = RunType::Y THEN										
"TendDeclEntry.SETRANGE(""Y-Report ID"",'')"										
ELSE										
"TendDeclEntry.SETRANGE(""Y-Report ID"");}"										
"IF Store.""Tend. Decl. Calculation"" = Store.""Tend. Decl. Calculation""::Sum THEN BEGIN"										
BufferTendDeclEntry;										
IF TendDeclEntry.FIND('-') THEN										
"Transaction.""Transaction No."" := TendDeclEntry.""Transaction No."";"										
END ELSE BEGIN										
IF TendDeclEntry.FIND('-') THEN										
REPEAT										
"IF TendDeclEntry.""Transaction No."" > Transaction.""Transaction No."" THEN"										
"Transaction.GET(TendDeclEntry.""Store No."",TendDeclEntry.""POS Terminal No."",TendDeclEntry.""Transaction No."")"										
UNTIL TendDeclEntry.NEXT=0;										
END;										
										
"IF Transaction.""Transaction No."" <> 0 THEN BEGIN"										
"//CSPNT281015  PrintLine(2,FormatLine(Text112,FALSE,TRUE,FALSE,FALSE));"										
CLEAR(TendDeclEntry);										
LocalTotal := 0;										
"IF Store.""Tend. Decl. Calculation"" = Store.""Tend. Decl. Calculation""::Last THEN BEGIN"										
"TendDeclEntry.SETCURRENTKEY(""Store No."",""POS Terminal No."",""Transaction No."");"										
"TendDeclEntry.SETRANGE(""Store No."",Transaction.""Store No."");"										
"TendDeclEntry.SETRANGE(""POS Terminal No."",Transaction.""POS Terminal No."");"										
"TendDeclEntry.SETRANGE(""Transaction No."",Transaction.""Transaction No."");"										
BufferTendDeclEntry;										
END;										
"TempTendDeclEntry.SETFILTER(""Currency Code"",'=%1','');"										
//CSPNT281015  PrintTenderDeclLines;										
"Transaction.""Gross Amount"" := -LocalTotal;"										
"//CSPNT281015  PrintTotal(Transaction,2,0);"										
"//CSPNT281015  PrintLine(2,'');"										
"TempTendDeclEntry.SETFILTER(""Currency Code"",'<>%1','');"										
//CSPNT281015  PrintTenderDeclLines;										
END;										
										
//CSPNT261015 contenido cortes										
CASE RunType OF										
RunType::X: BEGIN										
										
//CSPNT140116										
//CSPNT150116										
vVentasGravadasTotales := 0;										
vImpuestoIVATotales := 0;										
vTotalGravadoTotales := 0;										
vVentasExentasTotales := 0;										
vVentasNoSujetasTotales := 0;										
vVentasTotalesTotales := 0;										
vIVAPercibidoTotales := 0;										
vIVAPercibidoDevTotales := 0;										
vIVARetenidoTotales := 0;										
//CSPNT010916										
vCESCTotales := 0;										
										
//ENCABEZADO PARA EL TIPO DE COMPROBANTE										
"DSTR1 := COPYSTR('#C######################################',1);"										
//CSPNT060216										
Value[1] := '1- Ticket';										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//CSPNT281015										
Transaction2.RESET;										
"Transaction2.SETCURRENTKEY(""Statement Code"",""Z-Report ID"",""Transaction Type"",""Entry Status"");"										
"Transaction2.SETRANGE(""Statement Code"",SCode);"										
"Transaction2.SETRANGE(""Z-Report ID"",'');"										
"Transaction2.SETRANGE(""Transaction Type"",Transaction2.""Transaction Type""::Sales);"										
//CSPNT270216										
"Transaction2.SETFILTER(""Entry Status"",'%1|%2|%3',Transaction2.""Entry Status""::"" "",Transaction2.""Entry Status""::Posted,Transact"	ion	"2."""	En	try	"Status""::Voided);"					
"Transaction2.SETRANGE(""No. Serie NCF"",Terminal.""No. Serie NCF Ticket"");"										
IF Transaction2.FINDFIRST THEN BEGIN										
rNoSeries.RESET;										
"//CSPNT281015      IF rNoSeries.GET(Transaction2.""No. Serie NCF"") THEN BEGIN"										
"IF rNoSeries.GET(Terminal.""No. Serie NCF Ticket"") THEN BEGIN"										
rNoSeriesLn.RESET;										
"rNoSeriesLn.SETRANGE(""Series Code"",rNoSeries.Code);"										
IF rNoSeriesLn.FINDFIRST THEN BEGIN										
"DSTR1 := COPYSTR('#L######################################',1);"										
Value[1] := 'Autorizacion: ' + UPPERCASE(rNoSeriesLn.Autorizacion);										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
//CONSISA-Imprimir el rango de ticket..										
"DSTR1 := COPYSTR('#L######################################',1);"										
"Value[1] := 'Del ' + rNoSeriesLn.""Starting No."";"										
//CSPNT090316										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
"DSTR1 := COPYSTR('#L######################################',1);"										
//CSPNT090316										
"Value[1] := 'al  ' + rNoSeriesLn.""Ending No."";"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
END;										
										
FirstTicket := Transaction2.NCF;										
										
REPEAT										
CLEAR(Venta);										
CLEAR(Iva);										
CLEAR(vTotal);										
"rSalesEntry.SETRANGE(""Store No."",Transaction2.""Store No."");"										
"rSalesEntry.SETRANGE(""POS Terminal No."",Transaction2.""POS Terminal No."");"										
"rSalesEntry.SETRANGE(""Transaction No."",Transaction2.""Transaction No."");"										
IF rSalesEntry.FIND('-') THEN										
REPEAT										
IF rSalesEntry.NotaRemision <> '' THEN BEGIN										
rImpuestos.RESET;										
"rImpuestos.SETRANGE(""VAT Bus. Posting Group"",rSalesEntry.""VAT Bus. Posting Group"");"										
"rImpuestos.SETRANGE(""VAT Prod. Posting Group"",rSalesEntry.""VAT Prod. Posting Group"");"										
IF rImpuestos.FINDFIRST THEN BEGIN										
"Venta    += -(rSalesEntry.""Net Amount"");"										
"Iva      += -(rSalesEntry.""VAT Amount"");"										
"vTotal   += -(rSalesEntry.""Net Amount"") + -(rSalesEntry.""VAT Amount"");"										
										
IF rImpuestos.Impuesto=rImpuestos.Impuesto::Gravado THEN BEGIN										
"IF NOT Transaction2.""Sale Is Return Sale"" THEN BEGIN"										
"VentasG  += -(rSalesEntry.""Net Amount"");"										
"TotalIva += -(rSalesEntry.""VAT Amount"");"										
END ELSE BEGIN										
"TotalVentNcr += -(rSalesEntry.""Net Amount"");"										
"TotalIvaNcr  += -(rSalesEntry.""VAT Amount"");"										
END;										
END ELSE BEGIN										
IF rImpuestos.Impuesto=rImpuestos.Impuesto::Exento THEN BEGIN										
"IF NOT Transaction2.""Sale Is Return Sale"" THEN"										
"VentasE  += -(rSalesEntry.""Net Amount"")"										
ELSE										
"VentasEDev  += -(rSalesEntry.""Net Amount"");"										
END ELSE BEGIN										
"IF NOT Transaction2.""Sale Is Return Sale"" THEN"										
"VentasNoSu  += -(rSalesEntry.""Net Amount"")"										
ELSE										
"VentasNoSuDev  += -(rSalesEntry.""Net Amount"");"										
END;										
END;										
END;										
END ELSE BEGIN										
rImpuestos.RESET;										
"rImpuestos.SETRANGE(""VAT Bus. Posting Group"",rSalesEntry.""VAT Bus. Posting Group"");"										
"rImpuestos.SETRANGE(""VAT Prod. Posting Group"",rSalesEntry.""VAT Prod. Posting Group"");"										
IF rImpuestos.FINDFIRST THEN BEGIN										
"Venta    += ABS(rSalesEntry.""Net Amount"");"										
"Iva      += ABS(rSalesEntry.""VAT Amount"");"										
"vTotal   += ABS(rSalesEntry.""Net Amount"") + ABS(rSalesEntry.""VAT Amount"");"										
										
IF rImpuestos.Impuesto=rImpuestos.Impuesto::Gravado THEN BEGIN										
"IF NOT Transaction2.""Sale Is Return Sale"" THEN BEGIN"										
"VentasG  += ABS(rSalesEntry.""Net Amount"");"										
"TotalIva += ABS(rSalesEntry.""VAT Amount"");"										
END ELSE BEGIN										
"TotalVentNcr += ABS(rSalesEntry.""Net Amount"");"										
"TotalIvaNcr  += ABS(rSalesEntry.""VAT Amount"");"										
END;										
END ELSE BEGIN										
IF rImpuestos.Impuesto=rImpuestos.Impuesto::Exento THEN BEGIN										
"IF NOT Transaction2.""Sale Is Return Sale"" THEN"										
"VentasE  += ABS(rSalesEntry.""Net Amount"")"										
ELSE										
"VentasEDev  += ABS(rSalesEntry.""Net Amount"");"										
END ELSE BEGIN										
"IF NOT Transaction2.""Sale Is Return Sale"" THEN"										
"VentasNoSu  += ABS(rSalesEntry.""Net Amount"")"										
ELSE										
"VentasNoSuDev  += ABS(rSalesEntry.""Net Amount"");"										
END;										
END;										
END;										
END;										
UNTIL rSalesEntry.NEXT = 0;										
										
LastTicket := Transaction2.NCF;										
										
//CSPNT010916										
rRecargasElectronicas.RESET;										
"rRecargasElectronicas.SETRANGE(""Store No."", Transaction2.""Store No."");"										
"rRecargasElectronicas.SETRANGE(""POS Terminal No."", Transaction2.""POS Terminal No."");"										
"rRecargasElectronicas.SETRANGE(""Receipt No."", Transaction2.""Receipt No."");"										
IF rRecargasElectronicas.FINDFIRST THEN										
vCESC := vCESC + rRecargasElectronicas.CESC;										
										
UNTIL Transaction2.NEXT = 0;										
END;										
										
//CSPNT070916										
IF (FirstTicket <> '') OR (LastTicket <> '') THEN BEGIN										
//Del No.										
"DSTR1 := COPYSTR('#L######################################',1);"										
Value[1] := 'Del No.: ' + FirstTicket;										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
//Al No.										
"DSTR1 := COPYSTR('#L######################################',1);"										
Value[1] := 'Al No.: ' + LastTicket;										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
										
//Imprimir Linea en blanco...										
"DSTR1 :=     COPYSTR('                     ',1);"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
//CSPNT150116										
{    //ENCABEZADO DE VENTAS TOTALES...										
"DSTR1 := COPYSTR('    #L#############',1);"										
Value[1] := 'VENTAS TOTALES:';										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
}										
VentasG := VentasG - TotalVentNcr;										
										
//VENTAS GRAVADAS...										
"DSTR1 := COPYSTR('#L##############         #R#############',1);"										
Value[1] := 'Ventas Gravadas:';										
"Value[2] := '$' + FORMAT(VentasG,0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
TotalIva := TotalIva - TotalIvaNcr;										
										
//IMPUESTO IVA...										
"DSTR1 := COPYSTR('#L###########            #R#############',1);"										
Value[1] := 'Impuesto IVA:';										
//CSPNT010916										
"Value[2] := '$' + FORMAT(TotalIva - vCESC,0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//CSPNT010916 IMPUESTO CESC...										
"DSTR1 := COPYSTR('#L############           #R#############',1);"										
Value[1] := 'Impuesto CESC:';										
"Value[2] := '$' + FORMAT(vCESC,0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//Total Gravado...										
"DSTR1 := COPYSTR('#L############           #R#############',1);"										
Value[1] := 'Total Gravado:';										
"Value[2] := '$' + FORMAT(VentasG + TotalIva,0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//VENTAS EXENTAS...										
"DSTR1 := COPYSTR('#L#############          #R#############',1);"										
Value[1] := 'Ventas Exentas:';										
"Value[2] := '$' + FORMAT((VentasE-VentasEDev),0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//VENTAS NO SUJETAS...										
"DSTR1 := COPYSTR('#L################       #R#############',1);"										
Value[1] := 'Ventas No Sujetas:';										
"Value[2] := '$' + FORMAT((VentasNoSu-VentasNoSuDev),0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//VENTAS TOTALES										
"DSTR1 := COPYSTR('#L#############          #R#############',1);"										
Value[1] := 'Ventas Totales:';										
"Value[2] := '$' + FORMAT((VentasG + TotalIva + VentasE + VentasNoSu)-(VentasEDev+VentasNoSuDev),0,'<Integer Thousand><Decimals"	",3>"	');								
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//CSPNT140116										
//CSPNT150116										
vVentasGravadasTotales := vVentasGravadasTotales + VentasG;										
//CSPNT010916										
vImpuestoIVATotales := vImpuestoIVATotales + TotalIva - vCESC;										
vCESCTotales := vCESCTotales + vCESC;										
vTotalGravadoTotales := vTotalGravadoTotales + (VentasG + TotalIva);										
vVentasExentasTotales := vVentasExentasTotales + (VentasE-VentasEDev);										
vVentasNoSujetasTotales := vVentasNoSujetasTotales + (VentasNoSu-VentasNoSuDev);										
vVentasTotalesTotales := vVentasTotalesTotales + ((VentasG + TotalIva + VentasE + VentasNoSu)-(VentasEDev+VentasNoSuDev));										
										
//LIMPIO LAS VARIABLES QUE MUESTRAN LOS TOTALES DE LAS VENTAS POR TIPO DE COMPROBANTES.										
CLEAR(FirstTicket);										
CLEAR(LastTicket);										
CLEAR(Venta);										
CLEAR(Iva);										
CLEAR(vTotal);										
CLEAR(VentasG);										
CLEAR(TotalIva);										
CLEAR(TotalVentNcr);										
CLEAR(TotalIvaNcr);										
CLEAR(VentasE);										
CLEAR(VentasNoSu);										
CLEAR(VentasEDev);										
CLEAR(VentasNoSuDev);										
//CSPNT010916										
CLEAR(vCESC);										
										
//Imprimir Linea en blanco...										
"DSTR1 :=     COPYSTR('                     ',1);"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//ENCABEZADO PARA EL TIPO DE COMPROBANTE										
"DSTR1 := COPYSTR('#C######################################',1);"										
Value[1] := '2- Comprobante de CrÇdito Fiscal';										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//CSRM16102013 Se quito que imprimiera los rango de facturas porq no es un solo pos en la tienda										
//CSPNT271015 se agrego rango de facturas										
//CSPNT281015										
//BUSCO PRIMERO LOS NCF PARA CREDITO FISCALES										
Transaction2.RESET;										
"Transaction2.SETCURRENTKEY(""Statement Code"",""Z-Report ID"",""Transaction Type"",""Entry Status"");"										
"Transaction2.SETRANGE(""Statement Code"",SCode);"										
"Transaction2.SETRANGE(""Z-Report ID"",'');"										
"Transaction2.SETRANGE(""Transaction Type"",Transaction2.""Transaction Type""::Sales);"										
//CSPNT270216										
"Transaction2.SETFILTER(""Entry Status"",'%1|%2|%3',Transaction2.""Entry Status""::"" "",Transaction2.""Entry Status""::Posted,Transact"	ion	"2."""	En	try	"Status""::Voided);"					
"Transaction2.SETRANGE(""No. Serie NCF"",Terminal.""No. Serie NCF Credito Fiscal"");"										
IF Transaction2.FINDFIRST THEN BEGIN										
rNoSeries.RESET;										
"IF rNoSeries.GET(Terminal.""No. Serie NCF Credito Fiscal"") THEN BEGIN"										
rNoSeriesLn.RESET;										
"rNoSeriesLn.SETRANGE(""Series Code"",rNoSeries.Code);"										
IF rNoSeriesLn.FINDFIRST THEN BEGIN										
"DSTR1 := COPYSTR('#L######################################',1);"										
Value[1] := 'Autorizacion: ' + UPPERCASE(rNoSeriesLn.Autorizacion);										
"//CSPNT070416          PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
"DSTR1 := COPYSTR('#L#################  #R#################',1);"										
"Value[1] := 'Del ' + rNoSeriesLn.""Starting No."";"										
"Value[2] := 'al  ' + rNoSeriesLn.""Ending No."";"										
"//CSPNT070416          PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
END;										
//CSRM16102013 Se quito que imprimiera los rango de facturas porq no es un solo pos en la tienda										
//CSPNT241015 se agrego rango de facturas										
"FirstFactCrf := Transaction2.""Correlativo Facturas"";"										
//CSPNT290816										
vFirstFechaCref := Transaction2.Date;										
//CSRM16102013 Se quito que imprimiera los rango de facturas porq no es un solo pos en la tienda										
										
REPEAT										
CLEAR(Venta);										
CLEAR(Iva);										
CLEAR(vTotal);										
//CSPNT090316        CLEAR(Percepcion);										
"rSalesEntry.SETRANGE(""Store No."",Transaction2.""Store No."");"										
"rSalesEntry.SETRANGE(""POS Terminal No."",Transaction2.""POS Terminal No."");"										
"rSalesEntry.SETRANGE(""Transaction No."",Transaction2.""Transaction No."");"										
IF rSalesEntry.FIND('-') THEN										
REPEAT										
IF rSalesEntry.NotaRemision <> '' THEN BEGIN										
rImpuestos.RESET;										
"rImpuestos.SETRANGE(""VAT Bus. Posting Group"",rSalesEntry.""VAT Bus. Posting Group"");"										
"rImpuestos.SETRANGE(""VAT Prod. Posting Group"",rSalesEntry.""VAT Prod. Posting Group"");"										
IF rImpuestos.FINDFIRST THEN BEGIN										
"Venta    += -(rSalesEntry.""Net Amount"");"										
"Iva      += -(rSalesEntry.""VAT Amount"");"										
"vTotal   += -(rSalesEntry.""Net Amount"") + -(rSalesEntry.""VAT Amount"");"										
										
IF rImpuestos.Impuesto=rImpuestos.Impuesto::Gravado THEN BEGIN										
"IF NOT Transaction2.""Sale Is Return Sale"" THEN BEGIN"										
"VentasG  += -(rSalesEntry.""Net Amount"");"										
"TotalIva += -(rSalesEntry.""VAT Amount"");"										
END ELSE BEGIN										
"TotalVentNcr += -(rSalesEntry.""Net Amount"");"										
"TotalIvaNcr  += -(rSalesEntry.""VAT Amount"");"										
END;										
END ELSE BEGIN										
IF rImpuestos.Impuesto=rImpuestos.Impuesto::Exento THEN BEGIN										
"IF NOT Transaction2.""Sale Is Return Sale"" THEN"										
"VentasE  += -(rSalesEntry.""Net Amount"")"										
ELSE										
"VentasEDev  += -(rSalesEntry.""Net Amount"");"										
END ELSE BEGIN										
"IF NOT Transaction2.""Sale Is Return Sale"" THEN"										
"VentasNoSu  += -(rSalesEntry.""Net Amount"")"										
ELSE										
"VentasNoSuDev  += -(rSalesEntry.""Net Amount"");"										
END;										
END;										
END;										
END ELSE BEGIN										
rImpuestos.RESET;										
"rImpuestos.SETRANGE(""VAT Bus. Posting Group"",rSalesEntry.""VAT Bus. Posting Group"");"										
"rImpuestos.SETRANGE(""VAT Prod. Posting Group"",rSalesEntry.""VAT Prod. Posting Group"");"										
IF rImpuestos.FINDFIRST THEN BEGIN										
"Venta    += ABS(rSalesEntry.""Net Amount"");"										
"Iva      += ABS(rSalesEntry.""VAT Amount"");"										
"vTotal   += ABS(rSalesEntry.""Net Amount"") + ABS(rSalesEntry.""VAT Amount"");"										
										
IF rImpuestos.Impuesto=rImpuestos.Impuesto::Gravado THEN BEGIN										
"IF NOT Transaction2.""Sale Is Return Sale"" THEN BEGIN"										
"VentasG  += ABS(rSalesEntry.""Net Amount"");"										
"TotalIva += ABS(rSalesEntry.""VAT Amount"");"										
END ELSE BEGIN										
"TotalVentNcr += ABS(rSalesEntry.""Net Amount"");"										
"TotalIvaNcr  += ABS(rSalesEntry.""VAT Amount"");"										
END;										
END ELSE BEGIN										
IF rImpuestos.Impuesto=rImpuestos.Impuesto::Exento THEN BEGIN										
"IF NOT Transaction2.""Sale Is Return Sale"" THEN"										
"VentasE  += ABS(rSalesEntry.""Net Amount"")"										
ELSE										
"VentasEDev  += ABS(rSalesEntry.""Net Amount"");"										
END ELSE BEGIN										
"IF NOT Transaction2.""Sale Is Return Sale"" THEN"										
"VentasNoSu  += ABS(rSalesEntry.""Net Amount"")"										
ELSE										
"VentasNoSuDev  += ABS(rSalesEntry.""Net Amount"");"										
END;										
END;										
END;										
END;										
UNTIL rSalesEntry.NEXT = 0;										
//CSRM16102013 Se quito que imprimiera los rango de facturas porq no es un solo pos en la tienda										
//CSPNT241015 se agrego rango de facturas										
"LastFactCrf := Transaction2.""Correlativo Facturas"";"										
//CSPNT290816										
vLastFechaCref := Transaction2.Date;										
//CSRM16102013 Se quito que imprimiera los rango de facturas porq no es un solo pos en la tienda										
//CSPNT090316										
"//CSPNT270416        IF (Transaction2.""Refund Receipt No."" = '') THEN BEGIN"										
"IF NOT Transaction2.""Sale Is Return Sale"" THEN"										
"Percepcion  += ABS(Transaction2.""Percepcion Amount"")"										
ELSE										
"PercepcionDev  += -(Transaction2.""Percepcion Amount"");"										
//CSPNT270416        END;										
										
//CSPNT010916										
rRecargasElectronicas.RESET;										
"rRecargasElectronicas.SETRANGE(""Store No."", Transaction2.""Store No."");"										
"rRecargasElectronicas.SETRANGE(""POS Terminal No."", Transaction2.""POS Terminal No."");"										
"rRecargasElectronicas.SETRANGE(""Receipt No."", Transaction2.""Receipt No."");"										
IF rRecargasElectronicas.FINDFIRST THEN										
vCESC := vCESC + rRecargasElectronicas.CESC;										
										
UNTIL Transaction2.NEXT = 0;										
END;										
										
//CSRM16102013 Se quito que imprimiera los rango de facturas porq no es un solo pos en la tienda										
//CSPNT241015 se agrego rango de facturas										
//CSPNT271015										
//CSPNT070916										
IF (FirstFactCrf <> '') OR (LastFactCrf <> '') THEN BEGIN										
//CSPNT070416										
rNoSeriesLn.RESET;										
"rNoSeriesLn.SETRANGE(""Series Code"",rNoSeries.Code);"										
IF rNoSeriesLn.FINDFIRST THEN										
REPEAT										
//CSPNT290816										
"IF ((rNoSeriesLn.""Starting No."" <= FirstFactCrf) AND (rNoSeriesLn.""Ending No."" >= FirstFactCrf)) AND"										
"((rNoSeriesLn.""Starting Date"" <= vFirstFechaCref) AND (rNoSeriesLn.""Last Date Used"" >= vFirstFechaCref)) THEN"										
vFirstFactCredAut := UPPERCASE(rNoSeriesLn.Autorizacion);										
"IF ((rNoSeriesLn.""Starting No."" <= LastFactCrf) AND (rNoSeriesLn.""Ending No."" >= LastFactCrf)) AND"										
"((rNoSeriesLn.""Starting Date"" <= vLastFechaCref) AND (rNoSeriesLn.""Last Date Used"" >= vLastFechaCref)) THEN"										
vLastFactCredAut := UPPERCASE(rNoSeriesLn.Autorizacion);										
UNTIL rNoSeriesLn.NEXT = 0;										
										
//CSPNT290816										
"DSTR1 := COPYSTR('#L######################################',1);"										
//CSPNT070416										
Value[1] := 'Del No.: ' + vFirstFactCredAut + ' ' + FirstFactCrf;										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
//CSPNT290816										
"DSTR1 := COPYSTR('#L######################################',1);"										
//CSPNT070416										
Value[1] := 'Al No.: ' + vLastFactCredAut + ' ' + LastFactCrf;										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
										
//CSRM16102013 Se quito que imprimiera los rango de facturas porq no es un solo pos en la tienda										
										
//Imprimir Linea en blanco...										
"DSTR1 :=     COPYSTR('                     ',1);"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
//CSPNT150116										
{    //ENCABEZADO DE VENTAS TOTALES...										
"DSTR1 := COPYSTR('    #L#############',1);"										
Value[1] := 'VENTAS TOTALES:';										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
}										
VentasG := VentasG - TotalVentNcr;										
										
//VENTAS GRAVADAS...										
"DSTR1 := COPYSTR('#L##############    #R##################',1);"										
Value[1] := 'Ventas Gravadas:';										
"Value[2] := '$' + FORMAT(VentasG,0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
TotalIva := TotalIva - TotalIvaNcr;										
										
//IMPUESTO IVA...										
"DSTR1 := COPYSTR('#L###########       #R##################',1);"										
Value[1] := 'Impuesto IVA:';										
//CSPNT010916										
"Value[2] := '$' + FORMAT(TotalIva - vCESC,0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//CSPNT010916 IMPUESTO CESC...										
"DSTR1 := COPYSTR('#L############           #R#############',1);"										
Value[1] := 'Impuesto CESC:';										
"Value[2] := '$' + FORMAT(vCESC,0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//Total Gravado...										
"DSTR1 := COPYSTR('#L############      #R##################',1);"										
Value[1] := 'Total Gravado:';										
"Value[2] := '$' + FORMAT(VentasG + TotalIva,0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
CLEAR(Percibido);										
//PERCEPCION...										
"DSTR1 := COPYSTR('#L################# #R##################',1);"										
Value[1] := '(+) IVA Percibido:';										
"//CSPNT270416    Value[2] := '$' + FORMAT((Percepcion-PercepcionDev),0,'<Integer Thousand><Decimals,3>');"										
"Value[2] := '$' + FORMAT((Percepcion),0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//VENTAS EXENTAS...										
"DSTR1 := COPYSTR('#L#############     #R##################',1);"										
Value[1] := 'Ventas Exentas:';										
"//CSPNT270416    Value[2] := '$' + FORMAT((VentasE-VentasEDev),0,'<Integer Thousand><Decimals,3>');"										
"Value[2] := '$' + FORMAT((VentasE),0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//VENTAS NO SUJETAS...										
"DSTR1 := COPYSTR('#L################  #R##################',1);"										
Value[1] := 'Ventas No Sujetas:';										
"//CSPNT270416    Value[2] := '$' + FORMAT((VentasNoSu-VentasNoSuDev),0,'<Integer Thousand><Decimals,3>');"										
"Value[2] := '$' + FORMAT((VentasNoSu),0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//VENTAS TOTALES										
"DSTR1 := COPYSTR('#L#############     #R##################',1);"										
Value[1] := 'Ventas Totales:';										
"//CSPNT090316    Value[2] := '$' + FORMAT((VentasG + TotalIva + VentasE + VentasNoSu)-(VentasEDev+VentasNoSuDev),0,'<Integer Thous"	and	><D	ec	ima	"ls,3>');"					
//CSPNT270416    Value[2] := '$' + FORMAT((VentasG + TotalIva + VentasE + VentasNoSu+(Percepcion-PercepcionDev))-(VentasEDev+Venta	sNo	SuD	ev	"),0"	",'<Integer Thousand><Decimals,3>');"					
"Value[2] := '$' + FORMAT((VentasG + TotalIva + VentasE + VentasNoSu + Percepcion),0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//CSPNT140116										
//CSPNT150116										
vVentasGravadasTotales := vVentasGravadasTotales + VentasG;										
//CSPNT010916										
vImpuestoIVATotales := vImpuestoIVATotales + TotalIva - vCESC;										
vCESCTotales := vCESCTotales + vCESC;										
vTotalGravadoTotales := vTotalGravadoTotales + (VentasG + TotalIva);										
vVentasExentasTotales := vVentasExentasTotales + (VentasE-VentasEDev);										
vVentasNoSujetasTotales := vVentasNoSujetasTotales + (VentasNoSu-VentasNoSuDev);										
//CSPNT090316										
vVentasTotalesTotales := vVentasTotalesTotales + ((VentasG + TotalIva + VentasE + VentasNoSu + (Percepcion-PercepcionDev))-(Ve	nta	sED	ev	#NAME?	ntasNoSuDev));					
//CSPNT270416										
vIVAPercibidoTotales := vIVAPercibidoTotales + (Percepcion);										
										
//LIMPIO LAS VARIABLES QUE MUESTRAN LOS TOTALES DE LAS VENTAS POR TIPO DE COMPROBANTES.										
CLEAR(Venta);										
CLEAR(Iva);										
CLEAR(vTotal);										
CLEAR(VentasG);										
CLEAR(TotalIva);										
CLEAR(TotalVentNcr);										
CLEAR(TotalIvaNcr);										
CLEAR(VentasE);										
CLEAR(VentasNoSu);										
CLEAR(VentasEDev);										
CLEAR(VentasNoSuDev);										
CLEAR(Retencion);										
//CSPNT090316										
CLEAR(Percepcion);										
//CSPNT010916										
CLEAR(vCESC);										
										
//Imprimir Linea en blanco...										
"DSTR1 :=     COPYSTR('                     ',1);"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//ENCABEZADO PARA EL TIPO DE COMPROBANTE										
"DSTR1 := COPYSTR('#C######################################',1);"										
Value[1] := '3- Nota de CrÇdito';										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//CSRM16102013 Se quito que imprimiera los rango de facturas porq no es un solo pos en la tienda										
//CSPNT271015 se agrego rango de facturas										
//CSPNT281015										
Transaction2.RESET;										
"Transaction2.SETCURRENTKEY(""Statement Code"",""Z-Report ID"",""Transaction Type"",""Entry Status"");"										
"Transaction2.SETRANGE(""Statement Code"",SCode);"										
"Transaction2.SETRANGE(""Z-Report ID"",'');"										
"Transaction2.SETRANGE(""Transaction Type"",Transaction2.""Transaction Type""::Sales);"										
//CSPNT270216										
"Transaction2.SETFILTER(""Entry Status"",'%1|%2|%3',Transaction2.""Entry Status""::"" "",Transaction2.""Entry Status""::Posted,Transact"	ion	"2."""	En	try	"Status""::Voided);"					
"Transaction2.SETRANGE(""No. Serie NCF"",Terminal.""No. Serie NCF Nota de Credito"");"										
IF Transaction2.FINDFIRST THEN BEGIN										
rNoSeries.RESET;										
"IF rNoSeries.GET(Terminal.""No. Serie NCF Nota de Credito"") THEN BEGIN"										
rNoSeriesLn.RESET;										
"rNoSeriesLn.SETRANGE(""Series Code"",rNoSeries.Code);"										
IF rNoSeriesLn.FINDFIRST THEN BEGIN										
"DSTR1 := COPYSTR('#L######################################',1);"										
Value[1] := 'Autorizacion: ' + UPPERCASE(rNoSeriesLn.Autorizacion);										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
"DSTR1 := COPYSTR('#L#################  #R#################',1);"										
"Value[1] := 'Del ' + rNoSeriesLn.""Starting No."";"										
"Value[2] := 'al  ' + rNoSeriesLn.""Ending No."";"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
END;										
//CSRM16102013 Se quito que imprimiera los rango de facturas porq no es un solo pos en la tienda										
//CSPNT241015 se agrego rango de facturas										
FirstFactCrfDev := Transaction2.NCF;										
//CSPNT290816										
vFirstFechaNocre := Transaction2.Date;										
//CSRM16102013 Se quito que imprimiera los rango de facturas porq no es un solo pos en la tienda										
										
REPEAT										
CLEAR(Venta);										
CLEAR(Iva);										
CLEAR(vTotal);										
//CSPNT090316        CLEAR(Percepcion);										
"rSalesEntry.SETRANGE(""Store No."",Transaction2.""Store No."");"										
"rSalesEntry.SETRANGE(""POS Terminal No."",Transaction2.""POS Terminal No."");"										
"rSalesEntry.SETRANGE(""Transaction No."",Transaction2.""Transaction No."");"										
IF rSalesEntry.FIND('-') THEN										
REPEAT										
IF rSalesEntry.NotaRemision <> '' THEN BEGIN										
rImpuestos.RESET;										
"rImpuestos.SETRANGE(""VAT Bus. Posting Group"",rSalesEntry.""VAT Bus. Posting Group"");"										
"rImpuestos.SETRANGE(""VAT Prod. Posting Group"",rSalesEntry.""VAT Prod. Posting Group"");"										
IF rImpuestos.FINDFIRST THEN BEGIN										
"Venta    += -(rSalesEntry.""Net Amount"");"										
"Iva      += -(rSalesEntry.""VAT Amount"");"										
"vTotal   += -(rSalesEntry.""Net Amount"") + -(rSalesEntry.""VAT Amount"");"										
										
IF rImpuestos.Impuesto=rImpuestos.Impuesto::Gravado THEN BEGIN										
"IF NOT Transaction2.""Sale Is Return Sale"" THEN BEGIN"										
"VentasG  += -(rSalesEntry.""Net Amount"");"										
"TotalIva += -(rSalesEntry.""VAT Amount"");"										
END ELSE BEGIN										
"TotalVentNcr += -(rSalesEntry.""Net Amount"");"										
"TotalIvaNcr  += -(rSalesEntry.""VAT Amount"");"										
END;										
END ELSE BEGIN										
IF rImpuestos.Impuesto=rImpuestos.Impuesto::Exento THEN BEGIN										
"IF NOT Transaction2.""Sale Is Return Sale"" THEN"										
"VentasE  += -(rSalesEntry.""Net Amount"")"										
ELSE										
"VentasEDev  += -(rSalesEntry.""Net Amount"");"										
END ELSE BEGIN										
"IF NOT Transaction2.""Sale Is Return Sale"" THEN"										
"VentasNoSu  += -(rSalesEntry.""Net Amount"")"										
ELSE										
"VentasNoSuDev  += -(rSalesEntry.""Net Amount"");"										
END;										
END;										
END;										
END ELSE BEGIN										
rImpuestos.RESET;										
"rImpuestos.SETRANGE(""VAT Bus. Posting Group"",rSalesEntry.""VAT Bus. Posting Group"");"										
"rImpuestos.SETRANGE(""VAT Prod. Posting Group"",rSalesEntry.""VAT Prod. Posting Group"");"										
IF rImpuestos.FINDFIRST THEN BEGIN										
"Venta    += ABS(rSalesEntry.""Net Amount"");"										
"Iva      += ABS(rSalesEntry.""VAT Amount"");"										
"vTotal   += ABS(rSalesEntry.""Net Amount"") + ABS(rSalesEntry.""VAT Amount"");"										
										
IF rImpuestos.Impuesto=rImpuestos.Impuesto::Gravado THEN BEGIN										
"IF NOT Transaction2.""Sale Is Return Sale"" THEN BEGIN"										
"VentasG  += ABS(rSalesEntry.""Net Amount"");"										
"TotalIva += ABS(rSalesEntry.""VAT Amount"");"										
END ELSE BEGIN										
"TotalVentNcr += ABS(rSalesEntry.""Net Amount"");"										
"TotalIvaNcr  += ABS(rSalesEntry.""VAT Amount"");"										
END;										
END ELSE BEGIN										
IF rImpuestos.Impuesto=rImpuestos.Impuesto::Exento THEN BEGIN										
"IF NOT Transaction2.""Sale Is Return Sale"" THEN"										
"VentasE  += ABS(rSalesEntry.""Net Amount"")"										
ELSE										
"VentasEDev  += ABS(rSalesEntry.""Net Amount"");"										
END ELSE BEGIN										
"IF NOT Transaction2.""Sale Is Return Sale"" THEN"										
"VentasNoSu  += ABS(rSalesEntry.""Net Amount"")"										
ELSE										
"VentasNoSuDev  += ABS(rSalesEntry.""Net Amount"");"										
END;										
END;										
END;										
END;										
UNTIL rSalesEntry.NEXT = 0;										
//CSRM16102013 Se quito que imprimiera los rango de facturas porq no es un solo pos en la tienda										
//CSPNT241015 se agrego rango de facturas										
LastFactCrfDev := Transaction2.NCF;										
//CSPNT290816										
vLastFechaNocre := Transaction2.Date;										
//CSRM16102013 Se quito que imprimiera los rango de facturas porq no es un solo pos en la tienda										
//CSPNT090316										
"IF NOT Transaction2.""Sale Is Return Sale"" THEN"										
"Percepcion  += ABS(Transaction2.""Percepcion Amount"")"										
ELSE										
"PercepcionDev  += -(Transaction2.""Percepcion Amount"");"										
UNTIL Transaction2.NEXT = 0;										
END;										
										
//CSRM16102013 Se quito que imprimiera los rango de facturas porq no es un solo pos en la tienda										
//CSPNT241015 se agrego rango de facturas										
//CSPNT271015										
//CSPNT290816										
//CSPNT070916										
IF (FirstFactCrfDev <> '') OR (LastFactCrfDev <> '') THEN BEGIN										
rNoSeriesLn.RESET;										
"rNoSeriesLn.SETRANGE(""Series Code"",rNoSeries.Code);"										
IF rNoSeriesLn.FINDFIRST THEN										
REPEAT										
"IF ((rNoSeriesLn.""Starting No."" <= FirstFactCrfDev) AND (rNoSeriesLn.""Ending No."" >= FirstFactCrfDev)) AND"										
"((rNoSeriesLn.""Starting Date"" <= vFirstFechaNocre) AND (rNoSeriesLn.""Last Date Used"" >= vFirstFechaNocre)) THEN"										
vFirstFactCredAut := UPPERCASE(rNoSeriesLn.Autorizacion);										
"IF ((rNoSeriesLn.""Starting No."" <= LastFactCrfDev) AND (rNoSeriesLn.""Ending No."" >= LastFactCrfDev)) AND"										
"((rNoSeriesLn.""Starting Date"" <= vLastFechaNocre) AND (rNoSeriesLn.""Last Date Used"" >= vLastFechaNocre)) THEN"										
vLastFactCredAut := UPPERCASE(rNoSeriesLn.Autorizacion);										
UNTIL rNoSeriesLn.NEXT = 0;										
"DSTR1 := COPYSTR('#L######################################',1);"										
Value[1] := 'Del No.: ' + vFirstFactCredAut + ' ' + FirstFactCrfDev;										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
"DSTR1 := COPYSTR('#L######################################',1);"										
Value[1] := 'Al No.: ' + vLastFactCredAut + ' ' + LastFactCrfDev;										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
										
//CSRM16102013 Se quito que imprimiera los rango de facturas porq no es un solo pos en la tienda										
										
//Imprimir Linea en blanco...										
"DSTR1 :=     COPYSTR('                     ',1);"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
//CSPNT150116										
{    //ENCABEZADO DE VENTAS TOTALES...										
"DSTR1 := COPYSTR('    #L#############',1);"										
Value[1] := 'VENTAS TOTALES:';										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
}										
VentasG := VentasG - TotalVentNcr;										
										
//VENTAS GRAVADAS...										
"DSTR1 := COPYSTR('#L##############    #R##################',1);"										
Value[1] := 'Ventas Gravadas:';										
"Value[2] := '$' + FORMAT(VentasG,0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
TotalIva := TotalIva - TotalIvaNcr;										
										
//IMPUESTO IVA...										
"DSTR1 := COPYSTR('#L###########       #R##################',1);"										
Value[1] := 'Impuesto IVA:';										
"Value[2] := '$' + FORMAT(TotalIva,0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//Total Gravado...										
"DSTR1 := COPYSTR('#L############      #R##################',1);"										
Value[1] := 'Total Gravado:';										
"Value[2] := '$' + FORMAT(VentasG + TotalIva,0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
CLEAR(Percibido);										
//PERCEPCION...										
"DSTR1 := COPYSTR('#L################# #R##################',1);"										
Value[1] := '(+) IVA Percibido:';										
"//CSPNT270416    Value[2] := '$' + FORMAT((Percepcion-PercepcionDev),0,'<Integer Thousand><Decimals,3>');"										
"Value[2] := '$' + FORMAT((-PercepcionDev),0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//VENTAS EXENTAS...										
"DSTR1 := COPYSTR('#L#############     #R##################',1);"										
Value[1] := 'Ventas Exentas:';										
"Value[2] := '$' + FORMAT((VentasE-VentasEDev),0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//VENTAS NO SUJETAS...										
"DSTR1 := COPYSTR('#L################  #R##################',1);"										
Value[1] := 'Ventas No Sujetas:';										
"Value[2] := '$' + FORMAT((VentasNoSu-VentasNoSuDev),0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//VENTAS TOTALES										
"DSTR1 := COPYSTR('#L#############     #R##################',1);"										
Value[1] := 'Ventas Totales:';										
"//CSPNT090316    Value[2] := '$' + FORMAT((VentasG + TotalIva + VentasE + VentasNoSu)-(VentasEDev+VentasNoSuDev),0,'<Integer Thous"	and	><D	ec	ima	"ls,3>');"					
//CSPNT270416										
"Value[2] := '$' + FORMAT((VentasG + TotalIva + VentasE + VentasNoSu + (PercepcionDev+Percepcion))-(VentasEDev+VentasNoSuDev),0"	",'<"	Int	eg	er	"Thousand><Decimals,3>');"					
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//CSPNT140116										
//CSPNT150116										
vVentasGravadasTotales := vVentasGravadasTotales + VentasG;										
vImpuestoIVATotales := vImpuestoIVATotales + TotalIva;										
vTotalGravadoTotales := vTotalGravadoTotales + (VentasG + TotalIva);										
vVentasExentasTotales := vVentasExentasTotales + (VentasE-VentasEDev);										
vVentasNoSujetasTotales := vVentasNoSujetasTotales + (VentasNoSu-VentasNoSuDev);										
//CSPNT090316										
//CSPNT270416										
vVentasTotalesTotales := vVentasTotalesTotales + ((VentasG + TotalIva + VentasE + VentasNoSu + (PercepcionDev+Percepcion))-(Ve	nta	sED	ev	#NAME?	ntasNoSuDev));					
//CSPNT270416										
vIVAPercibidoDevTotales := vIVAPercibidoDevTotales + (-PercepcionDev);										
										
//LIMPIO LAS VARIABLES QUE MUESTRAN LOS TOTALES DE LAS VENTAS POR TIPO DE COMPROBANTES.										
CLEAR(Venta);										
CLEAR(Iva);										
CLEAR(vTotal);										
CLEAR(VentasG);										
CLEAR(TotalIva);										
CLEAR(TotalVentNcr);										
CLEAR(TotalIvaNcr);										
CLEAR(VentasE);										
CLEAR(VentasNoSu);										
CLEAR(VentasEDev);										
CLEAR(VentasNoSuDev);										
CLEAR(Retencion);										
										
//Imprimir Linea en blanco...										
"DSTR1 :=     COPYSTR('                     ',1);"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//CSPNT251115 Solo aparece el valor total de documentos de devoluci¢n en detalle de factura de consumidor final										
//ENCABEZADO PARA EL TIPO DE COMPROBANTE										
"{    DSTR1 := COPYSTR('#C######################################',1);"										
Value[1] := '5- Documento de Devoluci¢n';										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
}										
//BUSCO PRIMERO LOS NCF PARA FACTURAS DE CONSUMIDORES FINALES										
Transaction2.RESET;										
"Transaction2.SETCURRENTKEY(""Statement Code"",""Z-Report ID"",""Transaction Type"",""Entry Status"");"										
"Transaction2.SETRANGE(""Statement Code"",SCode);"										
"Transaction2.SETRANGE(""Z-Report ID"",'');"										
"Transaction2.SETRANGE(""Transaction Type"",Transaction2.""Transaction Type""::Sales);"										
"Transaction2.SETFILTER(""Entry Status"",'%1|%2',Transaction2.""Entry Status""::"" "",Transaction2.""Entry Status""::Posted);"										
"Transaction2.SETRANGE(""No. Serie NCF"",Terminal.""No. Serie Documento Devolucion"");"										
IF Transaction2.FINDFIRST THEN BEGIN										
{      rNoSeries.RESET;										
"IF rNoSeries.GET(Terminal.""No. Serie Documento Devolucion"") THEN BEGIN"										
rNoSeriesLn.RESET;										
"rNoSeriesLn.SETRANGE(""Series Code"",rNoSeries.Code);"										
IF rNoSeriesLn.FINDFIRST THEN BEGIN										
"DSTR1 := COPYSTR('#L######################################',1);"										
Value[1] := 'Autorizacion: ' + UPPERCASE(rNoSeriesLn.Autorizacion);										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
"DSTR1 := COPYSTR('#L#################  #R#################',1);"										
"Value[1] := 'Del ' + rNoSeriesLn.""Starting No."";"										
"Value[2] := 'al  ' + rNoSeriesLn.""Ending No."";"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
END;										
}										
//CSRM16102013 Se quito que imprimiera los rango de facturas porq no es un solo pos en la tienda										
//CSPNT241015 se agrego rango de facturas										
FirstFactCfDev := Transaction2.NCF;										
REPEAT										
CLEAR(Venta);										
CLEAR(Iva);										
CLEAR(vTotal);										
"rSalesEntry.SETRANGE(""Store No."",Transaction2.""Store No."");"										
"rSalesEntry.SETRANGE(""POS Terminal No."",Transaction2.""POS Terminal No."");"										
"rSalesEntry.SETRANGE(""Transaction No."",Transaction2.""Transaction No."");"										
IF rSalesEntry.FIND('-') THEN										
REPEAT										
IF rSalesEntry.NotaRemision <> '' THEN BEGIN										
rImpuestos.RESET;										
"rImpuestos.SETRANGE(""VAT Bus. Posting Group"",rSalesEntry.""VAT Bus. Posting Group"");"										
"rImpuestos.SETRANGE(""VAT Prod. Posting Group"",rSalesEntry.""VAT Prod. Posting Group"");"										
IF rImpuestos.FINDFIRST THEN BEGIN										
"Venta    += -(rSalesEntry.""Net Amount"");"										
"Iva      += -(rSalesEntry.""VAT Amount"");"										
"vTotal   += -(rSalesEntry.""Net Amount"") + -(rSalesEntry.""VAT Amount"");"										
IF rImpuestos.Impuesto=rImpuestos.Impuesto::Gravado THEN BEGIN										
"IF NOT Transaction2.""Sale Is Return Sale"" THEN BEGIN"										
"VentasG  += -(rSalesEntry.""Net Amount"");"										
"TotalIva += -(rSalesEntry.""VAT Amount"");"										
END ELSE BEGIN										
"TotalVentNcr += -(rSalesEntry.""Net Amount"");"										
"TotalIvaNcr  += -(rSalesEntry.""VAT Amount"");"										
END;										
END ELSE BEGIN										
IF rImpuestos.Impuesto=rImpuestos.Impuesto::Exento THEN BEGIN										
"IF NOT Transaction2.""Sale Is Return Sale"" THEN"										
"VentasE  += -(rSalesEntry.""Net Amount"")"										
ELSE										
"VentasEDev  += -(rSalesEntry.""Net Amount"");"										
END ELSE BEGIN										
"IF NOT Transaction2.""Sale Is Return Sale"" THEN"										
"VentasNoSu  += -(rSalesEntry.""Net Amount"")"										
ELSE										
"VentasNoSuDev  += -(rSalesEntry.""Net Amount"");"										
END;										
END;										
END;										
END ELSE BEGIN										
rImpuestos.RESET;										
"rImpuestos.SETRANGE(""VAT Bus. Posting Group"",rSalesEntry.""VAT Bus. Posting Group"");"										
"rImpuestos.SETRANGE(""VAT Prod. Posting Group"",rSalesEntry.""VAT Prod. Posting Group"");"										
IF rImpuestos.FINDFIRST THEN BEGIN										
"Venta    += ABS(rSalesEntry.""Net Amount"");"										
"Iva      += ABS(rSalesEntry.""VAT Amount"");"										
"vTotal   += ABS(rSalesEntry.""Net Amount"") + ABS(rSalesEntry.""VAT Amount"");"										
IF rImpuestos.Impuesto=rImpuestos.Impuesto::Gravado THEN BEGIN										
"IF NOT Transaction2.""Sale Is Return Sale"" THEN BEGIN"										
"VentasG  += ABS(rSalesEntry.""Net Amount"");"										
"TotalIva += ABS(rSalesEntry.""VAT Amount"");"										
END ELSE BEGIN										
"TotalVentNcr += ABS(rSalesEntry.""Net Amount"");"										
"TotalIvaNcr  += ABS(rSalesEntry.""VAT Amount"");"										
END;										
END ELSE BEGIN										
IF rImpuestos.Impuesto=rImpuestos.Impuesto::Exento THEN BEGIN										
"IF NOT Transaction2.""Sale Is Return Sale"" THEN"										
"VentasE  += ABS(rSalesEntry.""Net Amount"")"										
ELSE										
"VentasEDev  += ABS(rSalesEntry.""Net Amount"");"										
END ELSE BEGIN										
"IF NOT Transaction2.""Sale Is Return Sale"" THEN"										
"VentasNoSu  += ABS(rSalesEntry.""Net Amount"")"										
ELSE										
"VentasNoSuDev  += ABS(rSalesEntry.""Net Amount"");"										
END;										
END;										
END;										
END;										
UNTIL rSalesEntry.NEXT = 0;										
										
//CSRM16102013 Se quito que imprimiera los rango de facturas porq no es un solo pos en la tienda										
//CSPNT241015 se agrego rango de facturas										
LastFactCfDev := Transaction2.NCF;										
										
//CSPNT210416										
"IF NOT Transaction2.""Sale Is Return Sale"" THEN"										
"Retencion  += ABS(Transaction2.""Retencion Amount"")"										
ELSE										
"RetencionDev  += -(Transaction2.""Retencion Amount"");"										
										
UNTIL Transaction2.NEXT = 0;										
END;										
										
//CSRM16102013 Se quito que imprimiera los rango de facturas porq no es un solo pos en la tienda										
//CSPNT241015 se agrego rango de facturas										
//CSPNT271015										
{    IF (FirstFactCfDev <> '') AND (LastFactCfDev <> '') THEN BEGIN										
//Del No.										
"DSTR1 := COPYSTR('#L#################################',1);"										
Value[1] := 'Del No.: ' + FirstFactCfDev;										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
//Al No.										
"DSTR1 := COPYSTR('#L#################################',1);"										
Value[1] := 'Al No.: ' + LastFactCfDev;										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
										
//CSRM16102013 Se quito que imprimiera los rango de facturas porq no es un solo pos en la tienda										
//Imprimir Linea en blanco...										
"DSTR1 :=     COPYSTR('                     ',1);"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//ENCABEZADO DE VENTAS TOTALES...										
"DSTR1 := COPYSTR('    #L#############',1);"										
Value[1] := 'VENTAS TOTALES:';										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
}										
VentasG := VentasG - TotalVentNcr;										
{										
//VENTAS GRAVADAS...										
"DSTR1 := COPYSTR('#L##############    #R##################',1);"										
Value[1] := 'Ventas Gravadas:';										
"Value[2] := '$' + FORMAT(VentasG,0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
}										
TotalIva := TotalIva - TotalIvaNcr;										
{										
//IMPUESTO IVA...										
"DSTR1 := COPYSTR('#L###########       #R##################',1);"										
Value[1] := 'Impuesto IVA:';										
"Value[2] := '$' + FORMAT(TotalIva,0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//Total Gravado...										
"DSTR1 := COPYSTR('#L############      #R##################',1);"										
Value[1] := 'Total Gravado:';										
"Value[2] := '$' + FORMAT(VentasG + TotalIva,0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//PERCEPCION...										
"DSTR1 := COPYSTR('#L################# #R##################',1);"										
Value[1] := '(-) IVA Retenido:';										
"Value[2] := '$' + FORMAT((Retencion-RetencionDev),0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//VENTAS EXENTAS...										
"DSTR1 := COPYSTR('#L#############     #R##################',1);"										
Value[1] := 'Ventas Exentas:';										
"Value[2] := '$' + FORMAT((VentasE-VentasEDev),0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//VENTAS NO SUJETAS...										
"DSTR1 := COPYSTR('#L################  #R##################',1);"										
Value[1] := 'Ventas No Sujetas:';										
"Value[2] := '$' + FORMAT((VentasNoSu-VentasNoSuDev),0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//VENTAS TOTALES										
"DSTR1 := COPYSTR('#L#############     #R##################',1);"										
Value[1] := 'Ventas Totales:';										
"Value[2] := '$' + FORMAT((VentasG + TotalIva + VentasE + VentasNoSu)-(VentasEDev+VentasNoSuDev),0,'<Integer Thousand><Decimals"	",3>"	');								
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
}										
//CSPNT251115 TOTAL documentos devolucion										
//CSPNT090316    vTotalDocDevolucion := (VentasG + TotalIva + VentasE + VentasNoSu)-(VentasEDev+VentasNoSuDev);										
vTotalDocDevolucion := (VentasG + VentasE + VentasNoSu)-(VentasEDev+VentasNoSuDev);										
vTotalIvaDocDevolucion := TotalIva;										
										
//CSPNT210416										
vTotalRetencionDev := RetencionDev;										
//CSPNT270416										
VentasEDevDocDev := VentasEDev;										
vVentasExentasTotales := vVentasExentasTotales + (VentasE-VentasEDev);										
										
//CSRM16102013										
//LIMPIO LAS VARIABLES QUE MUESTRAN LOS TOTALES DE LAS VENTAS POR TIPO DE COMPROBANTES.										
CLEAR(Venta);										
CLEAR(Iva);										
CLEAR(vTotal);										
CLEAR(VentasG);										
CLEAR(TotalIva);										
CLEAR(TotalVentNcr);										
CLEAR(TotalIvaNcr);										
CLEAR(VentasE);										
CLEAR(VentasNoSu);										
CLEAR(VentasEDev);										
CLEAR(VentasNoSuDev);										
										
{    //Imprimir Linea en blanco...										
"DSTR1 :=     COPYSTR('                     ',1);"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
}										
//ENCABEZADO PARA EL TIPO DE COMPROBANTE										
"DSTR1 := COPYSTR('#C######################################',1);"										
Value[1] := '4- Factura De Consumidor Final';										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//BUSCO PRIMERO LOS NCF PARA FACTURAS DE CONSUMIDORES FINALES										
Transaction2.RESET;										
"Transaction2.SETCURRENTKEY(""Statement Code"",""Z-Report ID"",""Transaction Type"",""Entry Status"");"										
"Transaction2.SETRANGE(""Statement Code"",SCode);"										
"Transaction2.SETRANGE(""Z-Report ID"",'');"										
"Transaction2.SETRANGE(""Transaction Type"",Transaction2.""Transaction Type""::Sales);"										
//CSPNT270216										
"Transaction2.SETFILTER(""Entry Status"",'%1|%2|%3',Transaction2.""Entry Status""::"" "",Transaction2.""Entry Status""::Posted,Transact"	ion	"2."""	En	try	"Status""::Voided);"					
"Transaction2.SETRANGE(""No. Serie NCF"",Terminal.""No. Serie NCF Cons. Final"");"										
IF Transaction2.FINDFIRST THEN BEGIN										
rNoSeries.RESET;										
"IF rNoSeries.GET(Terminal.""No. Serie NCF Cons. Final"") THEN BEGIN"										
rNoSeriesLn.RESET;										
"rNoSeriesLn.SETRANGE(""Series Code"",rNoSeries.Code);"										
IF rNoSeriesLn.FINDFIRST THEN BEGIN										
"DSTR1 := COPYSTR('#L######################################',1);"										
Value[1] := 'Autorizacion: ' + UPPERCASE(rNoSeriesLn.Autorizacion);										
"//CSPNT070416          PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
"DSTR1 := COPYSTR('#L#################  #R#################',1);"										
"Value[1] := 'Del ' + rNoSeriesLn.""Starting No."";"										
"Value[2] := 'al  ' + rNoSeriesLn.""Ending No."";"										
"//CSPNT070416          PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
END;										
										
//CSRM16102013 Se quito que imprimiera los rango de facturas porq no es un solo pos en la tienda										
//CSPNT241015 se agrego rango de facturas										
"FirstFactCf := Transaction2.""Correlativo Facturas"";"										
//CSPNT290816										
vFirstFechaFac := Transaction2.Date;										
REPEAT										
CLEAR(Venta);										
CLEAR(Iva);										
CLEAR(vTotal);										
"rSalesEntry.SETRANGE(""Store No."",Transaction2.""Store No."");"										
"rSalesEntry.SETRANGE(""POS Terminal No."",Transaction2.""POS Terminal No."");"										
"rSalesEntry.SETRANGE(""Transaction No."",Transaction2.""Transaction No."");"										
IF rSalesEntry.FIND('-') THEN										
REPEAT										
IF rSalesEntry.NotaRemision <> '' THEN BEGIN										
rImpuestos.RESET;										
"rImpuestos.SETRANGE(""VAT Bus. Posting Group"",rSalesEntry.""VAT Bus. Posting Group"");"										
"rImpuestos.SETRANGE(""VAT Prod. Posting Group"",rSalesEntry.""VAT Prod. Posting Group"");"										
IF rImpuestos.FINDFIRST THEN BEGIN										
"Venta    += -(rSalesEntry.""Net Amount"");"										
"Iva      += -(rSalesEntry.""VAT Amount"");"										
"vTotal   += -(rSalesEntry.""Net Amount"") + -(rSalesEntry.""VAT Amount"");"										
										
IF rImpuestos.Impuesto=rImpuestos.Impuesto::Gravado THEN BEGIN										
"IF NOT Transaction2.""Sale Is Return Sale"" THEN BEGIN"										
"VentasG  += -(rSalesEntry.""Net Amount"");"										
"TotalIva += -(rSalesEntry.""VAT Amount"");"										
END ELSE BEGIN										
"TotalVentNcr += -(rSalesEntry.""Net Amount"");"										
"TotalIvaNcr  += -(rSalesEntry.""VAT Amount"");"										
END;										
END ELSE BEGIN										
IF rImpuestos.Impuesto=rImpuestos.Impuesto::Exento THEN BEGIN										
"IF NOT Transaction2.""Sale Is Return Sale"" THEN"										
"VentasE  += -(rSalesEntry.""Net Amount"")"										
ELSE										
"VentasEDev  += -(rSalesEntry.""Net Amount"");"										
END ELSE BEGIN										
"IF NOT Transaction2.""Sale Is Return Sale"" THEN"										
"VentasNoSu  += -(rSalesEntry.""Net Amount"")"										
ELSE										
"VentasNoSuDev  += -(rSalesEntry.""Net Amount"");"										
END;										
END;										
END;										
END ELSE BEGIN										
rImpuestos.RESET;										
"rImpuestos.SETRANGE(""VAT Bus. Posting Group"",rSalesEntry.""VAT Bus. Posting Group"");"										
"rImpuestos.SETRANGE(""VAT Prod. Posting Group"",rSalesEntry.""VAT Prod. Posting Group"");"										
IF rImpuestos.FINDFIRST THEN BEGIN										
"Venta    += ABS(rSalesEntry.""Net Amount"");"										
"Iva      += ABS(rSalesEntry.""VAT Amount"");"										
"vTotal   += ABS(rSalesEntry.""Net Amount"") + ABS(rSalesEntry.""VAT Amount"");"										
										
IF rImpuestos.Impuesto=rImpuestos.Impuesto::Gravado THEN BEGIN										
"IF NOT Transaction2.""Sale Is Return Sale"" THEN BEGIN"										
"VentasG  += ABS(rSalesEntry.""Net Amount"");"										
"TotalIva += ABS(rSalesEntry.""VAT Amount"");"										
END ELSE BEGIN										
"TotalVentNcr += ABS(rSalesEntry.""Net Amount"");"										
"TotalIvaNcr  += ABS(rSalesEntry.""VAT Amount"");"										
END;										
END ELSE BEGIN										
IF rImpuestos.Impuesto=rImpuestos.Impuesto::Exento THEN BEGIN										
"IF NOT Transaction2.""Sale Is Return Sale"" THEN"										
"VentasE  += ABS(rSalesEntry.""Net Amount"")"										
ELSE										
"VentasEDev  += ABS(rSalesEntry.""Net Amount"");"										
END ELSE BEGIN										
"IF NOT Transaction2.""Sale Is Return Sale"" THEN"										
"VentasNoSu  += ABS(rSalesEntry.""Net Amount"")"										
ELSE										
"VentasNoSuDev  += ABS(rSalesEntry.""Net Amount"");"										
END;										
END;										
END;										
END;										
UNTIL rSalesEntry.NEXT = 0;										
										
//CSRM16102013 Se quito que imprimiera los rango de facturas porq no es un solo pos en la tienda										
//CSPNT241015 se agrego rango de facturas										
"LastFactCf := Transaction2.""Correlativo Facturas"";"										
//CSPNT290816										
vLastFechaFac := Transaction2.Date;										
//CSPNT090316										
"IF NOT Transaction2.""Sale Is Return Sale"" THEN"										
"Retencion  += ABS(Transaction2.""Retencion Amount"")"										
ELSE										
"RetencionDev  += -(Transaction2.""Retencion Amount"");"										
										
//CSPNT010916										
rRecargasElectronicas.RESET;										
"rRecargasElectronicas.SETRANGE(""Store No."", Transaction2.""Store No."");"										
"rRecargasElectronicas.SETRANGE(""POS Terminal No."", Transaction2.""POS Terminal No."");"										
"rRecargasElectronicas.SETRANGE(""Receipt No."", Transaction2.""Receipt No."");"										
IF rRecargasElectronicas.FINDFIRST THEN										
vCESC := vCESC + rRecargasElectronicas.CESC;										
										
UNTIL Transaction2.NEXT = 0;										
END;										
										
//CSRM16102013 Se quito que imprimiera los rango de facturas porq no es un solo pos en la tienda										
//CSPNT241015 se agrego rango de facturas										
//CSPNT271015										
//CSPNT070916										
IF (FirstFactCf <> '') OR (LastFactCf <> '') THEN BEGIN										
//CSPNT070416										
rNoSeriesLn.RESET;										
"rNoSeriesLn.SETRANGE(""Series Code"",rNoSeries.Code);"										
IF rNoSeriesLn.FINDFIRST THEN										
REPEAT										
//CSPNT290816										
"IF ((rNoSeriesLn.""Starting No."" <= FirstFactCf) AND (rNoSeriesLn.""Ending No."" >= FirstFactCf)) AND"										
"((rNoSeriesLn.""Starting Date"" <= vFirstFechaFac) AND (rNoSeriesLn.""Last Date Used"" >= vFirstFechaFac)) THEN"										
vFirstFactCFAut := UPPERCASE(rNoSeriesLn.Autorizacion);										
"IF ((rNoSeriesLn.""Starting No."" <= LastFactCf) AND (rNoSeriesLn.""Ending No."" >= LastFactCf)) AND"										
"((rNoSeriesLn.""Starting Date"" <= vLastFechaFac) AND (rNoSeriesLn.""Last Date Used"" >= vLastFechaFac)) THEN"										
vLastFactCFAut := UPPERCASE(rNoSeriesLn.Autorizacion);										
UNTIL rNoSeriesLn.NEXT = 0;										
										
//CSPNT290816										
"DSTR1 := COPYSTR('#L######################################',1);"										
//CSPNT070416										
Value[1] := 'Del No.: ' + vFirstFactCFAut + ' ' + FirstFactCf;										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
//CSPNT290816										
"DSTR1 := COPYSTR('#L######################################',1);"										
//CSPNT070416										
Value[1] := 'Al No.: ' + vLastFactCFAut + ' ' + LastFactCf;										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
										
//CSRM16102013 Se quito que imprimiera los rango de facturas porq no es un solo pos en la tienda										
//Imprimir Linea en blanco...										
"DSTR1 :=     COPYSTR('                     ',1);"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
//CSPNT150116										
{    //ENCABEZADO DE VENTAS TOTALES...										
"DSTR1 := COPYSTR('    #L#############',1);"										
Value[1] := 'VENTAS TOTALES:';										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
}										
//CSPNT090316    VentasG := VentasG - TotalVentNcr;										
//CSPNT270416										
VentasG := VentasG - TotalVentNcr + vTotalDocDevolucion + VentasEDevDocDev;										
										
//VENTAS GRAVADAS...										
"DSTR1 := COPYSTR('#L##############    #R##################',1);"										
Value[1] := 'Ventas Gravadas:';										
"Value[2] := '$' + FORMAT(VentasG,0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//CSPNT090316    TotalIva := TotalIva - TotalIvaNcr;										
TotalIva := TotalIva - TotalIvaNcr + vTotalIvaDocDevolucion;										
//IMPUESTO IVA...										
"DSTR1 := COPYSTR('#L###########       #R##################',1);"										
Value[1] := 'Impuesto IVA:';										
//CSPNT010916										
"Value[2] := '$' + FORMAT(TotalIva - vCESC,0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//CSPNT010916 IMPUESTO CESC...										
"DSTR1 := COPYSTR('#L############           #R#############',1);"										
Value[1] := 'Impuesto CESC:';										
"Value[2] := '$' + FORMAT(vCESC,0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//Total Gravado...										
"DSTR1 := COPYSTR('#L############      #R##################',1);"										
Value[1] := 'Total Gravado:';										
"Value[2] := '$' + FORMAT(VentasG + TotalIva,0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//PERCEPCION...										
"DSTR1 := COPYSTR('#L################# #R##################',1);"										
Value[1] := '(-) IVA Retenido:';										
"//CSPNT210416    Value[2] := '$' + FORMAT((Retencion-RetencionDev),0,'<Integer Thousand><Decimals,3>');"										
"Value[2] := '$' + FORMAT((Retencion-vTotalRetencionDev),0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//VENTAS EXENTAS...										
"DSTR1 := COPYSTR('#L#############     #R##################',1);"										
Value[1] := 'Ventas Exentas:';										
//CSPNT270416										
"Value[2] := '$' + FORMAT((VentasE-VentasEDev-VentasEDevDocDev),0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//VENTAS NO SUJETAS...										
"DSTR1 := COPYSTR('#L################  #R##################',1);"										
Value[1] := 'Ventas No Sujetas:';										
"Value[2] := '$' + FORMAT((VentasNoSu-VentasNoSuDev),0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//CSPNT251115 TOTAL DOCUMENTO DEVOLUCION										
"//CSPNT090316    DSTR1 := COPYSTR('#L################  #R##################',1);"										
{    Value[1] := 'Devoluciones:';										
"Value[2] := '$' + FORMAT(vTotalDocDevolucion,0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
}										
//VENTAS TOTALES										
"DSTR1 := COPYSTR('#L#############     #R##################',1);"										
Value[1] := 'Ventas Totales:';										
//CSPNT251115										
//CSPNT090316    Value[2] := '$' + FORMAT((VentasG + TotalIva + VentasE + VentasNoSu)-(VentasEDev+VentasNoSuDev-vTotalDocDevolucio	"n),"	"0,'"	<I	nte	"ger Thousand><Decimals,3>');"					
//CSPNT270416										
Value[2] := '$' + FORMAT((VentasG + TotalIva + VentasE + VentasNoSu)-(VentasEDev+VentasNoSuDev+(Retencion-RetencionDev)+Ventas	EDe	vDo	cD	ev)	",0,'<Integer Thousand><Decimals,3>');"					
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//CSPNT140116										
//CSPNT150116										
vVentasGravadasTotales := vVentasGravadasTotales + VentasG;										
//CSPNT010916										
vImpuestoIVATotales := vImpuestoIVATotales + TotalIva - vCESC;										
vCESCTotales := vCESCTotales + vCESC;										
vTotalGravadoTotales := vTotalGravadoTotales + (VentasG + TotalIva);										
vVentasExentasTotales := vVentasExentasTotales + (VentasE-VentasEDev);										
vVentasNoSujetasTotales := vVentasNoSujetasTotales + (VentasNoSu-VentasNoSuDev);										
//CSPNT090316										
vVentasTotalesTotales := vVentasTotalesTotales + ((VentasG + TotalIva + VentasE + VentasNoSu)-(VentasEDev+VentasNoSuDev+(Reten	cio	n-R	et	enc	ionDev)+VentasEDevDocDev));					
vIVARetenidoTotales := vIVARetenidoTotales + (Retencion-RetencionDev);										
										
//CSRM16102013										
//LIMPIO LAS VARIABLES QUE MUESTRAN LOS TOTALES DE LAS VENTAS POR TIPO DE COMPROBANTES.										
CLEAR(Venta);										
CLEAR(Iva);										
CLEAR(vTotal);										
CLEAR(VentasG);										
CLEAR(TotalIva);										
CLEAR(TotalVentNcr);										
CLEAR(TotalIvaNcr);										
CLEAR(VentasE);										
CLEAR(VentasNoSu);										
CLEAR(VentasEDev);										
CLEAR(VentasNoSuDev);										
//CSPNT251115										
CLEAR(vTotalDocDevolucion);										
										
//Imprimir Linea en blanco...										
"DSTR1 :=     COPYSTR('                     ',1);"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//CSPNT140116										
"DSTR1 := COPYSTR('#C######################################',1);"										
Value[1] := 'VENTAS TOTALES';										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//Imprimir Linea en blanco...										
"DSTR1 :=     COPYSTR('                     ',1);"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//CSPNT150116										
//VENTAS GRAVADAS TOTALES										
"DSTR1 := COPYSTR('#L###################### #R#############',1);"										
Value[1] := 'Ventas Gravadas:';										
"Value[2] := '$' + FORMAT(vVentasGravadasTotales,0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//IMPUESTO IVA TOTALES										
"DSTR1 := COPYSTR('#L###################### #R#############',1);"										
Value[1] := 'Impuesto IVA:';										
"Value[2] := '$' + FORMAT(vImpuestoIVATotales,0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//CSPNT010916IMPUESTO CESC TOTALES										
"DSTR1 := COPYSTR('#L###################### #R#############',1);"										
Value[1] := 'Impuesto CESC:';										
"Value[2] := '$' + FORMAT(vCESCTotales,0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//TOTAL GRAVADO TOTALES										
"DSTR1 := COPYSTR('#L###################### #R#############',1);"										
Value[1] := 'Total Gravado:';										
"Value[2] := '$' + FORMAT(vTotalGravadoTotales,0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//VENTAS EXENTAS TOTALES										
"DSTR1 := COPYSTR('#L###################### #R#############',1);"										
Value[1] := 'Ventas Exentas:';										
"Value[2] := '$' + FORMAT(vVentasExentasTotales,0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//VENTAS NO SUJETAS TOTALES										
"DSTR1 := COPYSTR('#L###################### #R#############',1);"										
Value[1] := 'Ventas No Sujetas:';										
"Value[2] := '$' + FORMAT(vVentasNoSujetasTotales,0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//IVA PERCIBIDO TOTALES										
"DSTR1 := COPYSTR('#L###################### #R#############',1);"										
Value[1] := '(+) IVA Percebido:';										
//CSPNT270416										
"Value[2] := '$' + FORMAT(vIVAPercibidoTotales-vIVAPercibidoDevTotales,0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//IVA RETENIDO TOTALES										
"DSTR1 := COPYSTR('#L###################### #R#############',1);"										
Value[1] := '(-) IVA Retenido:';										
"Value[2] := '$' + FORMAT(vIVARetenidoTotales,0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//VENTAS TOTALES TOTALES										
"DSTR1 := COPYSTR('#L###################### #R#############',1);"										
Value[1] := 'Ventas Totales:';										
"Value[2] := '$' + FORMAT(vVentasTotalesTotales,0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//Imprimir Linea en blanco...										
"DSTR1 :=     COPYSTR('                     ',1);"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//CSPNT130116 TOTAL DEVOLUCIONES										
										
//ENCABEZADO PARA EL TIPO DE COMPROBANTE										
"DSTR1 := COPYSTR('#C######################################',1);"										
Value[1] := 'DEVOLUCIONES';										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//CSPNT281015										
Transaction2.RESET;										
"Transaction2.SETCURRENTKEY(""Statement Code"",""Z-Report ID"",""Transaction Type"",""Entry Status"");"										
"Transaction2.SETRANGE(""Statement Code"",SCode);"										
"Transaction2.SETRANGE(""Z-Report ID"",'');"										
"Transaction2.SETRANGE(""Transaction Type"",Transaction2.""Transaction Type""::Sales);"										
"Transaction2.SETFILTER(""Entry Status"",'%1|%2',Transaction2.""Entry Status""::"" "",Transaction2.""Entry Status""::Posted);"										
"Transaction2.SETRANGE(""Sale Is Return Sale"", TRUE);"										
vNoDevoluciones := 0;										
IF Transaction2.FINDFIRST THEN BEGIN										
REPEAT										
vNoDevoluciones := (vNoDevoluciones + 1);										
CLEAR(Venta);										
CLEAR(Iva);										
CLEAR(vTotal);										
"rSalesEntry.SETRANGE(""Store No."",Transaction2.""Store No."");"										
"rSalesEntry.SETRANGE(""POS Terminal No."",Transaction2.""POS Terminal No."");"										
"rSalesEntry.SETRANGE(""Transaction No."",Transaction2.""Transaction No."");"										
IF rSalesEntry.FIND('-') THEN										
REPEAT										
IF rSalesEntry.NotaRemision <> '' THEN BEGIN										
rImpuestos.RESET;										
"rImpuestos.SETRANGE(""VAT Bus. Posting Group"",rSalesEntry.""VAT Bus. Posting Group"");"										
"rImpuestos.SETRANGE(""VAT Prod. Posting Group"",rSalesEntry.""VAT Prod. Posting Group"");"										
IF rImpuestos.FINDFIRST THEN BEGIN										
"Venta    += -(rSalesEntry.""Net Amount"");"										
"Iva      += -(rSalesEntry.""VAT Amount"");"										
"vTotal   += -(rSalesEntry.""Net Amount"") + -(rSalesEntry.""VAT Amount"");"										
										
IF rImpuestos.Impuesto=rImpuestos.Impuesto::Gravado THEN BEGIN										
"IF NOT Transaction2.""Sale Is Return Sale"" THEN BEGIN"										
"VentasG  += -(rSalesEntry.""Net Amount"");"										
"TotalIva += -(rSalesEntry.""VAT Amount"");"										
END ELSE BEGIN										
"TotalVentNcr += -(rSalesEntry.""Net Amount"");"										
"TotalIvaNcr  += -(rSalesEntry.""VAT Amount"");"										
END;										
END ELSE BEGIN										
IF rImpuestos.Impuesto=rImpuestos.Impuesto::Exento THEN BEGIN										
"IF NOT Transaction2.""Sale Is Return Sale"" THEN"										
"VentasE  += -(rSalesEntry.""Net Amount"")"										
ELSE										
"VentasEDev  += -(rSalesEntry.""Net Amount"");"										
END ELSE BEGIN										
"IF NOT Transaction2.""Sale Is Return Sale"" THEN"										
"VentasNoSu  += -(rSalesEntry.""Net Amount"")"										
ELSE										
"VentasNoSuDev  += -(rSalesEntry.""Net Amount"");"										
END;										
END;										
END;										
END ELSE BEGIN										
rImpuestos.RESET;										
"rImpuestos.SETRANGE(""VAT Bus. Posting Group"",rSalesEntry.""VAT Bus. Posting Group"");"										
"rImpuestos.SETRANGE(""VAT Prod. Posting Group"",rSalesEntry.""VAT Prod. Posting Group"");"										
IF rImpuestos.FINDFIRST THEN BEGIN										
"Venta    += ABS(rSalesEntry.""Net Amount"");"										
"Iva      += ABS(rSalesEntry.""VAT Amount"");"										
"vTotal   += ABS(rSalesEntry.""Net Amount"") + ABS(rSalesEntry.""VAT Amount"");"										
										
IF rImpuestos.Impuesto=rImpuestos.Impuesto::Gravado THEN BEGIN										
"IF NOT Transaction2.""Sale Is Return Sale"" THEN BEGIN"										
"VentasG  += ABS(rSalesEntry.""Net Amount"");"										
"TotalIva += ABS(rSalesEntry.""VAT Amount"");"										
END ELSE BEGIN										
"TotalVentNcr += ABS(rSalesEntry.""Net Amount"");"										
"TotalIvaNcr  += ABS(rSalesEntry.""VAT Amount"");"										
END;										
END ELSE BEGIN										
IF rImpuestos.Impuesto=rImpuestos.Impuesto::Exento THEN BEGIN										
"IF NOT Transaction2.""Sale Is Return Sale"" THEN"										
"VentasE  += ABS(rSalesEntry.""Net Amount"")"										
ELSE										
"VentasEDev  += ABS(rSalesEntry.""Net Amount"");"										
END ELSE BEGIN										
"IF NOT Transaction2.""Sale Is Return Sale"" THEN"										
"VentasNoSu  += ABS(rSalesEntry.""Net Amount"")"										
ELSE										
"VentasNoSuDev  += ABS(rSalesEntry.""Net Amount"");"										
END;										
END;										
END;										
END;										
UNTIL rSalesEntry.NEXT = 0;										
UNTIL Transaction2.NEXT = 0;										
END;										
										
//DEVOLUCIONES...										
"DSTR1 := COPYSTR('#L#################### #L#############',1);"										
Value[1] := 'Cantidad devoluciones:';										
Value[2] := FORMAT(vNoDevoluciones);										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//Imprimir Linea en blanco...										
"DSTR1 :=     COPYSTR('                     ',1);"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
VentasG := VentasG - TotalVentNcr;										
TotalIva := TotalIva - TotalIvaNcr;										
										
//VENTAS TOTALES										
"DSTR1 := COPYSTR('#L################### #R################',1);"										
Value[1] := 'Devoluciones Totales:';										
"//CSPNT270416    Value[2] := '$' + FORMAT((VentasG + TotalIva + VentasE + VentasNoSu)-(VentasEDev+VentasNoSuDev),0,'<Integer Thous"	and	><D	ec	ima	"ls,3>');"					
Value[2] := '$' + FORMAT((VentasG + TotalIva + VentasE + VentasNoSu)-(VentasEDev+VentasNoSuDev)+vTotalRetencionDev-vIVAPercibi	doD	evT	ot	ale	"s,0,'<Integer Thousand><Decimals,3>');"					
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//LIMPIO LAS VARIABLES QUE MUESTRAN LOS TOTALES DE LAS VENTAS POR TIPO DE COMPROBANTES.										
CLEAR(FirstTicket);										
CLEAR(LastTicket);										
CLEAR(Venta);										
CLEAR(Iva);										
CLEAR(vTotal);										
CLEAR(VentasG);										
CLEAR(TotalIva);										
CLEAR(TotalVentNcr);										
CLEAR(TotalIvaNcr);										
CLEAR(VentasE);										
CLEAR(VentasNoSu);										
CLEAR(VentasEDev);										
CLEAR(VentasNoSuDev);										
										
//Imprimir Linea en blanco...										
"DSTR1 :=     COPYSTR('                     ',1);"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
// -										
										
END;										
RunType::Z: BEGIN										
										
//CSPNT140116										
//CSPNT150116										
vVentasGravadasTotales := 0;										
vImpuestoIVATotales := 0;										
vTotalGravadoTotales := 0;										
vVentasExentasTotales := 0;										
vVentasNoSujetasTotales := 0;										
vVentasTotalesTotales := 0;										
vIVAPercibidoTotales := 0;										
vIVAPercibidoDevTotales := 0;										
vIVARetenidoTotales := 0;										
//CSPNT010916										
vCESCTotales := 0;										
										
//ENCABEZADO PARA EL TIPO DE COMPROBANTE										
"DSTR1 := COPYSTR('#C######################################',1);"										
//CSPNT060216										
Value[1] := '1- Ticket';										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
Transaction2.RESET;										
"Transaction2.SETCURRENTKEY(""Statement Code"",""Z-Report ID"",""Transaction Type"",""Entry Status"");"										
"Transaction2.SETRANGE(""Statement Code"",SCode);"										
"Transaction2.SETRANGE(""Z-Report ID"",'');"										
"Transaction2.SETRANGE(""Transaction Type"",Transaction2.""Transaction Type""::Sales);"										
//CSPNT270216										
"Transaction2.SETFILTER(""Entry Status"",'%1|%2|%3',Transaction2.""Entry Status""::"" "",Transaction2.""Entry Status""::Posted,Transact"	ion	"2."""	En	try	"Status""::Voided);"					
"Transaction2.SETRANGE(""No. Serie NCF"",Terminal.""No. Serie NCF Ticket"");"										
IF Transaction2.FINDFIRST THEN BEGIN										
rNoSeries.RESET;										
"IF rNoSeries.GET(Transaction2.""No. Serie NCF"") THEN BEGIN"										
rNoSeriesLn.RESET;										
"rNoSeriesLn.SETRANGE(""Series Code"",rNoSeries.Code);"										
IF rNoSeriesLn.FINDFIRST THEN BEGIN										
"DSTR1 := COPYSTR('#L######################################',1);"										
Value[1] := 'Autorizacion:' + ' ' + UPPERCASE(rNoSeriesLn.Autorizacion);										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//CONSISA-Imprimir el rango de ticket..										
//CSPNT090316										
"DSTR1 := COPYSTR('#L######################################',1);"										
"Value[1] := 'Del ' + rNoSeriesLn.""Starting No."";"										
//CSPNT090316										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
"DSTR1 := COPYSTR('#L######################################',1);"										
//CSPNT090316										
"Value[1] := 'al  ' + rNoSeriesLn.""Ending No."";"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
END;										
										
FirstTicket := Transaction2.NCF;										
										
REPEAT										
"rSalesEntry.SETRANGE(""Store No."",Transaction2.""Store No."");"										
"rSalesEntry.SETRANGE(""POS Terminal No."",Transaction2.""POS Terminal No."");"										
"rSalesEntry.SETRANGE(""Transaction No."",Transaction2.""Transaction No."");"										
IF rSalesEntry.FIND('-') THEN										
REPEAT										
IF rSalesEntry.NotaRemision <> '' THEN BEGIN										
rImpuestos.RESET;										
"rImpuestos.SETRANGE(""VAT Bus. Posting Group"",rSalesEntry.""VAT Bus. Posting Group"");"										
"rImpuestos.SETRANGE(""VAT Prod. Posting Group"",rSalesEntry.""VAT Prod. Posting Group"");"										
IF rImpuestos.FINDFIRST THEN BEGIN										
"Venta    += (rSalesEntry.""Net Amount"" * -1);"										
"Iva      += (rSalesEntry.""VAT Amount"" * -1);"										
"vTotal   += (rSalesEntry.""Net Amount"" * -1) + (rSalesEntry.""VAT Amount"" * -1);"										
										
IF rImpuestos.Impuesto=rImpuestos.Impuesto::Gravado THEN BEGIN										
"IF NOT Transaction2.""Sale Is Return Sale"" THEN BEGIN"										
"VentasG  += (rSalesEntry.""Net Amount"" * -1);"										
"TotalIva += (rSalesEntry.""VAT Amount"" * -1);"										
END ELSE BEGIN										
"TotalVentNcr += (rSalesEntry.""Net Amount"" * -1);"										
"TotalIvaNcr  += (rSalesEntry.""VAT Amount"" * -1);"										
END;										
END ELSE BEGIN										
IF rImpuestos.Impuesto=rImpuestos.Impuesto::Exento THEN BEGIN										
"IF NOT Transaction2.""Sale Is Return Sale"" THEN"										
"VentasE  += (rSalesEntry.""Net Amount"" * -1)"										
ELSE										
"VentasEDev  += (rSalesEntry.""Net Amount"" * -1);"										
END ELSE BEGIN										
"IF NOT Transaction2.""Sale Is Return Sale"" THEN"										
"VentasNoSu  += (rSalesEntry.""Net Amount"" * -1)"										
ELSE										
"VentasNoSuDev  += (rSalesEntry.""Net Amount"" * -1);"										
END;										
END;										
END;										
END ELSE BEGIN										
rImpuestos.RESET;										
"rImpuestos.SETRANGE(""VAT Bus. Posting Group"",rSalesEntry.""VAT Bus. Posting Group"");"										
"rImpuestos.SETRANGE(""VAT Prod. Posting Group"",rSalesEntry.""VAT Prod. Posting Group"");"										
IF rImpuestos.FINDFIRST THEN BEGIN										
"Venta    += ABS(rSalesEntry.""Net Amount"");"										
"Iva      += ABS(rSalesEntry.""VAT Amount"");"										
"vTotal   += ABS(rSalesEntry.""Net Amount"") + ABS(rSalesEntry.""VAT Amount"");"										
										
IF rImpuestos.Impuesto=rImpuestos.Impuesto::Gravado THEN BEGIN										
"IF NOT Transaction2.""Sale Is Return Sale"" THEN BEGIN"										
"VentasG  += ABS(rSalesEntry.""Net Amount"");"										
"TotalIva += ABS(rSalesEntry.""VAT Amount"");"										
END ELSE BEGIN										
"TotalVentNcr += ABS(rSalesEntry.""Net Amount"");"										
"TotalIvaNcr  += ABS(rSalesEntry.""VAT Amount"");"										
END;										
END ELSE BEGIN										
IF rImpuestos.Impuesto=rImpuestos.Impuesto::Exento THEN BEGIN										
"IF NOT Transaction2.""Sale Is Return Sale"" THEN"										
"VentasE  += ABS(rSalesEntry.""Net Amount"")"										
ELSE										
"VentasEDev  += ABS(rSalesEntry.""Net Amount"");"										
END ELSE BEGIN										
"IF NOT Transaction2.""Sale Is Return Sale"" THEN"										
"VentasNoSu  += ABS(rSalesEntry.""Net Amount"")"										
ELSE										
"VentasNoSuDev  += ABS(rSalesEntry.""Net Amount"");"										
END;										
END;										
END;										
END;										
UNTIL rSalesEntry.NEXT = 0;										
LastTicket := Transaction2.NCF;										
										
//CSPNT010916										
rRecargasElectronicas.RESET;										
"rRecargasElectronicas.SETRANGE(""Store No."", Transaction2.""Store No."");"										
"rRecargasElectronicas.SETRANGE(""POS Terminal No."", Transaction2.""POS Terminal No."");"										
"rRecargasElectronicas.SETRANGE(""Receipt No."", Transaction2.""Receipt No."");"										
IF rRecargasElectronicas.FINDFIRST THEN										
vCESC := vCESC + rRecargasElectronicas.CESC;										
										
UNTIL Transaction2.NEXT = 0;										
END;										
//CSPNT271015										
//CSPNT070916										
IF (FirstTicket <> '') OR (LastTicket <> '') THEN BEGIN										
//Del No.										
"DSTR1 := COPYSTR('#L######################################',1);"										
Value[1] := 'Del No.: ' + FirstTicket;										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
//Al No.										
"DSTR1 := COPYSTR('#L######################################',1);"										
Value[1] := 'Al No.: ' + LastTicket;										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
										
//Imprimir Linea en blanco...										
"DSTR1 :=     COPYSTR('                     ',1);"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
//CSPNT150116										
{    //ENCABEZADO DE VENTAS TOTALES...										
"DSTR1 := COPYSTR('    #L#############',1);"										
Value[1] := 'VENTAS TOTALES:';										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
}										
VentasG := VentasG - TotalVentNcr;										
										
//VENTAS GRAVADAS...										
"DSTR1 := COPYSTR('#L##############         #R#############',1);"										
Value[1] := 'Ventas Gravadas:';										
"Value[2] := '$' + FORMAT(VentasG,0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
TotalIva := TotalIva - TotalIvaNcr;										
										
//IMPUESTO IVA...										
"DSTR1 := COPYSTR('#L###########            #R#############',1);"										
Value[1] := 'Impuesto IVA:';										
//CSPNT010916										
"Value[2] := '$' + FORMAT(TotalIva - vCESC,0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//CSPNT010916 IMPUESTO CESC...										
"DSTR1 := COPYSTR('#L############           #R#############',1);"										
Value[1] := 'Impuesto CESC:';										
"Value[2] := '$' + FORMAT(vCESC,0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//Total Gravado...										
"DSTR1 := COPYSTR('#L############           #R#############',1);"										
Value[1] := 'Total Gravado:';										
"Value[2] := '$' + FORMAT(VentasG + TotalIva,0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//VENTAS EXENTAS...										
"DSTR1 := COPYSTR('#L#############          #R#############',1);"										
Value[1] := 'Ventas Exentas:';										
"Value[2] := '$' + FORMAT((VentasE-VentasEDev),0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//VENTAS NO SUJETAS...										
"DSTR1 := COPYSTR('#L################       #R#############',1);"										
Value[1] := 'Ventas No Sujetas:';										
"Value[2] := '$' + FORMAT((VentasNoSu-VentasNoSuDev),0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//VENTAS TOTALES										
"DSTR1 := COPYSTR('#L#############          #R#############',1);"										
Value[1] := 'Ventas Totales:';										
"Value[2] := '$' + FORMAT((VentasG + TotalIva + VentasE + VentasNoSu)-(VentasEDev+VentasNoSuDev),0,'<Integer Thousand><Decimals"	",3>"	');								
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//CSPNT140116										
//CSPNT150116										
vVentasGravadasTotales := vVentasGravadasTotales + VentasG;										
//CSPNT010916										
vImpuestoIVATotales := vImpuestoIVATotales + TotalIva - vCESC;										
vCESCTotales := vCESCTotales + vCESC;										
vTotalGravadoTotales := vTotalGravadoTotales + (VentasG + TotalIva);										
vVentasExentasTotales := vVentasExentasTotales + (VentasE-VentasEDev);										
vVentasNoSujetasTotales := vVentasNoSujetasTotales + (VentasNoSu-VentasNoSuDev);										
vVentasTotalesTotales := vVentasTotalesTotales + ((VentasG + TotalIva + VentasE + VentasNoSu)-(VentasEDev+VentasNoSuDev));										
										
//LIMPIO LAS VARIABLES QUE MUESTRAN LOS TOTALES DE LAS VENTAS POR TIPO DE COMPROBANTES.										
CLEAR(Venta);										
CLEAR(Iva);										
CLEAR(vTotal);										
CLEAR(VentasG);										
CLEAR(TotalIva);										
CLEAR(TotalVentNcr);										
CLEAR(TotalIvaNcr);										
CLEAR(VentasE);										
CLEAR(VentasNoSu);										
CLEAR(VentasEDev);										
CLEAR(VentasNoSuDev);										
CLEAR(Percepcion);										
CLEAR(PercepcionDev);										
//CSPNT010916										
CLEAR(vCESC);										
										
//Imprimir Linea en blanco...										
"DSTR1 :=     COPYSTR('                     ',1);"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//ENCABEZADO PARA EL TIPO DE COMPROBANTE										
"DSTR1 := COPYSTR('#C######################################',1);"										
Value[1] := '2- Comprobante de CrÇdito Fiscal';										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//CSRM16102013 Se quito que imprimiera los rango de facturas porq no es un solo pos en la tienda										
//CSPNT271015 se agrego el rango de facturas										
//CSPNT281015										
//CSPNT301015										
//BUSCO PRIMERO LOS NCF PARA CREDITO FISCALES										
Transaction2.RESET;										
"Transaction2.SETCURRENTKEY(""Statement Code"",""Z-Report ID"",""Transaction Type"",""Entry Status"");"										
"Transaction2.SETRANGE(""Statement Code"",SCode);"										
"Transaction2.SETRANGE(""Z-Report ID"",'');"										
"Transaction2.SETRANGE(""Transaction Type"",Transaction2.""Transaction Type""::Sales);"										
//CSPNT270216										
"Transaction2.SETFILTER(""Entry Status"",'%1|%2|%3',Transaction2.""Entry Status""::"" "",Transaction2.""Entry Status""::Posted,Transact"	ion	"2."""	En	try	"Status""::Voided);"					
"Transaction2.SETRANGE(""No. Serie NCF"",Terminal.""No. Serie NCF Credito Fiscal"");"										
IF Transaction2.FINDFIRST THEN BEGIN										
rNoSeries.RESET;										
"IF rNoSeries.GET(Transaction2.""No. Serie NCF"") THEN BEGIN"										
rNoSeriesLn.RESET;										
"rNoSeriesLn.SETRANGE(""Series Code"",rNoSeries.Code);"										
IF rNoSeriesLn.FINDFIRST THEN BEGIN										
"DSTR1 := COPYSTR('#L######################################',1);"										
Value[1] := 'Autorizacion: ' + UPPERCASE(rNoSeriesLn.Autorizacion);										
"//CSPNT070416          PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
"DSTR1 := COPYSTR('#L#################  #R#################',1);"										
"Value[1] := 'Del ' + rNoSeriesLn.""Starting No."";"										
"Value[2] := 'al  ' + rNoSeriesLn.""Ending No."";"										
"//CSPNT070416          PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
END;										
//CSRM16102013 Se quito que imprimiera los rango de facturas porq no es un solo pos en la tienda										
//CSPNT241015 se agrego rango de facturas										
"FirstFactCrf := Transaction2.""Correlativo Facturas"";"										
//CSPNT290816										
vFirstFechaCref := Transaction2.Date;										
//CSRM16102013 Se quito que imprimiera los rango de facturas porq no es un solo pos en la tienda										
REPEAT										
"rSalesEntry.SETRANGE(""Store No."",Transaction2.""Store No."");"										
"rSalesEntry.SETRANGE(""POS Terminal No."",Transaction2.""POS Terminal No."");"										
"rSalesEntry.SETRANGE(""Transaction No."",Transaction2.""Transaction No."");"										
IF rSalesEntry.FIND('-') THEN										
REPEAT										
IF rSalesEntry.NotaRemision <> '' THEN BEGIN										
rImpuestos.RESET;										
"rImpuestos.SETRANGE(""VAT Bus. Posting Group"",rSalesEntry.""VAT Bus. Posting Group"");"										
"rImpuestos.SETRANGE(""VAT Prod. Posting Group"",rSalesEntry.""VAT Prod. Posting Group"");"										
IF rImpuestos.FINDFIRST THEN BEGIN										
"Venta    += (rSalesEntry.""Net Amount"" * -1);"										
"Iva      += (rSalesEntry.""VAT Amount"" * -1);"										
"vTotal   += (rSalesEntry.""Net Amount"" * -1) + (rSalesEntry.""VAT Amount"" * -1);"										
										
IF rImpuestos.Impuesto=rImpuestos.Impuesto::Gravado THEN BEGIN										
"IF NOT Transaction2.""Sale Is Return Sale"" THEN BEGIN"										
"VentasG  += (rSalesEntry.""Net Amount"" * -1);"										
"TotalIva += (rSalesEntry.""VAT Amount"" * -1);"										
END ELSE BEGIN										
"TotalVentNcr += (rSalesEntry.""Net Amount"" * -1);"										
"TotalIvaNcr  += (rSalesEntry.""VAT Amount"" * -1);"										
END;										
END ELSE BEGIN										
IF rImpuestos.Impuesto=rImpuestos.Impuesto::Exento THEN BEGIN										
"IF NOT Transaction2.""Sale Is Return Sale"" THEN"										
"VentasE  += (rSalesEntry.""Net Amount"" * -1)"										
ELSE										
"VentasEDev  += (rSalesEntry.""Net Amount"" * -1);"										
END ELSE BEGIN										
"IF NOT Transaction2.""Sale Is Return Sale"" THEN"										
"VentasNoSu  += (rSalesEntry.""Net Amount"" * -1)"										
ELSE										
"VentasNoSuDev  += (rSalesEntry.""Net Amount"" * -1);"										
END;										
END;										
END;										
END ELSE BEGIN										
rImpuestos.RESET;										
"rImpuestos.SETRANGE(""VAT Bus. Posting Group"",rSalesEntry.""VAT Bus. Posting Group"");"										
"rImpuestos.SETRANGE(""VAT Prod. Posting Group"",rSalesEntry.""VAT Prod. Posting Group"");"										
IF rImpuestos.FINDFIRST THEN BEGIN										
"Venta    += ABS(rSalesEntry.""Net Amount"");"										
"Iva      += ABS(rSalesEntry.""VAT Amount"");"										
"vTotal   += ABS(rSalesEntry.""Net Amount"") + ABS(rSalesEntry.""VAT Amount"");"										
										
"//CSPNT090316 IF NOT Transaction2.""Sale Is Return Sale"" THEN"										
"{ Percepcion  += ABS(Transaction2.""Percepcion Amount"")"										
ELSE										
"PercepcionDev  += -(Transaction2.""Percepcion Amount"");"										
}										
IF rImpuestos.Impuesto=rImpuestos.Impuesto::Gravado THEN BEGIN										
"IF NOT Transaction2.""Sale Is Return Sale"" THEN BEGIN"										
"VentasG  += ABS(rSalesEntry.""Net Amount"");"										
"TotalIva += ABS(rSalesEntry.""VAT Amount"");"										
END ELSE BEGIN										
"TotalVentNcr += ABS(rSalesEntry.""Net Amount"");"										
"TotalIvaNcr  += ABS(rSalesEntry.""VAT Amount"");"										
END;										
END ELSE BEGIN										
IF rImpuestos.Impuesto=rImpuestos.Impuesto::Exento THEN BEGIN										
"IF NOT Transaction2.""Sale Is Return Sale"" THEN"										
"VentasE  += ABS(rSalesEntry.""Net Amount"")"										
ELSE										
"VentasEDev  += ABS(rSalesEntry.""Net Amount"");"										
END ELSE BEGIN										
"IF NOT Transaction2.""Sale Is Return Sale"" THEN"										
"VentasNoSu  += ABS(rSalesEntry.""Net Amount"")"										
ELSE										
"VentasNoSuDev  += ABS(rSalesEntry.""Net Amount"");"										
END;										
END;										
END;										
END;										
UNTIL rSalesEntry.NEXT = 0;										
//CSRM16102013 Se quito que imprimiera los rango de facturas porq no es un solo pos en la tienda										
//CSPNT241015 se agrego rango de facturas										
"LastFactCrf := Transaction2.""Correlativo Facturas"";"										
//CSPNT290816										
vLastFechaCref := Transaction2.Date;										
//CSRM16102013 Se quito que imprimiera los rango de facturas porq no es un solo pos en la tienda										
//CSPNT090316										
"//CSPNT270416        IF (Transaction2.""Refund Receipt No."" = '') THEN BEGIN"										
"IF NOT Transaction2.""Sale Is Return Sale"" THEN"										
"Percepcion  += ABS(Transaction2.""Percepcion Amount"")"										
ELSE										
"PercepcionDev  += -(Transaction2.""Percepcion Amount"");"										
//CSPNT270416        END;										
										
//CSPNT010916										
rRecargasElectronicas.RESET;										
"rRecargasElectronicas.SETRANGE(""Store No."", Transaction2.""Store No."");"										
"rRecargasElectronicas.SETRANGE(""POS Terminal No."", Transaction2.""POS Terminal No."");"										
"rRecargasElectronicas.SETRANGE(""Receipt No."", Transaction2.""Receipt No."");"										
IF rRecargasElectronicas.FINDFIRST THEN										
vCESC := vCESC + rRecargasElectronicas.CESC;										
										
UNTIL Transaction2.NEXT = 0;										
END;										
										
//CSRM16102013 Se quito que imprimiera los rango de facturas porq no es un solo pos en la tienda										
//CSPNT241015 se agrego rango de facturas										
//CSPNT271015										
//CSPNT070916										
IF (FirstFactCrf <> '') OR (LastFactCrf <> '') THEN BEGIN										
//CSPNT070416										
rNoSeriesLn.RESET;										
"rNoSeriesLn.SETRANGE(""Series Code"",rNoSeries.Code);"										
IF rNoSeriesLn.FINDFIRST THEN										
REPEAT										
//CSPNT290816										
"IF ((rNoSeriesLn.""Starting No."" <= FirstFactCrf) AND (rNoSeriesLn.""Ending No."" >= FirstFactCrf)) AND"										
"((rNoSeriesLn.""Starting Date"" <= vFirstFechaCref) AND (rNoSeriesLn.""Last Date Used"" >= vFirstFechaCref)) THEN"										
vFirstFactCredAut := UPPERCASE(rNoSeriesLn.Autorizacion);										
"IF ((rNoSeriesLn.""Starting No."" <= LastFactCrf) AND (rNoSeriesLn.""Ending No."" >= LastFactCrf)) AND"										
"((rNoSeriesLn.""Starting Date"" <= vLastFechaCref) AND (rNoSeriesLn.""Last Date Used"" >= vLastFechaCref)) THEN"										
vLastFactCredAut := UPPERCASE(rNoSeriesLn.Autorizacion);										
UNTIL rNoSeriesLn.NEXT = 0;										
										
//CSPNT290816										
"DSTR1 := COPYSTR('#L######################################',1);"										
//CSPNT070416										
Value[1] := 'Del No.: ' + vFirstFactCredAut + ' ' + FirstFactCrf;										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
//CSPNT290816										
"DSTR1 := COPYSTR('#L######################################',1);"										
//CSPNT070416										
Value[1] := 'Al No.: ' + vLastFactCredAut + ' ' + LastFactCrf;										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
										
//CSRM16102013 Se quito que imprimiera los rango de facturas porq no es un solo pos en la tienda										
										
//Imprimir Linea en blanco...										
"DSTR1 :=     COPYSTR('                     ',1);"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
//CSPNT150116										
{    //ENCABEZADO DE VENTAS TOTALES...										
"DSTR1 := COPYSTR('    #L#############',1);"										
Value[1] := 'VENTAS TOTALES:';										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
}										
VentasG := VentasG - TotalVentNcr;										
										
//VENTAS GRAVADAS...										
"DSTR1 := COPYSTR('#L##############    #R##################',1);"										
Value[1] := 'Ventas Gravadas:';										
"Value[2] := '$' + FORMAT(VentasG,0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
TotalIva := TotalIva - TotalIvaNcr;										
										
//IMPUESTO IVA...										
"DSTR1 := COPYSTR('#L###########       #R##################',1);"										
Value[1] := 'Impuesto IVA:';										
//CSPNT010916										
"Value[2] := '$' + FORMAT(TotalIva - vCESC,0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//CSPNT010916 IMPUESTO CESC...										
"DSTR1 := COPYSTR('#L############           #R#############',1);"										
Value[1] := 'Impuesto CESC:';										
"Value[2] := '$' + FORMAT(vCESC,0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//Total Gravado...										
"DSTR1 := COPYSTR('#L############      #R##################',1);"										
Value[1] := 'Total Gravado:';										
"Value[2] := '$' + FORMAT(VentasG + TotalIva,0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
CLEAR(Percibido);										
//PERCEPCION...										
"DSTR1 := COPYSTR('#L################# #R##################',1);"										
Value[1] := '(+) IVA Percibido:';										
//Percibido:=  Percepcion-PercepcionDev;										
//IF Percibido =0 THEN										
//  Percibido:=0.0 ;										
"//CSPNT270416    Value[2] := '$' + FORMAT((Percepcion-PercepcionDev),0,'<Integer Thousand><Decimals,3>');"										
"Value[2] := '$' + FORMAT((Percepcion),0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//VENTAS EXENTAS...										
"DSTR1 := COPYSTR('#L#############     #R##################',1);"										
Value[1] := 'Ventas Exentas:';										
"//CSPNT270416    Value[2] := '$' + FORMAT((VentasE-VentasEDev),0,'<Integer Thousand><Decimals,3>');"										
"Value[2] := '$' + FORMAT((VentasE),0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//VENTAS NO SUJETAS...										
"DSTR1 := COPYSTR('#L################  #R##################',1);"										
Value[1] := 'Ventas No Sujetas:';										
"//CSPNT270416    Value[2] := '$' + FORMAT((VentasNoSu-VentasNoSuDev),0,'<Integer Thousand><Decimals,3>');"										
"Value[2] := '$' + FORMAT((VentasNoSu),0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//VENTAS TOTALES										
"DSTR1 := COPYSTR('#L#############     #R##################',1);"										
Value[1] := 'Ventas Totales:';										
"//CSPNT090316    Value[2] := '$' + FORMAT((VentasG + TotalIva + VentasE + VentasNoSu)-(VentasEDev+VentasNoSuDev),0,'<Integer Thous"	and	><D	ec	ima	"ls,3>');"					
//CSPNT270416    Value[2] := '$' + FORMAT((VentasG + TotalIva + VentasE + VentasNoSu+(Percepcion-PercepcionDev))-(VentasEDev+Venta	sNo	SuD	ev	"),0"	",'<Integer Thousand><Decimals,3>');"					
"Value[2] := '$' + FORMAT((VentasG + TotalIva + VentasE + VentasNoSu + Percepcion),0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//CSPNT140116										
//CSPNT150116										
vVentasGravadasTotales := vVentasGravadasTotales + VentasG;										
//CSPNT010916										
vImpuestoIVATotales := vImpuestoIVATotales + TotalIva - vCESC;										
vCESCTotales := vCESCTotales + vCESC;										
vTotalGravadoTotales := vTotalGravadoTotales + (VentasG + TotalIva);										
vVentasExentasTotales := vVentasExentasTotales + (VentasE-VentasEDev);										
vVentasNoSujetasTotales := vVentasNoSujetasTotales + (VentasNoSu-VentasNoSuDev);										
//CSPNT090316										
vVentasTotalesTotales := vVentasTotalesTotales + ((VentasG + TotalIva + VentasE + VentasNoSu + (Percepcion-PercepcionDev))-(Ve	nta	sED	ev	#NAME?	ntasNoSuDev));					
//CSPNT270416										
vIVAPercibidoTotales := vIVAPercibidoTotales + (Percepcion);										
										
//LIMPIO LAS VARIABLES QUE MUESTRAN LOS TOTALES DE LAS VENTAS POR TIPO DE COMPROBANTES.										
CLEAR(Venta);										
CLEAR(Iva);										
CLEAR(vTotal);										
CLEAR(VentasG);										
CLEAR(TotalIva);										
CLEAR(TotalVentNcr);										
CLEAR(TotalIvaNcr);										
CLEAR(VentasE);										
CLEAR(VentasNoSu);										
CLEAR(VentasEDev);										
CLEAR(VentasNoSuDev);										
//CSPNT090316										
CLEAR(Percepcion);										
CLEAR(PercepcionDev);										
//CSPNT010916										
CLEAR(vCESC);										
										
//Imprimir Linea en blanco...										
"DSTR1 :=     COPYSTR('                     ',1);"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//ENCABEZADO PARA EL TIPO DE COMPROBANTE										
"DSTR1 := COPYSTR('#C######################################',1);"										
Value[1] := '3- Nota de CrÇdito';										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//CSRM16102013 Se quito que imprimiera los rango de facturas porq no es un solo pos en la tienda										
//CSPNT271015 se agrego el rango de facturas										
//CSPNT281015										
//CSPNT301015										
//BUSCO PRIMERO LOS NCF PARA CREDITO FISCALES										
Transaction2.RESET;										
"Transaction2.SETCURRENTKEY(""Statement Code"",""Z-Report ID"",""Transaction Type"",""Entry Status"");"										
"Transaction2.SETRANGE(""Statement Code"",SCode);"										
"Transaction2.SETRANGE(""Z-Report ID"",'');"										
"Transaction2.SETRANGE(""Transaction Type"",Transaction2.""Transaction Type""::Sales);"										
//CSPNT270216										
"Transaction2.SETFILTER(""Entry Status"",'%1|%2|%3',Transaction2.""Entry Status""::"" "",Transaction2.""Entry Status""::Posted,Transact"	ion	"2."""	En	try	"Status""::Voided);"					
"Transaction2.SETRANGE(""No. Serie NCF"",Terminal.""No. Serie NCF Nota de Credito"");"										
IF Transaction2.FINDFIRST THEN BEGIN										
rNoSeries.RESET;										
"IF rNoSeries.GET(Transaction2.""No. Serie NCF"") THEN BEGIN"										
rNoSeriesLn.RESET;										
"rNoSeriesLn.SETRANGE(""Series Code"",rNoSeries.Code);"										
IF rNoSeriesLn.FINDFIRST THEN BEGIN										
"DSTR1 := COPYSTR('#L######################################',1);"										
Value[1] := 'Autorizacion: ' + UPPERCASE(rNoSeriesLn.Autorizacion);										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
"DSTR1 := COPYSTR('#L#################  #R#################',1);"										
"Value[1] := 'Del ' + rNoSeriesLn.""Starting No."";"										
"Value[2] := 'al  ' + rNoSeriesLn.""Ending No."";"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
END;										
//CSRM16102013 Se quito que imprimiera los rango de facturas porq no es un solo pos en la tienda										
//CSPNT241015 se agrego rango de facturas										
FirstFactCrfDev := Transaction2.NCF;										
//CSPNT290816										
vFirstFechaNocre := Transaction2.Date;										
//CSRM16102013 Se quito que imprimiera los rango de facturas porq no es un solo pos en la tienda										
REPEAT										
"rSalesEntry.SETRANGE(""Store No."",Transaction2.""Store No."");"										
"rSalesEntry.SETRANGE(""POS Terminal No."",Transaction2.""POS Terminal No."");"										
"rSalesEntry.SETRANGE(""Transaction No."",Transaction2.""Transaction No."");"										
IF rSalesEntry.FIND('-') THEN										
REPEAT										
IF rSalesEntry.NotaRemision <> '' THEN BEGIN										
rImpuestos.RESET;										
"rImpuestos.SETRANGE(""VAT Bus. Posting Group"",rSalesEntry.""VAT Bus. Posting Group"");"										
"rImpuestos.SETRANGE(""VAT Prod. Posting Group"",rSalesEntry.""VAT Prod. Posting Group"");"										
IF rImpuestos.FINDFIRST THEN BEGIN										
"Venta    += (rSalesEntry.""Net Amount"" * -1);"										
"Iva      += (rSalesEntry.""VAT Amount"" * -1);"										
"vTotal   += (rSalesEntry.""Net Amount"" * -1) + (rSalesEntry.""VAT Amount"" * -1);"										
										
IF rImpuestos.Impuesto=rImpuestos.Impuesto::Gravado THEN BEGIN										
"IF NOT Transaction2.""Sale Is Return Sale"" THEN BEGIN"										
"VentasG  += (rSalesEntry.""Net Amount"" * -1);"										
"TotalIva += (rSalesEntry.""VAT Amount"" * -1);"										
END ELSE BEGIN										
"TotalVentNcr += (rSalesEntry.""Net Amount"" * -1);"										
"TotalIvaNcr  += (rSalesEntry.""VAT Amount"" * -1);"										
END;										
END ELSE BEGIN										
IF rImpuestos.Impuesto=rImpuestos.Impuesto::Exento THEN BEGIN										
"IF NOT Transaction2.""Sale Is Return Sale"" THEN"										
"VentasE  += (rSalesEntry.""Net Amount"" * -1)"										
ELSE										
"VentasEDev  += (rSalesEntry.""Net Amount"" * -1);"										
END ELSE BEGIN										
"IF NOT Transaction2.""Sale Is Return Sale"" THEN"										
"VentasNoSu  += (rSalesEntry.""Net Amount"" * -1)"										
ELSE										
"VentasNoSuDev  += (rSalesEntry.""Net Amount"" * -1);"										
END;										
END;										
END;										
END ELSE BEGIN										
rImpuestos.RESET;										
"rImpuestos.SETRANGE(""VAT Bus. Posting Group"",rSalesEntry.""VAT Bus. Posting Group"");"										
"rImpuestos.SETRANGE(""VAT Prod. Posting Group"",rSalesEntry.""VAT Prod. Posting Group"");"										
IF rImpuestos.FINDFIRST THEN BEGIN										
"Venta    += ABS(rSalesEntry.""Net Amount"");"										
"Iva      += ABS(rSalesEntry.""VAT Amount"");"										
"vTotal   += ABS(rSalesEntry.""Net Amount"") + ABS(rSalesEntry.""VAT Amount"");"										
										
IF rImpuestos.Impuesto=rImpuestos.Impuesto::Gravado THEN BEGIN										
"IF NOT Transaction2.""Sale Is Return Sale"" THEN BEGIN"										
"VentasG  += ABS(rSalesEntry.""Net Amount"");"										
"TotalIva += ABS(rSalesEntry.""VAT Amount"");"										
END ELSE BEGIN										
"TotalVentNcr += ABS(rSalesEntry.""Net Amount"");"										
"TotalIvaNcr  += ABS(rSalesEntry.""VAT Amount"");"										
END;										
END ELSE BEGIN										
IF rImpuestos.Impuesto=rImpuestos.Impuesto::Exento THEN BEGIN										
"IF NOT Transaction2.""Sale Is Return Sale"" THEN"										
"VentasE  += ABS(rSalesEntry.""Net Amount"")"										
ELSE										
"VentasEDev  += ABS(rSalesEntry.""Net Amount"");"										
END ELSE BEGIN										
"IF NOT Transaction2.""Sale Is Return Sale"" THEN"										
"VentasNoSu  += ABS(rSalesEntry.""Net Amount"")"										
ELSE										
"VentasNoSuDev  += ABS(rSalesEntry.""Net Amount"");"										
END;										
END;										
END;										
END;										
UNTIL rSalesEntry.NEXT = 0;										
//CSRM16102013 Se quito que imprimiera los rango de facturas porq no es un solo pos en la tienda										
//CSPNT241015 se agrego rango de facturas										
LastFactCrfDev := Transaction2.NCF;										
//CSPNT290816										
vLastFechaNocre := Transaction2.Date;										
//CSRM16102013 Se quito que imprimiera los rango de facturas porq no es un solo pos en la tienda										
//CSPNT090316										
"IF NOT Transaction2.""Sale Is Return Sale"" THEN"										
"Percepcion  += ABS(Transaction2.""Percepcion Amount"")"										
ELSE										
"PercepcionDev  += -(Transaction2.""Percepcion Amount"");"										
UNTIL Transaction2.NEXT = 0;										
END;										
										
//CSRM16102013 Se quito que imprimiera los rango de facturas porq no es un solo pos en la tienda										
//CSPNT241015 se agrego rango de facturas										
//CSPNT271015										
//CSPNT290816										
//CSPNT070916										
IF (FirstFactCrfDev <> '') OR (LastFactCrfDev <> '') THEN BEGIN										
rNoSeriesLn.RESET;										
"rNoSeriesLn.SETRANGE(""Series Code"",rNoSeries.Code);"										
IF rNoSeriesLn.FINDFIRST THEN										
REPEAT										
"IF ((rNoSeriesLn.""Starting No."" <= FirstFactCrfDev) AND (rNoSeriesLn.""Ending No."" >= FirstFactCrfDev)) AND"										
"((rNoSeriesLn.""Starting Date"" <= vFirstFechaNocre) AND (rNoSeriesLn.""Last Date Used"" >= vFirstFechaNocre)) THEN"										
vFirstFactCredAut := UPPERCASE(rNoSeriesLn.Autorizacion);										
"IF ((rNoSeriesLn.""Starting No."" <= LastFactCrfDev) AND (rNoSeriesLn.""Ending No."" >= LastFactCrfDev)) AND"										
"((rNoSeriesLn.""Starting Date"" <= vLastFechaNocre) AND (rNoSeriesLn.""Last Date Used"" >= vLastFechaNocre)) THEN"										
vLastFactCredAut := UPPERCASE(rNoSeriesLn.Autorizacion);										
UNTIL rNoSeriesLn.NEXT = 0;										
"DSTR1 := COPYSTR('#L######################################',1);"										
Value[1] := 'Del No.: ' + vFirstFactCredAut + ' ' + FirstFactCrfDev;										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
"DSTR1 := COPYSTR('#L######################################',1);"										
Value[1] := 'Al No.: ' + vLastFactCredAut + ' ' + LastFactCrfDev;										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
										
//CSRM16102013 Se quito que imprimiera los rango de facturas porq no es un solo pos en la tienda										
										
//Imprimir Linea en blanco...										
"DSTR1 :=     COPYSTR('                     ',1);"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
//CSPNT150116										
{    //ENCABEZADO DE VENTAS TOTALES...										
"DSTR1 := COPYSTR('    #L#############',1);"										
Value[1] := 'VENTAS TOTALES:';										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
}										
VentasG := VentasG - TotalVentNcr;										
										
//VENTAS GRAVADAS...										
"DSTR1 := COPYSTR('#L##############    #R##################',1);"										
Value[1] := 'Ventas Gravadas:';										
"Value[2] := '$' + FORMAT(VentasG,0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
TotalIva := TotalIva - TotalIvaNcr;										
										
//IMPUESTO IVA...										
"DSTR1 := COPYSTR('#L###########       #R##################',1);"										
Value[1] := 'Impuesto IVA:';										
"Value[2] := '$' + FORMAT(TotalIva,0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//Total Gravado...										
"DSTR1 := COPYSTR('#L############      #R##################',1);"										
Value[1] := 'Total Gravado:';										
"Value[2] := '$' + FORMAT(VentasG + TotalIva,0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
CLEAR(Percibido);										
//PERCEPCION...										
"DSTR1 := COPYSTR('#L################# #R##################',1);"										
Value[1] := '(+) IVA Percibido:';										
//Percibido:=  Percepcion-PercepcionDev;										
//IF Percibido =0 THEN										
//  Percibido:=0.0 ;										
"//CSPNT270416    Value[2] := '$' + FORMAT((Percepcion-PercepcionDev),0,'<Integer Thousand><Decimals,3>');"										
"Value[2] := '$' + FORMAT((-PercepcionDev),0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//VENTAS EXENTAS...										
"DSTR1 := COPYSTR('#L#############     #R##################',1);"										
Value[1] := 'Ventas Exentas:';										
"Value[2] := '$' + FORMAT((VentasE-VentasEDev),0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//VENTAS NO SUJETAS...										
"DSTR1 := COPYSTR('#L################  #R##################',1);"										
Value[1] := 'Ventas No Sujetas:';										
"Value[2] := '$' + FORMAT((VentasNoSu-VentasNoSuDev),0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//VENTAS TOTALES										
"DSTR1 := COPYSTR('#L#############     #R##################',1);"										
Value[1] := 'Ventas Totales:';										
"//CSPNT090316    Value[2] := '$' + FORMAT((VentasG + TotalIva + VentasE + VentasNoSu)-(VentasEDev+VentasNoSuDev),0,'<Integer Thous"	and	><D	ec	ima	"ls,3>');"					
//CSPNT270416										
"Value[2] := '$' + FORMAT((VentasG + TotalIva + VentasE + VentasNoSu + (PercepcionDev+Percepcion))-(VentasEDev+VentasNoSuDev),0"	",'<"	Int	eg	er	"Thousand><Decimals,3>');"					
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//CSPNT150116										
vVentasGravadasTotales := vVentasGravadasTotales + VentasG;										
vImpuestoIVATotales := vImpuestoIVATotales + TotalIva;										
vTotalGravadoTotales := vTotalGravadoTotales + (VentasG + TotalIva);										
vVentasExentasTotales := vVentasExentasTotales + (VentasE-VentasEDev);										
vVentasNoSujetasTotales := vVentasNoSujetasTotales + (VentasNoSu-VentasNoSuDev);										
//CSPNT090316										
//CSPNT270416										
vVentasTotalesTotales := vVentasTotalesTotales + ((VentasG + TotalIva + VentasE + VentasNoSu + (PercepcionDev+Percepcion))-(Ve	nta	sED	ev	#NAME?	ntasNoSuDev));					
										
//CSPNT270416										
vIVAPercibidoDevTotales := vIVAPercibidoDevTotales + (-PercepcionDev);										
										
//LIMPIO LAS VARIABLES QUE MUESTRAN LOS TOTALES DE LAS VENTAS POR TIPO DE COMPROBANTES.										
CLEAR(Venta);										
CLEAR(Iva);										
CLEAR(vTotal);										
CLEAR(VentasG);										
CLEAR(TotalIva);										
CLEAR(TotalVentNcr);										
CLEAR(TotalIvaNcr);										
CLEAR(VentasE);										
CLEAR(VentasNoSu);										
CLEAR(VentasEDev);										
CLEAR(VentasNoSuDev);										
//CSPNT090316										
CLEAR(Percepcion);										
CLEAR(PercepcionDev);										
										
//Imprimir Linea en blanco...										
"DSTR1 :=     COPYSTR('                     ',1);"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//CSPNT251115										
//ENCABEZADO PARA EL TIPO DE COMPROBANTE										
"{    DSTR1 := COPYSTR('#C######################################',1);"										
Value[1] := '5- Documento de Devoluci¢n';										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
}										
//BUSCO PRIMERO LOS NCF PARA FACTURAS DE CONSUMIDORES FINALES										
Transaction2.RESET;										
"Transaction2.SETCURRENTKEY(""Statement Code"",""Z-Report ID"",""Transaction Type"",""Entry Status"");"										
"Transaction2.SETRANGE(""Statement Code"",SCode);"										
"Transaction2.SETRANGE(""Z-Report ID"",'');"										
"Transaction2.SETRANGE(""Transaction Type"",Transaction2.""Transaction Type""::Sales);"										
"Transaction2.SETFILTER(""Entry Status"",'%1|%2',Transaction2.""Entry Status""::"" "",Transaction2.""Entry Status""::Posted);"										
"Transaction2.SETRANGE(""No. Serie NCF"",Terminal.""No. Serie Documento Devolucion"");"										
IF Transaction2.FINDFIRST THEN BEGIN										
{      rNoSeries.RESET;										
"IF rNoSeries.GET(Transaction2.""No. Serie NCF"") THEN BEGIN"										
rNoSeriesLn.RESET;										
"rNoSeriesLn.SETRANGE(""Series Code"",rNoSeries.Code);"										
IF rNoSeriesLn.FINDFIRST THEN BEGIN										
"DSTR1 := COPYSTR('#L######################################',1);"										
Value[1] := 'Autorizacion: ' + UPPERCASE(rNoSeriesLn.Autorizacion);										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
"DSTR1 := COPYSTR('#L#################  #R#################',1);"										
"Value[1] := 'Del ' + rNoSeriesLn.""Starting No."";"										
"Value[2] := 'al  ' + rNoSeriesLn.""Ending No."";"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
END;										
}      //CSRM16102013 Se quito que imprimiera los rango de facturas porq no es un solo pos en la tienda										
//CSPNT241015 se agrego rango de facturas										
FirstFactCfDev := Transaction2.NCF;										
REPEAT										
"rSalesEntry.SETRANGE(""Store No."",Transaction2.""Store No."");"										
"rSalesEntry.SETRANGE(""POS Terminal No."",Transaction2.""POS Terminal No."");"										
"rSalesEntry.SETRANGE(""Transaction No."",Transaction2.""Transaction No."");"										
IF rSalesEntry.FIND('-') THEN										
REPEAT										
IF rSalesEntry.NotaRemision <> '' THEN BEGIN										
rImpuestos.RESET;										
"rImpuestos.SETRANGE(""VAT Bus. Posting Group"",rSalesEntry.""VAT Bus. Posting Group"");"										
"rImpuestos.SETRANGE(""VAT Prod. Posting Group"",rSalesEntry.""VAT Prod. Posting Group"");"										
IF rImpuestos.FINDFIRST THEN BEGIN										
"Venta    += -(rSalesEntry.""Net Amount"");"										
"Iva      += -(rSalesEntry.""VAT Amount"");"										
"vTotal   += -(rSalesEntry.""Net Amount"") + -(rSalesEntry.""VAT Amount"");"										
IF rImpuestos.Impuesto=rImpuestos.Impuesto::Gravado THEN BEGIN										
"IF NOT Transaction2.""Sale Is Return Sale"" THEN BEGIN"										
"VentasG  += -(rSalesEntry.""Net Amount"");"										
"TotalIva += -(rSalesEntry.""VAT Amount"");"										
END ELSE BEGIN										
"TotalVentNcr += -(rSalesEntry.""Net Amount"");"										
"TotalIvaNcr  += -(rSalesEntry.""VAT Amount"");"										
END;										
END ELSE BEGIN										
IF rImpuestos.Impuesto=rImpuestos.Impuesto::Exento THEN BEGIN										
"IF NOT Transaction2.""Sale Is Return Sale"" THEN"										
"VentasE  += -(rSalesEntry.""Net Amount"")"										
ELSE										
"VentasEDev  += -(rSalesEntry.""Net Amount"");"										
END ELSE BEGIN										
"IF NOT Transaction2.""Sale Is Return Sale"" THEN"										
"VentasNoSu  += -(rSalesEntry.""Net Amount"")"										
ELSE										
"VentasNoSuDev  += -(rSalesEntry.""Net Amount"");"										
END;										
END;										
END;										
END ELSE BEGIN										
rImpuestos.RESET;										
"rImpuestos.SETRANGE(""VAT Bus. Posting Group"",rSalesEntry.""VAT Bus. Posting Group"");"										
"rImpuestos.SETRANGE(""VAT Prod. Posting Group"",rSalesEntry.""VAT Prod. Posting Group"");"										
IF rImpuestos.FINDFIRST THEN BEGIN										
"Venta    += ABS(rSalesEntry.""Net Amount"");"										
"Iva      += ABS(rSalesEntry.""VAT Amount"");"										
"vTotal   += ABS(rSalesEntry.""Net Amount"") + ABS(rSalesEntry.""VAT Amount"");"										
IF rImpuestos.Impuesto=rImpuestos.Impuesto::Gravado THEN BEGIN										
"IF NOT Transaction2.""Sale Is Return Sale"" THEN BEGIN"										
"VentasG  += ABS(rSalesEntry.""Net Amount"");"										
"TotalIva += ABS(rSalesEntry.""VAT Amount"");"										
END ELSE BEGIN										
"TotalVentNcr += ABS(rSalesEntry.""Net Amount"");"										
"TotalIvaNcr  += ABS(rSalesEntry.""VAT Amount"");"										
END;										
END ELSE BEGIN										
IF rImpuestos.Impuesto=rImpuestos.Impuesto::Exento THEN BEGIN										
"IF NOT Transaction2.""Sale Is Return Sale"" THEN"										
"VentasE  += ABS(rSalesEntry.""Net Amount"")"										
ELSE										
"VentasEDev  += ABS(rSalesEntry.""Net Amount"");"										
END ELSE BEGIN										
"IF NOT Transaction2.""Sale Is Return Sale"" THEN"										
"VentasNoSu  += ABS(rSalesEntry.""Net Amount"")"										
ELSE										
"VentasNoSuDev  += ABS(rSalesEntry.""Net Amount"");"										
END;										
END;										
END;										
END;										
UNTIL rSalesEntry.NEXT = 0;										
										
//CSRM16102013 Se quito que imprimiera los rango de facturas porq no es un solo pos en la tienda										
//CSPNT241015 se agrego rango de facturas										
LastFactCfDev := Transaction2.NCF;										
										
//CSPNT210416										
"IF NOT Transaction2.""Sale Is Return Sale"" THEN"										
"Retencion  += ABS(Transaction2.""Retencion Amount"")"										
ELSE										
"RetencionDev  += -(Transaction2.""Retencion Amount"");"										
										
UNTIL Transaction2.NEXT = 0;										
END;										
										
//CSRM16102013 Se quito que imprimiera los rango de facturas porq no es un solo pos en la tienda										
//CSPNT241015 se agrego rango de facturas										
//CSPNT271015										
{    IF (FirstFactCfDev <> '') AND (LastFactCfDev <> '') THEN BEGIN										
//Del No.										
"DSTR1 := COPYSTR('#L#################################',1);"										
Value[1] := 'Del No.: ' + FirstFactCfDev;										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
//Al No.										
"DSTR1 := COPYSTR('#L#################################',1);"										
Value[1] := 'Al No.: ' + LastFactCfDev;										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
										
//CSRM16102013 Se quito que imprimiera los rango de facturas porq no es un solo pos en la tienda										
//Imprimir Linea en blanco...										
"DSTR1 :=     COPYSTR('                     ',1);"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//ENCABEZADO DE VENTAS TOTALES...										
"DSTR1 := COPYSTR('    #L#############',1);"										
Value[1] := 'VENTAS TOTALES:';										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
}										
VentasG := VentasG - TotalVentNcr;										
{										
//VENTAS GRAVADAS...										
"DSTR1 := COPYSTR('#L##############    #R##################',1);"										
Value[1] := 'Ventas Gravadas:';										
"Value[2] := '$' + FORMAT(VentasG,0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
}										
TotalIva := TotalIva - TotalIvaNcr;										
{										
//IMPUESTO IVA...										
"DSTR1 := COPYSTR('#L###########       #R##################',1);"										
Value[1] := 'Impuesto IVA:';										
"Value[2] := '$' + FORMAT(TotalIva,0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//Total Gravado...										
"DSTR1 := COPYSTR('#L############      #R##################',1);"										
Value[1] := 'Total Gravado:';										
"Value[2] := '$' + FORMAT(VentasG + TotalIva,0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//PERCEPCION...										
"DSTR1 := COPYSTR('#L################# #R##################',1);"										
Value[1] := '(-) IVA Retenido:';										
"Value[2] := '$' + FORMAT((Retencion-RetencionDev),0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//VENTAS EXENTAS...										
"DSTR1 := COPYSTR('#L#############     #R##################',1);"										
Value[1] := 'Ventas Exentas:';										
"Value[2] := '$' + FORMAT((VentasE-VentasEDev),0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//VENTAS NO SUJETAS...										
"DSTR1 := COPYSTR('#L################  #R##################',1);"										
Value[1] := 'Ventas No Sujetas:';										
"Value[2] := '$' + FORMAT((VentasNoSu-VentasNoSuDev),0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//VENTAS TOTALES										
"DSTR1 := COPYSTR('#L#############     #R##################',1);"										
Value[1] := 'Ventas Totales:';										
"Value[2] := '$' + FORMAT((VentasG + TotalIva + VentasE + VentasNoSu)-(VentasEDev+VentasNoSuDev),0,'<Integer Thousand><Decimals"	",3>"	');								
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
}										
//CSPNT251115 TOTAL documentos devolucion										
//CSPNT090316    vTotalDocDevolucion := (VentasG + TotalIva + VentasE + VentasNoSu)-(VentasEDev+VentasNoSuDev);										
vTotalDocDevolucion := (VentasG + VentasE + VentasNoSu)-(VentasEDev+VentasNoSuDev);										
vTotalIvaDocDevolucion := TotalIva;										
//CSPNT210416										
vTotalRetencionDev := RetencionDev;										
//CSPNT270416										
VentasEDevDocDev := VentasEDev;										
vVentasExentasTotales := vVentasExentasTotales + (VentasE-VentasEDev);										
										
//CSRM16102013										
//LIMPIO LAS VARIABLES QUE MUESTRAN LOS TOTALES DE LAS VENTAS POR TIPO DE COMPROBANTES.										
CLEAR(Venta);										
CLEAR(Iva);										
CLEAR(vTotal);										
CLEAR(VentasG);										
CLEAR(TotalIva);										
CLEAR(TotalVentNcr);										
CLEAR(TotalIvaNcr);										
CLEAR(VentasE);										
CLEAR(VentasNoSu);										
CLEAR(VentasEDev);										
CLEAR(VentasNoSuDev);										
{										
//Imprimir Linea en blanco...										
"DSTR1 :=     COPYSTR('                     ',1);"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
}										
										
//ENCABEZADO PARA EL TIPO DE COMPROBANTE										
"DSTR1 := COPYSTR('#C######################################',1);"										
Value[1] := '4- Factura De Consumidor Final';										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//BUSCO PRIMERO LOS NCF PARA FACTURAS DE CONSUMIDORES FINALES										
Transaction2.RESET;										
"Transaction2.SETCURRENTKEY(""Statement Code"",""Z-Report ID"",""Transaction Type"",""Entry Status"");"										
"Transaction2.SETRANGE(""Statement Code"",SCode);"										
"Transaction2.SETRANGE(""Z-Report ID"",'');"										
"Transaction2.SETRANGE(""Transaction Type"",Transaction2.""Transaction Type""::Sales);"										
//CSPNT270216										
"Transaction2.SETFILTER(""Entry Status"",'%1|%2|%3',Transaction2.""Entry Status""::"" "",Transaction2.""Entry Status""::Posted,Transact"	ion	"2."""	En	try	"Status""::Voided);"					
"Transaction2.SETRANGE(""No. Serie NCF"",Terminal.""No. Serie NCF Cons. Final"");"										
IF Transaction2.FINDFIRST THEN BEGIN										
rNoSeries.RESET;										
"IF rNoSeries.GET(Transaction2.""No. Serie NCF"") THEN BEGIN"										
rNoSeriesLn.RESET;										
"rNoSeriesLn.SETRANGE(""Series Code"",rNoSeries.Code);"										
IF rNoSeriesLn.FINDFIRST THEN BEGIN										
"DSTR1 := COPYSTR('#L######################################',1);"										
Value[1] := 'Autorizacion: ' + UPPERCASE(rNoSeriesLn.Autorizacion);										
"//CSPNT070416          PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
"DSTR1 := COPYSTR('#L#################  #R#################',1);"										
"Value[1] := 'Del ' + rNoSeriesLn.""Starting No."";"										
"Value[2] := 'al  ' + rNoSeriesLn.""Ending No."";"										
"//CSPNT070416          PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
END;										
//CSRM16102013 Se quito que imprimiera los rango de facturas porq no es un solo pos en la tienda										
//CSPNT241015 se agrego rango de facturas										
"FirstFactCf := Transaction2.""Correlativo Facturas"";"										
//CSPNT290816										
vFirstFechaFac := Transaction2.Date;										
REPEAT										
"rSalesEntry.SETRANGE(""Store No."",Transaction2.""Store No."");"										
"rSalesEntry.SETRANGE(""POS Terminal No."",Transaction2.""POS Terminal No."");"										
"rSalesEntry.SETRANGE(""Transaction No."",Transaction2.""Transaction No."");"										
IF rSalesEntry.FIND('-') THEN										
REPEAT										
IF rSalesEntry.NotaRemision <> '' THEN BEGIN										
rImpuestos.RESET;										
"rImpuestos.SETRANGE(""VAT Bus. Posting Group"",rSalesEntry.""VAT Bus. Posting Group"");"										
"rImpuestos.SETRANGE(""VAT Prod. Posting Group"",rSalesEntry.""VAT Prod. Posting Group"");"										
IF rImpuestos.FINDFIRST THEN BEGIN										
"Venta    += -(rSalesEntry.""Net Amount"");"										
"Iva      += -(rSalesEntry.""VAT Amount"");"										
"vTotal   += -(rSalesEntry.""Net Amount"") + -(rSalesEntry.""VAT Amount"");"										
IF rImpuestos.Impuesto=rImpuestos.Impuesto::Gravado THEN BEGIN										
"IF NOT Transaction2.""Sale Is Return Sale"" THEN BEGIN"										
"VentasG  += -(rSalesEntry.""Net Amount"");"										
"TotalIva += -(rSalesEntry.""VAT Amount"");"										
END ELSE BEGIN										
"TotalVentNcr += -(rSalesEntry.""Net Amount"");"										
"TotalIvaNcr  += -(rSalesEntry.""VAT Amount"");"										
END;										
END ELSE BEGIN										
IF rImpuestos.Impuesto=rImpuestos.Impuesto::Exento THEN BEGIN										
"IF NOT Transaction2.""Sale Is Return Sale"" THEN"										
"VentasE  += -(rSalesEntry.""Net Amount"")"										
ELSE										
"VentasEDev  += -(rSalesEntry.""Net Amount"");"										
END ELSE BEGIN										
"IF NOT Transaction2.""Sale Is Return Sale"" THEN"										
"VentasNoSu  += -(rSalesEntry.""Net Amount"")"										
ELSE										
"VentasNoSuDev  += -(rSalesEntry.""Net Amount"");"										
END;										
END;										
END;										
END ELSE BEGIN										
rImpuestos.RESET;										
"rImpuestos.SETRANGE(""VAT Bus. Posting Group"",rSalesEntry.""VAT Bus. Posting Group"");"										
"rImpuestos.SETRANGE(""VAT Prod. Posting Group"",rSalesEntry.""VAT Prod. Posting Group"");"										
IF rImpuestos.FINDFIRST THEN BEGIN										
"Venta    += ABS(rSalesEntry.""Net Amount"");"										
"Iva      += ABS(rSalesEntry.""VAT Amount"");"										
"vTotal   += ABS(rSalesEntry.""Net Amount"") + ABS(rSalesEntry.""VAT Amount"");"										
IF rImpuestos.Impuesto=rImpuestos.Impuesto::Gravado THEN BEGIN										
"IF NOT Transaction2.""Sale Is Return Sale"" THEN BEGIN"										
"VentasG  += ABS(rSalesEntry.""Net Amount"");"										
"TotalIva += ABS(rSalesEntry.""VAT Amount"");"										
END ELSE BEGIN										
"TotalVentNcr += ABS(rSalesEntry.""Net Amount"");"										
"TotalIvaNcr  += ABS(rSalesEntry.""VAT Amount"");"										
END;										
END ELSE BEGIN										
IF rImpuestos.Impuesto=rImpuestos.Impuesto::Exento THEN BEGIN										
"IF NOT Transaction2.""Sale Is Return Sale"" THEN"										
"VentasE  += ABS(rSalesEntry.""Net Amount"")"										
ELSE										
"VentasEDev  += ABS(rSalesEntry.""Net Amount"");"										
END ELSE BEGIN										
"IF NOT Transaction2.""Sale Is Return Sale"" THEN"										
"VentasNoSu  += ABS(rSalesEntry.""Net Amount"")"										
ELSE										
"VentasNoSuDev  += ABS(rSalesEntry.""Net Amount"");"										
END;										
END;										
END;										
END;										
UNTIL rSalesEntry.NEXT = 0;										
										
//CSRM16102013 Se quito que imprimiera los rango de facturas porq no es un solo pos en la tienda										
//CSPNT241015 se agrego rango de facturas										
"LastFactCf := Transaction2.""Correlativo Facturas"";"										
//CSPNT290816										
vLastFechaFac := Transaction2.Date;										
//CSPNT090316										
"IF NOT Transaction2.""Sale Is Return Sale"" THEN"										
"Retencion  += ABS(Transaction2.""Retencion Amount"")"										
ELSE										
"RetencionDev  += -(Transaction2.""Retencion Amount"");"										
										
//CSPNT010916										
rRecargasElectronicas.RESET;										
"rRecargasElectronicas.SETRANGE(""Store No."", Transaction2.""Store No."");"										
"rRecargasElectronicas.SETRANGE(""POS Terminal No."", Transaction2.""POS Terminal No."");"										
"rRecargasElectronicas.SETRANGE(""Receipt No."", Transaction2.""Receipt No."");"										
IF rRecargasElectronicas.FINDFIRST THEN										
vCESC := vCESC + rRecargasElectronicas.CESC;										
										
UNTIL Transaction2.NEXT = 0;										
END;										
										
//CSRM16102013 Se quito que imprimiera los rango de facturas porq no es un solo pos en la tienda										
//CSPNT241015 se agrego rango de facturas										
//CSPNT271015										
//CSPNT070916										
IF (FirstFactCf <> '') OR (LastFactCf <> '') THEN BEGIN										
//CSPNT070416										
rNoSeriesLn.RESET;										
"rNoSeriesLn.SETRANGE(""Series Code"",rNoSeries.Code);"										
IF rNoSeriesLn.FINDFIRST THEN										
REPEAT										
//CSPNT290816										
"IF ((rNoSeriesLn.""Starting No."" <= FirstFactCf) AND (rNoSeriesLn.""Ending No."" >= FirstFactCf)) AND"										
"((rNoSeriesLn.""Starting Date"" <= vFirstFechaFac) AND (rNoSeriesLn.""Last Date Used"" >= vFirstFechaFac)) THEN"										
vFirstFactCFAut := UPPERCASE(rNoSeriesLn.Autorizacion);										
"IF ((rNoSeriesLn.""Starting No."" <= LastFactCf) AND (rNoSeriesLn.""Ending No."" >= LastFactCf)) AND"										
"((rNoSeriesLn.""Starting Date"" <= vLastFechaFac) AND (rNoSeriesLn.""Last Date Used"" >= vLastFechaFac)) THEN"										
vLastFactCFAut := UPPERCASE(rNoSeriesLn.Autorizacion);										
UNTIL rNoSeriesLn.NEXT = 0;										
										
//CSPNT290816										
"DSTR1 := COPYSTR('#L######################################',1);"										
//CSPNT070416										
Value[1] := 'Del No.: ' + vFirstFactCFAut + ' ' + FirstFactCf;										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
//CSPNT290816										
"DSTR1 := COPYSTR('#L######################################',1);"										
//CSPNT070416										
Value[1] := 'Al No.: ' + vLastFactCFAut + ' ' + LastFactCf;										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
										
//CSRM16102013 Se quito que imprimiera los rango de facturas porq no es un solo pos en la tienda										
//Imprimir Linea en blanco...										
"DSTR1 :=     COPYSTR('                     ',1);"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
//CSPNT150116										
{    //ENCABEZADO DE VENTAS TOTALES...										
"DSTR1 := COPYSTR('    #L#############',1);"										
Value[1] := 'VENTAS TOTALES:';										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
}										
//CSPNT090316    VentasG := VentasG - TotalVentNcr;										
//CSPNT270416										
VentasG := VentasG - TotalVentNcr + vTotalDocDevolucion + VentasEDevDocDev;										
										
//VENTAS GRAVADAS...										
"DSTR1 := COPYSTR('#L##############    #R##################',1);"										
Value[1] := 'Ventas Gravadas:';										
"Value[2] := '$' + FORMAT(VentasG,0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//CSPNT090316    TotalIva := TotalIva - TotalIvaNcr;										
TotalIva := TotalIva - TotalIvaNcr + vTotalIvaDocDevolucion;										
										
//IMPUESTO IVA...										
"DSTR1 := COPYSTR('#L###########       #R##################',1);"										
Value[1] := 'Impuesto IVA:';										
//CSPNT010916										
"Value[2] := '$' + FORMAT(TotalIva - vCESC,0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//CSPNT010916 IMPUESTO CESC...										
"DSTR1 := COPYSTR('#L############           #R#############',1);"										
Value[1] := 'Impuesto CESC:';										
"Value[2] := '$' + FORMAT(vCESC,0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//Total Gravado...										
"DSTR1 := COPYSTR('#L############      #R##################',1);"										
Value[1] := 'Total Gravado:';										
"Value[2] := '$' + FORMAT(VentasG + TotalIva,0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//PERCEPCION...										
"DSTR1 := COPYSTR('#L################# #R##################',1);"										
Value[1] := '(-) IVA Retenido:';										
"//CSPNT210416    Value[2] := '$' + FORMAT((Retencion-RetencionDev),0,'<Integer Thousand><Decimals,3>');"										
"Value[2] := '$' + FORMAT((Retencion-vTotalRetencionDev),0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//VENTAS EXENTAS...										
"DSTR1 := COPYSTR('#L#############     #R##################',1);"										
Value[1] := 'Ventas Exentas:';										
//CSPNT270416										
"Value[2] := '$' + FORMAT((VentasE-VentasEDev-VentasEDevDocDev),0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//VENTAS NO SUJETAS...										
"DSTR1 := COPYSTR('#L################  #R##################',1);"										
Value[1] := 'Ventas No Sujetas:';										
"Value[2] := '$' + FORMAT((VentasNoSu-VentasNoSuDev),0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//CSPNT251115 TOTAL DOCUMENTO DEVOLUCION										
"//CSPNT090316    DSTR1 := COPYSTR('#L################  #R##################',1);"										
{    Value[1] := 'Devoluciones:';										
"Value[2] := '$' + FORMAT(vTotalDocDevolucion,0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
}										
//VENTAS TOTALES										
"DSTR1 := COPYSTR('#L#############     #R##################',1);"										
Value[1] := 'Ventas Totales:';										
"Value[2] := '$' + FORMAT((VentasG + TotalIva + VentasE + VentasNoSu)-(VentasEDev+VentasNoSuDev-vTotalDocDevolucion),0,'<Intege"	r T	hou	sa	nd>	"<Decimals,3>');"					
//CSPNT090316    Value[2] := '$' + FORMAT((VentasG + TotalIva + VentasE + VentasNoSu)-(VentasEDev+VentasNoSuDev-vTotalDocDevolucio	"n),"	"0,'"	<I	nte	"ger Thousand><Decimals,3>');"					
//CSPNT270416										
Value[2] := '$' + FORMAT((VentasG + TotalIva + VentasE + VentasNoSu)-(VentasEDev+VentasNoSuDev+(Retencion-RetencionDev)+Ventas	EDe	vDo	cD	ev)	",0,'<Integer Thousand><Decimals,3>');"					
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//CSPNT140116										
//CSPNT150116										
vVentasGravadasTotales := vVentasGravadasTotales + VentasG;										
//CSPNT010916										
vImpuestoIVATotales := vImpuestoIVATotales + TotalIva - vCESC;										
vCESCTotales := vCESCTotales + vCESC;										
vTotalGravadoTotales := vTotalGravadoTotales + (VentasG + TotalIva);										
vVentasExentasTotales := vVentasExentasTotales + (VentasE-VentasEDev);										
vVentasNoSujetasTotales := vVentasNoSujetasTotales + (VentasNoSu-VentasNoSuDev);										
//CSPNT090316										
vVentasTotalesTotales := vVentasTotalesTotales + ((VentasG + TotalIva + VentasE + VentasNoSu)-(VentasEDev+VentasNoSuDev+(Reten	cio	n-R	et	enc	ionDev)+VentasEDevDocDev));					
vIVARetenidoTotales := vIVARetenidoTotales + (Retencion-RetencionDev);										
										
//CSRM16102013										
//LIMPIO LAS VARIABLES QUE MUESTRAN LOS TOTALES DE LAS VENTAS POR TIPO DE COMPROBANTES.										
CLEAR(Venta);										
CLEAR(Iva);										
CLEAR(vTotal);										
CLEAR(VentasG);										
CLEAR(TotalIva);										
CLEAR(TotalVentNcr);										
CLEAR(TotalIvaNcr);										
CLEAR(VentasE);										
CLEAR(VentasNoSu);										
CLEAR(VentasEDev);										
CLEAR(VentasNoSuDev);										
//CSPNT251115										
CLEAR(vTotalDocDevolucion);										
										
//Imprimir Linea en blanco...										
"DSTR1 :=     COPYSTR('                     ',1);"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//CSPNT140116										
"DSTR1 := COPYSTR('#C######################################',1);"										
Value[1] := 'VENTAS TOTALES';										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//Imprimir Linea en blanco...										
"DSTR1 :=     COPYSTR('                     ',1);"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//CSPNT150116										
//VENTAS GRAVADAS TOTALES										
"DSTR1 := COPYSTR('#L###################### #R#############',1);"										
Value[1] := 'Ventas Gravadas:';										
"Value[2] := '$' + FORMAT(vVentasGravadasTotales,0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//IMPUESTO IVA TOTALES										
"DSTR1 := COPYSTR('#L###################### #R#############',1);"										
Value[1] := 'Impuesto IVA:';										
"Value[2] := '$' + FORMAT(vImpuestoIVATotales,0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//CSPNT010916IMPUESTO CESC TOTALES										
"DSTR1 := COPYSTR('#L###################### #R#############',1);"										
Value[1] := 'Impuesto CESC:';										
"Value[2] := '$' + FORMAT(vCESCTotales,0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//TOTAL GRAVADO TOTALES										
"DSTR1 := COPYSTR('#L###################### #R#############',1);"										
Value[1] := 'Total Gravado:';										
"Value[2] := '$' + FORMAT(vTotalGravadoTotales,0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//VENTAS EXENTAS TOTALES										
"DSTR1 := COPYSTR('#L###################### #R#############',1);"										
Value[1] := 'Ventas Exentas:';										
"Value[2] := '$' + FORMAT(vVentasExentasTotales,0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//VENTAS NO SUJETAS TOTALES										
"DSTR1 := COPYSTR('#L###################### #R#############',1);"										
Value[1] := 'Ventas No Sujetas:';										
"Value[2] := '$' + FORMAT(vVentasNoSujetasTotales,0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//IVA PERCIBIDO TOTALES										
"DSTR1 := COPYSTR('#L###################### #R#############',1);"										
Value[1] := '(+) IVA Percebido:';										
//CSPNT270416										
"Value[2] := '$' + FORMAT(vIVAPercibidoTotales-vIVAPercibidoDevTotales,0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//IVA RETENIDO TOTALES										
"DSTR1 := COPYSTR('#L###################### #R#############',1);"										
Value[1] := '(-) IVA Retenido:';										
"Value[2] := '$' + FORMAT(vIVARetenidoTotales,0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//VENTAS TOTALES TOTALES										
"DSTR1 := COPYSTR('#L###################### #R#############',1);"										
Value[1] := 'Ventas Totales:';										
"Value[2] := '$' + FORMAT(vVentasTotalesTotales,0,'<Integer Thousand><Decimals,3>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//Imprimir Linea en blanco...										
"DSTR1 :=     COPYSTR('                     ',1);"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//CSPNT130116 TOTAL DEVOLUCIONES										
										
//ENCABEZADO PARA EL TIPO DE COMPROBANTE										
"DSTR1 := COPYSTR('#C######################################',1);"										
Value[1] := 'DEVOLUCIONES';										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//CSPNT281015										
Transaction2.RESET;										
"Transaction2.SETCURRENTKEY(""Statement Code"",""Z-Report ID"",""Transaction Type"",""Entry Status"");"										
"Transaction2.SETRANGE(""Statement Code"",SCode);"										
"Transaction2.SETRANGE(""Z-Report ID"",'');"										
"Transaction2.SETRANGE(""Transaction Type"",Transaction2.""Transaction Type""::Sales);"										
"Transaction2.SETFILTER(""Entry Status"",'%1|%2',Transaction2.""Entry Status""::"" "",Transaction2.""Entry Status""::Posted);"										
"Transaction2.SETRANGE(""Sale Is Return Sale"", TRUE);"										
vNoDevoluciones := 0;										
IF Transaction2.FINDFIRST THEN BEGIN										
REPEAT										
vNoDevoluciones := (vNoDevoluciones + 1);										
CLEAR(Venta);										
CLEAR(Iva);										
CLEAR(vTotal);										
"rSalesEntry.SETRANGE(""Store No."",Transaction2.""Store No."");"										
"rSalesEntry.SETRANGE(""POS Terminal No."",Transaction2.""POS Terminal No."");"										
"rSalesEntry.SETRANGE(""Transaction No."",Transaction2.""Transaction No."");"										
IF rSalesEntry.FIND('-') THEN										
REPEAT										
IF rSalesEntry.NotaRemision <> '' THEN BEGIN										
rImpuestos.RESET;										
"rImpuestos.SETRANGE(""VAT Bus. Posting Group"",rSalesEntry.""VAT Bus. Posting Group"");"										
"rImpuestos.SETRANGE(""VAT Prod. Posting Group"",rSalesEntry.""VAT Prod. Posting Group"");"										
IF rImpuestos.FINDFIRST THEN BEGIN										
"Venta    += -(rSalesEntry.""Net Amount"");"										
"Iva      += -(rSalesEntry.""VAT Amount"");"										
"vTotal   += -(rSalesEntry.""Net Amount"") + -(rSalesEntry.""VAT Amount"");"										
										
IF rImpuestos.Impuesto=rImpuestos.Impuesto::Gravado THEN BEGIN										
"IF NOT Transaction2.""Sale Is Return Sale"" THEN BEGIN"										
"VentasG  += -(rSalesEntry.""Net Amount"");"										
"TotalIva += -(rSalesEntry.""VAT Amount"");"										
END ELSE BEGIN										
"TotalVentNcr += -(rSalesEntry.""Net Amount"");"										
"TotalIvaNcr  += -(rSalesEntry.""VAT Amount"");"										
END;										
END ELSE BEGIN										
IF rImpuestos.Impuesto=rImpuestos.Impuesto::Exento THEN BEGIN										
"IF NOT Transaction2.""Sale Is Return Sale"" THEN"										
"VentasE  += -(rSalesEntry.""Net Amount"")"										
ELSE										
"VentasEDev  += -(rSalesEntry.""Net Amount"");"										
END ELSE BEGIN										
"IF NOT Transaction2.""Sale Is Return Sale"" THEN"										
"VentasNoSu  += -(rSalesEntry.""Net Amount"")"										
ELSE										
"VentasNoSuDev  += -(rSalesEntry.""Net Amount"");"										
END;										
END;										
END;										
END ELSE BEGIN										
rImpuestos.RESET;										
"rImpuestos.SETRANGE(""VAT Bus. Posting Group"",rSalesEntry.""VAT Bus. Posting Group"");"										
"rImpuestos.SETRANGE(""VAT Prod. Posting Group"",rSalesEntry.""VAT Prod. Posting Group"");"										
IF rImpuestos.FINDFIRST THEN BEGIN										
"Venta    += ABS(rSalesEntry.""Net Amount"");"										
"Iva      += ABS(rSalesEntry.""VAT Amount"");"										
"vTotal   += ABS(rSalesEntry.""Net Amount"") + ABS(rSalesEntry.""VAT Amount"");"										
										
IF rImpuestos.Impuesto=rImpuestos.Impuesto::Gravado THEN BEGIN										
"IF NOT Transaction2.""Sale Is Return Sale"" THEN BEGIN"										
"VentasG  += ABS(rSalesEntry.""Net Amount"");"										
"TotalIva += ABS(rSalesEntry.""VAT Amount"");"										
END ELSE BEGIN										
"TotalVentNcr += ABS(rSalesEntry.""Net Amount"");"										
"TotalIvaNcr  += ABS(rSalesEntry.""VAT Amount"");"										
END;										
END ELSE BEGIN										
IF rImpuestos.Impuesto=rImpuestos.Impuesto::Exento THEN BEGIN										
"IF NOT Transaction2.""Sale Is Return Sale"" THEN"										
"VentasE  += ABS(rSalesEntry.""Net Amount"")"										
ELSE										
"VentasEDev  += ABS(rSalesEntry.""Net Amount"");"										
END ELSE BEGIN										
"IF NOT Transaction2.""Sale Is Return Sale"" THEN"										
"VentasNoSu  += ABS(rSalesEntry.""Net Amount"")"										
ELSE										
"VentasNoSuDev  += ABS(rSalesEntry.""Net Amount"");"										
END;										
END;										
END;										
END;										
UNTIL rSalesEntry.NEXT = 0;										
UNTIL Transaction2.NEXT = 0;										
END;										
										
//DEVOLUCIONES...										
"DSTR1 := COPYSTR('#L#################### #L#############',1);"										
Value[1] := 'Cantidad devoluciones:';										
Value[2] := FORMAT(vNoDevoluciones);										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//Imprimir Linea en blanco...										
"DSTR1 :=     COPYSTR('                     ',1);"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
VentasG := VentasG - TotalVentNcr;										
TotalIva := TotalIva - TotalIvaNcr;										
										
//VENTAS TOTALES										
"DSTR1 := COPYSTR('#L###################### #R#############',1);"										
//CSPNT220116										
Value[1] := 'Devoluciones Totales:';										
"//CSPNT270416    Value[2] := '$' + FORMAT((VentasG + TotalIva + VentasE + VentasNoSu)-(VentasEDev+VentasNoSuDev),0,'<Integer Thous"	and	><D	ec	ima	"ls,3>');"					
Value[2] := '$' + FORMAT((VentasG + TotalIva + VentasE + VentasNoSu)-(VentasEDev+VentasNoSuDev)+vTotalRetencionDev-vIVAPercibi	doD	evT	ot	ale	"s,0,'<Integer Thousand><Decimals,3>');"					
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//LIMPIO LAS VARIABLES QUE MUESTRAN LOS TOTALES DE LAS VENTAS POR TIPO DE COMPROBANTES.										
CLEAR(FirstTicket);										
CLEAR(LastTicket);										
CLEAR(Venta);										
CLEAR(Iva);										
CLEAR(vTotal);										
CLEAR(VentasG);										
CLEAR(TotalIva);										
CLEAR(TotalVentNcr);										
CLEAR(TotalIvaNcr);										
CLEAR(VentasE);										
CLEAR(VentasNoSu);										
CLEAR(VentasEDev);										
CLEAR(VentasNoSuDev);										
										
//Imprimir Linea en blanco...										
"DSTR1 :=     COPYSTR('                     ',1);"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
// -										
										
END;										
END;										
//CSPNT261015 contenido cortes fin										
										
//CSPNT100316										
//CSPNT270416vIVAS := vIVAPercibidoTotales-vIVARetenidoTotales;										
vIVAS := vIVAPercibidoTotales-vIVAPercibidoDevTotales-vIVARetenidoTotales;										
										
//  Line per Tender Type										
//CSPNT031115 Se movio al final de los reportes										
CLEAR(PaymEntry);										
"PaymEntry.SETCURRENTKEY(""Statement Code"",""Z-Report ID"",""Tender Type"",""Currency Code"",""Card No."");"										
"PaymEntry.SETRANGE(""Statement Code"",SCode);"										
"PaymEntry.SETRANGE(""Z-Report ID"",'');"										
//CSPNT281015										
IF RunType = RunType::Y THEN										
"PaymEntry.SETRANGE(""Y-Report ID"",'');"										
PaymTrans3.COPYFILTERS(PaymEntry);										
										
"TenderType.SETCURRENTKEY(""Store No."");"										
"TenderType.SETRANGE(""Store No."",Globals.StoreNo);"										
"TenderType.SETFILTER(TenderType.""Function"",'<>%1',TenderType.""Function""::""Tender Remove/Float"");"										
"TenderType.SETRANGE(""Foreign Currency"",TRUE);"										
LocalTotal := 0;										
//CSPNT281015										
"//CSPNT301015 TenderType.SETRANGE(""Foreign Currency"",TRUE);"										
//LocalTotal := 0;										
										
//CSPNT210116PrintSeperator(2);										
//CSPNT210116PrintXZLines();										
										
//  Floating and Removal Totals										
//CSPNT281015										
										
"TenderType.SETRANGE(""Foreign Currency"");"										
"TenderType.SETRANGE(TenderType.""Function"",TenderType.""Function""::""Tender Remove/Float"");"										
"TenderType.SETRANGE(TenderType.""Function"",TenderType.""Function""::""Tender Remove/Float"");"										
IF TenderType.FIND('-') THEN BEGIN										
PrintSeperator(2);										
REPEAT										
FOR lSafeType := 0 TO 3 DO BEGIN										
NoOfLines := 0;										
TotalSafeType := 0;										
"PaymEntry.SETRANGE(""Safe type"",lSafeType);"										
"PaymEntry.SETRANGE(""Currency Code"");"										
"PaymEntry.SETRANGE(""Card No."");"										
"PaymEntry.SETRANGE(""Tender Type"",TenderType.Code);"										
IF PaymEntry.FIND('-') THEN										
REPEAT										
//CSPNT200116          IF NoOfLines = 0 THEN BEGIN										
{            IF lSafeType = 0 THEN										
HeaderText := Text320										
ELSE										
"HeaderText := FORMAT(PaymEntry.""Safe type"");"										
DSTR1 := '#C######################################';										
Value[1] := HeaderText;										
Value[1] := TenderType.Description;										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
}										
NoOfLines := NoOfLines + 1;										
"Transaction.GET(PaymEntry.""Store No."",PaymEntry.""POS Terminal No."",PaymEntry.""Transaction No."");"										
"IF PaymEntry.""Amount Tendered"" > 0 THEN BEGIN"										
"RemoveTotal := RemoveTotal + PaymEntry.""Amount Tendered"";"										
//CSPNT200116            DSTR1    := '#L############## #L###### #R############';										
{            DSTR1    := '#L##############          #R############';										
"Value[1] := STRSUBSTNO('%1',Transaction.""Transaction Type"");"										
"//CSPNT200116            Value[2] := Transaction.""Staff ID"";"										
"Value[2] := POSFunctions.FormatAmount(PaymEntry.""Amount Tendered"");"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
}										
END										
ELSE BEGIN										
"FloatTotal := FloatTotal + PaymEntry.""Amount Tendered"";"										
//CSPNT200116            DSTR1    := '#L############## #L###### #R############';										
{            DSTR1    := '#L##############          #R############';										
"Value[1] := STRSUBSTNO('%1',Transaction.""Transaction Type"");"										
"//CSPNT200116            Value[2] := Transaction.""Staff ID"";"										
"Value[2] := POSFunctions.FormatAmount(-PaymEntry.""Amount Tendered"");"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
}										
END;										
"TotalSafeType := TotalSafeType + PaymEntry.""Amount Tendered"";"										
LineFound := TRUE;										
UNTIL PaymEntry.NEXT = 0;										
{      IF NoOfLines > 0 THEN BEGIN										
IF NoOfLines > 1 THEN BEGIN										
"PrintLine(2,'');"										
DSTR1    := '#L############## #L###### #R############';										
Value[1] := Text005;										
Value[2] := '';										
Value[3] := POSFunctions.FormatAmount(TotalSafeType);										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
PrintSeperator(2);										
END										
ELSE BEGIN										
PrintSeperator(2);										
END;										
END;										
}										
END;										
UNTIL TenderType.NEXT = 0;										
END;										
"PaymEntry.SETRANGE(""Safe type"");"										
										
IF FloatTotal <> 0 THEN BEGIN										
//CSPNT250216										
DSTR1 := '#C######################################';										
Value[1] := 'INGRESOS';										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
DSTR1 := '#L#############     #R##################';										
Value[1] := 'DESCRIPCI‡N';										
Value[2] := 'MONTO';										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
DSTR1    := '#L##############    #R##################';										
Value[1] := Text009 + ':';										
Value[2] := POSFunctions.FormatAmount(FloatTotal);										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//CSPNT250216										
"DSTR1 :=     COPYSTR('                     ',1);"										
Value[1] := '';										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
DSTR1 := '#L######################### #R##########';										
END;										
"//CSPNT230116 removetotal cambiado por efectivo removido, cheque removido"										
{IF RemoveTotal <> 0 THEN BEGIN										
//CSPNT220116										
DSTR1 := '#L###################### #R#############';										
Value[1] := Text010 + ':';										
Value[2] := POSFunctions.FormatAmount(RemoveTotal);										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
}										
										
//CSPNT230116										
DSTR1 := '#C######################################';										
Value[1] := 'RETIROS';										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
DSTR1 := '#L#############     #R##################';										
Value[1] := 'DESCRIPCI‡N';										
Value[2] := 'MONTO';										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//CSPNT230116										
TenderType.RESET;										
"TenderType.SETRANGE(""Store No."",Store.""No."");"										
"TenderType.SETFILTER(TenderType.Code,'%1|%2','1','2');"										
IF TenderType.FIND('-') THEN										
REPEAT										
"PaymEntry.SETRANGE(""Tender Type"",TenderType.Code);"										
"PaymEntry.SETRANGE(""Z-Report ID"",'');  //CSMQ090816"										
"PaymEntry.SETFILTER(""Amount Tendered"",'<%1',0);"										
//CSPNT120316										
"PaymEntry.SETFILTER(""Safe type"",'=%1',PaymEntry.""Safe type""::Bank);"										
IF PaymEntry.FIND('-') THEN										
REPEAT										
rTransaction.RESET;										
"rTransaction.SETRANGE(""Receipt No."",PaymEntry.""Receipt No."");"										
rTransaction.FINDFIRST;										
"IF (rTransaction.""Transaction Type"" = rTransaction.""Transaction Type""::""Remove Tender"") OR"										
//CSPNT240516										
"(rTransaction.""Transaction Type"" = rTransaction.""Transaction Type""::""Tender Decl."") THEN BEGIN"										
IF (TenderType.Code = '1') THEN										
"vEfectivoRetirado := vEfectivoRetirado + (-PaymEntry.""Amount Tendered"")"										
ELSE										
"vChequeRetirado := vChequeRetirado + (-PaymEntry.""Amount Tendered"");"										
END;										
UNTIL PaymEntry.NEXT = 0;										
UNTIL TenderType.NEXT = 0;										
										
IF (vEfectivoRetirado >= 0) THEN BEGIN										
DSTR1 := '#L###################### #R#############';										
Value[1] := TextEfectivoRetirado;										
Value[2] := POSFunctions.FormatAmount(vEfectivoRetirado);										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
IF (vChequeRetirado >= 0) THEN BEGIN										
DSTR1 := '#L###################### #R#############';										
Value[1] := TextChequeRetirado;										
Value[2] := POSFunctions.FormatAmount(vChequeRetirado);										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
										
//CSPNT230116 Imprimir Linea en blanco...										
"DSTR1 :=     COPYSTR('                     ',1);"										
Value[1] := '';										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
DSTR1 := '#L######################### #R##########';										
										
//CSPNT210116 efectivo a retirar										
//CSPNT220116 Efectivo y cheque a retirar										
TenderType.RESET;										
"TenderType.SETRANGE(""Store No."",Store.""No."");"										
"TenderType.SETFILTER(TenderType.Code,'%1|%2','1','2');"										
IF TenderType.FIND('-') THEN										
REPEAT										
//CSPNT290416										
Transaction4.RESET;										
"Transaction4.SETRANGE(""Transaction Type"",Transaction4.""Transaction Type""::Sales);"										
"Transaction4.SETRANGE(""Z-Report ID"",'');  //CSMQ090816"										
"Transaction4.SETRANGE(""Income/Exp. Amount"",0.0);"										
IF Transaction4.FINDSET THEN										
REPEAT										
PaymEntry.RESET;										
"PaymEntry.SETRANGE(""Z-Report ID"",'');"										
"PaymEntry.SETRANGE(""Tender Type"",TenderType.Code);"										
//CSPNT120316										
"PaymEntry.SETFILTER(""Safe type"",'<>%1&<>%2',PaymEntry.""Safe type""::Bank,PaymEntry.""Safe type""::Safe);"										
//CSPNT290416										
"PaymEntry.SETRANGE(""Receipt No."",Transaction4.""Receipt No."");"										
IF PaymEntry.FIND('-') THEN										
REPEAT										
IF (TenderType.Code = '1') THEN										
"vEfectivoTotal := vEfectivoTotal + PaymEntry.""Amount Tendered"""										
ELSE										
"vChequeTotal := vChequeTotal + PaymEntry.""Amount Tendered"";"										
UNTIL PaymEntry.NEXT = 0;										
UNTIL Transaction4.NEXT = 0;										
UNTIL TenderType.NEXT = 0;										
										
//CSPNT100316										
rTransSafeEntry.RESET;										
"rTransSafeEntry.SETRANGE(""Safe Type"", rTransSafeEntry.""Safe Type""::Safe);"										
"rTransSafeEntry.SETRANGE(""Tender Type"", '1');"										
IF rTransSafeEntry.FIND('-') THEN BEGIN										
"rTransSafeEntry.CALCSUMS(""Amount Tendered"");"										
"vCofreEfectivo := rTransSafeEntry.""Amount Tendered"";"										
END;										
//CSPNT120316										
rTransSafeEntry.RESET;										
"rTransSafeEntry.SETRANGE(""Safe Type"", rTransSafeEntry.""Safe Type""::Safe);"										
"rTransSafeEntry.SETRANGE(""Tender Type"", '2');"										
IF rTransSafeEntry.FIND('-') THEN BEGIN										
"rTransSafeEntry.CALCSUMS(""Amount Tendered"");"										
"vCofreCheque := rTransSafeEntry.""Amount Tendered"";"										
END;										
										
//CSPNT220116										
//CSPNT230116										
//CSPNT250216IF (vEfectivoTotal - vEfectivoRetirado >= 0) THEN BEGIN										
//CSPNT120316										
//CSPNT140316										
IF (vEfectivoTotal - ABS(vEfectivoRetirado) >= 0) THEN BEGIN										
DSTR1 := '#L########################## #R#########';										
Value[1] := TextEfectivoARetirar;										
//CSPNT250216										
//CSPNT100316										
//CSPNT120316  Value[2] := POSFunctions.FormatAmount(vEfectivoTotal-vEfectivoRetirado+vIVAPercibidoTotales-vIVARetenidoTotales-vCo	fre	);								
//CSPNT140316										
//CSPNT160316 se quito el ivaretenido										
//CSPNT270416 se quito el ivapercibido										
Value[2] := POSFunctions.FormatAmount(vEfectivoTotal-ABS(vEfectivoRetirado));										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
										
//CSPNT250216IF (vChequeTotal - vChequeRetirado >= 0) THEN BEGIN										
//CSPNT120316										
//CSPNT140316										
IF (vChequeTotal - ABS(vChequeRetirado) >= 0) THEN BEGIN										
DSTR1 := '#L########################## #R#########';										
Value[1] := TextChequeARetirar;										
//CSPNT250216										
//CSPNT120316										
//CSPNT140316										
Value[2] := POSFunctions.FormatAmount(vChequeTotal-ABS(vChequeRetirado));										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
										
//CSPNT120316 mostrar cofre										
IF TRUE THEN BEGIN										
DSTR1 := '#L########################## #R#########';										
Value[1] := 'Cofre Efectivo';										
Value[2] := POSFunctions.FormatAmount(vCofreEfectivo);										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
DSTR1 := '#L########################## #R#########';										
Value[1] := 'Cofre Cheque';										
Value[2] := POSFunctions.FormatAmount(vCofreCheque);										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
										
//CSPNT200116IF (LocalTotal<>0) OR (FloatTotal<>0) OR (RemoveTotal<>0) THEN										
//  PrintSeperator(2);										
										
//CSPNT031115										
CLEAR(PaymEntry);										
"PaymEntry.SETCURRENTKEY(""Statement Code"",""Z-Report ID"",""Tender Type"",""Currency Code"",""Card No."");"										
"PaymEntry.SETRANGE(""Statement Code"",SCode);"										
"PaymEntry.SETRANGE(""Z-Report ID"",'');"										
//CSPNT281015										
{IF RunType = RunType::Y THEN										
"PaymEntry.SETRANGE(""Y-Report ID"",'');}"										
PaymTrans3.COPYFILTERS(PaymEntry);										
										
//CSPNT210116										
TenderType.RESET;										
"TenderType.SETCURRENTKEY(""Store No."");"										
"TenderType.SETRANGE(""Store No."",Globals.StoreNo);"										
"TenderType.SETFILTER(TenderType.""Function"",'<>%1',TenderType.""Function""::""Tender Remove/Float"");"										
"TenderType.SETRANGE(""Foreign Currency"",FALSE);"										
LocalTotal := 0;										
//CSPNT281015										
"//CSPNT301015 TenderType.SETRANGE(""Foreign Currency"",TRUE);"										
LocalTotal := 0;										
										
//CSPNT291015										
PrintSeperator(2);										
PrintXZLines();										
										
//CSPNT210116PrintSeperator(2);										
										
//CSPNT281015										
"Transaction.""Transaction No."" := 0;"										
"TendDeclEntry.SETCURRENTKEY(""Statement Code"",""Z-Report ID"",""Tender Type"",""Currency Code"",""Card No."");"										
"TendDeclEntry.SETRANGE(""Statement Code"",SCode);"										
"TendDeclEntry.SETRANGE(""Z-Report ID"",'');"										
"IF Store.""Tend. Decl. Calculation"" = Store.""Tend. Decl. Calculation""::Sum THEN BEGIN"										
BufferTendDeclEntry;										
IF TendDeclEntry.FIND('-') THEN										
"Transaction.""Transaction No."" := TendDeclEntry.""Transaction No."";"										
END										
ELSE BEGIN										
IF TendDeclEntry.FIND('-') THEN										
REPEAT										
"IF TendDeclEntry.""Transaction No."" > Transaction.""Transaction No."" THEN"										
"Transaction.GET(TendDeclEntry.""Store No."",TendDeclEntry.""POS Terminal No."",TendDeclEntry.""Transaction No."")"										
UNTIL TendDeclEntry.NEXT=0;										
END;										
										
"IF Transaction.""Transaction No."" <> 0 THEN BEGIN"										
"PrintLine(2,FormatLine(Text112,FALSE,TRUE,FALSE,FALSE));"										
CLEAR(TendDeclEntry);										
LocalTotal := 0;										
"IF Store.""Tend. Decl. Calculation"" = Store.""Tend. Decl. Calculation""::Last THEN BEGIN"										
"TendDeclEntry.SETCURRENTKEY(""Store No."",""POS Terminal No."",""Transaction No."");"										
"TendDeclEntry.SETRANGE(""Store No."",Transaction.""Store No."");"										
"TendDeclEntry.SETRANGE(""POS Terminal No."",Transaction.""POS Terminal No."");"										
"TendDeclEntry.SETRANGE(""Transaction No."",Transaction.""Transaction No."");"										
BufferTendDeclEntry;										
END;										
"TempTendDeclEntry.SETFILTER(""Currency Code"",'=%1','');"										
PrintTenderDeclLines;										
"Transaction.""Gross Amount"" := -LocalTotal;"										
"PrintTotal(Transaction,2,0);"										
"PrintLine(2,'');"										
"TempTendDeclEntry.SETFILTER(""Currency Code"",'<>%1','');"										
PrintTenderDeclLines;										
END;										
										
// Sales and Discount Totals										
"Transaction.SETCURRENTKEY(""Statement Code"",""Z-Report ID"",""Transaction Type"",""Entry Status"");"										
"Transaction.SETRANGE(""Statement Code"",SCode);"										
"Transaction.SETRANGE(""Z-Report ID"",'');"										
"Transaction.SETRANGE(""Transaction Type"",Transaction.""Transaction Type""::Sales);"										
"Transaction.SETFILTER(""Entry Status"",'%1|%2',Transaction.""Entry Status""::"" "",Transaction.""Entry Status""::Posted);"										
//CSPNT281015 IF RunType = RunType::Y THEN										
"//CSPNT281015   Transaction.SETRANGE(""Y-Report ID"",'');"										
"//CSPNT281015Transaction.CALCSUMS(""Gross Amount"",""Discount Amount"",""Total Discount"",Rounded,""No. of Items"",""No. of Covers"");"										
"Transaction.CALCSUMS(""Gross Amount"",""Discount Amount"",""Total Discount"",Rounded,""No. of Items"");"										
										
"IF Transaction.""Entry Status"" <> Transaction.""Entry Status""::Training THEN BEGIN  //LS7.1-09"										
CASE RunType OF										
RunType::Z:										
BEGIN										
ZReportStats.INIT;										
"ZReportStats.""Store No."" := Globals.StoreNo;"										
"ZReportStats.""POS Terminal No."" := Globals.TerminalNo;"										
ZReportStats.Date := TODAY;										
"ZReportStats.""Sales Amount"":= -Transaction.""Gross Amount"" + Transaction.Rounded;"										
ZReportStats.INSERT(TRUE);										
END;										
RunType::Y:										
BEGIN										
YReportStats.INIT;										
"YReportStats.""Store No."" := Globals.StoreNo;"										
"YReportStats.""POS Terminal No."" := Globals.TerminalNo;"										
YReportStats.Date := TODAY;										
"YReportStats.""Sales Amount"":= -Transaction.""Gross Amount"" + Transaction.Rounded;"										
YReportStats.INSERT(TRUE);										
END;										
END;										
END;  //LS7.1-09										
										
//CSPNT210116 Imprimir Linea en blanco...										
"DSTR1 :=     COPYSTR('                     ',1);"										
Value[1] := '';										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
DSTR1 := '#L######################### #R##########';										
//CSPNT220116										
Value[1] := 'Total Medios de Pago:';										
//CSPNT100316										
"Value[2] := POSFunctions.FormatAmount(-Transaction.""Gross Amount"" + Transaction.Rounded + vIVAS);"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
PrintSeperator(2);										
										
DSTR1 := '#L######################### #R##########';										
//CSPNT100316										
"Value[2] := POSFunctions.FormatAmount(-Transaction.""Gross Amount"" + Transaction.""Discount Amount"" + vIVAS);"										
//Value[1] := Text011;										
Value[1] := 'Ventas Brutas:';										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
"Value[2] := POSFunctions.FormatAmount(-Transaction.""Discount Amount"");"										
//Value[1] := Text012;										
Value[1] := 'Descuento';										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//CSPNT191115										
{Value[2] := POSFunctions.FormatAmount(Transaction.Rounded);										
//Value[1] := Text093;										
Value[1] := 'Redondeo';										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));}"										
										
//CSPNT210116PrintSeperator(2);										
//Value[1] := Text027;										
{Value[1] := 'Total Ventas Netas';										
"Value[2] := POSFunctions.FormatAmount(-Transaction.""Gross Amount"" + Transaction.Rounded);"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
}										
"IncExpAccount.SETRANGE(IncExpAccount.""Store No."",Globals.StoreNo);"										
IF IncExpAccount.FIND('-') THEN BEGIN										
"IncExpEntry.SETCURRENTKEY(""Statement Code"",""Z-Report ID"",""No."");"										
"IncExpEntry.SETRANGE(""Statement Code"",SCode);"										
"IncExpEntry.SETRANGE(""Z-Report ID"",'');"										
//CSPNT281015  IF RunType = RunType::Y THEN										
"//CSPNT281015    IncExpEntry.SETRANGE(""Z-Report ID"",'');"										
IF IncExpEntry.FIND('-') THEN BEGIN										
PrintSeperator(2);										
//CSPNT201115										
DSTR1 := '#C######################################';										
Value[1] := 'FONDOS AJENOS';										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
DSTR1 := '#L#############     #R##################';										
Value[1] := 'DESCRIPCI‡N';										
Value[2] := 'MONTO';										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
DSTR1 := '#L########################## #R#########';										
REPEAT										
"IncExpEntry.SETRANGE(""No."",IncExpAccount.""No."");"										
IF IncExpEntry.FIND('-') THEN BEGIN										
Value[1] := IncExpAccount.Description;										
IncExpEntry.CALCSUMS(Amount);										
Value[2] := POSFunctions.FormatAmount(IncExpEntry.Amount);										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
UNTIL IncExpAccount.NEXT = 0;										
END;										
END;										
										
PrintSeperator(2);										
										
//Transaction counting										
IF PaymTrans3.FIND('-') THEN										
REPEAT										
"IF NOT PaymTemp.GET(PaymTrans3.""Store No."",PaymTrans3.""POS Terminal No."",PaymTrans3.""Transaction No."") THEN BEGIN"										
"Transaction2.GET(PaymTrans3.""Store No."",PaymTrans3.""POS Terminal No."",PaymTrans3.""Transaction No."");"										
"IF Transaction2.""Transaction Type"" = Transaction2.""Transaction Type""::Sales THEN"										
RecCount := RecCount + 1;										
"PaymTemp.""Store No."" := PaymTrans3.""Store No."";"										
"PaymTemp.""POS Terminal No."" := PaymTrans3.""POS Terminal No."";"										
"PaymTemp.""Transaction No."" := PaymTrans3.""Transaction No."";"										
PaymTemp.INSERT;										
END;										
UNTIL PaymTrans3.NEXT = 0;										
//Value[1] := Text134 + ':';										
//CSPNT061115										
{Value[1] := 'Clientes que pagaron:';										
Value[2] := FORMAT(RecCount);										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));}"										
										
//Value[1] := Text028;										
Value[1] := 'No. de transacciones:';										
"Value[2] := FORMAT(Transaction.COUNT,0,'<Integer>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//Value[1] := Text029;										
Value[1] := 'Articulos vendidos:';										
"Value[2] := FORMAT(Transaction.""No. of Items"",0,'<Integer>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
"Transaction.SETRANGE(Transaction.""Sale Is Return Sale"",TRUE);"										
//Value[1] := Text030;										
Value[1] := 'No. de devoluciones:';										
"Value[2] := FORMAT(Transaction.COUNT,0,'<Integer>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
"Transaction.SETRANGE(Transaction.""Sale Is Return Sale"");"										
										
"SuspTrans.SETRANGE(""Store No."",Store.""No."");"										
"SuspTrans.SETRANGE(""Entry Status"",SuspTrans.""Entry Status""::Suspended);"										
NoSuspended := SuspTrans.COUNT;										
//Value[1] := Text031;										
Value[1] := 'No. de suspenciones:';										
"Value[2] := FORMAT(NoSuspended,0,'<Integer>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
"SuspTrans.SETRANGE(""Store No."");"										
										
//CSPNT281015										
IF (RunType = RunType::X) AND (NoSuspended > 0) THEN BEGIN										
"IF Terminal.""Print Suspend with Prepayment"" THEN BEGIN"										
NoSuspPrepayment := 0;										
SuspPrepayment := 0;										
										
SuspTransLine.RESET;										
"SuspTransLine.SETCURRENTKEY(""Receipt No."",""Entry Type"",""Entry Status"");"										
"SuspTransLine.SETRANGE(""Entry Type"",SuspTransLine.""Entry Type""::IncomeExpense);"										
IF SuspTransLine.FIND('-') THEN BEGIN										
REPEAT										
"IF (SuspTransLine.""POS Terminal No."" = '0') THEN BEGIN"										
NoSuspPrepayment := NoSuspPrepayment + 1;										
SuspPrepayment := SuspPrepayment + SuspTransLine.Amount;										
END;										
UNTIL SuspTransLine.NEXT = 0;										
END;										
SuspPrepayment := ABS(SuspPrepayment);										
IF (NoSuspPrepayment > 0) THEN BEGIN										
END;										
IF (SuspPrepayment > 0) THEN BEGIN										
END;										
END;										
END;										
										
IF RunType = RunType::Z THEN BEGIN										
"IF Terminal.""Print Suspend with Prepayment"" THEN BEGIN"										
NoSuspPrepayment := 0;										
SuspPrepayment := 0;										
										
SuspTransLine.RESET;										
"SuspTransLine.SETCURRENTKEY(""Receipt No."",""Entry Type"",""Entry Status"");"										
"SuspTransLine.SETRANGE(""Entry Type"",SuspTransLine.""Entry Type""::IncomeExpense);"										
IF SuspTransLine.FIND('-') THEN BEGIN										
REPEAT										
"IF (SuspTransLine.""POS Terminal No."" = '0') THEN BEGIN"										
NoSuspPrepayment := NoSuspPrepayment + 1;										
SuspPrepayment := SuspPrepayment + SuspTransLine.Amount;										
END;										
UNTIL SuspTransLine.NEXT = 0;										
END;										
SuspPrepayment := ABS(SuspPrepayment);										
IF (NoSuspPrepayment > 0) THEN BEGIN										
Value[1] := '  ' + Text154;										
"Value[2] := FORMAT(NoSuspPrepayment,0,'<Integer>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
END;										
IF (SuspPrepayment > 0) THEN BEGIN										
Value[1] := '  ' + Text155;										
Value[2] := POSFunctions.FormatAmount(SuspPrepayment);										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
END;										
END;										
END;										
										
IF RunType = RunType::Y THEN BEGIN										
"IF Terminal.""Print Suspend with Prepayment"" THEN BEGIN"										
NoSuspPrepayment := 0;										
SuspPrepayment := 0;										
										
SuspTransLine.RESET;										
"SuspTransLine.SETCURRENTKEY(""Receipt No."",""Entry Type"",""Entry Status"");"										
"SuspTransLine.SETRANGE(""Entry Type"",SuspTransLine.""Entry Type""::IncomeExpense);"										
IF SuspTransLine.FIND('-') THEN BEGIN										
REPEAT										
"IF (SuspTransLine.""POS Terminal No."" = '0') THEN BEGIN"										
NoSuspPrepayment := NoSuspPrepayment + 1;										
SuspPrepayment := SuspPrepayment + SuspTransLine.Amount;										
END;										
UNTIL SuspTransLine.NEXT = 0;										
END;										
SuspPrepayment := ABS(SuspPrepayment);										
IF (NoSuspPrepayment > 0) THEN BEGIN										
Value[1] := '  ' + Text154;										
"Value[2] := FORMAT(NoSuspPrepayment,0,'<Integer>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
END;										
IF (SuspPrepayment > 0) THEN BEGIN										
Value[1] := '  ' + Text155;										
Value[2] := POSFunctions.FormatAmount(SuspPrepayment);										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
END;										
END;										
END;										
										
"Transaction.SETRANGE(""Entry Status"",Transaction.""Entry Status""::Voided);"										
//Value[1] := Text032;										
Value[1] := 'No. de anulaciones:';										
"Value[2] := FORMAT(Transaction.COUNT,0,'<Integer>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
IF gNoSuspPOSTransactionsVoided <> 0 THEN BEGIN										
Value[1] := '  ' + Text230;										
"Value[2] := FORMAT(gNoSuspPOSTransactionsVoided,0,'<Integer>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
END;										
										
"Transaction.SETRANGE(""Entry Status"",Transaction.""Entry Status""::Training);"										
//CSPNT281015Value[1] := Text034;										
"//CSPNT281015Value[2] := FORMAT(Transaction.COUNT,0,'<Integer>');"										
"//CSPNT281015PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
"Transaction.SETRANGE(""Entry Status"");"										
										
"Transaction.SETFILTER(""Transaction Type"",'%1|%2',"										
"Transaction.""Transaction Type""::Sales,Transaction.""Transaction Type""::""Open Drawer"");"										
"Transaction.SETRANGE(""Open Drawer"",TRUE);"										
//CSPNT281015Value[1] := Text037;										
"//CSPNT281015Value[2] := FORMAT(Transaction.COUNT,0,'<Integer>');"										
"//CSPNT281015PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
"Transaction.SETRANGE(""Open Drawer"");"										
										
"Transaction.SETRANGE(""Transaction Type"",Transaction.""Transaction Type""::Logon);"										
//CSPNT281015Value[1] := Text139;										
"//CSPNT281015 Value[2] := FORMAT(Transaction.COUNT,0,'<Integer>');"										
"//CSPNT281015PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
"Transaction.SETRANGE(""Transaction Type"");"										
										
"IF Transaction.""No. of Covers"" <> 0 THEN BEGIN"										
Value[1] := Text235;										
"Value[2] := FORMAT(Transaction.""No. of Covers"",0,'<Integer>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
										
"Transaction.SETFILTER(""Split Number"",'<>%1',0);"										
NoSplitTrans := Transaction.COUNT;										
Value[1] := Text236;										
"Value[2] := FORMAT(NoSplitTrans,0,'<Integer>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
"Transaction.SETRANGE(""Split Number"");"										
										
NoTables:= RecCount - NoSplitTrans;										
										
Value[1] := Text237;										
"Value[2] := FORMAT(Transaction.""No. of Covers""/NoTables,0,'<Integer>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
										
Value[1] := Text238;										
"Value[2] := FORMAT(RecCount/NoTables,0,'<Integer>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
END;										
										
IF WHBatchQueue.COUNT > 0 THEN BEGIN										
Value[1] := lText004;										
"Value[2] := FORMAT(WHBatchQueue.COUNT,0,'<Integer>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
END;										
										
										
IF RunType = RunType::Z THEN BEGIN										
"IF Terminal.""Statement Method"" = Terminal.""Statement Method""::""POS Terminal"" THEN BEGIN"										
"IF Terminal.""Last Z-Report"" <> '' THEN"										
"Terminal.""Last Z-Report"" := INCSTR(Terminal.""Last Z-Report"")"										
ELSE										
"Terminal.""Last Z-Report"" :='T000000001';"										
"ZReportID := Terminal.""Last Z-Report"";"										
END ELSE BEGIN										
"IF Staff.""Last Z-Report"" <> '' THEN"										
"Staff.""Last Z-Report"" := INCSTR(Staff.""Last Z-Report"")"										
ELSE										
"Staff.""Last Z-Report"" :='S000000001';"										
"ZReportID := Staff.""Last Z-Report"";"										
END;										
//CSPNT160516  IF (Globals.GetValue('TS_ERROR') <> '') THEN										
"//CSPNT160516    ZReportID := 'X' + COPYSTR(ZReportID,2);"										
//CSPNT271015  PrintSeperator(2);										
"//CSPNT271015  PrintLine(2,Text116 + ZReportID);"										
PrintSeperator(2);										
END;										
										
IF RunType = RunType::Y THEN BEGIN										
"IF Terminal.""Statement Method"" = Terminal.""Statement Method""::""POS Terminal"" THEN BEGIN"										
"IF Terminal.""Last Y-Report"" <> '' THEN"										
"Terminal.""Last Y-Report"" := INCSTR(Terminal.""Last Y-Report"")"										
ELSE										
"Terminal.""Last Y-Report"" :='T000000001';"										
"YReportID := Terminal.""Last Y-Report"";"										
END ELSE BEGIN										
"IF Staff.""Last Y-Report"" <> '' THEN"										
"Staff.""Last Y-Report"" := INCSTR(Staff.""Last Y-Report"")"										
ELSE										
"Staff.""Last Y-Report"" :='S000000001';"										
"YReportID := Staff.""Last Y-Report"";"										
END;										
IF (Globals.GetValue('TS_ERROR') <> '') THEN										
"YReportID := 'X' + COPYSTR(YReportID,2);"										
PrintSeperator(2);										
"PrintLine(2,Text117 + YReportID);"										
PrintSeperator(2);										
END;										
										
										
IF RunType = RunType::X THEN BEGIN										
"IF GenPosFunc.""TS Send Transactions"" AND (GenPosFunc.""Send Transaction"" <> '') THEN BEGIN"										
TransServerWorkTable.RESET;										
"TransServerWorkTable.SETRANGE(Table,DATABASE::""Transaction Header"");"										
"TransServerWorkTable.SETRANGE(""Store No."",Globals.StoreNo);"										
"TransServerWorkTable.SETRANGE(""POS Terminal No."",Globals.TerminalNo);"										
TransNotSent := TransServerWorkTable.COUNT;										
IF TransNotSent > 0 THEN BEGIN										
PrintSeperator(2);										
CLEAR(Value);										
DSTR1 := '#L######################################';										
Value[1] := Text153;										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
"Value[1] := STRSUBSTNO(Text161,TransNotSent);"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
PrintSeperator(2);										
END;										
END;										
END;										
										
//CSPNT130116										
{IF (RunType = RunType::Z) OR (RunType = RunType::Y) THEN BEGIN										
DSTR1 := '#L##################### #R##############';										
//  Value[1] := Text035;										
Value[1] := 'Ventas Netas Acumuladas:';										
										
IF RunType = RunType::Y THEN										
"Value[2] := POSFunctions.FormatAmount(YReportStats.""Cumulative Sales Amount"")"										
ELSE										
"Value[2] := POSFunctions.FormatAmount(ZReportStats.""Cumulative Sales Amount"");"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//Count not z-printed entries in the database										
"Transaction2.SETCURRENTKEY(""Statement Code"",""Z-Report ID"",""Transaction Type"",""Entry Status"");"										
"Transaction2.SETFILTER(""Statement Code"",'<>%1',SCode);"										
"Transaction2.SETRANGE(""Z-Report ID"",'');"										
"Transaction2.SETRANGE(""Transaction Type"",Transaction.""Transaction Type""::Sales);"										
"Transaction2.SETFILTER(""Entry Status"",'%1|%2',Transaction.""Entry Status""::"" "",Transaction.""Entry Status""::Posted);"										
IF RunType = RunType::Y THEN										
"Transaction2.SETRANGE(""Y-Report ID"",'');"										
IF Transaction2.FIND('-') THEN BEGIN										
Value[1] := lText001;										
"Value[2] := FORMAT(Transaction2.COUNT,0,'<Integer>');"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
OldestDate := Transaction2.Date;										
REPEAT										
IF Transaction2.Date < OldestDate THEN										
OldestDate := Transaction2.Date;										
UNTIL Transaction2.NEXT = 0;										
Value[1] := lText002;										
Value[2] := FORMAT(OldestDate);										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
										
"Transaction2.CALCSUMS(""Gross Amount"",""Discount Amount"",""Total Discount"",Rounded,""No. of Items"");"										
Value[1] := lText003;										
"Value[2] := POSFunctions.FormatAmount(-Transaction2.""Gross Amount"" + Transaction2.Rounded);"										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
END;										
Transaction2.RESET;										
PrintSeperator(2);										
END;										
}										
IF NOT ClosePrinter(2) THEN										
EXIT(FALSE);										
										
//LS7.1-09-										
"IF Transaction.""Entry Status"" = Transaction.""Entry Status""::Training THEN"										
EXIT(TRUE);										
//LS7.1-09+										
										
//Mark every entry included in the report with Z or Y report code.										
IF (RunType = RunType::Z) OR (RunType = RunType::Y) THEN BEGIN										
"IF Terminal.""Statement Method"" = Terminal.""Statement Method""::""POS Terminal"" THEN"										
Terminal.MODIFY										
ELSE BEGIN										
Staff.MODIFY;										
END;										
										
"PaymEntry.SETRANGE(""Currency Code"");"										
"PaymEntry.SETRANGE(""Card No."");"										
"PaymEntry.SETRANGE(""Tender Type"");"										
IF PaymEntry.FIND('-') THEN REPEAT										
PaymTrans2 := PaymEntry;										
//CSPNT281015    IF RunType = RunType::Y THEN										
"//CSPNT281015      PaymTrans2.""Y-Report ID"" := YReportID"										
//CSPNT281015    ELSE										
"PaymTrans2.""Z-Report ID"" := ZReportID;"										
PaymTrans2.MODIFY(TRUE);										
UNTIL PaymEntry.NEXT = 0;										
										
CLEAR(TendDeclEntry);										
"TendDeclEntry.SETCURRENTKEY(""Statement Code"",""Z-Report ID"",""Tender Type"",""Currency Code"",""Card No."");"										
"TendDeclEntry.SETRANGE(""Statement Code"",SCode);"										
"TendDeclEntry.SETRANGE(""Z-Report ID"",'');"										
//CSPNT281015  IF RunType = RunType::Y THEN										
"//CSPNT281015    TendDeclEntry.SETRANGE(""Y-Report ID"",'');"										
IF TendDeclEntry.FIND('-') THEN REPEAT										
TendDeclEntry2 :=  TendDeclEntry;										
//CSPNT281015    IF RunType = RunType::Y THEN										
"//CSPNT281015      TendDeclEntry2.""Y-Report ID"" := YReportID"										
//CSPNT281015    ELSE										
"TendDeclEntry2.""Z-Report ID"" := ZReportID;"										
TendDeclEntry2.MODIFY(TRUE);										
UNTIL TendDeclEntry.NEXT=0;										
										
CLEAR(IncExpEntry);										
"IncExpEntry.SETCURRENTKEY(""Statement Code"",""Z-Report ID"");"										
"IncExpEntry.SETRANGE(""Statement Code"",SCode);"										
"IncExpEntry.SETRANGE(""Z-Report ID"",'');"										
//CSPNT281015  IF RunType = RunType::Y THEN										
"//CSPNT281015    IncExpEntry.SETRANGE(""Y-Report ID"",'');"										
IF IncExpEntry.FIND('-') THEN REPEAT										
IncExpEntry2 := IncExpEntry;										
"IncExpEntry2.""Z-Report ID"" := ZReportID;"										
IncExpEntry2.MODIFY(TRUE);										
UNTIL IncExpEntry.NEXT = 0;										
										
IF Transaction.FIND('-') THEN REPEAT										
//CSPNT281015    Transaction2 := Transaction;										
//CSPNT281015    IF RunType = RunType::Y THEN										
"//CSPNT281015      Transaction2.""Y-Report ID"" := YReportID"										
//CSPNT281015    ELSE										
"//CSPNT281015      Transaction2.""Z-Report ID"" := ZReportID;"										
//CSPNT281015    Transaction2.MODIFY(TRUE);										
Transaction3 := Transaction;										
"Transaction3.""Z-Report ID"" := ZReportID;"										
"Transaction3.""Correlativo Reporte-Z"" := NoCorrelativoXZ; //CONSISA PARA GUARDAR EL CORRELATIVO FISCAL EN EL TRANS. HEADER."										
Transaction3.MODIFY(TRUE);										
UNTIL Transaction.NEXT = 0;										
										
IF RunType = RunType::Y THEN BEGIN										
"YReportStats.""Y-Report Id"" := YReportID;"										
YReportStats.MODIFY(TRUE);										
"Globals.SetValue('LAST_YID',YReportID);"										
END										
ELSE BEGIN										
"ZReportStats.""Z-Report Id"" := ZReportID;"										
ZReportStats.MODIFY(TRUE);										
"Globals.SetValue('LAST_ZID',ZReportID);"										
END;										
										
//CSPNT281015										
ZReportHist.INIT;										
"ZReportHist.""Store No.""           := Store.""No."";"										
"ZReportHist.""POS Terminal No.""    := Terminal.""No."";"										
"ZReportHist.""Z-Report ID""         := ZReportID;"										
"ZReportHist.""Correlativo Fiscal""  := NoCorrelativoXZ;"										
ZReportHist.Fecha                 := TODAY;										
ZReportHist.Hora                  := TIME;										
ZReportHist.INSERT;										
COMMIT;     //CSRG01										
										
//CSPNT150416  PAGE.RUNMODAL(50001);										
"SaveRolloAuditor(TODAY,ZReportID);"										
END;										
//CSPNT281015										
IF RunType = RunType::X THEN BEGIN										
"Terminal.""Last X-Report"" := INCSTR(Terminal.""Last X-Report"");"										
Terminal.MODIFY;										
END;										
										
EXIT(TRUE);										
END;										
										
PROCEDURE PrintLineRemision@1000000028(Tray@1000000001 : Integer;PrintSep@1000000002 : Boolean;Information@1000000000 : Text[100];Am	oun	t@1	0	0	0005 : Decimal);					
VAR										
DSTR@1000000003 : Text[100];										
InfoText@1000000004 : Text[100];										
BEGIN										
// CONSISA FASANI Creditos Padre Hijo										
// Impresion de InfoCode TXTFACT para notas de remision										
DSTR := '            #L####################################  #R####                     #R######';										
// Imprimir la linea de remision										
"Value[1] := COPYSTR(Information,1,38);"										
Value[2] := POSFunctions.FormatAmount(-Amount);										
Value[3] := POSFunctions.FormatAmount(-Amount)+'G';										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR),FALSE,FALSE,FALSE,FALSE));"										
"AddPrintLine(350,2,NodeName,Value,DSTR,FALSE,FALSE,FALSE,FALSE,Tray); //LS7.1-02"										
IF PrintSep THEN										
"PrintLine(Tray,'');"										
END;										
										
PROCEDURE Num2Text@1000000029(Value@1000000000 : Decimal) : Text[100];										
BEGIN										
"FormatNoText1(Texto,ABS(Value));"										
EXIT(TotFac + vDecimalesTextoFactura);										
END;										
										
PROCEDURE PrintSeperatorVIP@1000000033(Tray@1000 : Integer);										
VAR										
LineLength@1001 : Integer;										
DSTR1@1002 : Text[50];										
BEGIN										
//PrintSeperator										
IF Tray = 2 THEN										
LineLength := LineLen										
ELSE IF Tray = 4 THEN										
LineLength := InvLineLen;										
										
"DSTR1 := '#C' + StringPad('#',LineLength - 2);"										
"Value[1] := StringPad('=',LineLength);"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
										
PROCEDURE PrintComprobanteVIP@1000000030(VAR MemberNo@1000000003 : Code[100];Tray@1000000002 : Integer;Recpt@1000000030 : Code[20])	: B	ool	ea	n;						
VAR										
rCompanyInfo@1000000004 : Record 79;										
DSTR1@1000000005 : Text[100];										
MemberCard@1000000006 : Record 99009003;										
MemberContact@1000000007 : Record 99009002;										
Espacio@1000000008 : Integer;										
Print@1000000000 : Boolean;										
PosTrans@1000000001 : Record 99008980;										
NoSeries@1000000009 : Codeunit 396;										
Correlativo@1000000010 : Code[20];										
TemaTicket@1000000011 : TextConst 'ENU=COMPROBANTE DE AFILIACION VIP;ESP=COMPROBANTE DE AFILIACION VIP;ESM=COMPROBANTE DE AFILIACI	ON	VIP	';							
TarjetaVip@1000000012 : TextConst 'ENU=TARJETA VIP;ESP=TARJETA VIP;ESM=TARJETA VIP';										
NoTarjeta@1000000013 : TextConst 'ENU=TARJETA VIP #:;ESP=TARJETA VIP #:;ESM=TARJETA VIP #:';										
Correl@1000000014 : TextConst 'ENU=CORRELATIVO VIP:;ESP=CORRELATIVO VIP:;ESM=CORRELATIVO VIP:';										
Desde@1000000015 : TextConst 'ENU=VIGENCIA DESDE:;ESP=VIGENCIA DESDE:;ESM=VIGENCIA DESDE:';										
Hasta@1000000016 : TextConst 'ENU=VIGENCIA HASTA:;ESP=VIGENCIA HASTA:;ESM=VIGENCIA HASTA:';										
"Titular@1000000017 : TextConst 'ENU=""TITULAR: "";ESP=""TITULAR: "";ESM=""TITULAR: ""';"										
FechNac@1000000018 : TextConst 'ENU=FECHA NACIMIENTO:;ESP=FECHA NACIMIENTO:;ESM=FECHA NACIMIENTO:';										
NoDui@1000000019 : TextConst 'ENU=DUI:;ESP=DUI:;ESM=DUI:';										
"Benef@1000000020 : TextConst 'ENU=""BENEFICIARIO: "";ESP=""BENEFICIARIO: "";ESM=""BENEFICIARIO: ""';"										
Firma@1000000022 : TextConst 'ENU=FIRMA TITULAR:;ESP=FIRMA TITULAR:;ESM=FIRMA TITULAR:';										
Comprob@1000000023 : TextConst 'ENU=COMPROBANTE FARMACIA CON AYUDA;ESP=COMPROBANTE FARMACIA CON AYUDA;ESM=COMPROBANTE FARMACIA CON	AY	UDA	';							
Econo@1000000024 : TextConst 'ENU=ECONOMICA POR ACCIDENTE;ESP=ECONOMICA POR ACCIDENTE;ESM=ECONOMICA POR ACCIDENTE';										
Aplica@1000000025 : TextConst 'ENU=APLICA AYUDA ECONOMICA PARA;ESP=APLICA AYUDA ECONOMICA PARA;ESM=APLICA AYUDA ECONOMICA PARA';										
Personas@1000000026 : TextConst 'ENU=PERSONAS ENTRE 18 Y 80 A•OS;ESP=PERSONAS ENTRE 18 Y 80 A•OS;ESM=PERSONAS ENTRE 18 Y 80 A•OS';										
Sucursal@1000000021 : TextConst 'ENU=SUCURSAL:;ESP=SUCURSAL:;ESM=SUCURSAL:';										
Usuario@1000000027 : TextConst 'ENU=USUARIO:;ESP=USUARIO:;ESM=USUARIO:';										
Caja@1000000028 : TextConst 'ENU=CAJA:;ESP=CAJA:;ESM=CAJA:';										
Fecha@1000000029 : TextConst 'ENU=FECHA:;ESP=FECHA:;ESM=FECHA:';										
TransHead@1000000031 : Record 99001472;										
BEGIN										
//CSLM180116 IMPRESION DE TICKET DE AFILIACION VIP										
"IF NOT OpenReceiptPrinter(2, 'TENDER', 'PRINTVIP_TICKET', 0, '') THEN"										
EXIT(FALSE);										
										
PrintSeperatorVIP(2);										
IF Tray = 2 THEN BEGIN										
//CSLM180116 IMPRIMIR EL NOMBRE DE LA EMPRESA										
rCompanyInfo.GET();										
"DSTR1 :=     COPYSTR('#C######################################',1);"										
Value[1] := rCompanyInfo.Name;										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
"DSTR1 :=     COPYSTR('#C######################################',1);"										
Value[1] := TemaTicket;										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
"DSTR1 :=     COPYSTR('#C######################################',1);"										
Value[1] := TarjetaVip;										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
PrintSeperatorVIP(2);										
//OBTENER LOS DATOS DEL CLIENTE AFILIADO A LA TARJETA VIP										
MemberCard.RESET;										
"MemberCard.SETRANGE(""Card No."",MemberNo);"										
IF MemberCard.FINDFIRST THEN BEGIN										
IF MemberCard.Status = MemberCard.Status::Active THEN BEGIN										
//NUMERO DE TARJETA VIP										
"DSTR1 :=     COPYSTR('#L######################################',1);"										
"Value[1] := NoTarjeta + MemberCard.""Card No."";"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
//CORRELATIVO GENERADO										
"Correlativo := NoSeries.GetNextNo('VIP-TICKET',TODAY,TRUE);"										
"DSTR1 :=     COPYSTR('#L######################################',1);"										
Value[1] := Correl +  Correlativo;										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//VIGENCIA VIP										
"DSTR1 :=     COPYSTR('#L######################################',1);"										
"Value[1] := Desde+ FORMAT(MemberCard.""Date Created"");"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
"DSTR1 :=     COPYSTR('#L######################################',1);"										
"Value[1] := Hasta+ FORMAT(MemberCard.""Last Valid Date"");"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
MemberContact.RESET;										
"MemberContact.SETRANGE(MemberContact.""Account No."",MemberCard.""Contact No."");"										
IF MemberContact.FINDFIRST THEN BEGIN										
//DATOS DEL CLIENTE										
"DSTR1 :=     COPYSTR('#L################',1);"										
Value[1] := Titular;										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
"DSTR1 :=     COPYSTR('#L######################################',1);"										
Value[1] := MemberContact.Name;										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
"DSTR1 :=     COPYSTR('#L######################################',1);"										
"Value[1] := FechNac + FORMAT(MemberContact.""Date of Birth"");"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
										
"DSTR1 :=     COPYSTR('#L######################################',1);"										
"Value[1] := NoDui + MemberCard.""Account No."";"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
"DSTR1 :=     COPYSTR('#L################',1);"										
Value[1] := Benef;										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
"DSTR1 :=     COPYSTR('#L######################################',1);"										
Value[1] := MemberCard.Beneficiario;										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
FOR Espacio := 1 TO 4 DO BEGIN										
"DSTR1 :=     COPYSTR('                     ',1);"										
Value[1] := '';										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
										
//ESPACIO PARA LA FIRMA										
"DSTR1 :=     COPYSTR('#C######################################',1);"										
Value[1] := '-------------------------------';										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
"DSTR1 :=     COPYSTR('#C######################################',1);"										
Value[1] := Firma;										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
"DSTR1 :=     COPYSTR('                     ',1);"										
Value[1] := '';										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
PrintSeperatorVIP(2);										
//DATOS COMPLEMENTARIOS DEL TICKET										
"DSTR1 :=     COPYSTR('#C######################################',1);"										
Value[1] := Comprob;										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
"DSTR1 :=     COPYSTR('#C######################################',1);"										
Value[1] := Econo;										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
"DSTR1 :=     COPYSTR('#C######################################',1);"										
Value[1] := Aplica;										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
"DSTR1 :=     COPYSTR('#C######################################',1);"										
Value[1] := Personas;										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
"DSTR1 :=     COPYSTR('                     ',1);"										
Value[1] := '';										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
PosTrans.RESET;										
"PosTrans.SETRANGE(PosTrans.""Member Card No."",MemberNo);"										
IF PosTrans.FINDFIRST THEN BEGIN										
//IMPRIMIR EL NOMBRE DE LA SUCURSAL										
"DSTR1 :=     COPYSTR('#L######################################',1);"										
"Value[1] := Sucursal + PosTrans.""Store No."";"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
//USUARIO QUE ATIENDE										
"DSTR1 :=     COPYSTR('#L######################################',1);"										
"Value[1] := Usuario + PosTrans.""Staff ID"";"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
//NUMERO DE LA CAJA										
"DSTR1 :=     COPYSTR('#L######################################',1);"										
"Value[1] := Caja + PosTrans.""POS Terminal No."";"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
//NUMERO DE DOCUMENTO										
"DSTR1 :=     COPYSTR('#L######################################',1);"										
"Value[1] := 'DOCUMENTO:'+ MemberCard.""Documento de compra"";"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//FECHA DE LA IMPRESION										
"DSTR1 :=     COPYSTR('#L######################################',1);"										
Value[1] := Fecha+ FORMAT(TODAY);										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END										
ELSE BEGIN										
TransHead.RESET;										
"TransHead.SETRANGE(TransHead.""Receipt No."",Recpt);"										
IF TransHead.FINDFIRST THEN BEGIN										
//IMPRIMIR EL NOMBRE DE LA SUCURSAL										
"DSTR1 :=     COPYSTR('#L######################################',1);"										
"Value[1] := Sucursal + TransHead.""Store No."";"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
//USUARIO QUE ATIENDE										
"DSTR1 :=     COPYSTR('#L######################################',1);"										
"Value[1] := Usuario + TransHead.""Staff ID"";"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
//NUMERO DE LA CAJA										
"DSTR1 :=     COPYSTR('#L######################################',1);"										
"Value[1] := Caja + TransHead.""POS Terminal No."";"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
//NUMERO DE DOCUMENTO										
"DSTR1 :=     COPYSTR('#L######################################',1);"										
Value[1] := 'DOCUMENTO:'+TransHead.NCF;										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
//FECHA DE LA IMPRESION										
"DSTR1 :=     COPYSTR('#L######################################',1);"										
Value[1] := Fecha+ FORMAT(TODAY);										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
//CSPNT250616										
END;										
END;										
//CSPNT250616										
TransHead.RESET;										
"TransHead.SETRANGE(""Receipt No."",Recpt);"										
IF TransHead.FINDFIRST THEN BEGIN										
"MemberCard.""Documento de compra"" := TransHead.NCF;"										
MemberCard.MODIFY(TRUE);										
COMMIT;										
END;										
										
END;										
END;										
IF NOT ClosePrinter(2) THEN										
EXIT(FALSE);										
END;										
END;										
										
PROCEDURE PRINTROLLO1@1000000032(RANGO1@1000000000 : Text;RANGO2@1000000001 : Text) : Boolean;										
VAR										
PRINTCOPY@1000000002 : Record 50002;										
DSTR1@1000000003 : Text[100];										
BEGIN										
										
"IF NOT OpenReceiptPrinter(2, 'TENDER', 'ZXREPORT', 0, '') THEN"										
EXIT(FALSE);										
										
										
										
PRINTCOPY.RESET;										
"PRINTCOPY.SETFILTER(ZX,'=%1','Z');"										
										
IF PRINTCOPY.FINDFIRST THEN										
REPEAT										
										
DSTR1 :=     '#L#########################################';										
"Value[1] := PRINTCOPY.""Line Printed"";"										
										
"PrintLine(2,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
										
UNTIL PRINTCOPY.NEXT = 0;										
										
										
										
										
										
IF NOT ClosePrinter(2) THEN										
EXIT(FALSE);										
END;										
										
PROCEDURE PrintDriverSalesInfo@1000000035(POSTransaction@1000000000 : Record 99008980;Tray@1000000001 : Integer;SplitNumber@10000000	2	: I	nt	ege	r);					
VAR										
xStore@1000000003 : Record 99001470;										
DSTR1@1000000004 : Text[100];										
xInfoCodeEntry@1000000005 : Record 99008982;										
xDireccion@1000000006 : Text[250];										
xStaff@1000000007 : Record 99001461;										
xPosTrLines@1000000008 : Record 99008981;										
xItem@1000000009 : Record 27;										
rDeliveryOrder@1000000010 : Record 10001218;										
BEGIN										
										
CLEAR(Value);										
DSTR1 := '#L######################################';										
										
// Pedido										
"Value[1] := 'PEDIDO: ' + COPYSTR(POSTransaction.""Receipt No."", 11);"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
"AddPrintLine(200,2,NodeName,Value,DSTR1,FALSE,FALSE,FALSE,FALSE,Tray); //LS7.1-02"										
										
// Linea de Farmacia										
"IF xStore.GET(POSTransaction.""Store No."") THEN"										
Value[1] := 'FASANI: ' + xStore.Name										
ELSE										
Value[1] := 'FASANI: ____________________';										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
"AddPrintLine(200,2,NodeName,Value,DSTR1,FALSE,FALSE,FALSE,FALSE,Tray); //LS7.1-02"										
										
// Linea de Cliente										
"Value[1] := 'Cliente ID: ' + POSTransaction.""Sell-to Contact No."";"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
"AddPrintLine(200,2,NodeName,Value,DSTR1,FALSE,FALSE,FALSE,FALSE,Tray); //LS7.1-02"										
										
// Nombre de Cliente										
"Value[1] := 'Cliente: ' + COPYSTR(POSTransaction.Comment, 1, 31);"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
"AddPrintLine(200,2,NodeName,Value,DSTR1,FALSE,FALSE,FALSE,FALSE,Tray); //LS7.1-02"										
										
// Direccion de Entrega										
CLEAR(xInfoCodeEntry);										
"xInfoCodeEntry.SETRANGE(""Receipt No."", POSTransaction.""Receipt No."");"										
"xInfoCodeEntry.SETRANGE(Infocode, 'DDIRECTION');"										
IF xInfoCodeEntry.FIND('-') THEN										
xDireccion := xInfoCodeEntry.Information										
ELSE										
xDireccion := '________________________________________________________________________________';										
// Imprimir direccion fragmentada:										
"Value[1] := 'Direccion: ' + COPYSTR(xDireccion, 1, 29);"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
"AddPrintLine(200,2,NodeName,Value,DSTR1,FALSE,FALSE,FALSE,FALSE,Tray); //LS7.1-02"										
										
"Value[1] := '   ' + COPYSTR(xDireccion, 30, 67);"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
"AddPrintLine(200,2,NodeName,Value,DSTR1,FALSE,FALSE,FALSE,FALSE,Tray); //LS7.1-02"										
										
"Value[1] := '   ' + COPYSTR(xDireccion, 68, 105);"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
"AddPrintLine(200,2,NodeName,Value,DSTR1,FALSE,FALSE,FALSE,FALSE,Tray); //LS7.1-02"										
										
//CSPNT140716										
"Value[1] := '   ' + COPYSTR(xDireccion, 106, 143);"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
"AddPrintLine(200,2,NodeName,Value,DSTR1,FALSE,FALSE,FALSE,FALSE,Tray); //LS7.1-02"										
"Value[1] := '   ' + COPYSTR(xDireccion, 144, 181);"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
"AddPrintLine(200,2,NodeName,Value,DSTR1,FALSE,FALSE,FALSE,FALSE,Tray); //LS7.1-02"										
"Value[1] := '   ' + COPYSTR(xDireccion, 182, 219);"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
"AddPrintLine(200,2,NodeName,Value,DSTR1,FALSE,FALSE,FALSE,FALSE,Tray); //LS7.1-02"										
"Value[1] := '   ' + COPYSTR(xDireccion, 220, 257);"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
"AddPrintLine(200,2,NodeName,Value,DSTR1,FALSE,FALSE,FALSE,FALSE,Tray); //LS7.1-02"										
										
//CSPNT240516										
rDeliveryOrder.RESET;										
"rDeliveryOrder.SETRANGE(""Order No."", POSTransaction.""Receipt No."");"										
IF rDeliveryOrder.FINDFIRST THEN BEGIN										
//CSPNT040616										
IF rDeliveryOrder.Address <> '' THEN BEGIN										
"Value[1] := 'Calle/Colonia: ' + COPYSTR(rDeliveryOrder.Address,3);"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
IF rDeliveryOrder.Grid <> '' THEN BEGIN										
Value[1] := 'Zona: ' + rDeliveryOrder.Grid;										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
										
END;										
										
										
// Caja y Vendedor										
DSTR1 := 'CAJA: 999 VENDEDOR: 12345678901234567890';										
DSTR1 := '#L####### #L############################';										
"Value[1] := 'Caja: ' + COPYSTR(POSTransaction.""POS Terminal No."", 5, 3);"										
"IF xStaff.GET(POSTransaction.""Staff ID"") THEN"										
"Value[2] := 'Vendedor: ' + COPYSTR(xStaff.""Name on Receipt"", 1, 20)"										
ELSE										
Value[2] := 'Vendedor: ' + '____________________';										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
"AddPrintLine(200,2,NodeName,Value,DSTR1,FALSE,FALSE,FALSE,FALSE,Tray); //LS7.1-02"										
										
PrintSeperator(Tray);										
										
DSTR1 := '#L######################################';										
CLEAR(xPosTrLines);										
"xPosTrLines.SETRANGE(""Receipt No."", POSTransaction.""Receipt No."");"										
"xPosTrLines.SETRANGE(""Entry Type"", xPosTrLines.""Entry Type""::Item);"										
"xPosTrLines.SETFILTER(""Entry Status"", '<>%1',  xPosTrLines.""Entry Status""::Voided); //CSMQ300416 Ignora las voided"										
IF xPosTrLines.FIND('-') THEN REPEAT										
IF xItem.GET(xPosTrLines.Number) THEN BEGIN										
DSTR1 := '#L######################################';										
"Value[1] := '*** ' + COPYSTR(xItem.""Attrib 1 Code"", 1, 30) + ' ***';"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
"AddPrintLine(200,2,NodeName,Value,DSTR1,FALSE,FALSE,FALSE,FALSE,Tray); //LS7.1-02"										
DSTR1 := '#L# #L##################################';										
Value[1] := FORMAT(xPosTrLines.Quantity);										
"//CSPNT240616    Value[2] := COPYSTR(xItem.Description, 1, 36);"										
"IF (xPosTrLines.""Barcode No."" <> '') THEN BEGIN"										
"IF rBarras.GET(xPosTrLines.""Barcode No."") THEN"										
"Value[2] := COPYSTR(rBarras.Description,1,35)"										
ELSE										
"Value[2] := COPYSTR(xItem.Description,1,35);"										
END										
ELSE BEGIN										
"Value[2] := COPYSTR(xItem.Description,1,35);"										
END;										
										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
"AddPrintLine(200,2,NodeName,Value,DSTR1,FALSE,FALSE,FALSE,FALSE,Tray); //LS7.1-02"										
DSTR1 := 'PLU:1234567 1234567890123456789012345678';										
DSTR1 := '#L######### #L##########################';										
Value[1] := 'PLU:' + xPosTrLines.Number;										
"Value[2] := xPosTrLines.""Unit of Measure"";"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
"AddPrintLine(200,2,NodeName,Value,DSTR1,FALSE,FALSE,FALSE,FALSE,Tray); //LS7.1-02"										
END;										
UNTIL xPosTrLines.NEXT = 0;										
										
PrintSeperator(Tray);										
										
CLEAR(xPosTrLines);										
"xPosTrLines.SETRANGE(""Receipt No."", POSTransaction.""Receipt No."");"										
"xPosTrLines.SETRANGE(""Entry Type"", xPosTrLines.""Entry Type""::FreeText);"										
IF xPosTrLines.FIND('-') THEN REPEAT										
DSTR1 := '#L######################################';										
"Value[1] := COPYSTR(xPosTrLines.Description, 1, 40);"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
"AddPrintLine(200,2,NodeName,Value,DSTR1,FALSE,FALSE,FALSE,FALSE,Tray); //LS7.1-02"										
										
IF STRLEN(xPosTrLines.Description) > 40 THEN BEGIN										
"Value[1] := '   ' + COPYSTR(xPosTrLines.Description, 41, 37);"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
"AddPrintLine(200,2,NodeName,Value,DSTR1,FALSE,FALSE,FALSE,FALSE,Tray); //LS7.1-02"										
END;										
										
IF STRLEN(xPosTrLines.Description) > 77 THEN BEGIN										
"Value[1] := '   ' + COPYSTR(xPosTrLines.Description, 78);"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
"AddPrintLine(200,2,NodeName,Value,DSTR1,FALSE,FALSE,FALSE,FALSE,Tray); //LS7.1-02"										
END;										
UNTIL xPosTrLines.NEXT = 0;										
										
PrintSeperator(Tray);										
										
DSTR1 := '#L######################################';										
"Value[1] := 'Fecha: ' + FORMAT(WORKDATE, 10, '<Day,2>/<Month,2>/<Year4>') + ' ' + FORMAT(TIME, 14, '<Hours12>:<Minutes,2>:<Seconds"	",2>"	<A	M/	PM>	');					
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
"AddPrintLine(200,2,NodeName,Value,DSTR1,FALSE,FALSE,FALSE,FALSE,Tray); //LS7.1-02"										
										
Value[1] := '';										
Value[2] := '';										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
"AddPrintLine(200,2,NodeName,Value,DSTR1,FALSE,FALSE,FALSE,FALSE,Tray); //LS7.1-02"										
END;										
										
PROCEDURE PrintCardVoucher@1000000037(Tarjeta@1000000000 : Record 99008987);										
VAR										
Tray@1000000001 : Integer;										
rCompanyInfo@1000000002 : Record 79;										
DSTR1@1000000003 : Text[100];										
BEGIN										
										
//CSPNT060416										
Tray := 2;										
										
rCompanyInfo.GET();										
"DSTR1 :=     COPYSTR('#C######################################',1);"										
Value[1] := rCompanyInfo.Name;										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
"DSTR1 :=     COPYSTR('#C######################################',1);"										
Value[1] := rCompanyInfo.Giro;										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
"DSTR1 :=     COPYSTR('#C######################################',1);"										
"Value[1] := rCompanyInfo.""Phone No."";"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
PrintSeperatorVIP(2);										
										
"DSTR1 :=  COPYSTR('#L######################################',1);"										
"Value[1] := Tarjeta.""Receipt No."";"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
"DSTR1 :=  COPYSTR('#L######################################',1);"										
"Value[1] := Tarjeta.""Nombre Tarjeta"";"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
"DSTR1 :=  COPYSTR('#L######################################',1);"										
"Value[1] := Tarjeta.""Card Type Name"";"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
"DSTR1 :=  COPYSTR('#L######################################',1);"										
"Value[1] := '**********' + Tarjeta.""Ultimos Digitos"";"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
"DSTR1 :=  COPYSTR('#L######################################',1);"										
"Value[1] := Tarjeta.""Expiry Date"";"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
"DSTR1 :=  COPYSTR('#L######################################',1);"										
Value[1] := 'Nombre:  __________________________';										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
"DSTR1 :=  COPYSTR('#L######################################',1);"										
Value[1] := 'DUI:     __________________________';										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
"DSTR1 :=  COPYSTR('#L######################################',1);"										
Value[1] := 'Firma:   __________________________';										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
										
PROCEDURE PrintCardVoucherCopy@1000000039(Tarjeta@1000000000 : Record 99008987);										
VAR										
Tray@1000000001 : Integer;										
rCompanyInfo@1000000002 : Record 79;										
DSTR1@1000000003 : Text[100];										
BEGIN										
										
//CSPNT060416										
Tray := 2;										
										
rCompanyInfo.GET();										
"DSTR1 :=     COPYSTR('#C######################################',1);"										
Value[1] := rCompanyInfo.Name;										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
"DSTR1 :=     COPYSTR('#C######################################',1);"										
Value[1] := rCompanyInfo.Giro;										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
"DSTR1 :=     COPYSTR('#C######################################',1);"										
"Value[1] := rCompanyInfo.""Phone No."";"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
PrintSeperatorVIP(2);										
										
"DSTR1 :=  COPYSTR('#L######################################',1);"										
"Value[1] := Tarjeta.""Receipt No."";"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
"DSTR1 :=  COPYSTR('#L######################################',1);"										
"Value[1] := Tarjeta.""Nombre Tarjeta"";"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
"DSTR1 :=  COPYSTR('#L######################################',1);"										
"Value[1] := Tarjeta.""Card Type Name"";"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
"DSTR1 :=  COPYSTR('#L######################################',1);"										
"Value[1] := '**********' + Tarjeta.""Ultimos Digitos"";"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
"DSTR1 :=  COPYSTR('#L######################################',1);"										
"Value[1] := Tarjeta.""Expiry Date"";"										
										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
										
PROCEDURE PrintReferencia@1000000034();										
VAR										
DSTR1@1000000000 : Text[100];										
BEGIN										
										
FOR iContador := 1 TO 70 DO BEGIN										
DSTR1 := '#L################################################';										
Value[1] := '123456789012345678901234567890123456789012345678'+FORMAT(iContador);										
"PrintLine(4,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
END;										
										
PROCEDURE WSGenerarFactura@1000000038(VAR Transaction@1000 : Record 99001472;Tray@1001 : Integer);										
VAR										
TransInfoCode@1002 : Record 99001478;										
Customer@1003 : Record 18;										
rTransInfo@1000000124 : Record 99001478;										
SalesEntry@1004 : Record 99001473;										
Item@1005 : Record 27;										
VATSetup@1006 : Record 99001560;										
MixMatchEntry@1008 : Record 99001496;										
PeriodicDiscount@1010 : Record 99001453;										
TransInfoEntry@1011 : Record 99001478;										
POSTerminal@1012 : Record 99001471;										
ItemPosTextHeader@1013 : Record 99001534;										
ItemPosTextLine@1014 : Record 99001535;										
IncExpEntry@1015 : Record 99001475;										
IncExpAcc@1016 : Record 99001476;										
CompInfo@1046 : Record 79;										
ItemVariant@1200070002 : Record 5401;										
Contact@1100409010 : Record 5050;										
ItemName@1017 : Text[50];										
SalesLineAmount@1018 : Decimal;										
SalesAmountVAT@1019 : ARRAY [5] OF Decimal;										
VATPerc@1020 : ARRAY [5] OF Decimal;										
VATAmount@1021 : ARRAY [5] OF Decimal;										
VATCode@1022 : ARRAY [5] OF Code[10];										
TmpVATPerc@1023 : Decimal;										
i@1024 : Integer;										
j@1025 : Integer;										
PrintItemNo@1026 : Integer;										
VATPrinted@1027 : Boolean;										
discText@1028 : Text[30];										
discountSection@1029 : Boolean;										
totalCustItemDisc@1030 : Decimal;										
maxCounter@1034 : Integer;										
PerDiscOffArr@1038 : ARRAY [250] OF Code[20];										
PerDiscOffAmtArr@1039 : ARRAY [250] OF Decimal;										
PerDiscOffArrCount@1040 : Integer;										
DSTR1@1041 : Text[100];										
qtyTxt@1042 : Text[15];										
LineArr@1043 : ARRAY [10] OF Text[50];										
OrderByDepartment@1200070001 : Boolean;										
LastDepartment@1200070000 : Code[10];										
PrintItem@1100409000 : Boolean;										
ItemTranslate@1200070003 : Record 30;										
ItemUnitOfMeasure@1100409001 : Record 5404;										
totalNumberOfItems@1100409002 : Decimal;										
totalSavings@1100409006 : Decimal;										
SalesEntry2@1100409003 : Record 99001473;										
LinkedItems@1100409004 : Record 99001452;										
CountItemOk@1100409005 : Boolean;										
TransactionOrderEntry@1100409007 : Record 10012704;										
OptTypeValueEntry@1100409008 : Record 10012713;										
LineCount@1100409009 : Integer;										
TransDiscountEntry@1100409012 : Record 99001642;										
CouponHeader@1100409015 : Record 99001621;										
DSTR2@1100409013 : Text[100];										
DiscountText@1100409014 : Text[80];										
OfferCode@1100409017 : Code[20];										
TotalAmtForSummary@1100409019 : Decimal;										
DiscountOnBlockPrintOffers@1100409020 : Decimal;										
ParentItemLine@1100409022 : Record 99001473;										
ParentItem@1100409025 : Record 27;										
RecipeBufferTEMP@1100409023 : TEMPORARY Record 99001473;										
RecipeBufferTEMP2@1100409024 : TEMPORARY Record 99001473;										
RecipeBufferDetailTEMP_l@1100409027 : TEMPORARY Record 99001642;										
DiscountOnLine@1100409011 : Decimal;										
IncomeExpenseAccount@1100409016 : Record 99001476;										
ThisIsATipsLine@1100409018 : Boolean;										
TmpValue@1100409021 : Text[100];										
StringLenBeforeSplitLine@1100409026 : Integer;										
rImpuestos@1000000000 : Record 50005;										
TotalVentG@1000000001 : Decimal;										
TotalVentE@1000000002 : Decimal;										
TotalNoSuj@1000000003 : Decimal;										
Descuento@1000000004 : Decimal;										
CantLinFact@1000000005 : Integer;										
rVATPostingSetup@1000000006 : Record 325;										
Impuesto@1000000007 : Decimal;										
Precio@1000000008 : Decimal;										
TotalIVA@1000000009 : Decimal;										
SubtotalLinea@1000000010 : Decimal;										
TotalPercepcion@1000000011 : Decimal;										
TotalRetencion@1000000012 : Decimal;										
TotalLetras@1000000013 : Text[100];										
Texto1@1000000014 : Text[44];										
Texto2@1000000015 : Text[44];										
TextGravado@1000000016 : TextConst 'ENU=G';										
TextNSujeto@1000000017 : TextConst 'ENU=NS';										
TextExento@1000000018 : TextConst 'ENU=E';										
TextAtencion@1000000019 : TextConst 'ENU=Atendio:';										
"TextTotVentasG@1000000020 : TextConst 'ENU=""G=Ventas Gravadas:""';"										
"TextTotVentasE@1000000021 : TextConst 'ENU=""E=Ventas Exentas:""';"										
TextVentNoSuj@1000000022 : TextConst 'ENU=Ventas No Sujetas:';										
TextSubTotal@1000000023 : TextConst 'ENU=Sub-Total:';										
TextDescuento@1000000024 : TextConst 'ENU=Ahorro Total:';										
TextTotal@1000000025 : TextConst 'ENU=TOTAL:';										
TextToRetencion@1000000026 : TextConst 'ENU=(-) IVA Retenido';										
TextToPercepcion@1000000027 : TextConst 'ENU=(-) IVA Percibido';										
rSalesPerson@1000000028 : Record 13;										
rStaff1@1000000029 : Record 99001461;										
rPosTerminal@1000000030 : Record 99001471;										
vSalesPersonNo@1000000031 : ARRAY [30] OF Text[100];										
vAgregarSalesPersonNo@1000000032 : Integer;										
vIncomeExpense@1000000033 : Boolean;										
rRecargasElectronicas@1000000034 : Record 50040;										
vMediosPago@1000000036 : ARRAY [30] OF Text[90];										
rCompanyInfo@1000000038 : Record 79;										
rCustomer@1000000037 : Record 18;										
vCopia@1000000101 : Integer;										
vIdDocumento@1000000092 : Integer;										
vResolucionCopia@1000000102 : Text;										
vSerieCopia@1000000103 : Text;										
vDesdeCopia@1000000104 : Integer;										
vHastaCopia@1000000105 : Integer;										
vNcfCopia@1000000106 : Text;										
vGiroEmpresa@1000000058 : Text;										
vSucursal@1000000057 : Text;										
vDireccionSucursal@1000000120 : Text;										
vNitEmpresa@1000000056 : Text;										
vNrcEmpresa@1000000055 : Text;										
vNombreCliente@1000000054 : Text;										
vDireccionCliente@1000000053 : Text;										
vDuiCliente@1000000052 : Text;										
vNitCliente@1000000051 : Text;										
vNrcCliente@1000000123 : Text;										
vGiroCliente@1000000093 : Text;										
vFecha@1000000050 : Text;										
vSumas@1000000049 : Decimal;										
vVentasNoSujetas@1000000048 : Decimal;										
vVentasExentas@1000000047 : Decimal;										
vVentasAfectas@1000000046 : Decimal;										
vSubTotal@1000000045 : Decimal;										
vIvaNormal@1000000097 : Decimal;										
vCesc@1000000113 : Decimal;										
vIvaRetenido@1000000044 : Decimal;										
vIvaPercibido@1000000094 : Decimal;										
vMonto@1000000043 : Decimal;										
vPOS@1000000042 : Text;										
vCajero@1000000041 : Text;										
vVendedor@1000000040 : Text;										
vFormaPago@1000000095 : Text;										
vTotalLetras@1000000039 : Text;										
xmlDetalles@1000000073 : Text;										
xml1@1000000074 : Text[1024];										
xml2@1000000086 : Text[1024];										
xml3@1000000087 : Text[1024];										
xml4@1000000096 : Text[1024];										
xmlDetallesBig@1000000088 : BigText;										
xmlBig@1000000089 : BigText;										
xml2Big@1000000090 : BigText;										
xml3Big@1000000091 : BigText;										
url@1000000072 : Text;										
soapActionUrl@1000000071 : Text;										
"sb@1000000070 : DotNet ""'mscorlib, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089'.System.Text.StringBuilder"";"										
"uriObj@1000000069 : DotNet ""'System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089'.System.Uri"";"										
"lgRequest@1000000068 : DotNet ""'System, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089'.System.Net.HttpWebReque"	"st"""	;								
"stream@1000000067 : DotNet ""'mscorlib, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089'.System.IO.StreamWriter"";"										
"lgResponse@1000000066 : DotNet ""'System, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089'.System.Net.HttpWebResp"	ons	"e"";"								
"str@1000000065 : DotNet ""'mscorlib, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089'.System.IO.Stream"";"										
"reader@1000000064 : DotNet ""'System.Xml, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089'.System.Xml.XmlTextRead"	"er"""	;								
"document@1000000063 : DotNet ""'System.Xml, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089'.System.Xml.XmlDocume"	"nt"""	;								
"ascii@1000000062 : DotNet ""'mscorlib, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089'.System.Text.Encoding"";"										
"credentials@1000000061 : DotNet ""'System, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089'.System.Net.Credential"	Cac	"he"""	;							
"xmlnodelist@1000000060 : DotNet ""'System.Xml, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089'.System.Xml.XmlNod"	eLi	"st"""	;							
"xmlnode@1000000059 : DotNet ""'System.Xml, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089'.System.Xml.XmlNode"";"										
"xmlelement@1000000035 : DotNet ""'System.Xml, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089'.System.Xml.XmlElem"	ent	""";"								
nodos@1000000085 : Integer;										
vDetalleCodigo@1000000075 : Text;										
vDetalleProducto@1000000076 : Text;										
vDetalleCantidad@1000000077 : Integer;										
vDetallePrecio@1000000078 : Decimal;										
vDetalleDescuento@1000000079 : Decimal;										
vDetalleVentasNoSujetas@1000000080 : Decimal;										
vDetalleVentasExentas@1000000081 : Decimal;										
vDetalleVentasAfectas@1000000082 : Decimal;										
vDetalleCostoNeto@1000000083 : Decimal;										
vDetalleTotal@1000000084 : Decimal;										
rFacturasHijas@1000000098 : Record 50007;										
vDesde@1000000099 : Integer;										
vHasta@1000000100 : Integer;										
rRemisionLine@1000000107 : Record 50053;										
vMontoRemision@1000000110 : Decimal;										
vMontoIvaRemision@1000000109 : Decimal;										
vMontoTotalRemision@1000000108 : Decimal;										
rSeriesLine@1000000111 : Record 309;										
vUltimaLinea@1000000112 : Integer;										
xml5@1000000114 : Text[1024];										
xml6@1000000115 : Text[1024];										
xml7@1000000116 : Text[1024];										
xml8@1000000117 : Text[1024];										
vInfoAmountTotal@1000000118 : Decimal;										
vIP@1000000119 : Text[20];										
xmlFinal@1000000122 : File;										
xmlStream@1000000121 : OutStream;										
vReimpresion@1000000125 : Boolean;										
vReimpresionR@1000000126 : Integer;										
xmlCorrelativo@1000000127 : Text[1024];										
vResolucionR@1000000128 : Text[30];										
vFechaAutorizacionR@1000000129 : Text[30];										
vSerieR@1000000130 : Text[30];										
vDesdeR@1000000131 : Text[30];										
vHastaR@1000000132 : Text[30];										
vNCFR@1000000133 : Text[30];										
EsRemision@1000000135 : Boolean;										
OriginalTrans@1000000134 : Record 99001472;										
xDescuentos@1000000136 : Record 99001642;										
xTitular@1000000137 : Text[50];										
xBenef@1000000138 : Text[50];										
BEGIN										
										
//CSPNT051216										
"IF (Transaction.""Receipt No."" <> PosTrans.GetReceiptNo) THEN BEGIN"										
vReimpresion := TRUE;										
vReimpresionR := 1;										
END;										
										
// CSALX20170309 Determinar si es una transaccion de Nota de Remision										
IF Transaction.NotaRemision THEN										
EsRemision := TRUE										
ELSE										
"IF Transaction.""Retrieved from Receipt No."" = '' THEN"										
EsRemision := FALSE										
ELSE BEGIN										
// Chequear si la transaccion original era de Remision										
CLEAR(OriginalTrans);										
"OriginalTrans.SETRANGE(""Receipt No."", Transaction.""Retrieved from Receipt No."");"										
IF OriginalTrans.FIND('-') THEN										
EsRemision := OriginalTrans.NotaRemision										
ELSE										
EsRemision := FALSE;										
END;										
										
rServidorGigaUno.RESET;										
"rServidorGigaUno.SETRANGE(""Store No."", Transaction.""Store No."");"										
rServidorGigaUno.FINDFIRST;										
"vIP := rServidorGigaUno.""IP Servidor"";"										
vDetalleCodigo := ' ';										
vDetalleProducto := ' ';										
vDetalleCantidad := 0;										
vDetallePrecio := 0;										
vDetalleDescuento := 0;										
vDetalleVentasNoSujetas := 0;										
vDetalleVentasExentas := 0;										
vDetalleVentasAfectas := 0;										
vDetalleCostoNeto := 0;										
vDetalleTotal := 0;										
										
vCopia := 4;										
vResolucionCopia := '';										
vSerieCopia := '';										
vDesdeCopia := 0;										
vHastaCopia := 0;										
vNcfCopia := '';										
										
vGiroEmpresa := '';										
vSucursal := '';										
vDireccionSucursal := '';										
vNitEmpresa := '';										
vNrcEmpresa := '';										
										
vNombreCliente := '';										
vDireccionCliente := '';										
vDuiCliente := '';										
vNitCliente := '';										
//CSPNT280916										
vNrcCliente := '';										
vGiroCliente := '';										
										
vFecha := '';										
vSumas := 0;										
vVentasNoSujetas := 0;										
vVentasExentas := 0;										
vVentasAfectas := 0;										
vSubTotal := 0;										
vIvaNormal := 0;										
vCesc := 0;										
vIvaRetenido := 0;										
vIvaPercibido := 0;										
vMonto := 0;										
vPOS := '';										
vCajero := '';										
vVendedor := '';										
vFormaPago := '';										
vTotalLetras := '';										
xTitular := '';										
xBenef := '';										
										
TotFac := '';										
vDecimalesTextoFactura := '';										
										
//*********************//										
//***** SUBHEADER *****//										
//*********************//										
										
//COPIA										
"{IF (Transaction.""Receipt No."" <> PosTrans.GetReceiptNo) THEN BEGIN"										
vCopia := 1;										
rFacturasHijas.RESET;										
"rFacturasHijas.SETRANGE(""Store No."",Transaction.""Store No."");"										
"rFacturasHijas.SETRANGE(""POS Terminal No."",Transaction.""POS Terminal No."");"										
"rFacturasHijas.SETRANGE(""Receipt No."",Transaction.""Receipt No."");"										
IF rFacturasHijas.FIND('-') THEN BEGIN										
vResolucionCopia := rFacturasHijas.Resolucion;										
vSerieCopia := rFacturasHijas.Serie;										
vDesdeCopia := rFacturasHijas.Desde;										
vHastaCopia := rFacturasHijas.Hasta;										
vNcfCopia := Transaction.NCF;										
END;										
END;}										
										
rCompanyInfo.GET();										
//DATOS COMPANIA										
vGiroEmpresa := rCompanyInfo.Giro;										
vSucursal := Store.Name;										
vDireccionSucursal := Store.Address;										
"vNitEmpresa:= rCompanyInfo.""VAT Registration No."";"										
vNrcEmpresa := rCompanyInfo.NRC;										
										
//DATOS CLIENTE										
"IF rCustomer.GET(Transaction.""Customer No."") THEN BEGIN"										
//CSPNT141016										
"vNombreCliente := COPYSTR(rCustomer.Name,1,31);"										
vDireccionCliente := rCustomer.Address;										
vDuiCliente := rCustomer.DUI;										
"vNitCliente := rCustomer.""VAT Registration No."";"										
//CSPNT280916										
vNrcCliente := rCustomer.NRC;										
vGiroCliente := rCustomer.GIRO;										
//CSPNT141016										
IF rCustomer.SolicitarBeneficiario THEN BEGIN										
///IF (STRLEN(vNombreCliente) < 31) THEN										
///  FOR iContador := STRLEN(vNombreCliente) TO 31 DO BEGIN										
///    vNombreCliente := vNombreCliente + ' ';										
///  END;										
///CLEAR(rTransInfo);										
"///rTransInfo.SETFILTER(""Transaction No."", '%1', Transaction.""Transaction No."");"										
"///rTransInfo.SETFILTER(NotaRemision, '%1', 'ENERGETICAS');"										
///IF rTransInfo.FIND('-') THEN										
///  REPEAT										
"///    vNombreCliente := vNombreCliente + PADSTR(rTransInfo.Information,41,' ');"										
///  UNTIL rTransInfo.NEXT = 0;										
/// Encontrando al titular										
CLEAR(rTransInfo);										
"rTransInfo.SETFILTER(""Transaction No."", '%1', Transaction.""Transaction No."");"										
"rTransInfo.SETFILTER(NotaRemision, '%1', 'ENERGETICAS');"										
"rTransInfo.SETFILTER(Information, 'TITULAR*');"										
IF rTransInfo.FIND('-') THEN										
"xTitular := COPYSTR(rTransInfo.Information, 11, 50);"										
/// Encontrando al beneficiario										
CLEAR(rTransInfo);										
"rTransInfo.SETFILTER(""Transaction No."", '%1', Transaction.""Transaction No."");"										
"rTransInfo.SETFILTER(NotaRemision, '%1', 'ENERGETICAS');"										
"rTransInfo.SETFILTER(Information, 'BENEFICIARIO*');"										
IF rTransInfo.FIND('-') THEN										
"xBenef := COPYSTR(rTransInfo.Information, 16, 50);"										
END;										
END;										
										
vFecha := FORMAT(Transaction.Date) + ' ' + FORMAT(Transaction.Time);										
										
										
//*********************//										
//***** SALESINFO *****//										
//*********************//										
										
										
StringLenBeforeSplitLine := 11;										
										
"IF GenPosFunc.""Multiple Items Symbol""='' THEN"										
"GenPosFunc.""Multiple Items Symbol"" := ' x ';"										
										
"TransInfoCode.SETRANGE(""Store No."",Transaction.""Store No."");"										
"TransInfoCode.SETRANGE(""POS Terminal No."",Transaction.""POS Terminal No."");"										
"TransInfoCode.SETRANGE(""Transaction No."",Transaction.""Transaction No."");"										
"TransInfoCode.SETRANGE(""Transaction Type"",TransInfoCode.""Transaction Type""::Header);"										
										
PerDiscOffArrCount := 0;										
totalCustItemDisc := 0;										
										
CLEAR(totalNumberOfItems);										
CLEAR(totalSavings);										
										
LineCount := 0;										
CLEAR(VATCode);										
CLEAR(VATPerc);										
CLEAR(VATAmount);										
CLEAR(SalesAmountVAT);										
CLEAR(SalesEntry);										
CLEAR(Value);										
tmpDeal.DELETEALL;										
TmpPrintedSalesEntry.DELETEALL;										
TmpPrintedDealPOSTransLine.DELETEALL;										
"IF GenPosFunc.""Print Disc/Cpn Info on Slip"" IN"										
"[GenPosFunc.""Print Disc/Cpn Info on Slip""::""Detail for each line and Sub-total"","										
"GenPosFunc.""Print Disc/Cpn Info on Slip""::""Summary information below Sub-total""] THEN BEGIN"										
PeriodicDiscountInfoTEMP.RESET;										
PeriodicDiscountInfoTEMP.DELETEALL;										
Subtotal := 0;										
END;										
TotalAmt := 0;										
TipsAmount1 := 0;										
TipsText1 := '';										
TipsAmount2 := 0;										
TipsText2 := '';										
glTrans := Transaction;										
"SalesEntry.SETRANGE(""Store No."",Transaction.""Store No."");"										
"SalesEntry.SETRANGE(""POS Terminal No."",Transaction.""POS Terminal No."");"										
"SalesEntry.SETRANGE(""Transaction No."",Transaction.""Transaction No."");"										
"OrderByDepartment := GenPosFunc.""Receipt Printing by Category"";"										
IF OrderByDepartment THEN										
"SalesEntry.SETCURRENTKEY(""Item Category Code"");"										
										
IF SalesEntry.FIND('-') THEN BEGIN										
PrintItemNo := 0;										
"IF POSTerminal.GET(SalesEntry.""POS Terminal No."") THEN"										
"IF POSTerminal.""Receipt Setup Location"" = POSTerminal.""Receipt Setup Location""::Store THEN BEGIN"										
"CASE Store.""Item No. on Receipt"" OF"										
"Store.""Item No. on Receipt""::""Item Number"" : PrintItemNo := 1;"										
"Store.""Item No. on Receipt""::""Barcode/Item Number"" : PrintItemNo := 2;"										
END;										
END										
ELSE BEGIN										
"CASE POSTerminal.""Item No. on Receipt"" OF"										
"POSTerminal.""Item No. on Receipt"" :: ""Item Number"": PrintItemNo := 1;"										
"POSTerminal.""Item No. on Receipt"" :: ""Barcode/Item Number"": PrintItemNo := 2;"										
END;										
END;										
										
LastDepartment := '';										
RecipeBufferTEMP.RESET;										
RecipeBufferTEMP.DELETEALL;										
RecipeBufferDetailTEMP_l.RESET;										
RecipeBufferDetailTEMP_l.DELETEALL;										
										
"{DSTR1 := COPYSTR('     #L###  #L#########################    #R#####  #R####  #R###  #R######  #R######  ',1);"										
Value[1] := 'CANT.'; Value[2] := 'D E S C R I P C I O N'; Value[3] := 'PrecioU'; Value[4] := 'Desc'; Value[5] := 'VeNoSu'; Value	[6]	:=	'	VeE	x'; Value[7] := 'VeGr';}					
										
//CSPNT300816										
//CSPNT301116										
REPEAT										
"IF Item.GET(SalesEntry.""Item No."") THEN BEGIN"										
rProductosTelefonicas.RESET;										
"rProductosTelefonicas.SETRANGE(ID,'1');"										
IF rProductosTelefonicas.FINDFIRST THEN										
"vProductoTelefonica1 := rProductosTelefonicas.""No. Producto"";"										
rProductosTelefonicas.RESET;										
"rProductosTelefonicas.SETRANGE(ID,'2');"										
IF rProductosTelefonicas.FINDFIRST THEN										
"vProductoTelefonica2 := rProductosTelefonicas.""No. Producto"";"										
rProductosTelefonicas.RESET;										
"rProductosTelefonicas.SETRANGE(ID,'3');"										
IF rProductosTelefonicas.FINDFIRST THEN										
"vProductoTelefonica3 := rProductosTelefonicas.""No. Producto"";"										
rProductosTelefonicas.RESET;										
"rProductosTelefonicas.SETRANGE(ID,'4');"										
IF rProductosTelefonicas.FINDFIRST THEN										
"vProductoTelefonica4 := rProductosTelefonicas.""No. Producto"";"										
"IF Item.GET(SalesEntry.""Item No."") THEN BEGIN"										
"IF (Item.""No."" = vProductoTelefonica1) OR (Item.""No."" = vProductoTelefonica2)"										
"OR (Item.""No."" = vProductoTelefonica3) OR (Item.""No."" = vProductoTelefonica4) THEN BEGIN"										
rRecargasElectronicas.RESET;										
//CSPNT280916										
"IF NOT Transaction.""Sale Is Return Sale"" THEN"										
"rRecargasElectronicas.SETRANGE(""Receipt No."",Transaction.""Receipt No."")"										
ELSE										
"rRecargasElectronicas.SETRANGE(""Receipt No."",Transaction.""Retrieved from Receipt No."");"										
IF rRecargasElectronicas.FINDFIRST THEN										
vCesc := rRecargasElectronicas.CESC;										
END;										
END;										
END;										
UNTIL SalesEntry.NEXT = 0;										
										
//CSPNT090916										
vInfoAmountTotal := 0;										
										
//CSPNT301116										
CLEAR(SalesEntry);										
"SalesEntry.SETRANGE(""Store No."",Transaction.""Store No."");"										
"SalesEntry.SETRANGE(""POS Terminal No."",Transaction.""POS Terminal No."");"										
"SalesEntry.SETRANGE(""Transaction No."",Transaction.""Transaction No."");"										
IF OrderByDepartment THEN										
"SalesEntry.SETCURRENTKEY(""Item Category Code"");"										
IF SalesEntry.FIND('-') THEN										
										
REPEAT										
"IF Item.GET(SalesEntry.""Item No."") THEN BEGIN"										
"IF (SalesEntry.""Barcode No."" <> '') THEN BEGIN"										
"IF rBarras.GET(SalesEntry.""Barcode No."") THEN"										
"ItemName := COPYSTR(rBarras.Description,1,50)"										
ELSE										
"ItemName := COPYSTR(Item.Description,1,50);"										
END										
ELSE BEGIN										
"ItemName := COPYSTR(Item.Description,1,50);"										
END;										
END										
ELSE										
"ItemName := SalesEntry.""Item No."";"										
										
"IF SalesEntry.""Parent Line No."" = 0 THEN BEGIN"										
ParentItem := Item;										
ParentItemLine := SalesEntry;										
END;										
										
"IF (ParentItem.""Skip Compression When Printed"" = FALSE) AND (NOT SalesEntry.""Deal Line"") THEN"										
"InsertIntoRecipeBuffer(SalesEntry,RecipeBufferTEMP,ParentItemLine,RecipeBufferDetailTEMP_l);"										
										
"POSTerminal.GET(Transaction.""POS Terminal No."");"										
"IF POSTerminal.""Print Total Savings"" THEN BEGIN"										
"totalSavings := totalSavings + SalesEntry.""Discount Amount"";"										
END;										
										
"IF POSTerminal.""Print Number of Items"" THEN BEGIN"										
IF (SalesEntry.Quantity < 0) THEN BEGIN										
CountItemOk := TRUE;										
"IF SalesEntry.""Linked No. not Orig."" THEN BEGIN"										
SalesEntry2.RESET;										
SalesEntry2.COPYFILTERS(SalesEntry);										
IF SalesEntry2.FIND('-') THEN BEGIN										
REPEAT										
"IF (SalesEntry2.""Item No."" <> SalesEntry.""Item No."") AND SalesEntry2.""Orig. of a Linked Item List"" THEN BEGIN"										
LinkedItems.RESET;										
"LinkedItems.SETRANGE(""Item No."",SalesEntry2.""Item No."");"										
"LinkedItems.SETRANGE(""Linked Item No."",SalesEntry.""Item No."");"										
"LinkedItems.SETFILTER(""Sales Type"",'%1|%2','',Transaction.""Sales Type"");"										
IF LinkedItems.FINDFIRST THEN BEGIN										
"IF LinkedItems.""Deposit Item"" THEN"										
CountItemOk := FALSE;										
END;										
END;										
UNTIL (SalesEntry2.NEXT = 0) OR NOT CountItemOk;										
END;										
END;										
IF CountItemOk THEN BEGIN										
"IF SalesEntry.""UOM Quantity"" <> 0 THEN"										
"totalNumberOfItems := totalNumberOfItems + ABS(SalesEntry.""UOM Quantity"")"										
ELSE										
totalNumberOfItems := totalNumberOfItems + ABS(SalesEntry.Quantity);										
END;										
END;										
END;										
										
"IF Customer.GET(Transaction.""Customer No."") THEN"										
"IF Customer.""Language Code"" <> '' THEN"										
"IF ItemTranslate.GET(SalesEntry.""Item No."",SalesEntry.""Variant Code"",Customer.""Language Code"") THEN"										
IF ItemTranslate.Description <> '' THEN										
ItemName := ItemTranslate.Description;										
										
"IF SalesEntry.""Deal Line"" THEN BEGIN"										
"PrintDeal(SalesEntry,Tray,PrintItemNo);"										
"CollectDiscInfo(SalesEntry,Tray,TotalAmt,Subtotal,PeriodicDiscountInfoTEMP);"										
"IF GenPosFunc.""Print Disc/Cpn Info on Slip"" = GenPosFunc.""Print Disc/Cpn Info on Slip""::""No printing"" THEN"										
"SalesLineAmount := SalesEntry.""Net Amount"" + SalesEntry.""VAT Amount"""										
ELSE										
"SalesLineAmount := SalesEntry.""Net Amount"" + SalesEntry.""VAT Amount"" - SalesEntry.""Discount Amount"";"										
"IF GenPosFunc.""Print Disc/Cpn Info on Slip"" = GenPosFunc.""Print Disc/Cpn Info on Slip""::""Detail information for each line"" T"	HEN									
TotalAmt := TotalAmt + SalesLineAmount										
ELSE										
"IF GenPosFunc.""Print Disc/Cpn Info on Slip"" = GenPosFunc.""Print Disc/Cpn Info on Slip""::""No printing"" THEN"										
TotalAmt := TotalAmt + SalesLineAmount;										
"//*************** normal line, not deal line"										
END										
ELSE BEGIN										
"IF GenPosFunc.""Print Disc/Cpn Info on Slip"" = GenPosFunc.""Print Disc/Cpn Info on Slip""::""No printing"" THEN"										
"SalesLineAmount := SalesEntry.""Net Amount"" + SalesEntry.""VAT Amount"""										
ELSE										
"SalesLineAmount := SalesEntry.""Net Amount"" + SalesEntry.""VAT Amount"" - SalesEntry.""Discount Amount"";"										
DiscountOnBlockPrintOffers := ReturnDiscountBlockPrinting(SalesEntry);										
"IF GenPosFunc.""Print Disc/Cpn Info on Slip"" IN"										
"[GenPosFunc.""Print Disc/Cpn Info on Slip""::""Detail information for each line"", GenPosFunc.""Print Disc/Cpn Info on Slip""::""No"	pr	int	in	"g""]"	THEN					
TotalAmt := TotalAmt + SalesLineAmount;										
"IF GenPosFunc.""Print Disc/Cpn Info on Slip"" IN"										
"[GenPosFunc.""Print Disc/Cpn Info on Slip""::""Detail information for each line"","										
"GenPosFunc.""Print Disc/Cpn Info on Slip""::""Detail for each line and Sub-total"", //LS7.1-12"										
"GenPosFunc.""Print Disc/Cpn Info on Slip""::""Summary information below Sub-total""] THEN"										
SalesLineAmount := SalesLineAmount + DiscountOnBlockPrintOffers;										
//********************** Quantity <> 1										
"IF (ABS(SalesEntry.Quantity) <> 1) OR ((SalesEntry.""UOM Quantity"" <> 0) AND (ABS(SalesEntry.""UOM Quantity"") <> 1)) OR"										
"SalesEntry.""Scale Item"" OR SalesEntry.""Price in Barcode"" THEN BEGIN"										
DSTR1 := '#L######################################';										
"IF ParentItem.""Skip Compression When Printed"" THEN"										
"//LS7.1-02 PrintLineHospitality(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE),SalesEntry);"										
"PrintLineHospitality(Tray,300,4,NodeName,Value,DSTR1,FALSE,FALSE,FALSE,FALSE,SalesEntry); //LS7.1-02"										
CLEAR(Value);										
DSTR1 := '   #L################### #N########## #R';										
"IF SalesEntry.""Scale Item"" OR SalesEntry.""Price in Barcode"" THEN BEGIN"										
"IF SalesEntry.""Weight Manually Entered"" THEN"										
DSTR1 := 'MAN #L################## #N########## #R';										
"Value[1] := Value[1] + POSFunctions.FormatWeight(-SalesEntry.Quantity,SalesEntry.""Unit of Measure"") +"										
"' ' + GenPosFunc.""Multiple Items Symbol"" + ' ';"										
"Value[1] := Value[1] + POSFunctions.FormatPricePrUnit(SalesEntry.Price,SalesEntry.""Unit of Measure"");"										
END										
ELSE BEGIN										
"IF SalesEntry.""Unit of Measure"" = '' THEN"										
"SalesEntry.""Unit of Measure"" :=  Text131;"										
"IF (SalesEntry.""UOM Quantity"" <> 0) THEN BEGIN"										
"SalesEntry.Quantity := SalesEntry.""UOM Quantity"";"										
"SalesEntry.Price := SalesEntry.""UOM Price"";"										
END;										
"Value[1] := POSFunctions.FormatQty(-SalesEntry.Quantity) + ' ' + LOWERCASE(SalesEntry.""Unit of Measure"") +"										
"' ' + GenPosFunc.""Multiple Items Symbol"" + ' ';"										
Value[1] := Value[1] + POSFunctions.FormatPrice(SalesEntry.Price);										
END;										
"IF ParentItem.""Skip Compression When Printed"" THEN"										
"PrintLineHospitality(Tray,300,6,NodeName,Value,DSTR1,FALSE,(SalesEntry.""Periodic Discount"" <> 0),FALSE,FALSE,SalesEntry)"	;									
//************* quantity = 1										
END										
ELSE BEGIN										
DSTR1 := '#L###################### #N########## #R';										
"IF ParentItem.""Skip Compression When Printed"" THEN"										
"PrintLineHospitality(Tray,300,9,NodeName,Value,DSTR1,FALSE,(SalesEntry.""Periodic Discount"" <> 0),FALSE,FALSE,SalesEntry)"	;									
END;										
										
"IF GenPosFunc.""Print Free Text on Receipt"" THEN"										
"PrintFreeTextLines(SalesEntry,Tray,FALSE);         //GEG Check when prints                 //GEG should print if sales lin"	e p	rin	te	d						
"CollectDiscInfo(SalesEntry,Tray,TotalAmt,Subtotal,PeriodicDiscountInfoTEMP);"										
										
"IF ItemPosTextHeader.GET(SalesEntry.""Item No."",ItemPosTextHeader.""Text Type""::""Receipt Text"",Store.""Language Code"") THEN BEG"	IN									
"ItemPosTextLine.SETRANGE(""Item No."",SalesEntry.""Item No."");"										
"ItemPosTextLine.SETRANGE(""Text Type"",ItemPosTextHeader.""Text Type""::""Receipt Text"");"										
"ItemPosTextLine.SETRANGE(""Language Code"",Store.""Language Code"");"										
IF ItemPosTextLine.FIND('-') THEN										
REPEAT										
"Value[1] := FORMAT(SalesEntry.""Line No."");"										
NodeName[1] := 'Line No.';										
Value[2] := ItemPosTextLine.Text;										
NodeName[2] := 'Extra Info Line';										
"PrintLine(Tray,ItemPosTextLine.Text);                                                         //GEG Should print if sa"	les	li	ne	pr	inted					
"AddPrintLine(350,2,NodeName,Value,DSTR1,FALSE,FALSE,FALSE,FALSE,Tray); //LS7.1-02"										
UNTIL ItemPosTextLine.NEXT = 0;										
END;										
										
"TransInfoEntry.SETRANGE(""Store No."",Transaction.""Store No."");                                      //GEG should print if sal"	es	lin	e	pri	nted					
"TransInfoEntry.SETRANGE(""POS Terminal No."",Transaction.""POS Terminal No."");"										
"TransInfoEntry.SETRANGE(""Transaction No."",Transaction.""Transaction No."");"										
"TransInfoEntry.SETRANGE(""Transaction Type"",TransInfoEntry.""Transaction Type""::""Sales Entry"");"										
"TransInfoEntry.SETRANGE(""Line No."",SalesEntry.""Line No."");"										
IF TransInfoEntry.FIND('-') THEN BEGIN										
IF Transaction.NotaRemision AND (TransInfoEntry.Information <> '') THEN BEGIN										
"IF (Transaction.""No. Serie NCF"" = POSTerminal.""No. Serie NCF Cons. Final"") THEN BEGIN"										
// Imprimir la linea de remision										
"vDetalleProducto := COPYSTR(TransInfoEntry.Information,1,40);"										
"vDetalleVentasAfectas := -TransInfoEntry.""Info. Amt."";"										
//CSPNT090916										
"vInfoAmountTotal := vInfoAmountTotal + TransInfoEntry.""Info. Amt."";"										
/// LINEA DE REMISION CONSUMIDOR FINAL										
xmlDetalles := '<DetalleDocumento>' +										
'<Codigo>' + vDetalleCodigo + '</Codigo>' +										
"'<Producto>' + DELCHR(DELCHR(vDetalleProducto,'=','>'),'=','<') + '</Producto>' +"										
'<Cantidad>1</Cantidad>' +										
"'<Precio>' + DELCHR(FORMAT(vDetalleVentasAfectas),'=',',') + '</Precio>';"										
IF vDetalleDescuento <> 0 THEN										
"xmlDetalles := xmlDetalles + '<Descuento>' + DELCHR(FORMAT(vDetalleDescuento),'=',',') + '</Descuento>';"										
IF vDetalleVentasNoSujetas <> 0 THEN										
"xmlDetalles := xmlDetalles + '<VentasNoSujetas>' + DELCHR(FORMAT(vDetalleVentasNoSujetas),'=',',') + '</VentasNoSuje"	tas	>';								
IF vDetalleVentasExentas <> 0 THEN										
"xmlDetalles := xmlDetalles + '<VentasExentas>' + DELCHR(FORMAT(vDetalleVentasExentas),'=',',') + '</VentasExentas>';"										
IF vDetalleVentasAfectas <> 0 THEN										
"xmlDetalles := xmlDetalles + '<VentasAfectas>' + DELCHR(FORMAT(vDetalleVentasAfectas),'=',',') + '</VentasAfectas>';"										
"xmlDetalles := xmlDetalles + '<CostoNeto>' + DELCHR(FORMAT(vDetalleCostoNeto),'=',',') + '</CostoNeto>' +"										
"'<Total>' + DELCHR(FORMAT(vDetalleVentasAfectas),'=',',') + '</Total>' +"										
'</DetalleDocumento>';										
"//              '<Cantidad>' + DELCHR(FORMAT(vDetalleCantidad),'=',',') + '</Cantidad>' +"										
xmlDetallesBig.ADDTEXT(xmlDetalles);										
										
vDetalleCodigo := ' ';										
vDetalleProducto := ' ';										
vDetalleCantidad := 0;										
vDetallePrecio := 0;										
vDetalleDescuento := 0;										
vDetalleVentasNoSujetas := 0;										
vDetalleVentasExentas := 0;										
vDetalleVentasAfectas := 0;										
vDetalleCostoNeto := 0;										
vDetalleTotal := 0;										
END ELSE BEGIN										
//CSPNT150816										
"IF Transaction.""Customer No."" = 'C000002' THEN BEGIN"										
"vDetalleProducto := COPYSTR(TransInfoEntry.Information,1,40);"										
vDetalleVentasAfectas := -TransInfoEntry.Amount;										
//CSPNT090916										
vInfoAmountTotal := vInfoAmountTotal + TransInfoEntry.Amount;										
										
/// LINEA DE REMISION CREDITO FISCAL										
xmlDetalles := '<DetalleDocumento>' +										
'<Codigo>' + vDetalleCodigo + '</Codigo>' +										
"'<Producto>' + DELCHR(DELCHR(vDetalleProducto,'=','>'),'=','<') + '</Producto>' +"										
'<Cantidad>1</Cantidad>' +										
"'<Precio>' + DELCHR(FORMAT(vDetalleVentasAfectas),'=',',') + '</Precio>';"										
IF vDetalleDescuento <> 0 THEN										
"xmlDetalles := xmlDetalles + '<Descuento>' + DELCHR(FORMAT(vDetalleDescuento),'=',',') + '</Descuento>';"										
IF vDetalleVentasNoSujetas <> 0 THEN										
"xmlDetalles := xmlDetalles + '<VentasNoSujetas>' + DELCHR(FORMAT(vDetalleVentasNoSujetas),'=',',') + '</VentasNoSu"	jet	as>	';							
IF vDetalleVentasExentas <> 0 THEN										
"xmlDetalles := xmlDetalles + '<VentasExentas>' + DELCHR(FORMAT(vDetalleVentasExentas),'=',',') + '</VentasExentas>"	';									
IF vDetalleVentasAfectas <> 0 THEN										
"xmlDetalles := xmlDetalles + '<VentasAfectas>' + DELCHR(FORMAT(vDetalleVentasAfectas),'=',',') + '</VentasAfectas>"	';									
xmlDetalles := xmlDetalles +										
"'<CostoNeto>' + DELCHR(FORMAT(vDetalleCostoNeto),'=',',') + '</CostoNeto>' +"										
"'<Total>' + DELCHR(FORMAT(vDetalleVentasAfectas),'=',',') + '</Total>' +"										
'</DetalleDocumento>';										
"//              '<Cantidad>' +  DELCHR(FORMAT(vDetalleCantidad),'=',',') + '</Cantidad>' +"										
xmlDetallesBig.ADDTEXT(xmlDetalles);										
										
vDetalleCodigo := ' ';										
vDetalleProducto := ' ';										
vDetalleCantidad := 0;										
vDetallePrecio := 0;										
vDetalleDescuento := 0;										
vDetalleVentasNoSujetas := 0;										
vDetalleVentasExentas := 0;										
vDetalleVentasAfectas := 0;										
vDetalleCostoNeto := 0;										
vDetalleTotal := 0;										
END										
ELSE BEGIN										
"IF (Transaction.""No. Serie NCF"" = POSTerminal.""No. Serie NCF Cons. Final"") THEN BEGIN"										
"vDetalleProducto := COPYSTR(TransInfoEntry.Information,1,40);"										
"vDetalleVentasAfectas := -TransInfoEntry.""Info. Amt."";"										
//CSPNT090916										
"vInfoAmountTotal := vInfoAmountTotal + -TransInfoEntry.""Info. Amt."";"										
										
/// LINEA DE PRODUCTO CONSUMIDOR FINAL										
xmlDetalles := '<DetalleDocumento>' +										
'<Codigo>' + vDetalleCodigo + '</Codigo>' +										
"'<Producto>' + DELCHR(DELCHR(vDetalleProducto,'=','>'),'=','<') + '</Producto>' +"										
'<Cantidad>1</Cantidad>' +										
"'<Precio>' + DELCHR(FORMAT(vDetalleVentasAfectas),'=',',') + '</Precio>' ;"										
IF vDetalleDescuento <> 0 THEN										
"xmlDetalles := xmlDetalles + '<Descuento>' + DELCHR(FORMAT(vDetalleDescuento),'=',',') + '</Descuento>';"										
IF vDetalleVentasNoSujetas <> 0 THEN										
"xmlDetalles := xmlDetalles + '<VentasNoSujetas>' + DELCHR(FORMAT(vDetalleVentasNoSujetas),'=',',') + '</VentasNo"	Suj	eta	s>	';						
IF vDetalleVentasExentas <> 0 THEN										
"xmlDetalles := xmlDetalles + '<VentasExentas>' + DELCHR(FORMAT(vDetalleVentasExentas),'=',',') + '</VentasExenta"	s>'	;								
IF vDetalleVentasAfectas <> 0 THEN										
"xmlDetalles := xmlDetalles + '<VentasAfectas>' + DELCHR(FORMAT(vDetalleVentasAfectas),'=',',') + '</VentasAfecta"	s>'	;								
xmlDetalles := xmlDetalles +										
"'<CostoNeto>' + DELCHR(FORMAT(vDetalleCostoNeto),'=',',') + '</CostoNeto>' +"										
"'<Total>' + DELCHR(FORMAT(vDetalleVentasAfectas),'=',',') + '</Total>' +"										
'</DetalleDocumento>';										
"//              '<Cantidad>' +  DELCHR(FORMAT(vDetalleCantidad),'=',',') + '</Cantidad>' +"										
xmlDetallesBig.ADDTEXT(xmlDetalles);										
										
vDetalleCodigo := ' ';										
vDetalleProducto := ' ';										
vDetalleCantidad := 0;										
vDetallePrecio := 0;										
vDetalleDescuento := 0;										
vDetalleVentasNoSujetas := 0;										
vDetalleVentasExentas := 0;										
vDetalleVentasAfectas := 0;										
vDetalleCostoNeto := 0;										
vDetalleTotal := 0;										
END										
ELSE BEGIN										
"vDetalleProducto := COPYSTR(TransInfoEntry.Information,1,40);"										
"vDetalleVentasAfectas := -ROUND(TransInfoEntry.""Info. Amt.""/1.13,0.01);"										
//CSPNT090916										
"vInfoAmountTotal := vInfoAmountTotal + -ROUND(TransInfoEntry.""Info. Amt.""/1.13,0.01);"										
										
/// LINEA DE PRODUCTO CREDITO FISCAL										
xmlDetalles := '<DetalleDocumento>' +										
'<Codigo>' + vDetalleCodigo + '</Codigo>' +										
"'<Producto>' + DELCHR(DELCHR(vDetalleProducto,'=','>'),'=','<') + '</Producto>' +"										
'<Cantidad>1</Cantidad>' +										
"'<Precio>' + DELCHR(FORMAT(vDetalleVentasAfectas),'=',',') + '</Precio>';"										
IF vDetalleDescuento <> 0 THEN										
"xmlDetalles := xmlDetalles + '<Descuento>' + DELCHR(FORMAT(vDetalleDescuento),'=',',') + '</Descuento>';"										
IF vDetalleVentasNoSujetas <> 0 THEN										
"xmlDetalles := xmlDetalles + '<VentasNoSujetas>' + DELCHR(FORMAT(vDetalleVentasNoSujetas),'=',',') + '</VentasNo"	Suj	eta	s>	';						
IF vDetalleVentasExentas <> 0 THEN										
"xmlDetalles := xmlDetalles + '<VentasExentas>' + DELCHR(FORMAT(vDetalleVentasExentas),'=',',') + '</VentasExenta"	s>'	;								
IF vDetalleVentasAfectas <> 0 THEN										
"xmlDetalles := xmlDetalles + '<VentasAfectas>' + DELCHR(FORMAT(vDetalleVentasAfectas),'=',',') + '</VentasAfecta"	s>'	;								
xmlDetalles := xmlDetalles +										
"'<CostoNeto>' + DELCHR(FORMAT(vDetalleCostoNeto),'=',',') + '</CostoNeto>' +"										
"'<Total>' + DELCHR(FORMAT(vDetalleVentasAfectas),'=',',') + '</Total>' +"										
'</DetalleDocumento>';										
"//              '<Cantidad>' +  DELCHR(FORMAT(vDetalleCantidad),'=',',') + '</Cantidad>' +"										
xmlDetallesBig.ADDTEXT(xmlDetalles);										
										
vDetalleCodigo := ' ';										
vDetalleProducto := ' ';										
vDetalleCantidad := 0;										
vDetallePrecio := 0;										
vDetalleDescuento := 0;										
vDetalleVentasNoSujetas := 0;										
vDetalleVentasExentas := 0;										
vDetalleVentasAfectas := 0;										
vDetalleCostoNeto := 0;										
vDetalleTotal := 0;										
END;										
END;										
END;										
END										
ELSE BEGIN										
"PrintTransInfoCode(TransInfoEntry,Tray,FALSE);"										
END;										
END;										
END;										
"//*************** normal line, not deal line END"										
										
"totalCustItemDisc := totalCustItemDisc + SalesEntry.""Infocode Discount"";"										
										
IF IsInvoice THEN BEGIN										
RetailSetup.GET();										
rVATPostingSetup.RESET;										
"rVATPostingSetup.SETRANGE(rVATPostingSetup.""VAT Bus. Posting Group"",SalesEntry.""VAT Bus. Posting Group"");"										
"rVATPostingSetup.SETRANGE(rVATPostingSetup.""VAT Prod. Posting Group"",SalesEntry.""VAT Code"");"										
IF rVATPostingSetup.FINDFIRST THEN										
"Impuesto:=rVATPostingSetup.""VAT %"";"										
										
rImpuestos.RESET;										
"rImpuestos.SETRANGE(""VAT Bus. Posting Group"",SalesEntry.""VAT Bus. Posting Group"");"										
"rImpuestos.SETRANGE(""VAT Prod. Posting Group"",SalesEntry.""VAT Prod. Posting Group"");"										
IF rImpuestos.FINDFIRST THEN BEGIN										
//impuesto gravado										
IF rImpuestos.Impuesto=rImpuestos.Impuesto::Gravado THEN BEGIN										
"IF Transaction.""Sale Is Return Sale"" AND Transaction.NotaCredito THEN"										
vDetalleCantidad := SalesEntry.Quantity										
ELSE										
vDetalleCantidad := -SalesEntry.Quantity;										
										
"vDetalleProducto := DELCHR(ItemName,'=','&');"										
										
IF Transaction.FacturaConsumidorFinal THEN BEGIN										
"IF (Item.""No."" = vProductoTelefonica1) OR (Item.""No."" = vProductoTelefonica2)"										
"OR (Item.""No."" = vProductoTelefonica3) OR (Item.""No."" = vProductoTelefonica4) THEN BEGIN"										
"vDetallePrecio := ROUND(ROUND(SalesEntry.Price/1.18,0.0001)+ROUND(ROUND(SalesEntry.Price/1.18,0.0001)*0.13,0.0001),0"	0	01)	;							
"vDetalleVentasAfectas := ROUND(ROUND(SalesEntry.Price/1.18,0.0001)+ROUND(ROUND(SalesEntry.Price/1.18,0.0001)*0.13,0."	0	"1),"	0	0	1) * ABS(SalesEntry.Quantity);					
END										
ELSE BEGIN										
vDetallePrecio := ABS(SalesEntry.Price);										
vDetalleVentasAfectas := ROUND(-(SalesEntry.Price * SalesEntry.Quantity));										
END;										
END										
ELSE IF Transaction.FacturaCreditoFiscal THEN BEGIN										
//CSPNT300816										
"IF (Item.""No."" = vProductoTelefonica1) OR (Item.""No."" = vProductoTelefonica2)"										
"OR (Item.""No."" = vProductoTelefonica3) OR (Item.""No."" = vProductoTelefonica4) THEN BEGIN"										
"vDetallePrecio := ROUND(ROUND(SalesEntry.Price/1.18,0.0001),0.0001);"										
"vDetalleVentasAfectas := ROUND(ROUND(SalesEntry.Price/1.18,0.0001),0.0001) * ABS(SalesEntry.Quantity);"										
END										
ELSE BEGIN										
"vDetallePrecio := ROUND((SalesEntry.Price / (1 + (Impuesto / 100))),0.0001);"										
"vDetalleVentasAfectas := (ROUND((SalesEntry.Price / (1 + (Impuesto / 100))),0.0001)) * ABS(SalesEntry.Quantity);"										
END;										
END										
"ELSE IF Transaction.""Sale Is Return Sale"" AND Transaction.NotaCredito THEN BEGIN"										
//CSPNT300816										
"IF (Item.""No."" = vProductoTelefonica1) OR (Item.""No."" = vProductoTelefonica2)"										
"OR (Item.""No."" = vProductoTelefonica3) OR (Item.""No."" = vProductoTelefonica4) THEN BEGIN"										
"vDetallePrecio := ROUND(ROUND(SalesEntry.Price/1.18,0.0001),0.0001);"										
"vDetalleVentasAfectas := ROUND(ROUND(SalesEntry.Price/1.18,0.0001),0.0001) * ABS(SalesEntry.Quantity);"										
END										
ELSE BEGIN										
"vDetallePrecio := ROUND((SalesEntry.Price / (1 + (Impuesto / 100))),0.0001);"										
"vDetalleVentasAfectas := (ROUND((SalesEntry.Price / (1 + (Impuesto / 100))),0.0001)) * ABS(SalesEntry.Quantity);"										
END;										
END										
"ELSE IF Transaction.""Sale Is Return Sale"" AND Transaction.FacturaConsumidorFinal THEN BEGIN"										
"vDetallePrecio := -(SalesEntry.""Net Amount"") / ABS(SalesEntry.Quantity);"										
vDetalleVentasAfectas := -(SalesEntry.Price * SalesEntry.Quantity);										
END;										
										
"IF SalesEntry.""Discount Amount"" <> 0 THEN BEGIN"										
"IF Transaction.""Sale Is Return Sale"" THEN BEGIN"										
IF Transaction.NotaCredito THEN BEGIN										
"vDetalleDescuento := (ROUND((SalesEntry.""Discount Amount"" / (1 + (Impuesto / 100))),0.01));"										
END ELSE BEGIN										
"vDetalleDescuento := SalesEntry.""Discount Amount"";"										
END;										
END ELSE BEGIN										
IF Transaction.FacturaConsumidorFinal THEN BEGIN										
"vDetalleDescuento := (ROUND((SalesEntry.""Discount Amount""),0.01));"										
END ELSE BEGIN										
"vDetalleDescuento := (ROUND((SalesEntry.""Discount Amount"" / (1 + (Impuesto / 100))),0.01));"										
END;										
END;										
END;										
										
IF NOT Transaction.NotaRemision THEN BEGIN										
xmlDetalles := '<DetalleDocumento>' +										
'<Codigo>' + vDetalleCodigo + '</Codigo>' +										
"'<Producto>' + DELCHR(DELCHR(vDetalleProducto,'=','>'),'=','<') + '</Producto>' +"										
"'<Cantidad>' +  DELCHR(FORMAT(vDetalleCantidad),'=',',') + '</Cantidad>';"										
IF vDetallePrecio <> 0 THEN										
"xmlDetalles := xmlDetalles + '<Precio>' + DELCHR(FORMAT(vDetallePrecio),'=',',') + '</Precio>';"										
IF vDetalleDescuento <> 0 THEN										
"xmlDetalles := xmlDetalles + '<Descuento>' + DELCHR(FORMAT(vDetalleDescuento),'=',',') + '</Descuento>';"										
IF vDetalleVentasNoSujetas <> 0 THEN										
"xmlDetalles := xmlDetalles + '<VentasNoSujetas>' + DELCHR(FORMAT(vDetalleVentasNoSujetas),'=',',') + '</VentasNoSuje"	tas	>';								
IF vDetalleVentasExentas <> 0 THEN										
"xmlDetalles := xmlDetalles + '<VentasExentas>' + DELCHR(FORMAT(vDetalleVentasExentas),'=',',') + '</VentasExentas>';"										
IF vDetalleVentasAfectas <> 0 THEN										
"xmlDetalles := xmlDetalles + '<VentasAfectas>' + DELCHR(FORMAT(vDetalleVentasAfectas),'=',',') + '</VentasAfectas>';"										
xmlDetalles := xmlDetalles +										
"'<CostoNeto>' + DELCHR(FORMAT(vDetalleCostoNeto),'=',',') + '</CostoNeto>' +"										
"'<Total>' + DELCHR(FORMAT(vDetalleVentasAfectas),'=',',') + '</Total>' +"										
'</DetalleDocumento>';										
xmlDetallesBig.ADDTEXT(xmlDetalles);										
										
vDetalleCodigo := ' ';										
vDetalleProducto := ' ';										
vDetalleCantidad := 0;										
vDetallePrecio := 0;										
vDetalleDescuento := 0;										
vDetalleVentasNoSujetas := 0;										
vDetalleVentasExentas := 0;										
vDetalleVentasAfectas := 0;										
vDetalleCostoNeto := 0;										
vDetalleTotal := 0;										
END;										
										
/// DESACTIVADO POR CORREO DEL 15 DE MAYO DE 2017										
/// CSALX20170506 Imprimir descuentos de linea										
///CLEAR(xDescuentos);										
///xDescuentos.RESET;										
"///xDescuentos.SETRANGE(""Receipt No."", SalesEntry.""Receipt No."");"										
"///xDescuentos.SETRANGE(""Transaction No."", SalesEntry.""Transaction No."");"										
"///xDescuentos.SETRANGE(""Line No."", SalesEntry.""Line No."");"										
///IF xDescuentos.FIND('-') THEN REPEAT										
"///  IF (xDescuentos.""Offer Type"" <> xDescuentos.""Offer Type""::""Tender Type"") AND"										
"///    (xDescuentos.""Offer Type"" <> xDescuentos.""Offer Type""::Customer) THEN BEGIN"										
"///    IF PeriodicDiscountInfoTEMP.GET(xDescuentos.""Offer No."") THEN"										
///      vDetalleProducto := PeriodicDiscountInfoTEMP.Description										
///    ELSE										
"///      vDetalleProducto := xDescuentos.""Offer No."";"										
///										
"///      IF Transaction.""Sale Is Return Sale"" THEN BEGIN"										
///        IF Transaction.NotaCredito THEN BEGIN										
"///          vDetalleDescuento := (ROUND(-(xDescuentos.""Discount Amount"" / (1 + (Impuesto / 100))),0.01));"										
///        END ELSE BEGIN										
"///          vDetalleDescuento := xDescuentos.""Discount Amount"";"										
///        END;										
///      END ELSE BEGIN										
///        IF Transaction.FacturaConsumidorFinal THEN BEGIN										
"///          vDetalleDescuento := (ROUND(-(xDescuentos.""Discount Amount""),0.01));"										
///        END ELSE BEGIN										
"///          vDetalleDescuento := (ROUND(-(xDescuentos.""Discount Amount"" / (1 + (Impuesto / 100))),0.01));"										
///        END;										
///      END;										
///										
///    IF NOT Transaction.NotaRemision THEN BEGIN										
///      xmlDetalles := '<DetalleDocumento>' +										
///                      '<Codigo>' + vDetalleCodigo + '</Codigo>' +										
"///                      '<Producto>' + DELCHR(DELCHR(vDetalleProducto,'=','>'),'=','<') + '</Producto>' +"										
"///                      '<Precio>' + DELCHR(FORMAT(vDetallePrecio),'=',',') + '</Precio>' +"										
"///                      '<Descuento>' + DELCHR(FORMAT(vDetalleDescuento),'=',',') + '</Descuento>' +"										
"///                      '<VentasNoSujetas>' + DELCHR(FORMAT(vDetalleVentasNoSujetas),'=',',') + '</VentasNoSujetas>' +"										
"///                      '<VentasExentas>' + DELCHR(FORMAT(vDetalleVentasExentas),'=',',') + '</VentasExentas>' +"										
"///                      '<VentasAfectas>' + DELCHR(FORMAT(vDetalleDescuento),'=',',') + '</VentasAfectas>' +"										
"///                      '<CostoNeto>' + DELCHR(FORMAT(vDetalleCostoNeto),'=',',') + '</CostoNeto>' +"										
"///                      '<Total>' + DELCHR(FORMAT(vDetalleDescuento),'=',',') + '</Total>' +"										
///                    '</DetalleDocumento>';										
///      xmlDetallesBig.ADDTEXT(xmlDetalles);										
///    END;										
///  END;										
///  vDetalleProducto := '';										
///  vDetalleDescuento := 0;										
///UNTIL xDescuentos.NEXT <= 0;										
///										
///{										
//CSPNT121015 Descuento impuesto gravado										
"///IF (SalesEntry.""Discount Amount"" <> 0) OR"										
"///(SalesEntry.""Discount Amt. For Printing"" <> 0) OR"										
"///(SalesEntry.""Line Discount"" <> 0) OR"										
"///(SalesEntry.""Coupon Amt. For Printing"" <> 0) THEN BEGIN"										
"///  IF ((SalesEntry.""Periodic Discount"" <> 0) OR"										
"///  (SalesEntry.""Discount Amt. For Printing"" <> 0)) AND"										
"///  (SalesEntry.""Customer Discount"" = 0) THEN BEGIN"										
"///    IF (SalesEntry.""Periodic Disc. Type"" <> SalesEntry.""Periodic Disc. Type""::"" "") THEN BEGIN"										
"///      IF SalesEntry.""Periodic Disc. Type"" = SalesEntry.""Periodic Disc. Type""::""Mix&Match"" THEN"										
"///        BufferDiscount(PerDiscOffArr,PerDiscOffAmtArr,PerDiscOffArrCount,SalesEntry.""Periodic Disc. Group"",SalesEntry"	".""D"	isc	ou	nt	"Amt. For Printing"")"					
"///        {ELSE IF SalesEntry.""Periodic Disc. Type"" = SalesEntry.""Periodic Disc. Type""::""Multibuy"" THEN"										
"///        BufferDiscount(PerDiscOffArr,PerDiscOffAmtArr,PerDiscOffArrCount,SalesEntry.""Periodic Disc. Group"",SalesEntry"	".""D"	isc	ou	nt	"Amt. For Printing"")}"					
///      ELSE										
"///        BufferDiscount(PerDiscOffArr,PerDiscOffAmtArr,PerDiscOffArrCount,SalesEntry.""Periodic Disc. Group"",SalesEntry"	".""P"	eri	od	ic	"Discount"");"					
"///      IF PeriodicDiscount.GET(SalesEntry.""Periodic Disc. Group"") THEN"										
///        discText := PeriodicDiscount.Description										
///      ELSE										
///        discText := FORMAT(PeriodicDiscount.Type);										
///    END;										
"///    IF SalesEntry.""Discount Amt. For Printing"" <> 0 THEN BEGIN"										
///      vDetalleProducto := discText;										
"///      IF Transaction.""Sale Is Return Sale"" THEN BEGIN"										
///        IF Transaction.NotaCredito THEN BEGIN										
"///          vDetalleDescuento := (ROUND(-(SalesEntry.""Discount Amt. For Printing"" / (1 + (Impuesto / 100))),0.01));"										
///        END										
///        ELSE BEGIN										
"///          vDetalleDescuento := SalesEntry.""Discount Amt. For Printing"";"										
///        END;										
///      END										
///      ELSE BEGIN										
///        //CSPNT191015 Descuento Multibuy										
///        IF Transaction.FacturaConsumidorFinal THEN BEGIN										
"///          vDetalleDescuento := (ROUND(-(SalesEntry.""Discount Amt. For Printing""),0.01));"										
///        END										
///        ELSE BEGIN										
"///          vDetalleDescuento := (ROUND(-(SalesEntry.""Discount Amt. For Printing"" / (1 + (Impuesto / 100))),0.01));"										
///        END;										
///      END;										
///										
///      IF NOT Transaction.NotaRemision THEN BEGIN										
///        xmlDetalles := '<DetalleDocumento>' +										
///                        '<Codigo>' + vDetalleCodigo + '</Codigo>' +										
"///                        '<Producto>' + DELCHR(DELCHR(vDetalleProducto,'=','>'),'=','<') + '</Producto>' +"										
///                        '<Cantidad></Cantidad>' +										
"///                        '<Precio>' + DELCHR(FORMAT(vDetallePrecio),'=',',') + '</Precio>' +"										
"///                        '<Descuento>' + DELCHR(FORMAT(vDetalleDescuento),'=',',') + '</Descuento>' +"										
"///                        '<VentasNoSujetas>' + DELCHR(FORMAT(vDetalleVentasNoSujetas),'=',',') + '</VentasNoSujetas>'"	+									
"///                        '<VentasExentas>' + DELCHR(FORMAT(vDetalleVentasExentas),'=',',') + '</VentasExentas>' +"										
"///                        '<VentasAfectas>' + DELCHR(FORMAT(vDetalleDescuento),'=',',') + '</VentasAfectas>' +"										
"///                        '<CostoNeto>' + DELCHR(FORMAT(vDetalleCostoNeto),'=',',') + '</CostoNeto>' +"										
"///                        '<Total>' + DELCHR(FORMAT(vDetalleDescuento),'=',',') + '</Total>' +"										
///                      '</DetalleDocumento>';										
///        xmlDetallesBig.ADDTEXT(xmlDetalles);										
///      END;										
///      vDetalleCodigo := ' ';										
///      vDetalleProducto := ' ';										
///      vDetalleCantidad := 0;										
///      vDetallePrecio := 0;										
///      vDetalleDescuento := 0;										
///      vDetalleVentasNoSujetas := 0;										
///      vDetalleVentasExentas := 0;										
///      vDetalleVentasAfectas := 0;										
///      vDetalleCostoNeto := 0;										
///      vDetalleTotal := 0;										
///    END										
"///    ELSE IF SalesEntry.""Periodic Disc. Type"" = SalesEntry.""Periodic Disc. Type""::""Disc. Offer"" THEN BEGIN"										
///      vDetalleProducto := discText;										
///      IF Transaction.FacturaCreditoFiscal THEN BEGIN										
"///        vDetalleDescuento := (ROUND(-(SalesEntry.""Periodic Discount"" / (1 + (Impuesto / 100))),0.01));"										
///      END										
///      ELSE IF Transaction.NotaCredito THEN BEGIN										
"///        vDetalleDescuento := (ROUND((SalesEntry.""Periodic Discount"" / (1 + (Impuesto / 100))),0.01));"										
///      END										
///      ELSE BEGIN										
"///        vDetalleDescuento := (ROUND(-(SalesEntry.""Periodic Discount""),0.00001));"										
///      END;										
///										
///      IF NOT Transaction.NotaRemision THEN BEGIN										
///        xmlDetalles := '<DetalleDocumento>' +										
///                        '<Codigo>' + vDetalleCodigo + '</Codigo>' +										
"///                        '<Producto>' + DELCHR(DELCHR(vDetalleProducto,'=','>'),'=','<') + '</Producto>' +"										
///                        '<Cantidad></Cantidad>' +										
"///                        '<Precio>' + DELCHR(FORMAT(vDetallePrecio),'=',',') + '</Precio>' +"										
"///                        '<Descuento>' + DELCHR(FORMAT(vDetalleDescuento),'=',',') + '</Descuento>' +"										
"///                        '<VentasNoSujetas>' + DELCHR(FORMAT(vDetalleVentasNoSujetas),'=',',') + '</VentasNoSujetas>'"	+									
"///                        '<VentasExentas>' + DELCHR(FORMAT(vDetalleVentasExentas),'=',',') + '</VentasExentas>' +"										
"///                        '<VentasAfectas>' + DELCHR(FORMAT(vDetalleDescuento),'=',',') + '</VentasAfectas>' +"										
"///                        '<CostoNeto>' + DELCHR(FORMAT(vDetalleCostoNeto),'=',',') + '</CostoNeto>' +"										
"///                        '<Total>' + DELCHR(FORMAT(vDetalleDescuento),'=',',') + '</Total>' +"										
///                      '</DetalleDocumento>';										
///        xmlDetallesBig.ADDTEXT(xmlDetalles);										
///      END;										
///      vDetalleCodigo := ' ';										
///      vDetalleProducto := ' ';										
///      vDetalleCantidad := 0;										
///      vDetallePrecio := 0;										
///      vDetalleDescuento := 0;										
///      vDetalleVentasNoSujetas := 0;										
///      vDetalleVentasExentas := 0;										
///      vDetalleVentasAfectas := 0;										
///      vDetalleCostoNeto := 0;										
///      vDetalleTotal := 0;										
///    END;										
///  END										
///  //CSMQ050116*************************************************************************										
"///  //Este es para que si no es Periodic Discount, muestre el descuento por medio de pago"										
"///  ELSE IF SalesEntry.""Discount Amount"" <> 0 THEN BEGIN"										
///    vDetalleProducto := PeriodicDiscountInfoTEMP.Description;										
"///    IF (Transaction.""No. Serie NCF"" = POSTerminal.""No. Serie NCF Credito Fiscal"") THEN BEGIN"										
"///      vDetalleDescuento := ROUND(-(SalesEntry.""Discount Amount"" / (1 + (Impuesto / 100))),0.01);"										
///    END										
"///    ELSE IF (Transaction.""No. Serie NCF"" = POSTerminal.""No. Serie NCF Nota de Credito"") THEN BEGIN"										
"///      vDetalleDescuento := ROUND((SalesEntry.""Discount Amount"" / (1 + (Impuesto / 100))),0.01);"										
///    END										
///    ELSE BEGIN										
"///      vDetalleDescuento := -SalesEntry.""Discount Amount"";"										
///    END;										
///    IF NOT Transaction.NotaRemision THEN BEGIN										
///      xmlDetalles := '<DetalleDocumento>' +										
///                      '<Codigo>' + vDetalleCodigo + '</Codigo>' +										
"///                      '<Producto>' + DELCHR(DELCHR(vDetalleProducto,'=','>'),'=','<') + '</Producto>' +"										
///                      '<Cantidad></Cantidad>' +										
"///                      '<Precio>' + DELCHR(FORMAT(vDetallePrecio),'=',',') + '</Precio>' +"										
"///                      '<Descuento>' + DELCHR(FORMAT(vDetalleDescuento),'=',',') + '</Descuento>' +"										
"///                      '<VentasNoSujetas>' + DELCHR(FORMAT(vDetalleVentasNoSujetas),'=',',') + '</VentasNoSujetas>' +"										
"///                      '<VentasExentas>' + DELCHR(FORMAT(vDetalleVentasExentas),'=',',') + '</VentasExentas>' +"										
"///                      '<VentasAfectas>' + DELCHR(FORMAT(vDetalleDescuento),'=',',') + '</VentasAfectas>' +"										
"///                      '<CostoNeto>' + DELCHR(FORMAT(vDetalleCostoNeto),'=',',') + '</CostoNeto>' +"										
"///                      '<Total>' + DELCHR(FORMAT(vDetalleDescuento),'=',',') + '</Total>' +"										
///                    '</DetalleDocumento>';										
///      xmlDetallesBig.ADDTEXT(xmlDetalles);										
///    END;										
///    vDetalleCodigo := ' ';										
///    vDetalleProducto := ' ';										
///    vDetalleCantidad := 0;										
///    vDetallePrecio := 0;										
///    vDetalleDescuento := 0;										
///    vDetalleVentasNoSujetas := 0;										
///    vDetalleVentasExentas := 0;										
///    vDetalleVentasAfectas := 0;										
///    vDetalleCostoNeto := 0;										
///    vDetalleTotal := 0;										
///  END;										
///  //************************************************************************************										
///										
"///  IF SalesEntry.""Line Discount"" <> 0 THEN BEGIN"										
///    vDetalleProducto := Text084;										
///    IF Transaction.FacturaCreditoFiscal THEN BEGIN										
"///      vDetalleDescuento := (ROUND(-(SalesEntry.""Line Discount"" / (1 + (Impuesto / 100))),0.01));"										
///    END										
///    ELSE BEGIN										
"///      vDetalleDescuento := -SalesEntry.""Line Discount"";"										
///    END;										
///										
///    IF NOT Transaction.NotaRemision THEN BEGIN										
///      xmlDetalles := '<DetalleDocumento>' +										
///                      '<Codigo>' + vDetalleCodigo + '</Codigo>' +										
"///                      '<Producto>' + DELCHR(DELCHR(vDetalleProducto,'=','>'),'=','<') + '</Producto>' +"										
///                      '<Cantidad></Cantidad>' +										
"///                      '<Precio>' + DELCHR(FORMAT(vDetallePrecio),'=',',') + '</Precio>' +"										
"///                      '<Descuento>' + DELCHR(FORMAT(vDetalleDescuento),'=',',') + '</Descuento>' +"										
"///                      '<VentasNoSujetas>' + DELCHR(FORMAT(vDetalleVentasNoSujetas),'=',',') + '</VentasNoSujetas>' +"										
"///                      '<VentasExentas>' + DELCHR(FORMAT(vDetalleVentasExentas),'=',',') + '</VentasExentas>' +"										
"///                      '<VentasAfectas>' + DELCHR(FORMAT(vDetalleDescuento),'=',',') + '</VentasAfectas>' +"										
"///                      '<CostoNeto>' + DELCHR(FORMAT(vDetalleCostoNeto),'=',',') + '</CostoNeto>' +"										
"///                      '<Total>' + DELCHR(FORMAT(vDetalleDescuento),'=',',') + '</Total>' +"										
///                    '</DetalleDocumento>';										
///      xmlDetallesBig.ADDTEXT(xmlDetalles);										
///    END;										
///    vDetalleCodigo := ' ';										
///    vDetalleProducto := ' ';										
///    vDetalleCantidad := 0;										
///    vDetallePrecio := 0;										
///    vDetalleDescuento := 0;										
///    vDetalleVentasNoSujetas := 0;										
///    vDetalleVentasExentas := 0;										
///    vDetalleVentasAfectas := 0;										
///    vDetalleCostoNeto := 0;										
///    vDetalleTotal := 0;										
///  END;										
///										
"///  IF SalesEntry.""Coupon Amt. For Printing"" <> 0 THEN BEGIN"										
///    vDetalleProducto := Text165;										
///    IF Transaction.FacturaCreditoFiscal THEN BEGIN										
"///      vDetalleDescuento := (ROUND(-(SalesEntry.""Coupon Amt. For Printing"" / (1 + (Impuesto / 100))),0.01));"										
///    END										
///    ELSE BEGIN										
"///      vDetalleDescuento := -SalesEntry.""Coupon Amt. For Printing"";"										
///    END;										
///										
///    IF NOT Transaction.NotaRemision THEN BEGIN										
///      xmlDetalles := '<DetalleDocumento>' +										
///                      '<Codigo>' + vDetalleCodigo + '</Codigo>' +										
"///                      '<Producto>' + DELCHR(DELCHR(vDetalleProducto,'=','>'),'=','<') + '</Producto>' +"										
///                      '<Cantidad></Cantidad>' +										
"///                      '<Precio>' + DELCHR(FORMAT(vDetallePrecio),'=',',') + '</Precio>' +"										
"///                      '<Descuento>' + DELCHR(FORMAT(vDetalleDescuento),'=',',') + '</Descuento>' +"										
"///                      '<VentasNoSujetas>' + DELCHR(FORMAT(vDetalleVentasNoSujetas),'=',',') + '</VentasNoSujetas>' +"										
"///                      '<VentasExentas>' + DELCHR(FORMAT(vDetalleVentasExentas),'=',',') + '</VentasExentas>' +"										
"///                      '<VentasAfectas>' + DELCHR(FORMAT(vDetalleDescuento),'=',',') + '</VentasAfectas>' +"										
"///                      '<CostoNeto>' + DELCHR(FORMAT(vDetalleCostoNeto),'=',',') + '</CostoNeto>' +"										
"///                      '<Total>' + DELCHR(FORMAT(vDetalleDescuento),'=',',') + '</Total>' +"										
///                    '</DetalleDocumento>';										
///      xmlDetallesBig.ADDTEXT(xmlDetalles);										
///    END;										
///										
///    vDetalleCodigo := ' ';										
///    vDetalleProducto := ' ';										
///    vDetalleCantidad := 0;										
///    vDetallePrecio := 0;										
///    vDetalleDescuento := 0;										
///    vDetalleVentasNoSujetas := 0;										
///    vDetalleVentasExentas := 0;										
///    vDetalleVentasAfectas := 0;										
///    vDetalleCostoNeto := 0;										
///    vDetalleTotal := 0;										
///										
///  END;										
///END;										
///										
/////CSPNT190116 Descuento de cliente										
"///IF (SalesEntry.""Customer Discount"" <> 0) THEN BEGIN"										
"///  IF (SalesEntry.""Periodic Disc. Type"" = SalesEntry.""Periodic Disc. Type""::"" "") THEN BEGIN"										
///    vDetalleProducto := Text085;										
///    IF Transaction.FacturaConsumidorFinal THEN BEGIN										
"///      vDetalleDescuento := (ROUND(-(SalesEntry.""Customer Discount""),0.01));"										
///    END										
///    ELSE BEGIN										
"///      vDetalleDescuento := (ROUND(-(SalesEntry.""Customer Discount"" / (1 + (Impuesto / 100))),0.01));"										
///    END;										
///										
///    IF NOT Transaction.NotaRemision THEN BEGIN										
///      xmlDetalles := '<DetalleDocumento>' +										
///                      '<Codigo>' + vDetalleCodigo + '</Codigo>' +										
"///                      '<Producto>' + DELCHR(DELCHR(vDetalleProducto,'=','>'),'=','<') + '</Producto>' +"										
///                      '<Cantidad></Cantidad>' +										
"///                      '<Precio>' + DELCHR(FORMAT(vDetallePrecio),'=',',') + '</Precio>' +"										
"///                      '<Descuento>' + DELCHR(FORMAT(vDetalleDescuento),'=',',') + '</Descuento>' +"										
"///                      '<VentasNoSujetas>' + DELCHR(FORMAT(vDetalleVentasNoSujetas),'=',',') + '</VentasNoSujetas>' +"										
"///                      '<VentasExentas>' + DELCHR(FORMAT(vDetalleVentasExentas),'=',',') + '</VentasExentas>' +"										
"///                      '<VentasAfectas>' + DELCHR(FORMAT(vDetalleDescuento),'=',',') + '</VentasAfectas>' +"										
"///                      '<CostoNeto>' + DELCHR(FORMAT(vDetalleCostoNeto),'=',',') + '</CostoNeto>' +"										
"///                      '<Total>' + DELCHR(FORMAT(vDetalleDescuento),'=',',') + '</Total>' +"										
///                    '</DetalleDocumento>';										
///      xmlDetallesBig.ADDTEXT(xmlDetalles);										
///    END;										
///    vDetalleCodigo := ' ';										
///    vDetalleProducto := ' ';										
///    vDetalleCantidad := 0;										
///    vDetallePrecio := 0;										
///    vDetalleDescuento := 0;										
///    vDetalleVentasNoSujetas := 0;										
///    vDetalleVentasExentas := 0;										
///    vDetalleVentasAfectas := 0;										
///    vDetalleCostoNeto := 0;										
///    vDetalleTotal := 0;										
///  END;										
///END;										
///}										
///										
IF Transaction.FacturaConsumidorFinal THEN BEGIN										
//CSPNT300816										
"IF (Item.""No."" = vProductoTelefonica1) OR (Item.""No."" = vProductoTelefonica2)"										
"OR (Item.""No."" = vProductoTelefonica3) OR (Item.""No."" = vProductoTelefonica4) THEN"										
"TotalVentG   += ABS(SalesEntry.""Net Amount"") + ABS(SalesEntry.""VAT Amount"") - vCesc"										
ELSE										
IF EsRemision THEN										
"TotalVentG   += (SalesEntry.""Net Amount"" * -1) + (SalesEntry.""VAT Amount"" * -1)"										
ELSE										
"TotalVentG   += ABS(SalesEntry.""Net Amount"") + ABS(SalesEntry.""VAT Amount"");"										
END										
ELSE IF Transaction.FacturaCreditoFiscal THEN BEGIN										
//CSPNT300816										
"IF (Item.""No."" = vProductoTelefonica1) OR (Item.""No."" = vProductoTelefonica2)"										
"OR (Item.""No."" = vProductoTelefonica3) OR (Item.""No."" = vProductoTelefonica4) THEN BEGIN"										
"TotalVentG   += ABS(SalesEntry.""Net Amount"");"										
//CSPNT090916										
"TotalIVA     += ABS(SalesEntry.""VAT Amount"" + vCesc);"										
END										
ELSE BEGIN										
IF EsRemision THEN BEGIN										
"TotalVentG   += (SalesEntry.""Net Amount"" * -1);"										
"TotalIVA     += (SalesEntry.""VAT Amount"" * -1);"										
END ELSE BEGIN										
"TotalVentG   += ABS(SalesEntry.""Net Amount"");"										
"TotalIVA     += ABS(SalesEntry.""VAT Amount"");"										
END;										
END;										
END										
"ELSE IF Transaction.""Sale Is Return Sale"" AND Transaction.NotaCredito THEN BEGIN"										
//CSPNT280916										
"IF (Item.""No."" = vProductoTelefonica1) OR (Item.""No."" = vProductoTelefonica2)"										
"OR (Item.""No."" = vProductoTelefonica3) OR (Item.""No."" = vProductoTelefonica4) THEN BEGIN"										
"TotalVentG   += ABS(SalesEntry.""Net Amount"");"										
"TotalIVA     += ABS(SalesEntry.""VAT Amount"" - vCesc);"										
END										
ELSE BEGIN										
IF EsRemision THEN BEGIN										
"TotalVentG   += (SalesEntry.""Net Amount"" * -1);"										
"TotalIVA     += (SalesEntry.""VAT Amount"" * -1);"										
END ELSE BEGIN										
"TotalVentG   += ABS(SalesEntry.""Net Amount"");"										
"TotalIVA     += ABS(SalesEntry.""VAT Amount"");"										
END;										
END;										
END										
"ELSE IF Transaction.""Sale Is Return Sale"" AND Transaction.FacturaConsumidorFinal THEN BEGIN"										
IF EsRemision THEN										
"TotalVentG   += (SalesEntry.""Net Amount"" * -1) + (SalesEntry.""VAT Amount"" * -1)"										
ELSE										
"TotalVentG   += ABS(SalesEntry.""Net Amount"") + ABS(SalesEntry.""VAT Amount"");"										
END;										
END										
										
//impuesto exento										
ELSE IF rImpuestos.Impuesto=rImpuestos.Impuesto::Exento THEN BEGIN										
"IF Transaction.""Sale Is Return Sale"" AND Transaction.NotaCredito THEN BEGIN"										
vDetalleCantidad := SalesEntry.Quantity;										
END										
ELSE BEGIN										
vDetalleCantidad := -SalesEntry.Quantity;										
END;										
										
//CSPNT070916										
"vDetalleProducto := DELCHR(ItemName,'=','&');"										
//vDetalleProducto := ItemName;										
										
"IF (Transaction.""Sale Is Return Sale"" AND Transaction.NotaCredito)"										
OR Transaction.FacturaCreditoFiscal THEN BEGIN										
"vDetallePrecio:=ROUND(SalesEntry.""Net Price"",0.01);"										
END										
ELSE BEGIN										
"vDetallePrecio := SalesEntry.""Net Price"";"										
END;										
										
"IF Transaction.""Sale Is Return Sale"" AND Transaction.NotaCredito THEN BEGIN"										
vDetalleVentasExentas := (SalesEntry.Price * SalesEntry.Quantity);										
END										
ELSE BEGIN										
vDetalleVentasExentas := -(SalesEntry.Price * SalesEntry.Quantity);										
END;										
										
"IF SalesEntry.""Discount Amount"" <> 0 THEN BEGIN"										
"IF (Transaction.""No. Serie NCF"" = POSTerminal.""No. Serie NCF Credito Fiscal"") THEN BEGIN"										
"vDetalleDescuento := ROUND((SalesEntry.""Discount Amount"" / (1 + (Impuesto / 100))),0.01);"										
"END ELSE IF (Transaction.""No. Serie NCF"" = POSTerminal.""No. Serie NCF Nota de Credito"") THEN BEGIN"										
"vDetalleDescuento := ROUND((SalesEntry.""Discount Amount"" / (1 + (Impuesto / 100))),0.01);"										
END ELSE BEGIN										
"vDetalleDescuento := SalesEntry.""Discount Amount"";"										
END;										
END;										
										
IF NOT Transaction.NotaRemision THEN BEGIN										
xmlDetalles := '<DetalleDocumento>' +										
'<Codigo>' + vDetalleCodigo + '</Codigo>' +										
"'<Producto>' + DELCHR(DELCHR(vDetalleProducto,'=','>'),'=','<') + '</Producto>' +"										
"'<Cantidad>' +  DELCHR(FORMAT(vDetalleCantidad),'=',',') + '</Cantidad>';"										
IF vDetallePrecio <> 0 THEN										
"xmlDetalles := xmlDetalles + '<Precio>' + DELCHR(FORMAT(vDetallePrecio),'=',',') + '</Precio>';"										
IF vDetalleDescuento <> 0 THEN										
"xmlDetalles := xmlDetalles + '<Descuento>' + DELCHR(FORMAT(vDetalleDescuento),'=',',') + '</Descuento>';"										
IF vDetalleVentasNoSujetas <> 0 THEN										
"xmlDetalles := xmlDetalles + '<VentasNoSujetas>' + DELCHR(FORMAT(vDetalleVentasNoSujetas),'=',',') + '</VentasNoSuje"	tas	>';								
IF vDetalleVentasExentas <> 0 THEN										
"xmlDetalles := xmlDetalles + '<VentasExentas>' + DELCHR(FORMAT(vDetalleVentasExentas),'=',',') + '</VentasExentas>';"										
IF vDetalleVentasAfectas <> 0 THEN										
"xmlDetalles := xmlDetalles + '<VentasAfectas>' + DELCHR(FORMAT(vDetalleVentasAfectas),'=',',') + '</VentasAfectas>';"										
xmlDetalles := xmlDetalles +										
"'<CostoNeto>' + DELCHR(FORMAT(vDetalleCostoNeto),'=',',') + '</CostoNeto>' +"										
"'<Total>' + DELCHR(FORMAT(vDetalleVentasExentas),'=',',') + '</Total>' +"										
'</DetalleDocumento>';										
xmlDetallesBig.ADDTEXT(xmlDetalles);										
										
vDetalleCodigo := ' ';										
vDetalleProducto := ' ';										
vDetalleCantidad := 0;										
vDetallePrecio := 0;										
vDetalleDescuento := 0;										
vDetalleVentasNoSujetas := 0;										
vDetalleVentasExentas := 0;										
vDetalleVentasAfectas := 0;										
vDetalleCostoNeto := 0;										
vDetalleTotal := 0;										
END;										
										
/// DESACTIVADO SEGUN INSTRUCCIONES DE CORREO DE FECHA 15 DE MAYO DE 2017										
/// CSALX20170506 Imprimir descuentos de linea										
///CLEAR(xDescuentos);										
///xDescuentos.RESET;										
"///xDescuentos.SETRANGE(""Receipt No."", SalesEntry.""Receipt No."");"										
"///xDescuentos.SETRANGE(""Transaction No."", SalesEntry.""Transaction No."");"										
"///xDescuentos.SETRANGE(""Line No."", SalesEntry.""Line No."");"										
///IF xDescuentos.FIND('-') THEN REPEAT										
"///  IF (xDescuentos.""Offer Type"" <> xDescuentos.""Offer Type""::""Tender Type"") AND"										
"///    (xDescuentos.""Offer Type"" <> xDescuentos.""Offer Type""::Customer) THEN BEGIN"										
"///    IF PeriodicDiscountInfoTEMP.GET(xDescuentos.""Offer No."") THEN"										
///      vDetalleProducto := PeriodicDiscountInfoTEMP.Description										
///    ELSE										
"///      vDetalleProducto := xDescuentos.""Offer No."";"										
///										
"///    IF (Transaction.""No. Serie NCF"" = POSTerminal.""No. Serie NCF Credito Fiscal"") THEN BEGIN"										
"///      vDetalleDescuento := ROUND(-(SalesEntry.""Discount Amount"" / (1 + (Impuesto / 100))),0.01);"										
"///    END ELSE IF (Transaction.""No. Serie NCF"" = POSTerminal.""No. Serie NCF Nota de Credito"") THEN BEGIN"										
"///      vDetalleDescuento := ROUND((SalesEntry.""Discount Amount"" / (1 + (Impuesto / 100))),0.01);"										
///    END ELSE BEGIN										
"///      vDetalleDescuento := -SalesEntry.""Discount Amount"";"										
///    END;										
///										
///    IF NOT Transaction.NotaRemision THEN BEGIN										
///      xmlDetalles := '<DetalleDocumento>' +										
///                      '<Codigo>' + vDetalleCodigo + '</Codigo>' +										
"///                      '<Producto>' + DELCHR(DELCHR(vDetalleProducto,'=','>'),'=','<') + '</Producto>' +"										
"///                      '<Precio>' + DELCHR(FORMAT(vDetallePrecio),'=',',') + '</Precio>' +"										
"///                      '<Descuento>' + DELCHR(FORMAT(vDetalleDescuento),'=',',') + '</Descuento>' +"										
"///                      '<VentasNoSujetas>' + DELCHR(FORMAT(vDetalleVentasNoSujetas),'=',',') + '</VentasNoSujetas>' +"										
"///                      '<VentasExentas>' + DELCHR(FORMAT(vDetalleVentasExentas),'=',',') + '</VentasExentas>' +"										
"///                      '<VentasAfectas>' + DELCHR(FORMAT(vDetalleDescuento),'=',',') + '</VentasAfectas>' +"										
"///                      '<CostoNeto>' + DELCHR(FORMAT(vDetalleCostoNeto),'=',',') + '</CostoNeto>' +"										
"///                      '<Total>' + DELCHR(FORMAT(vDetalleDescuento),'=',',') + '</Total>' +"										
///                    '</DetalleDocumento>';										
///      xmlDetallesBig.ADDTEXT(xmlDetalles);										
///    END;										
///  END;										
///  vDetalleProducto := '';										
///  vDetalleDescuento := 0;										
///UNTIL xDescuentos.NEXT <= 0;										
										
///										
//CSPNT121015 Descuento impuesto exento										
"///IF (SalesEntry.""Discount Amount"" <> 0) OR"										
"///(SalesEntry.""Discount Amt. For Printing"" <> 0) OR"										
"///(SalesEntry.""Line Discount"" <> 0) OR"										
"///(SalesEntry.""Coupon Amt. For Printing"" <> 0) THEN BEGIN"										
"///  IF ((SalesEntry.""Periodic Discount"" <> 0) OR"										
"///  (SalesEntry.""Discount Amt. For Printing"" <> 0)) AND"										
"///  (SalesEntry.""Customer Discount"" = 0) THEN BEGIN"										
"///    IF (SalesEntry.""Periodic Disc. Type"" <> SalesEntry.""Periodic Disc. Type""::"" "") THEN BEGIN"										
"///      IF SalesEntry.""Periodic Disc. Type"" = SalesEntry.""Periodic Disc. Type""::""Mix&Match"" THEN"										
"///        BufferDiscount(PerDiscOffArr,PerDiscOffAmtArr,PerDiscOffArrCount,SalesEntry.""Periodic Disc. Group"",SalesEntry"	".""D"	isc	ou	nt	"Amt. For Printing"")"					
///      ELSE										
"///        BufferDiscount(PerDiscOffArr,PerDiscOffAmtArr,PerDiscOffArrCount,SalesEntry.""Periodic Disc. Group"",SalesEntry"	".""P"	eri	od	ic	"Discount"");"					
"///      IF PeriodicDiscount.GET(SalesEntry.""Periodic Disc. Group"") THEN"										
///        discText := PeriodicDiscount.Description										
///      ELSE										
///        discText := FORMAT(PeriodicDiscount.Type);										
///    END;										
///										
"///    IF SalesEntry.""Discount Amt. For Printing"" <> 0 THEN BEGIN"										
///      vDetalleProducto := discText;										
"///     IF Transaction.""Sale Is Return Sale"" THEN BEGIN"										
"///        vDetalleDescuento := SalesEntry.""Discount Amt. For Printing"";"										
///      END										
///      ELSE BEGIN										
"///        vDetalleDescuento := -SalesEntry.""Discount Amt. For Printing"";"										
///      END;										
///										
///      IF NOT Transaction.NotaRemision THEN BEGIN										
///                        //'<Cantidad>' + FORMAT(1) + '</Cantidad>' +										
///        xmlDetalles := '<DetalleDocumento>' +										
///                        '<Codigo>' + vDetalleCodigo + '</Codigo>' +										
"///                        '<Producto>' + DELCHR(DELCHR(vDetalleProducto,'=','>'),'=','<') + '</Producto>' +"										
///                        '<Cantidad></Cantidad>' +										
"///                        '<Precio>' + DELCHR(FORMAT(vDetallePrecio),'=',',') + '</Precio>' +"										
"///                        '<Descuento>' + DELCHR(FORMAT(vDetalleDescuento),'=',',') + '</Descuento>' +"										
"///                        '<VentasNoSujetas>' + DELCHR(FORMAT(vDetalleVentasNoSujetas),'=',',') + '</VentasNoSujetas>'"	+									
"///                        '<VentasExentas>' + DELCHR(FORMAT(vDetalleDescuento),'=',',') + '</VentasExentas>' +"										
"///                        '<VentasAfectas>' + DELCHR(FORMAT(vDetalleVentasAfectas),'=',',') + '</VentasAfectas>' +"										
"///                        '<CostoNeto>' + DELCHR(FORMAT(vDetalleCostoNeto),'=',',') + '</CostoNeto>' +"										
"///                        '<Total>' + DELCHR(FORMAT(vDetalleDescuento),'=',',') + '</Total>' +"										
///                      '</DetalleDocumento>';										
///        xmlDetallesBig.ADDTEXT(xmlDetalles);										
///      END;										
///      vDetalleCodigo := ' ';										
///      vDetalleProducto := ' ';										
///      vDetalleCantidad := 0;										
///      vDetallePrecio := 0;										
///      vDetalleDescuento := 0;										
///      vDetalleVentasNoSujetas := 0;										
///      vDetalleVentasExentas := 0;										
///      vDetalleVentasAfectas := 0;										
///      vDetalleCostoNeto := 0;										
///      vDetalleTotal := 0;										
///    END										
"///    ELSE IF SalesEntry.""Periodic Disc. Type"" = SalesEntry.""Periodic Disc. Type""::""Disc. Offer"" THEN BEGIN"										
///      vDetalleProducto := discText;										
"///      vDetalleDescuento := (ROUND(-(SalesEntry.""Periodic Discount"" / (1 + (Impuesto / 100))),0.01));"										
///    END;										
///										
///    IF NOT Transaction.NotaRemision THEN BEGIN										
///      xmlDetalles := '<DetalleDocumento>' +										
///                      '<Codigo>' + vDetalleCodigo + '</Codigo>' +										
"///                      '<Producto>' + DELCHR(DELCHR(vDetalleProducto,'=','>'),'=','<') + '</Producto>' +"										
///                      '<Cantidad></Cantidad>' +										
"///                      '<Precio>' + DELCHR(FORMAT(vDetallePrecio),'=',',') + '</Precio>' +"										
"///                      '<Descuento>' + DELCHR(FORMAT(vDetalleDescuento),'=',',') + '</Descuento>' +"										
"///                      '<VentasNoSujetas>' + DELCHR(FORMAT(vDetalleVentasNoSujetas),'=',',') + '</VentasNoSujetas>' +"										
"///                      '<VentasExentas>' + DELCHR(FORMAT(vDetalleDescuento),'=',',') + '</VentasExentas>' +"										
"///                      '<VentasAfectas>' + DELCHR(FORMAT(vDetalleVentasAfectas),'=',',') + '</VentasAfectas>' +"										
"///                      '<CostoNeto>' + DELCHR(FORMAT(vDetalleCostoNeto),'=',',') + '</CostoNeto>' +"										
"///                      '<Total>' + DELCHR(FORMAT(vDetalleDescuento),'=',',') + '</Total>' +"										
///                    '</DetalleDocumento>';										
///      xmlDetallesBig.ADDTEXT(xmlDetalles);										
///    END;										
///    vDetalleCodigo := ' ';										
///    vDetalleProducto := ' ';										
///    vDetalleCantidad := 0;										
///    vDetallePrecio := 0;										
///    vDetalleDescuento := 0;										
///    vDetalleVentasNoSujetas := 0;										
///   vDetalleVentasExentas := 0;										
///    vDetalleVentasAfectas := 0;										
///    vDetalleCostoNeto := 0;										
///    vDetalleTotal := 0;										
///  END										
///  //CSMQ050116*************************************************************************										
"///  //Este es para que si no es Periodic Discount, muestre el descuento por medio de pago"										
"///  ELSE IF SalesEntry.""Discount Amount"" <> 0 THEN BEGIN"										
///    vDetalleProducto := PeriodicDiscountInfoTEMP.Description;										
"///    IF (Transaction.""No. Serie NCF"" = POSTerminal.""No. Serie NCF Credito Fiscal"") THEN BEGIN"										
"///      vDetalleDescuento := ROUND(-(SalesEntry.""Discount Amount"" / (1 + (Impuesto / 100))),0.01);"										
///    END										
"///    ELSE IF (Transaction.""No. Serie NCF"" = POSTerminal.""No. Serie NCF Nota de Credito"") THEN BEGIN"										
"///      vDetalleDescuento := ROUND((SalesEntry.""Discount Amount"" / (1 + (Impuesto / 100))),0.01);"										
///    END										
///    ELSE BEGIN										
"///      vDetalleDescuento := -SalesEntry.""Discount Amount"";"										
///    END;										
///    IF NOT Transaction.NotaRemision THEN BEGIN										
///      xmlDetalles := '<DetalleDocumento>' +										
///                      '<Codigo>' + vDetalleCodigo + '</Codigo>' +										
"///                      '<Producto>' + DELCHR(DELCHR(vDetalleProducto,'=','>'),'=','<') + '</Producto>' +"										
///                      '<Cantidad></Cantidad>' +										
"///                      '<Precio>' + DELCHR(FORMAT(vDetallePrecio),'=',',') + '</Precio>' +"										
"///                      '<Descuento>' + DELCHR(FORMAT(vDetalleDescuento),'=',',') + '</Descuento>' +"										
"///                      '<VentasNoSujetas>' + DELCHR(FORMAT(vDetalleVentasNoSujetas),'=',',') + '</VentasNoSujetas>' +"										
"///                      '<VentasExentas>' + DELCHR(FORMAT(vDetalleVentasExentas),'=',',') + '</VentasExentas>' +"										
"///                      '<VentasAfectas>' + DELCHR(FORMAT(vDetalleDescuento),'=',',') + '</VentasAfectas>' +"										
"///                      '<CostoNeto>' + DELCHR(FORMAT(vDetalleCostoNeto),'=',',') + '</CostoNeto>' +"										
"///                      '<Total>' + DELCHR(FORMAT(vDetalleDescuento),'=',',') + '</Total>' +"										
///                    '</DetalleDocumento>';										
///      xmlDetallesBig.ADDTEXT(xmlDetalles);										
///    END;										
///										
///    vDetalleCodigo := ' ';										
///    vDetalleProducto := ' ';										
///    vDetalleCantidad := 0;										
///    vDetallePrecio := 0;										
///    vDetalleDescuento := 0;										
///    vDetalleVentasNoSujetas := 0;										
///    vDetalleVentasExentas := 0;										
///    vDetalleVentasAfectas := 0;										
///    vDetalleCostoNeto := 0;										
///    vDetalleTotal := 0;										
///  END;										
///  //************************************************************************************										
///										
"///  IF SalesEntry.""Line Discount"" <> 0 THEN BEGIN"										
///    vDetalleProducto := Text084;										
"///    vDetalleDescuento := (ROUND(-(SalesEntry.""Line Discount"" / (1 + (Impuesto / 100))),0.01));"										
///										
///    IF NOT Transaction.NotaRemision THEN BEGIN										
///      xmlDetalles := '<DetalleDocumento>' +										
///                      '<Codigo>' + vDetalleCodigo + '</Codigo>' +										
"///                      '<Producto>' + DELCHR(DELCHR(vDetalleProducto,'=','>'),'=','<') + '</Producto>' +"										
///                      '<Cantidad></Cantidad>' +										
"///                      '<Precio>' + DELCHR(FORMAT(vDetallePrecio),'=',',') + '</Precio>' +"										
"///                      '<Descuento>' + DELCHR(FORMAT(vDetalleDescuento),'=',',') + '</Descuento>' +"										
"///                      '<VentasNoSujetas>' + DELCHR(FORMAT(vDetalleVentasNoSujetas),'=',',') + '</VentasNoSujetas>' +"										
"///                      '<VentasExentas>' + DELCHR(FORMAT(vDetalleDescuento),'=',',') + '</VentasExentas>' +"										
"///                      '<VentasAfectas>' + DELCHR(FORMAT(vDetalleVentasAfectas),'=',',') + '</VentasAfectas>' +"										
"///                      '<CostoNeto>' + DELCHR(FORMAT(vDetalleCostoNeto),'=',',') + '</CostoNeto>' +"										
"///                      '<Total>' + DELCHR(FORMAT(vDetalleDescuento),'=',',') + '</Total>' +"										
///                    '</DetalleDocumento>';										
///      xmlDetallesBig.ADDTEXT(xmlDetalles);										
///    END;										
///    vDetalleCodigo := ' ';										
///    vDetalleProducto := ' ';										
///    vDetalleCantidad := 0;										
///    vDetallePrecio := 0;										
///    vDetalleDescuento := 0;										
///    vDetalleVentasNoSujetas := 0;										
///    vDetalleVentasExentas := 0;										
///    vDetalleVentasAfectas := 0;										
///    vDetalleCostoNeto := 0;										
///    vDetalleTotal := 0;										
///  END;										
///										
"///  IF SalesEntry.""Coupon Amt. For Printing"" <> 0 THEN BEGIN"										
///    vDetalleProducto := Text165;										
"///    vDetalleDescuento := -SalesEntry.""Coupon Amt. For Printing"";"										
///										
///    IF NOT Transaction.NotaRemision THEN BEGIN										
///      xmlDetalles := '<DetalleDocumento>' +										
///                      '<Codigo>' + vDetalleCodigo + '</Codigo>' +										
"///                      '<Producto>' + DELCHR(DELCHR(vDetalleProducto,'=','>'),'=','<') + '</Producto>' +"										
///                      '<Cantidad></Cantidad>' +										
"///                      '<Precio>' + DELCHR(FORMAT(vDetallePrecio),'=',',') + '</Precio>' +"										
"///                      '<Descuento>' + DELCHR(FORMAT(vDetalleDescuento),'=',',') + '</Descuento>' +"										
"///                      '<VentasNoSujetas>' + DELCHR(FORMAT(vDetalleVentasNoSujetas),'=',',') + '</VentasNoSujetas>' +"										
"///                      '<VentasExentas>' + DELCHR(FORMAT(vDetalleDescuento),'=',',') + '</VentasExentas>' +"										
"///                      '<VentasAfectas>' + DELCHR(FORMAT(vDetalleVentasAfectas),'=',',') + '</VentasAfectas>' +"										
"///                      '<CostoNeto>' + DELCHR(FORMAT(vDetalleCostoNeto),'=',',') + '</CostoNeto>' +"										
"///                      '<Total>' + DELCHR(FORMAT(vDetalleDescuento),'=',',') + '</Total>' +"										
///                    '</DetalleDocumento>';										
///      xmlDetallesBig.ADDTEXT(xmlDetalles);										
///    END;										
///    vDetalleCodigo := ' ';										
///    vDetalleProducto := ' ';										
///    vDetalleCantidad := 0;										
///    vDetallePrecio := 0;										
///    vDetalleDescuento := 0;										
///    vDetalleVentasNoSujetas := 0;										
///    vDetalleVentasExentas := 0;										
///    vDetalleVentasAfectas := 0;										
///    vDetalleCostoNeto := 0;										
///    vDetalleTotal := 0;										
///  END;										
///END;										
///										
/////CSPNT190116 Descuento de cliente										
"///IF (SalesEntry.""Customer Discount"" <> 0) THEN BEGIN"										
"///  IF (SalesEntry.""Periodic Disc. Type"" = SalesEntry.""Periodic Disc. Type""::"" "") THEN BEGIN"										
///    vDetalleProducto := Text085;										
///    IF Transaction.FacturaConsumidorFinal THEN BEGIN										
"///      vDetalleDescuento := (ROUND(-(SalesEntry.""Customer Discount""),0.01));"										
///    END										
///    ELSE BEGIN										
"///      vDetalleDescuento := (ROUND(-(SalesEntry.""Customer Discount"" / (1 + (Impuesto / 100))),0.01));"										
///    END;										
///    IF NOT Transaction.NotaRemision THEN BEGIN										
///      xmlDetalles := '<DetalleDocumento>' +										
///                      '<Codigo>' + vDetalleCodigo + '</Codigo>' +										
"///                      '<Producto>' + DELCHR(DELCHR(vDetalleProducto,'=','>'),'=','<') + '</Producto>' +"										
///                      '<Cantidad></Cantidad>' +										
"///                      '<Precio>' + DELCHR(FORMAT(vDetallePrecio),'=',',') + '</Precio>' +"										
"///                      '<Descuento>' + DELCHR(FORMAT(vDetalleDescuento),'=',',') + '</Descuento>' +"										
"///                      '<VentasNoSujetas>' + DELCHR(FORMAT(vDetalleVentasNoSujetas),'=',',') + '</VentasNoSujetas>' +"										
"///                      '<VentasExentas>' + DELCHR(FORMAT(vDetalleDescuento),'=',',') + '</VentasExentas>' +"										
"///                      '<VentasAfectas>' + DELCHR(FORMAT(vDetalleVentasAfectas),'=',',') + '</VentasAfectas>' +"										
"///                      '<CostoNeto>' + DELCHR(FORMAT(vDetalleCostoNeto),'=',',') + '</CostoNeto>' +"										
"///                      '<Total>' + DELCHR(FORMAT(vDetalleDescuento),'=',',') + '</Total>' +"										
///                    '</DetalleDocumento>';										
///      xmlDetallesBig.ADDTEXT(xmlDetalles);										
///    END;										
///    vDetalleCodigo := ' ';										
///    vDetalleProducto := ' ';										
///    vDetalleCantidad := 0;										
///    vDetallePrecio := 0;										
///    vDetalleDescuento := 0;										
///    vDetalleVentasNoSujetas := 0;										
///    vDetalleVentasExentas := 0;										
///    vDetalleVentasAfectas := 0;										
///    vDetalleCostoNeto := 0;										
///    vDetalleTotal := 0;										
///  END;										
///END;										
"TotalVentE += ABS(SalesEntry.""Net Amount"");"										
END;										
END;										
END;										
UNTIL SalesEntry.NEXT = 0;										
										
vDetalleCodigo := '';										
vDetalleDescuento := 0;										
vDetalleProducto := '';										
vDetallePrecio := 0;										
vDetalleVentasNoSujetas := 0;										
vDetalleVentasExentas := 0;										
vDetalleVentasAfectas := 0;										
vDetalleCostoNeto := 0;										
										
"IF (Transaction.""Discount Amount"" <> 0) THEN BEGIN"										
vDetalleProducto := Text043;										
"IF Transaction.""Sale Is Return Sale"" THEN BEGIN"										
IF Transaction.NotaCredito THEN BEGIN										
"vDetalleDescuento := (ROUND(-(Transaction.""Discount Amount"" / (1 + (Impuesto / 100))),0.01));"										
END ELSE BEGIN										
"vDetalleDescuento := Transaction.""Discount Amount"";"										
END;										
END ELSE BEGIN										
IF Transaction.FacturaConsumidorFinal THEN BEGIN										
"vDetalleDescuento := (ROUND(-(Transaction.""Discount Amount""),0.01));"										
END ELSE BEGIN										
"vDetalleDescuento := (ROUND(-(Transaction.""Discount Amount"" / (1 + (Impuesto / 100))),0.01));"										
END;										
END;										
END;										
										
IF vDetalleDescuento <> 0 THEN BEGIN										
IF NOT Transaction.NotaRemision THEN BEGIN										
xmlDetalles := '<DetalleDocumento>' +										
'<Codigo>' + vDetalleCodigo + '</Codigo>' +										
"'<Producto>' + DELCHR(DELCHR(vDetalleProducto,'=','>'),'=','<') + '</Producto>';"										
IF vDetalleVentasNoSujetas <> 0 THEN										
"xmlDetalles := xmlDetalles + '<VentasNoSujetas>' + DELCHR(FORMAT(vDetalleVentasNoSujetas),'=',',') + '</VentasNoSujetas>';"										
IF vDetalleVentasExentas <> 0 THEN										
"xmlDetalles := xmlDetalles + '<VentasExentas>' + DELCHR(FORMAT(vDetalleVentasExentas),'=',',') + '</VentasExentas>';"										
xmlDetalles := xmlDetalles +										
"'<VentasAfectas>' + DELCHR(FORMAT(vDetalleDescuento),'=',',') + '</VentasAfectas>' +"										
"'<CostoNeto>' + DELCHR(FORMAT(vDetalleCostoNeto),'=',',') + '</CostoNeto>' +"										
"'<Total>' + DELCHR(FORMAT(vDetalleDescuento),'=',',') + '</Total>' +"										
'</DetalleDocumento>';										
xmlDetallesBig.ADDTEXT(xmlDetalles);										
END;										
vDetalleDescuento := 0;										
vDetalleProducto := '';										
END;										
										
//CSPNT301116										
CLEAR(SalesEntry);										
"SalesEntry.SETRANGE(""Store No."",Transaction.""Store No."");"										
"SalesEntry.SETRANGE(""POS Terminal No."",Transaction.""POS Terminal No."");"										
"SalesEntry.SETRANGE(""Transaction No."",Transaction.""Transaction No."");"										
IF OrderByDepartment THEN										
"SalesEntry.SETCURRENTKEY(""Item Category Code"");"										
IF SalesEntry.FIND('-') THEN										
REPEAT										
										
"IF (Item.""No."" = vProductoTelefonica1) OR (Item.""No."" = vProductoTelefonica2)"										
"OR (Item.""No."" = vProductoTelefonica3) OR (Item.""No."" = vProductoTelefonica4) THEN BEGIN"										
DSTR1 := '  #L##############  #L################  ';										
Value[1] := 'Trans. Operador:';										
rRecargasElectronicas.RESET;										
"rRecargasElectronicas.SETRANGE(""Receipt No."",Transaction.""Receipt No."");"										
IF rRecargasElectronicas.FINDFIRST THEN										
"Value[2] := rRecargasElectronicas.""Transaccion Operador"""										
ELSE										
Value[2] := 'ERROR';										
"//PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
DSTR1 := '  #L##############  #L################  ';										
Value[1] := 'Telefono:';										
rRecargasElectronicas.RESET;										
"rRecargasElectronicas.SETRANGE(""Receipt No."",Transaction.""Receipt No."");"										
IF rRecargasElectronicas.FINDFIRST THEN										
"Value[2] := rRecargasElectronicas.""Numero Telefono"""										
ELSE										
Value[2] := '';										
"//PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
UNTIL SalesEntry.NEXT = 0;										
										
/////CSPNT071215 Imprimir descuento tender type al final de las lineas de productos										
/////DESCUENTO AL FINAL										
///{										
///IF NOT IsInvoice THEN BEGIN										
"///  //CSPNT200116   PrintTotal(Transaction,Tray,3);"										
///END										
///ELSE BEGIN										
///  PeriodicDiscountInfoTEMP.RESET;										
"///  PeriodicDiscountInfoTEMP.SETCURRENTKEY(Status,Type);"										
"///  PeriodicDiscountInfoTEMP.SETRANGE(""Offer Type"",PeriodicDiscountInfoTEMP.""Offer Type""::""Tender Type"");"										
///  NodeName[1] := 'Total Text';										
///  NodeName[2] := 'Total Amount';										
///  IF PeriodicDiscountInfoTEMP.FINDSET THEN BEGIN										
///    TotalAmtForSummary := Subtotal;										
///    REPEAT										
"///      IF (GenPosFunc.""Print Disc/Cpn Info on Slip"" = GenPosFunc.""Print Disc/Cpn Info on Slip""::""Detail for each line and Sub-"	tot	"al"""	)	AND						
///      (PeriodicDiscountInfoTEMP.Description <> Text024) THEN										
"///        PeriodicDiscountInfoTEMP.""Discount Amount Value"" := 0;"										
"///      IF PeriodicDiscountInfoTEMP.""Discount Amount Value"" <> 0 THEN BEGIN"										
///        DSTR1 := '             #L#########################            #R####                             ';										
///        vDetalleProducto := PeriodicDiscountInfoTEMP.Description;										
///        IF Transaction.FacturaCreditoFiscal OR Transaction.NotaCredito THEN BEGIN										
"///          vDetalleDescuento := ROUND(-PeriodicDiscountInfoTEMP.""Discount Amount Value"" / (1 + (Impuesto / 100)),0.01);"										
///        END										
///        ELSE BEGIN										
"///          vDetalleDescuento := -PeriodicDiscountInfoTEMP.""Discount Amount Value"";"										
///        END;										
"///        //PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
"///        //AddPrintLine(800,2,NodeName,Value,DSTR1,FALSE,FALSE,FALSE,FALSE,Tray); //LS7.1-02"										
///										
///        IF NOT Transaction.NotaRemision THEN BEGIN										
///          xmlDetalles := '<DetalleDocumento>' +										
///                          '<Codigo>' + vDetalleCodigo + '</Codigo>' +										
"///                          '<Producto>' + DELCHR(DELCHR(vDetalleProducto,'=','>'),'=','<') + '</Producto>' +"										
///                          '<Cantidad></Cantidad>' +										
"///                          '<Precio>' + DELCHR(FORMAT(vDetallePrecio),'=',',') + '</Precio>' +"										
"///                          '<Descuento>' + DELCHR(FORMAT(vDetalleDescuento),'=',',') + '</Descuento>' +"										
"///                          '<VentasNoSujetas>' + DELCHR(FORMAT(vDetalleVentasNoSujetas),'=',',') + '</VentasNoSujetas>' +"										
"///                          '<VentasExentas>' + DELCHR(FORMAT(vDetalleDescuento),'=',',') + '</VentasExentas>' +"										
"///                          '<VentasAfectas>' + DELCHR(FORMAT(vDetalleVentasAfectas),'=',',') + '</VentasAfectas>' +"										
"///                          '<CostoNeto>' + DELCHR(FORMAT(vDetalleCostoNeto),'=',',') + '</CostoNeto>' +"										
"///                          '<Total>' + DELCHR(FORMAT(vDetalleDescuento),'=',',') + '</Total>' +"										
///                        '</DetalleDocumento>';										
///          xmlDetallesBig.ADDTEXT(xmlDetalles);										
///        END;										
///        vDetalleCodigo := ' ';										
///        vDetalleProducto := ' ';										
///        vDetalleCantidad := 0;										
///        vDetallePrecio := 0;										
///        vDetalleDescuento := 0;										
///        vDetalleVentasNoSujetas := 0;										
///        vDetalleVentasExentas := 0;										
///        vDetalleVentasAfectas := 0;										
///        vDetalleCostoNeto := 0;										
///        vDetalleTotal := 0;										
///										
"///        //TotalAmtForSummary := TotalAmtForSummary + PeriodicDiscountInfoTEMP.""Discount Amount Value"";"										
///      END;										
///    UNTIL PeriodicDiscountInfoTEMP.NEXT = 0;										
///  END;										
///END;										
///}										
										
END;										
										
"IncExpEntry.SETRANGE(""Store No."",Transaction.""Store No."");"										
"IncExpEntry.SETRANGE(""POS Terminal No."",Transaction.""POS Terminal No."");"										
"IncExpEntry.SETRANGE(""Transaction No."",Transaction.""Transaction No."");"										
IF IncExpEntry.FIND('-') THEN										
vIncomeExpense := TRUE										
ELSE										
vIncomeExpense := FALSE;										
										
//Imprime Linea de Descuento total										
IF IsInvoice THEN BEGIN										
"IF Transaction.""Total Discount"" <> 0 THEN BEGIN"										
Value[1] := 'Total Disc:';										
IF Transaction.NotaCredito  THEN										
"Value[2] := '$'+POSFunctions.FormatAmount(-1*(Transaction.""Total Discount""/ (1 + (Impuesto / 100))))"										
ELSE IF Transaction.FacturaCreditoFiscal THEN										
"Value[2] := '$'+POSFunctions.FormatAmount(-Transaction.""Total Discount""/ (1 + (Impuesto / 100)))"										
ELSE										
"Value[2] := '$'+POSFunctions.FormatAmount(-Transaction.""Total Discount"");"										
"//PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,TRUE,FALSE,FALSE));"										
END;										
END;										
CLEAR(Value);										
										
"IF NOT IsInvoice AND (Transaction.Ticket OR Transaction.""Doc. Devolucion"") AND NOT vIncomeExpense THEN BEGIN"										
END										
ELSE IF IsInvoice THEN BEGIN										
"//CSPNT250915 SUMAS, mostras las sumas de ventas exentas y gravadas en una sola linea"										
//FOOTER1										
Value[1] := Store.Name;										
"IF NOT Transaction.""Sale Is Return Sale"" THEN BEGIN"										
IF Transaction.NotaRemision THEN BEGIN										
rRemisionLine.RESET;										
"rRemisionLine.SETRANGE(""Receipt No."", Transaction.""Receipt No."");"										
IF rRemisionLine.FINDSET THEN BEGIN										
"rRemisionLine.CALCSUMS(Amount,""Amount Including VAT"");"										
"vMontoRemision := ROUND(rRemisionLine.Amount,0.01);"										
"vMontoIvaRemision := ROUND(rRemisionLine.""Amount Including VAT""-rRemisionLine.Amount,0.01);"										
"vMontoTotalRemision := ROUND(rRemisionLine.""Amount Including VAT"",0.01);"										
END;										
"IF Transaction.""Customer No."" = 'C000002' THEN BEGIN"										
//CSPNT090916vVentasAfectas := vMontoRemision;										
vVentasAfectas := -vInfoAmountTotal;										
END										
ELSE BEGIN										
"IF (Transaction.""No. Serie NCF"" = POSTerminal.""No. Serie NCF Cons. Final"") THEN"										
"//CSPNT090916vVentasAfectas := ROUND(-TransInfoEntry.""Info. Amt."",0.01)"										
"vVentasAfectas := ROUND(-vInfoAmountTotal,0.01)"										
ELSE										
"//CSPNT090916vVentasAfectas := ROUND(-TransInfoEntry.""Info. Amt.""/1.13,0.01);"										
"vVentasAfectas := ROUND(vInfoAmountTotal,0.01);"										
END;										
vVentasExentas := TotalVentE;										
//CSPNT270816vSumas := TotalVentE + vMontoRemision;										
vSumas := TotalVentE + vVentasAfectas;										
END										
ELSE BEGIN										
vVentasExentas := ABS(TotalVentE);										
vVentasAfectas := ABS(TotalVentG);										
vSumas := ABS(TotalVentE) + ABS(TotalVentG);										
END;										
"//PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END										
"ELSE IF (Transaction.""Sale Is Return Sale"") AND Transaction.NotaCredito THEN BEGIN"										
vVentasExentas := ABS(TotalVentE);										
vVentasAfectas := ABS(TotalVentG);										
vSumas := ABS(TotalVentE) + ABS(TotalVentG);										
"//PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END										
ELSE  BEGIN										
vVentasAfectas := ABS(TotalVentG);										
"//PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
END;										
										
//TOTAL IVA PARA LAS FACTURAS DE CREDITO FISCAL										
//FOOTER2										
//CSPNT021015 se agrega las ventas no sujetas para facturas de consumidor final										
IF Transaction.FacturaCreditoFiscal OR Transaction.NotaCredito OR Transaction.FacturaConsumidorFinal THEN BEGIN										
IF IsInvoice THEN BEGIN										
"vPOS := Transaction.""POS Terminal No."";"										
"IF NOT Transaction.""Sale Is Return Sale"" AND Transaction.FacturaConsumidorFinal THEN BEGIN"										
"Value[2] := '$' + FORMAT(TotalNoSuj,0,'<Integer Thousand><Decimals,3>');"										
"//PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END										
"ELSE IF NOT Transaction.""Sale Is Return Sale"" THEN BEGIN"										
IF Transaction.NotaRemision THEN BEGIN										
"IF Transaction.""Customer No."" = 'C000002' THEN"										
//CSPNT090916vIvaNormal := vMontoIvaRemision										
"vIvaNormal := ROUND(-vInfoAmountTotal*0.13,0.01)"										
ELSE										
"//CSPNT090916vIvaNormal := ROUND((-TransInfoEntry.""Info. Amt.""/1.13)*0.13,0.01);"										
"vIvaNormal := ROUND(vInfoAmountTotal*0.13,0.01);"										
END										
ELSE BEGIN										
vIvaNormal := ABS(TotalIVA);										
END;										
"//PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END										
//CSRM25092013										
"ELSE IF Transaction.""Sale Is Return Sale"" AND Transaction.NotaCredito THEN BEGIN"										
vIvaNormal := ABS(TotalIVA);										
"//PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
END;										
END;										
										
//Sub-Total										
//FOOTER3										
IF IsInvoice THEN BEGIN										
"SalesEntry.SETRANGE(""Transaction No."",Transaction.""Transaction No."");"										
IF SalesEntry.FIND('-') THEN BEGIN										
jContador := 1;										
REPEAT										
vAgregarSalesPersonNo := 0;										
FOR iContador := 1 TO 30 DO BEGIN										
"IF SalesEntry.""Sales Staff"" = vSalesPersonNo[iContador] THEN"										
vAgregarSalesPersonNo += 1;										
END;										
IF vAgregarSalesPersonNo=0 THEN BEGIN										
"vSalesPersonNo[jContador] := SalesEntry.""Sales Staff"";"										
jContador += 1;										
rStaff1.RESET;										
"rStaff1.SETRANGE(ID,SalesEntry.""Sales Staff"");"										
IF rStaff1.FIND('-') THEN BEGIN										
rSalesPerson.RESET;										
"rSalesPerson.SETRANGE(Code,rStaff1.""Sales Person"");"										
rSalesPerson.FIND('-');										
REPEAT										
vVendedor := vVendedor + rStaff1.ID + ' ';										
UNTIL rSalesPerson.NEXT=0;										
END;										
END;										
UNTIL SalesEntry.NEXT = 0;										
END;										
										
"//CSPNT130716  Value[1] := 'Cajero: ' + Transaction.""Staff ID"" + '  Vendedor: ' + vVendedor;"										
"vCajero := Transaction.""Staff ID"";"										
										
//CSPNT260915  Value[1] := TextSubTotal;										
//CSPNT021015 Se agrega ventas exentas para factura de consumidor final										
"IF NOT Transaction.""Sale Is Return Sale"" AND Transaction.FacturaConsumidorFinal THEN BEGIN"										
"Value[1] := 'Cajero: ' + Transaction.""Staff ID"" + '  Vendedor: ' + vVendedor;"										
"Value[2] := '$' + FORMAT(TotalVentE,0,'<Integer Thousand><Decimals,3>');"										
"//PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END										
"ELSE IF NOT Transaction.""Sale Is Return Sale"" THEN BEGIN"										
"Value[2] := '$' + FORMAT(TotalVentG + TotalIVA ,0,'<Integer Thousand><Decimals,3>');"										
"//PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END										
"ELSE IF Transaction.""Sale Is Return Sale"" AND Transaction.NotaCredito THEN BEGIN"										
"Value[2] :='$' + FORMAT(TotalVentG + TotalIVA,0,'<Integer Thousand><Decimals,3>');"										
"//PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END										
ELSE BEGIN										
"Value[2] := '(' + '$' + FORMAT(TotalVentG + TotalIVA,0,'<Integer Thousand><Decimals,3>') + ')';"										
"//PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END										
END;										
										
CLEAR(TotalPercepcion);										
CLEAR(TotalRetencion);										
"TotalPercepcion:= ABS(Transaction.""Percepcion Amount"");"										
"TotalRetencion:= ABS(Transaction.""Retencion Amount"");"										
										
IF Transaction.FacturaCreditoFiscal THEN BEGIN										
"//CSPNT180116  IF ABS(Transaction.""Percepcion Amount"") > 0 THEN BEGIN"										
END										
ELSE IF Transaction.FacturaConsumidorFinal THEN BEGIN										
//CSPNT021015 iva retenido se movio a footer 6										
END										
ELSE IF Transaction.NotaCredito THEN BEGIN										
"TotalPercepcion:= ABS(Transaction.""Percepcion Amount"");"										
//Value[1] := TextToPercepcion;										
vIvaPercibido := TotalPercepcion;										
"//CSPNT271015  PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
										
//Ventas Exentas										
"IF NOT IsInvoice AND (Transaction.Ticket OR Transaction.""Doc. Devolucion"") AND NOT vIncomeExpense THEN BEGIN"										
END										
ELSE IF IsInvoice THEN BEGIN										
"//CSPNT250915 ventas exentas, impresi¢n se mueve junto a ventas gravadas"										
"//CSPNT260915 ventas exentas, impresi¢n se agrega tambien despues de ventas no sujetas"										
//FOOTER4										
//CSPNT021015 ventas afectas agregadas para factura de consumidor final										
//CSPNT260915 total el letras se quita										
//CSPNT130116 total letras se agrega										
IF IsInvoice THEN BEGIN										
"PaymEntry.SETRANGE(""Transaction No."",Transaction.""Transaction No."");"										
IF PaymEntry.FIND('-') THEN										
jContador := 1;										
REPEAT										
vAgregarSalesPersonNo := 0;										
FOR iContador := 1 TO 30 DO BEGIN										
TenderType.RESET;										
"TenderType.SETRANGE(Code,PaymEntry.""Tender Type"");"										
TenderType.FIND('-');										
IF TenderType.Description = vMediosPago[iContador] THEN										
vAgregarSalesPersonNo += 1;										
END;										
IF vAgregarSalesPersonNo=0 THEN BEGIN										
vMediosPago[jContador] := TenderType.Description;										
jContador += 1;										
END;										
UNTIL PaymEntry.NEXT = 0;										
Value[1] := 'Medios pago: ';										
FOR iContador := 1 TO jContador DO BEGIN										
vFormaPago := vFormaPago + vMediosPago[iContador] + ' ';										
END;										
END;										
										
"IF NOT Transaction.""Sale Is Return Sale"" AND Transaction.FacturaConsumidorFinal THEN BEGIN"										
"Value[2] := '$' + FORMAT(TotalVentG,0,'<Integer Thousand><Decimals,3>');"										
"//PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END										
//CSPNT271015 iva percibido para credito fiscal y nota de credito										
ELSE BEGIN										
vIvaPercibido := TotalPercepcion;										
"//PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
END;										
										
/// CSALX20170506 Imprimir descuentos de tender type										
///vDetalleDescuento := 0;										
///CLEAR(xDescuentos);										
///xDescuentos.RESET;										
"///xDescuentos.SETRANGE(""Receipt No."", SalesEntry.""Receipt No."");"										
"///xDescuentos.SETRANGE(""Transaction No."", SalesEntry.""Transaction No."");"										
"///xDescuentos.SETRANGE(""Offer Type"", xDescuentos.""Offer Type""::""Tender Type"");"										
///IF xDescuentos.FIND('-') THEN REPEAT										
"///  //IF xDescuentos.""Offer Type"" <> xDescuentos.""Offer Type""::""Tender Type"" THEN BEGIN"										
///      vDetalleProducto := 'Descuento ' + vFormaPago;										
///										
"///      IF Transaction.""Sale Is Return Sale"" THEN BEGIN"										
///        IF Transaction.NotaCredito THEN BEGIN										
"///          vDetalleDescuento += (ROUND(-(xDescuentos.""Discount Amount"" / (1 + (Impuesto / 100))),0.01));"										
///        END ELSE BEGIN										
"///          vDetalleDescuento += xDescuentos.""Discount Amount"";"										
///        END;										
///      END ELSE BEGIN										
///        IF Transaction.FacturaConsumidorFinal THEN BEGIN										
"///          vDetalleDescuento += (ROUND(-(xDescuentos.""Discount Amount""),0.01));"										
///        END ELSE BEGIN										
"///          vDetalleDescuento += (ROUND(-(xDescuentos.""Discount Amount"" / (1 + (Impuesto / 100))),0.01));"										
///        END;										
///      END;										
///  //END;										
///UNTIL xDescuentos.NEXT <= 0;										
///										
///IF vDetalleDescuento <> 0 THEN BEGIN										
///  IF NOT Transaction.NotaRemision THEN BEGIN										
///    xmlDetalles := '<DetalleDocumento>' +										
///                    '<Codigo>' + vDetalleCodigo + '</Codigo>' +										
"///                    '<Producto>' + DELCHR(DELCHR(vDetalleProducto,'=','>'),'=','<') + '</Producto>' +"										
"///                    '<Precio>' + DELCHR(FORMAT(vDetallePrecio),'=',',') + '</Precio>' +"										
"///                    '<Descuento>' + DELCHR(FORMAT(vDetalleDescuento),'=',',') + '</Descuento>' +"										
"///                    '<VentasNoSujetas>' + DELCHR(FORMAT(vDetalleVentasNoSujetas),'=',',') + '</VentasNoSujetas>' +"										
"///                    '<VentasExentas>' + DELCHR(FORMAT(vDetalleVentasExentas),'=',',') + '</VentasExentas>' +"										
"///                    '<VentasAfectas>' + DELCHR(FORMAT(vDetalleDescuento),'=',',') + '</VentasAfectas>' +"										
"///                    '<CostoNeto>' + DELCHR(FORMAT(vDetalleCostoNeto),'=',',') + '</CostoNeto>' +"										
"///                    '<Total>' + DELCHR(FORMAT(vDetalleDescuento),'=',',') + '</Total>' +"										
///                  '</DetalleDocumento>';										
///    xmlDetallesBig.ADDTEXT(xmlDetalles);										
///  END;										
///  vDetalleDescuento := 0;										
///  vDetalleProducto := '';										
///END;										
										
										
										
//Ventas No Sujetas										
"IF NOT IsInvoice AND (Transaction.Ticket OR Transaction.""Doc. Devolucion"") AND NOT vIncomeExpense THEN BEGIN"										
END										
//CSPNT260915 impresion ventas no sujetas agregada										
//FOOTER5										
ELSE IF IsInvoice THEN BEGIN										
//CSPNT180116  Value[1] := vDecimalesTextoFactura + ' DOLARES';										
IF IsInvoice THEN BEGIN										
"FormatNoText1(Texto,ABS(Transaction.Payment));"										
TotalLetras := TotFac;										
Value[1] :=TotalLetras;										
END;										
//CSPNT260915  Value[1] := TextVentNoSuj;										
"IF NOT Transaction.""Sale Is Return Sale"" AND Transaction.FacturaConsumidorFinal THEN BEGIN"										
"Value[2] := '$' + FORMAT(TotalVentG + TotalIVA ,0,'<Integer Thousand><Decimals,3>');"										
"//PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END										
"ELSE IF NOT Transaction.""Sale Is Return Sale"" THEN BEGIN"										
"Value[2] := '$' + FORMAT(TotalNoSuj,0,'<Integer Thousand><Decimals,3>');"										
"//PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END										
"ELSE IF Transaction.""Sale Is Return Sale"" AND Transaction.NotaCredito THEN BEGIN"										
"Value[2] := '$' + FORMAT(TotalNoSuj,0,'<Integer Thousand><Decimals,3>');"										
"//PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END										
ELSE BEGIN										
"Value[2] := '(' + '$' + FORMAT(TotalNoSuj,0,'<Integer Thousand><Decimals,3>') + ')';"										
"//PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
										
//CSPNT260915 ventas exentas agregado										
//FOOTER6										
Value[1] := vDecimalesTextoFactura + ' DOLARES';										
vTotalLetras := TotalLetras + ' ' + vDecimalesTextoFactura + ' DOLARES';										
										
//CSPNT021015 iva retenido para facturas de consumidor final										
"IF NOT Transaction.""Sale Is Return Sale"" AND Transaction.FacturaConsumidorFinal THEN BEGIN"										
vIvaRetenido := TotalRetencion;										
"//PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END										
"ELSE IF NOT Transaction.""Sale Is Return Sale"" THEN BEGIN"										
"Value[2] := '$' + FORMAT(TotalVentE,0,'<Integer Thousand><Decimals,3>');"										
"//PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END										
"ELSE IF Transaction.""Sale Is Return Sale"" AND Transaction.NotaCredito THEN BEGIN"										
"Value[2] := '$' + FORMAT(TotalVentE,0,'<Integer Thousand><Decimals,3>');"										
"//PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END										
ELSE BEGIN										
"Value[2] := '(' + '$' + FORMAT(TotalVentE,0,'<Integer Thousand><Decimals,3>') + ')';"										
"//PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
END;										
										
//TOTAL										
//FOOTER7										
"IF NOT IsInvoice AND (Transaction.Ticket OR Transaction.""Doc. Devolucion"") AND NOT vIncomeExpense THEN BEGIN"										
END										
ELSE IF IsInvoice THEN BEGIN										
"IF NOT Transaction.""Sale Is Return Sale"" THEN BEGIN"										
IF Transaction.NotaCredito THEN BEGIN										
//CSPNT090916										
vMonto := ABS(TotalVentG + TotalIVA + TotalVentE + TotalNoSuj + TotalPercepcion - TotalRetencion + vCesc);										
"//PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END										
ELSE BEGIN										
//CSPNT090916										
vMonto := ABS(TotalVentG + TotalIVA + TotalVentE + TotalNoSuj + TotalPercepcion - TotalRetencion + vCesc);										
"//PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
END										
"ELSE IF Transaction.""Sale Is Return Sale"" AND Transaction.NotaCredito THEN BEGIN"										
//CSPNT280916										
vMonto := ABS(TotalVentG + TotalIVA + TotalVentE + TotalNoSuj + TotalPercepcion - TotalRetencion + vCesc);										
"//PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END										
ELSE BEGIN										
vMonto := ABS(TotalVentG + TotalIVA + TotalVentE + TotalNoSuj + TotalPercepcion - TotalRetencion);										
"//PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
END;										
										
"IncExpEntry.SETRANGE(""Store No."",Transaction.""Store No."");"										
"IncExpEntry.SETRANGE(""POS Terminal No."",Transaction.""POS Terminal No."");"										
"IncExpEntry.SETRANGE(""Transaction No."",Transaction.""Transaction No."");"										
IF IncExpEntry.FIND('-') THEN BEGIN										
REPEAT										
"IncExpAcc.GET(IncExpEntry.""Store No."",IncExpEntry.""No."");"										
DSTR1 := '#L#################### #N############';										
Value[1] := IncExpAcc.Description;										
Value[2] := POSFunctions.FormatAmount(-IncExpEntry.Amount);										
"//PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
"//IF IncExpAcc.""Slip Text 1"" <> '' THEN"										
"//PrintLine(Tray,IncExpAcc.""Slip Text 1"");"										
"//IF IncExpAcc.""Slip Text 2"" <> '' THEN"										
"//PrintLine(Tray,IncExpAcc.""Slip Text 2"");"										
"TransInfoEntry.SETRANGE(""Store No."",Transaction.""Store No."");"										
"TransInfoEntry.SETRANGE(""POS Terminal No."",Transaction.""POS Terminal No."");"										
"TransInfoEntry.SETRANGE(""Transaction No."",Transaction.""Transaction No."");"										
"TransInfoEntry.SETRANGE(""Transaction Type"",TransInfoEntry.""Transaction Type""::""Income/Expense Entry"");"										
"TransInfoEntry.SETRANGE(""Line No."",IncExpEntry.""Line No."");"										
"//PrintTransInfoCode(TransInfoEntry,Tray,FALSE);"										
UNTIL IncExpEntry.NEXT = 0;										
//PrintSeperator(Tray);										
END;										
										
glTrans.INIT;										
										
//CSPNT140716										
//CSPNT061016										
IF Transaction.FacturaConsumidorFinal AND NOT Transaction.NotaRemision THEN BEGIN										
vIdDocumento := 1;										
vCopia := 3;										
END										
ELSE										
IF Transaction.FacturaCreditoFiscal AND NOT Transaction.NotaRemision THEN BEGIN										
vIdDocumento := 2;										
vCopia := 4;										
END										
ELSE										
IF Transaction.NotaCredito AND NOT Transaction.NotaRemision THEN BEGIN										
vIdDocumento := 3;										
vCopia := 4;										
END										
ELSE										
IF Transaction.NotaRemision THEN BEGIN										
IF Transaction.FacturaConsumidorFinal THEN BEGIN										
vIdDocumento := 1;										
vCopia := 3;										
END										
ELSE BEGIN										
"IF Transaction.""Customer No."" = 'C000002' THEN BEGIN"										
vIdDocumento := 2;										
vCopia := 4;										
END										
ELSE BEGIN										
"IF (Transaction.""No. Serie NCF"" = POSTerminal.""No. Serie NCF Cons. Final"") THEN BEGIN"										
vIdDocumento := 1;										
vCopia := 3;										
END										
ELSE BEGIN										
vIdDocumento := 2;										
vCopia := 4;										
END;										
END;										
END;										
END;										
										
//***************//										
//***** XML *****//										
//***************//										
										
//CSPNT051216										
//CSPNT300117										
{IF NOT vReimpresion THEN BEGIN										
url := 'http://' + vIP + ':9393/WSImpresiones.asmx?op=SolicitarCorrelativo';										
//url := 'http://localhost:2103/WSImpresiones.asmx?op=SolicitarCorrelativo';										
"soapActionUrl := '""http://tempuri.org/SolicitarCorrelativo""';"										
										
"xmlCorrelativo := '<?xml version=""1.0"" encoding=""utf-8""?>' +"										
"'<soap:Envelope xmlns:xsi=""http://www.w3.org/2001/XMLSchema-instance"" xmlns:xsd=""http://www.w3.org/2001/XMLSchema"" xmlns:soap="	"""ht"	tp:	//	sch	"emas.xmlsoap.org/soap/envelope/"">' +"					
'<soap:Body>' +										
"'<SolicitarCorrelativo xmlns=""http://tempuri.org/"">' +"										
'<idDocumento>' + FORMAT(vIdDocumento) + '</idDocumento>' +										
'</SolicitarCorrelativo>' +										
'</soap:Body>' +										
'</soap:Envelope>';										
										
sb := sb.StringBuilder();										
sb.Append(xmlCorrelativo);										
"IF xmlFinal.CREATE('C:\Temp\' + Transaction.""Receipt No."" + ' cP.xml') THEN BEGIN"										
xmlFinal.CREATEOUTSTREAM(xmlStream);										
xmlStream.WRITE(sb.ToString);										
xmlFinal.CLOSE;										
END;										
uriObj := uriObj.Uri(url);										
lgRequest := lgRequest.CreateDefault(uriObj);										
lgRequest.Method := 'POST';										
lgRequest.Host := vIP;										
lgRequest.ContentType := 'text/xml; charset=utf-8';										
"lgRequest.Headers.Add('SOAPAction', soapActionUrl);"										
lgRequest.Timeout := 60000;										
"stream := stream.StreamWriter(lgRequest.GetRequestStream(), ascii.UTF8);"										
stream.Write(sb.ToString());										
stream.Close();										
//  IF lgRequest.UseDefaultCredentials(TRUE) THEN										
lgResponse := lgRequest.GetResponse();										
str := lgResponse.GetResponseStream();										
reader := reader.XmlTextReader(str);										
document := document.XmlDocument();										
document.Load(reader);										
xmlnodelist := document.SelectNodes('//*');										
"document.Save('C:\temp\' + Transaction.""Receipt No."" + ' cR.xml');"										
nodos := 11;										
										
FOR i := 5 TO nodos-1 DO BEGIN										
xmlnode := xmlnodelist.Item(i);										
										
//MESSAGE(xmlnode.FirstChild.InnerText);										
IF i = 5 THEN										
vResolucionR := xmlnode.FirstChild.InnerText										
ELSE IF i = 6 THEN										
//CSPNT121216										
vFechaAutorizacionR := xmlnode.FirstChild.InnerText										
ELSE IF i = 7 THEN										
vSerieR := xmlnode.FirstChild.InnerText										
ELSE IF i = 8 THEN										
vDesdeR := xmlnode.FirstChild.InnerText										
ELSE IF i = 9 THEN										
vHastaR := xmlnode.FirstChild.InnerText										
ELSE IF i = 10 THEN										
vNCFR := xmlnode.FirstChild.InnerText;										
END;										
										
IF vCopia > 0 THEN BEGIN										
IF nodos = 11 THEN BEGIN										
Transaction.NCF := vNCFR;										
"Transaction.""Correlativo Facturas"" := vNCFR;"										
"Transaction.""No. Serie Documento Devolucion"" := vSerieR; //CSALX20161222 Agregndo serie a Transaction Header"										
Transaction.MODIFY;										
END;										
										
rFacturasHijas.RESET;										
"rFacturasHijas.SETRANGE(""Store No."",Transaction.""Store No."");"										
"rFacturasHijas.SETRANGE(""POS Terminal No."",Transaction.""POS Terminal No."");"										
"rFacturasHijas.SETRANGE(""Receipt No."",Transaction.""Receipt No."");"										
IF rFacturasHijas.FINDLAST THEN BEGIN										
IF nodos = 11 THEN										
"rFacturasHijas.""Numero de Factura"" := vNCFR;"										
rFacturasHijas.Resolucion := vResolucionR;										
//CSPNT121216										
"rFacturasHijas.""Fecha Autorizacion"" := vFechaAutorizacionR;"										
rFacturasHijas.Serie := vSerieR;										
"EVALUATE(vDesde,vDesdeR);"										
rFacturasHijas.Desde := vDesde;										
IF nodos = 11 THEN BEGIN										
"EVALUATE(vHasta,vHastaR);"										
rFacturasHijas.Hasta := vHasta;										
END;										
rFacturasHijas.MODIFY;										
END										
ELSE BEGIN										
rFacturasHijas.INIT;										
"rFacturasHijas.""Store No."" := Transaction.""Store No."";"										
"rFacturasHijas.""POS Terminal No."" := Transaction.""POS Terminal No."";"										
"rFacturasHijas.""Receipt No."" := Transaction.""Receipt No."";"										
rFacturasHijas.Fecha := Transaction.Date;										
rFacturasHijas.Hora := Transaction.Time;										
"rFacturasHijas.""Nombre Cliente"" := Transaction.""Razon Social"";"										
rFacturasHijas.DUI := Transaction.DUI;										
rFacturasHijas.NIT := Transaction.NIT;										
IF nodos = 11 THEN										
"rFacturasHijas.""Numero de Factura"" := vNCFR;"										
rFacturasHijas.Resolucion := vResolucionR;										
//CSPNT121216										
"rFacturasHijas.""Fecha Autorizacion"" := vFechaAutorizacionR;"										
rFacturasHijas.Serie := vSerieR;										
"EVALUATE(vDesde,vDesdeR);"										
rFacturasHijas.Desde := vDesde;										
IF nodos = 11 THEN BEGIN										
"EVALUATE(vHasta,vHastaR);"										
rFacturasHijas.Hasta := vHasta;										
END;										
rFacturasHijas.INSERT;										
COMMIT;										
END;										
										
rSeriesLine.RESET;										
"rSeriesLine.SETRANGE(""Series Code"",Transaction.""No. Serie NCF"");"										
"rSeriesLine.SETRANGE(Autorizacion,vSerieR);"										
"rSeriesLine.SETRANGE(Serie,vResolucionR);"										
IF rSeriesLine.FINDLAST THEN BEGIN										
//Existe la linea autorizacion+serie										
IF nodos = 11 THEN										
"rSeriesLine.""Last No. Used"" := vNCFR;"										
"rSeriesLine.""Last Date Used"" := TODAY;"										
rSeriesLine.MODIFY(TRUE);										
COMMIT;										
END										
ELSE BEGIN										
//No existe la linea autorizacion+serie										
rSeriesLine.RESET;										
"rSeriesLine.SETRANGE(""Series Code"",Transaction.""No. Serie NCF"");"										
"rSeriesLine.SETRANGE(Autorizacion,vSerieR);"										
IF rSeriesLine.FINDLAST THEN BEGIN										
"vUltimaLinea := rSeriesLine.""Line No."";"										
//Existe la linea autorizacion										
rSeriesLine.INIT;										
"rSeriesLine.""Series Code"" := Transaction.""No. Serie NCF"";"										
"rSeriesLine.""Line No."" := vUltimaLinea + 10000;"										
"rSeriesLine.""Starting Date"" := TODAY;"										
"rSeriesLine.""Starting No."" := vDesdeR;"										
IF nodos = 11 THEN BEGIN										
"rSeriesLine.""Ending No."" := vHastaR;"										
"rSeriesLine.""Last No. Used"" := vNCFR;"										
END;										
rSeriesLine.Open := TRUE;										
"rSeriesLine.""Last Date Used"" := TODAY;"										
rSeriesLine.Autorizacion := vSerieR;										
rSeriesLine.Serie := vResolucionR;										
rSeriesLine.INSERT;										
COMMIT;										
END										
ELSE BEGIN										
//No existe la linea autorizacion										
rSeriesLine.RESET;										
"rSeriesLine.SETRANGE(""Series Code"",Transaction.""No. Serie NCF"");"										
IF rSeriesLine.FINDLAST THEN										
"vUltimaLinea := (rSeriesLine.""Line No."" + 10000)"										
ELSE										
vUltimaLinea := 10000;										
										
rSeriesLine.INIT;										
"rSeriesLine.""Series Code"" := Transaction.""No. Serie NCF"";"										
"rSeriesLine.""Line No."" := vUltimaLinea;"										
"rSeriesLine.""Starting Date"" := TODAY;"										
"rSeriesLine.""Starting No."" := vDesdeR;"										
IF nodos = 11 THEN BEGIN										
"rSeriesLine.""Ending No."" := vHastaR;"										
"rSeriesLine.""Last No. Used"" := vNCFR;"										
END;										
rSeriesLine.Open := TRUE;										
"rSeriesLine.""Last Date Used"" := TODAY;"										
rSeriesLine.Autorizacion := vSerieR;										
rSeriesLine.Serie := vResolucionR;										
rSeriesLine.INSERT;										
COMMIT;										
END;										
END;										
END;										
END										
ELSE BEGIN										
rFacturasHijas.RESET;										
"rFacturasHijas.SETRANGE(""Store No."",Transaction.""Store No."");"										
"rFacturasHijas.SETRANGE(""POS Terminal No."",Transaction.""POS Terminal No."");"										
"rFacturasHijas.SETRANGE(""Receipt No."",Transaction.""Receipt No."");"										
IF rFacturasHijas.FINDLAST THEN BEGIN										
vResolucionR := rFacturasHijas.Resolucion;										
//CSPNT121216										
"vFechaAutorizacionR := rFacturasHijas.""Fecha Autorizacion"";"										
vSerieR := rFacturasHijas.Serie;										
vDesdeR := FORMAT(rFacturasHijas.Desde);										
vHastaR := FORMAT(rFacturasHijas.Hasta);										
vNCFR := Transaction.NCF;										
END;										
END; }										
										
rFacturasHijas.RESET;										
"rFacturasHijas.SETRANGE(""Store No."",Transaction.""Store No."");"										
"rFacturasHijas.SETRANGE(""POS Terminal No."",Transaction.""POS Terminal No."");"										
"rFacturasHijas.SETRANGE(""Receipt No."",Transaction.""Receipt No."");"										
IF rFacturasHijas.FINDLAST THEN BEGIN										
vResolucionR := rFacturasHijas.Resolucion;										
"vFechaAutorizacionR := rFacturasHijas.""Fecha Autorizacion"";"										
vSerieR := rFacturasHijas.Serie;										
vDesdeR := FORMAT(rFacturasHijas.Desde);										
vHastaR := FORMAT(rFacturasHijas.Hasta);										
vNCFR := Transaction.NCF;										
IF Transaction.NotaCredito AND NOT Transaction.NotaRemision THEN BEGIN										
"rFacturasHijas.""Nombre Cliente"" := Transaction.""Razon Social"";"										
rFacturasHijas.DUI := Transaction.DUI;										
rFacturasHijas.NIT := Transaction.NIT;										
rFacturasHijas.MODIFY;										
END;										
END										
ELSE										
ERROR('No hay CORRELATIVO en Facturas Hijas');										
url := 'http://' + vIP + ':9393/WSImpresiones.asmx?op=ImprimirDocumento';										
//url := 'http://localhost:2103/WSImpresiones.asmx?op=ImprimirDocumento';										
"soapActionUrl := '""http://tempuri.org/ImprimirDocumento""';"										
										
"xml1 := '<?xml version=""1.0"" encoding=""utf-8""?>' +"										
"'<soap:Envelope xmlns:xsi=""http://www.w3.org/2001/XMLSchema-instance"" xmlns:xsd=""http://www.w3.org/2001/XMLSchema"" xmlns:soap=""h"	ttp	://	sc	hem	"as.xmlsoap.org/soap/envelope/"">' +"					
'<soap:Body>' +										
"'<ImprimirDocumento xmlns=""http://tempuri.org/"">' +"										
'<reimpresion>' + FORMAT(vReimpresionR) + '</reimpresion>' +										
'<copia>' + FORMAT(vCopia) + '</copia>' +										
'<idDocumento>' + FORMAT(vIdDocumento) + '</idDocumento>' +										
'<datosGenerales>' +										
'<resolucionCopia>' + vResolucionR + '</resolucionCopia>' +										
//CSPNT121216										
'<fechaAutorizacion>' + vFechaAutorizacionR + '</fechaAutorizacion>' +										
'<serieCopia>' + vSerieR + '</serieCopia>' +										
'<desdeCopia>' + FORMAT(vDesdeR) + '</desdeCopia>' +										
'<hastaCopia>' + FORMAT(vHastaR) + '</hastaCopia>' +										
'<ncfCopia>' + vNCFR + '</ncfCopia>'+										
'<giroEmpresa>' + vGiroEmpresa + '</giroEmpresa>' +										
'<sucursalEmpresa>' + vSucursal + '</sucursalEmpresa>' +										
'<direccionSucursal>' + vDireccionSucursal + '</direccionSucursal>' +										
'<nitEmpresa>' + vNitEmpresa + '</nitEmpresa>' +										
'<nrcEmpresa>' + vNrcEmpresa + '</nrcEmpresa>';										
										
"xml2 :=   '<nombreCliente>' + DELCHR(DELCHR(DELCHR(vNombreCliente,'=','>'),'=','<'),'=','&') + '</nombreCliente>' +"										
"'<direccionCliente>' + DELCHR(DELCHR(DELCHR(vDireccionCliente,'=','>'),'=','<'),'=','&') + '</direccionCliente>' +"										
'<titularCliente>' + xTitular + '</titularCliente>' +										
'<beneficiarioCliente>' + xBenef + '</beneficiarioCliente>' +										
'<duiCliente>' + vDuiCliente + '</duiCliente>' +										
'<nitCliente>' + vNitCliente + '</nitCliente>' +										
'<nrcCliente>' + vNrcCliente + '</nrcCliente>' +										
"'<giroCliente>' + DELCHR(DELCHR(DELCHR(vGiroCliente,'=','>'),'=','<'),'=','&') + '</giroCliente>';"										
										
xml3 :=   '<fecha>' + vFecha + '</fecha>' +										
"'<sumas>' + DELCHR(FORMAT(vSumas),'=',',') + '</sumas>' +"										
"'<ventasNoSujetas>' + DELCHR(FORMAT(vVentasNoSujetas),'=',',') + '</ventasNoSujetas>' +"										
"'<ventasExentas>' + DELCHR(FORMAT(vVentasExentas),'=',',') + '</ventasExentas>' +"										
"'<ventasAfectas>' + DELCHR(FORMAT(vVentasAfectas),'=',',') + '</ventasAfectas>' +"										
"'<subTotal>' + DELCHR(FORMAT(vSumas),'=',',') + '</subTotal>' +"										
"'<ivaNormal>' + DELCHR(FORMAT(vIvaNormal),'=',',') + '</ivaNormal>' +"										
"'<cesc>' + DELCHR(FORMAT(vCesc),'=',',') + '</cesc>' +"										
"'<ivaRetenido>' + DELCHR(FORMAT(vIvaRetenido),'=',',') + '</ivaRetenido>' +"										
"'<ivaPercibido>' + DELCHR(FORMAT(vIvaPercibido),'=',',') + '</ivaPercibido>' +"										
"'<monto>' + DELCHR(FORMAT(vMonto),'=',',') + '</monto>' +"										
'<pos>' + vPOS + '</pos>' +										
'<cajero>' + vCajero + '</cajero>' +										
'<vendedor>' + vVendedor + '</vendedor>' +										
'<formaPago>' + vFormaPago + '</formaPago>' +										
'<totalLetras>' + vTotalLetras + '</totalLetras>' +										
'</datosGenerales>' +										
'<listaProductos>';										
										
//        xmlDetalles										
										
xml4 := '</listaProductos>' +										
'</ImprimirDocumento>' +										
'</soap:Body>'+										
'</soap:Envelope>';										
										
xmlBig.ADDTEXT(xml1 + xml2 + xml3);										
xmlBig.ADDTEXT(xmlDetallesBig);										
xmlBig.ADDTEXT(xml4);										
										
sb := sb.StringBuilder();										
										
sb.Append(xmlBig);										
										
										
//CSPNT251016										
"IF xmlFinal.CREATE('C:\Temp\' + Transaction.""Receipt No."" + ' P ' + vFormaPago + '.xml') THEN BEGIN"										
xmlFinal.CREATEOUTSTREAM(xmlStream);										
xmlStream.WRITE(sb.ToString);										
xmlFinal.CLOSE;										
END;										
uriObj := uriObj.Uri(url);										
lgRequest := lgRequest.CreateDefault(uriObj);										
lgRequest.Method := 'POST';										
lgRequest.Host := vIP;										
lgRequest.ContentType := 'text/xml; charset=utf-8';										
"lgRequest.Headers.Add('SOAPAction', soapActionUrl);"										
lgRequest.Timeout := 90000;										
"stream := stream.StreamWriter(lgRequest.GetRequestStream(), ascii.UTF8);"										
stream.Write(sb.ToString());										
stream.Close();										
//IF lgRequest.UseDefaultCredentials(TRUE) THEN										
lgResponse := lgRequest.GetResponse();										
str := lgResponse.GetResponseStream();										
reader := reader.XmlTextReader(str);										
document := document.XmlDocument();										
document.Load(reader);										
//CSPNT251016										
//CSPNT291116										
xmlnodelist := document.SelectNodes('//*');										
"document.Save('C:\temp\' + Transaction.""Receipt No."" + ' R ' + vFormaPago + '.xml');"										
//CSPNT091116nodos := xmlnodelist.Count;										
nodos := 11;										
END;										
										
PROCEDURE PrintComprobanteRifa@1000000041(pRifaNo@1000000000 : Code[30];Tray@1000000001 : Integer;pTrans@1000000004 : Code[20];pWinn	er@	100	0	0	06 : Boolean) : Boolean;					
VAR										
DSTR1@1000000002 : Text[100];										
xRifa@1000000003 : Record 50106;										
xTran@1000000005 : Record 99001472;										
BEGIN										
CLEAR(xRifa);										
IF xRifa.GET(pRifaNo) THEN BEGIN										
"IF NOT OpenReceiptPrinter(2, 'TENDER', 'PRINTVIP_TICKET', 0, '') THEN"										
EXIT(FALSE);										
										
IF Tray = 2 THEN BEGIN										
CLEAR(xTran);										
"xTran.SETRANGE(""Receipt No."", pTrans);"										
IF xTran.FIND('-') THEN BEGIN										
"//PrintHeader(xTran,FALSE,2);"										
"PrintRifaHeader(xTran,2,xTran.Date,xTran.Time);"										
										
"DSTR1 := COPYSTR('#C######################################', 1);"										
"Value[1] := COPYSTR(xRifa.Descripcion, 1, 40);"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
PrintSeperatorVIP(2);										
										
"DSTR1 := COPYSTR('#C######################################', 1);"										
Value[1] := '';										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
Value[1] := '';										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
"DSTR1 := COPYSTR('#C##################', 1);"										
IF pWinner THEN BEGIN										
IF xRifa.Linea1Gana <> '' THEN BEGIN										
"Value[1] := COPYSTR(xRifa.Linea1Gana, 1, 20);"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),TRUE,FALSE,TRUE,FALSE));"										
END;										
IF xRifa.Linea2Gana <> '' THEN BEGIN										
"Value[1] := COPYSTR(xRifa.Linea2Gana, 1, 20);"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),TRUE,FALSE,TRUE,FALSE));"										
END;										
IF xRifa.Linea3Gana <> '' THEN BEGIN										
"Value[1] := COPYSTR(xRifa.Linea3Gana, 1, 20);"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),TRUE,FALSE,TRUE,FALSE));"										
END;										
END ELSE BEGIN										
IF xRifa.Linea1Pierde <> '' THEN BEGIN										
"Value[1] := COPYSTR(xRifa.Linea1Pierde, 1, 20);"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),TRUE,FALSE,TRUE,FALSE));"										
END;										
IF xRifa.Linea2Pierde <> '' THEN BEGIN										
"Value[1] := COPYSTR(xRifa.Linea2Pierde, 1, 20);"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),TRUE,FALSE,TRUE,FALSE));"										
END;										
IF xRifa.Linea3Pierde <> '' THEN BEGIN										
"Value[1] := COPYSTR(xRifa.Linea3Pierde, 1, 20);"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),TRUE,FALSE,TRUE,FALSE));"										
END;										
END;										
										
Value[1] := '';										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
Value[1] := '';										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
PrintSeperatorVIP(2);										
Value[1] := '';										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
IF xRifa.ImprimirCond THEN BEGIN										
"DSTR1 := COPYSTR('#C######################################', 1);"										
IF xRifa.Linea1Cond <> '' THEN BEGIN										
"Value[1] := COPYSTR(xRifa.Linea1Cond, 1, 38);"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
IF xRifa.Linea2Cond <> '' THEN BEGIN										
"Value[1] := COPYSTR(xRifa.Linea2Cond, 1, 38);"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
IF xRifa.Linea3Cond <> '' THEN BEGIN										
"Value[1] := COPYSTR(xRifa.Linea3Cond, 1, 38);"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
IF xRifa.Linea4Cond <> '' THEN BEGIN										
"Value[1] := COPYSTR(xRifa.Linea4Cond, 1, 38);"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
IF xRifa.Linea5Cond <> '' THEN BEGIN										
"Value[1] := COPYSTR(xRifa.Linea5Cond, 1, 38);"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
IF xRifa.Linea6Cond <> '' THEN BEGIN										
"Value[1] := COPYSTR(xRifa.Linea6Cond, 1, 38);"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
IF xRifa.Linea7Cond <> '' THEN BEGIN										
"Value[1] := COPYSTR(xRifa.Linea7Cond, 1, 38);"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
IF xRifa.Linea8Cond <> '' THEN BEGIN										
"Value[1] := COPYSTR(xRifa.Linea8Cond, 1, 38);"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
IF xRifa.Linea9Cond <> '' THEN BEGIN										
"Value[1] := COPYSTR(xRifa.Linea9Cond, 1, 38);"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
IF xRifa.Linea10Cond <> '' THEN BEGIN										
"Value[1] := COPYSTR(xRifa.Linea10Cond, 1, 38);"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
END;										
END;										
END;										
IF NOT ClosePrinter(2) THEN										
EXIT(FALSE);										
END;										
END;										
										
PROCEDURE PrintRifaHeader@1000000042(VAR Transaction@1000 : Record 99001472;Tray@1001 : Integer;PrDate@1002 : Date;PrTime@1003 : Tim	e);									
VAR										
Staff@1004 : Record 99001461;										
DSTR1@1005 : Text[100];										
StaffName@1006 : Text[30];										
blankStr@1007 : Text[30];										
rNoSeries@1000000000 : Record 308;										
rNoSeriesLn@1000000001 : Record 309;										
rCust@1000000002 : Record 18;										
rCompanyInfo@1000000003 : Record 79;										
rCountry@1000000004 : Record 9;										
rPosTerminal@1000000005 : Record 99001471;										
rPostCode@1000000006 : Record 225;										
Correlativo@1000000007 : Code[20];										
cNoSeriesMgt@1000000008 : Codeunit 396;										
Transaccion@1000000009 : Integer;										
k@1000000010 : Integer;										
rTenderType@1000000011 : Record 99001462;										
rTransPaymEntry@1000000012 : Record 99001474;										
CantPagos@1000000013 : Integer;										
TextNRC@1000000014 : TextConst 'ENU=NRC';										
TextRNC@1000000015 : TextConst 'ENU=NIT';										
TextGIRO@1000000016 : TextConst 'ENU=GIRO';										
TextCorrelativo@1000000017 : TextConst 'ENU=CORRELATIVO:';										
TextCodTienda@1000000018 : TextConst 'ENU=COD. TIENDA:';										
TextCaja@1000000019 : TextConst 'ENU=CAJA:';										
TextAutorizacion@1000000020 : TextConst 'ENU=AUTORIZACION:';										
TextTicket@1000000021 : TextConst 'ENU=TICKET';										
TextFecha@1000000022 : TextConst 'ENU=FECHA:';										
TextHora@1000000023 : TextConst 'ENU=HORA:';										
TextNIT@1000000024 : TextConst 'ENU=NIT:';										
TextDUI@1000000025 : TextConst 'ENU=DUI:';										
TextFirma@1000000026 : TextConst 'ENU=FIRMA:';										
TextUnidad@1000000027 : TextConst 'ENU=CANT.';										
TextCodigo@1000000028 : TextConst 'ENU=ARTICULO';										
TextValor@1000000029 : TextConst 'ENU=PRECIO';										
textTotal@1000000030 : TextConst 'ENU=SUBTOTAL';										
TextDUINIT@1000000031 : TextConst 'ENU=DUI/NIT:';										
TextNombre@1000000032 : TextConst 'ENU=NOMBRE:';										
rTransactionAfectada@1000000033 : Record 99001472;										
rStore@1000000034 : Record 99001470;										
xTransInfo@1000000035 : Record 99001478;										
vDireccionCompleta@1000000036 : Text[200];										
vDireccionParte1@1000000037 : Text[100];										
vDireccionParte2@1000000038 : Text[100];										
vDireccionCortada@1000000039 : Boolean;										
"TextCodCliente@1000000040 : TextConst 'ENU=""COD. CLIENTE: ""';"										
BEGIN										
//PrintSubHeader										
IF Tray = 2 THEN										
"blankStr := StringPad(' ',LineLen - 38)"										
ELSE IF Tray = 4 THEN										
"blankStr := StringPad(' ',InvLineLen - 38);"										
										
CLEAR(Value);										
IF Tray = 2 THEN BEGIN										
//CONSISA-Imprimir Nombre de la empresa...										
PrintLogo(2);										
rCompanyInfo.GET();										
"DSTR1 :=     COPYSTR('#C######################################',1);"										
Value[1] := rCompanyInfo.Name;										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//CONSISA-Imprimir Codigo Tipo Contribuyente y  No. Reg. Contribuyente de la empresa...										
rCompanyInfo.GET();										
"DSTR1 :=     COPYSTR('#C######################################',1);"										
"Value[1] := rCompanyInfo.""Tipo de Contibuyente"" + ' ' + TextNRC + ':' + rCompanyInfo.NRC;"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//CONSISA-Imprimir NIT de la empresa...										
rCompanyInfo.GET();										
"DSTR1 :=     COPYSTR('#C######################################',1);"										
"Value[1] := TextRNC + ':' + rCompanyInfo.""VAT Registration No."";"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//CONSISA-Imprimir Giro de la empresa...										
rCompanyInfo.GET();										
//CSPNT191115										
"DSTR1 :=     COPYSTR('#L################################################',1);"										
Value[1] := TextGIRO + ':' + rCompanyInfo.Giro;										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//Imprimir Linea en blanco...										
"DSTR1 :=     COPYSTR('                     ',1);"										
Value[1] := '';										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//CONSISA-Texto Devolucion										
"IF Transaction.""Sale Is Return Sale"" THEN BEGIN"										
"DSTR1 :=     COPYSTR('        #C#########',1);"										
Value[1] := 'DEVOLUCION';										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,TRUE,FALSE));"										
										
//Imprimir Linea en blanco...										
"DSTR1 :=     COPYSTR('                     ',1);"										
Value[1] := '';										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
										
//CONSISA-Imprimir Nombre de la tienda.										
"DSTR1 := COPYSTR('#L######################################',1);"										
Value[1] := Store.Name;										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//CONSISA-Imprimir 1era. direccion de la tienda.										
"DSTR1 := COPYSTR('#L######################################',1);"										
Value[1] := Store.Address;										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//CONSISA-Imprimir 2da. direccion de la tienda.										
//CSPNT011015 Imprimir direcci¢n solo si existe										
"IF Store.""Address 2"" <> '' THEN BEGIN"										
"DSTR1 := COPYSTR('#L######################################',1);"										
"Value[1] := Store.""Address 2"";"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
										
//CSPNT011015										
//CONSISA-Imprimir Municipio de la tienda										
"DSTR1 := COPYSTR('#L######################################',1);"										
Value[1] := Store.County;										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//CSPNT011015 Imprimir ciudad de la tienda										
"DSTR1 := COPYSTR('#L######################################',1);"										
Value[1] := Store.City;										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//CONSISA-Imprimir telefono de la tienda.										
"DSTR1 := COPYSTR('#L## #L#################################',1);"										
Value[1] := 'TEL:';										
"Value[2] := Store.""Phone No."";"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//CONSISA-Imprimir el Correlativo..										
//CSRM19092013										
"//Correlativo := Transaction.""Transaction No."";"										
"DSTR1 := COPYSTR('#L######################################',1);"										
"Value[1] := 'Trans.:' + ' ' + FORMAT(Transaction.""Receipt No."");"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//CONSISA-Imprimir el No. de la Caja..										
"DSTR1 := COPYSTR('#L#################      #R#############',1);"										
"Value[1] := TextCodTienda + Store.""No."";"										
"Value[2] := TextCaja + ' ' + Transaction.""POS Terminal No."";"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
rPosTerminal.RESET;										
"rPosTerminal.SETRANGE(""No."",Transaction.""POS Terminal No."");"										
"rPosTerminal.SETRANGE(""Store No."",Transaction.""Store No."");"										
IF rPosTerminal.FINDFIRST THEN BEGIN										
"IF (Transaction.""No. Serie NCF"" = rPosTerminal.""No. Serie NCF Ticket"") THEN BEGIN"										
//CONSISA-Imprimir No. Ticket.										
"DSTR1 := COPYSTR('#L################################',1);"										
										
Value[1] := TextTicket + ' ' + Transaction.NCF;										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
END;										
										
//CONSISA-Imprimir Hora y Fecha.										
CLEAR(Value);										
DSTR1 := '#L##### #L######### #R###### #R#########';										
//Value[1] := Text048 + ':'; ESL										
Value[1] := TextFecha;										
"Value[2] := FORMAT(PrDate,0,'<Day,2>/<Month,2>/<Year4>');"										
Value[3] := FORMAT(TextHora);										
"Value[4] := FORMAT(TIME,0,'<Hours12>:<Minutes,2> <AM/PM>');"										
//Value[5] := 'CF';										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//Imprimir Linea en blanco...										
"DSTR1 :=     COPYSTR('                     ',1);"										
Value[1] := '';										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//CSRM14102013										
//CSPNT261115										
"IF Transaction.""Customer No."" ='' THEN BEGIN"										
"IF Transaction.""Razon Social"" <> '' THEN BEGIN"										
"DSTR1 := COPYSTR('#L######################################',1);"										
"Value[1] := Transaction.""Razon Social"";"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
IF Transaction.DUI <> '' THEN BEGIN										
"DSTR1 := COPYSTR('#L######################################',1);"										
Value[1] := TextDUI + ' ' + Transaction.DUI;										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
IF Transaction.NIT <> '' THEN BEGIN										
"DSTR1 := COPYSTR('#L######################################',1);"										
Value[1] := TextNIT + ' ' + Transaction.NIT;										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
END;										
//CSRM14102013										
										
//CONSISA-Imprimir informacion del cliente.										
rCust.RESET;										
"IF rCust.GET(Transaction.""Customer No."") THEN BEGIN"										
//CSPNT200116										
"DSTR1 := COPYSTR('#L######################################',1);"										
"Value[1] := TextCodCliente + rCust.""No."";"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
"DSTR1 := COPYSTR('#L######################################',1);"										
Value[1] := rCust.Name;										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//CONSISA-Imprimir direccion del cliente										
"DSTR1 := COPYSTR('#L######################################',1);"										
Value[1] := rCust.Address;										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//CONSISA-Imprimir direccion 2 del cliente										
"IF rCust.""Address 2""<>'' THEN BEGIN"										
"DSTR1 := COPYSTR('#L######################################',1);"										
"Value[1] := rCust.""Address 2"";"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
										
//CONSISA-Imprimir codigo de ciudad del cliente										
"IF rCountry.GET(rCust.""Country/Region Code"") THEN BEGIN"										
"DSTR1 := COPYSTR('#L######################################',1);"										
Value[1] := rCountry.Name;										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
										
//CONSISA-Imprimir codigo de NIT y DUI del cliente										
"DSTR1 := COPYSTR('#L######################################',1);"										
"Value[1] := TextNIT + ' ' + rCust.""VAT Registration No."";"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
"DSTR1 := COPYSTR('#L######################################',1);"										
Value[1] := TextDUI + ' ' + rCust.DUI;										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
"DSTR1 := COPYSTR('#L######################################',1);"										
Value[1] := TextNRC + ' ' + rCust.NRC;										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
										
//CSPNT011015 Imprimir Linea en blanco...										
"DSTR1 :=     COPYSTR('                     ',1);"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
										
//CSPNT011015 Imprimir Linea en blanco...										
"DSTR1 :=     COPYSTR('                     ',1);"										
"PrintLine(Tray,FormatLine(FormatStr(Value,DSTR1),FALSE,FALSE,FALSE,FALSE));"										
END;										
END;										
										
BEGIN										
{										
"LS7.1-01 EMA #23733# Print Shorter Receipt Barcodes (If Terminal has the ""Receipt Barcode ID"" field set), also fix width/height"										
LS7.1-02 StK #25485# - New print buffer to support Web based printing.										
LS7.1-03 KG  #26244# - KDS Chit Printing										
LS7.1-04 ITG #27597# - Add attachment error when sending e-receipt on POS - fix										
LS7.1-05 ITG #26910# - New function to print Stores in Location Profile										
LS7.1-06 EMA #27686# - PrintBitmap File										
LS7.1-07 GH  #27090# 30.01.2014 - Fix Mix&Match with Coupon discount calculation and slip printing										
"LS7.1-08 GEG #27794# 30.01.2014 - Item Description variable length fixes (to 50) in PrintExtra, PrintExtraSlip + FieldValue"										
LS7.1-09 GL  #27553# 30.01.2014 - Z-report not registrered in Training mode.  Issue in Tender Declaration training.										
"LS7.1-10 ThJ #23619# 31.01.2014 - Manual Line discount showing up as ""Line"" on receipt instead of ""Line Discount"""										
LS7.1-11 FO  #26172# 31.01.2014 - The Print Buffer is now saved if flag SavePrintBuffer is set. This is used in CU POS Transaction	to	cr	ea	te	e-mail if required					
LS7.1-12 KG  #23520# 03.02.2014 - Total Discount calculation wrong. New option: Detail for each line and Sub-total.										
"LS7.1-13 EMA #NAV-545# ""Fiscal Printer"" changes and Print Logging"										
LS7.1-14 GH  #NAV-616# 31.03.2014 - Use web services when accessing member information										
LS7.1-15 GL  #NAV-691# 01.04.2014 - Print correct amounts in bank or safe for tender types.										
"LS7.1-16 FO  #NAV-714# 10.04.2014 - Field ""Secondary Total Currency"" in the POS Functionality Profile now prints correcly"										
										
LS7.10.01-01 GEG #NAV-837# 08.07.2014 - Fix on Line No./VAT Code										
										
"CSPNT240915 Cambios de factura credito fiscal, hasta lineas de productos"										
"CSPNT250915 Cambios de factura credito fiscal, despues de lineas de productos, variable global iContador agregada para loops for"										
"CSPNT260915 Cambios factura credito fiscal, iva, sub-total,...,ventas total agregados"										
CSPNT011015 Actualizacion en la longitud de numero de caracteres en el slip de 30 a 40										
"CSPNT021015 Actualizacion en la posicion de caracteres en la Factura de credito fiscal, Actualizacion factura consumidor final"										
"CSPNT051015 Cabecera lineas de productos se movi¢ de subheader a salesinfo, se agreg¢ el nombre de vendedores"										
CSPNT061015 Actualizaci¢n nombre de vendedores para que solo imprima una vez por salesstaff en salesentry										
CSPNT071015 Actualizaciones para nota de crÇdito										
CSPNT081015 Actualizaci¢n encabezado nota de crÇdito										
CSPNT091015 Actualizaci¢n encabezados para factura										
CSPNT121015 Presentaci¢n de los descuentos en tickets y facturas										
"CSPNT131015 Descuentos aplicados por l°neas de productos, no solo en totales"										
CSPNT191015 Actualizaciones para impresiones de descuentos										
CSPNT201015 Actualizaciones para impresion de descuentos en ofertas periodicas										
"CSPNT211015 Descuentos en facturas similares a los tickets, actualizaciones reportes X y Z"										
"CSPNT231015 Actualizaciones para impresi¢n en negrita, actualizaciones reportes X y Z"										
CSPNT241015 Actualizaciones para reporte Z										
"CSPNT261015 Correcciones facturas, Creaci¢n xzreportsv_2 basado en el xzreport original"										
CSPNT271015 Actualizaci¢n xzreportsv_2										
CSPNT281015 Actualizaci¢n xzreportsv_2										
"CSPNT291015 Actualizaci¢n xzreportsv_2, se agrego xzlines original"										
CSPNT301015 AND NOT vIncomeExpense										
CSPNT031115 xzreportsv_2 devoluciones aparte										
CSPNT061115 FASANI9										
CSPNT171115 Actualizaciones impresiones										
CSPNT191115 Actualizaciones reuni¢n call center										
CSPNT201115 Actualizaciones reuni¢n call center										
CSPNT251115 Correcci¢n reporte xzreportsv_2										
CSPNT261115 Actualizaciones compras > 100										
CSPNT051215 Impresiones funci¢n printtotal										
CSPNT071215 Actualizaci¢n impresi¢n printtotal										
CSPNT070116 Impresion transaccion operadores TELEFONICAS										
CSPNT130116 Actualizaciones revision POS										
CSPNT140116 Actualizaci¢n formatos facturas										
CSPNT150116 Totales transacciones reporte XZ										
CSPNT160116 Longitud DSTR1 aumentado										
CSPNT180116 Actualizaci¢n descuentos facturas										
CSPNT190116 Actualizaci¢n formato facturas										
CSPNT200116 Actualizaci¢n Ticket										
CSPNT210116 Actualizacion FOOTERS XZ										
CSPNT220116 Actualizacion retiros reporte XZ										
"CSPNT230116 Dividir retiros (Efectivo, Cheque) reporte XZ"										
CSPNT250116 Actualizaciones facturas										
CSPNT260116 Actualizaci¢n impresi¢n tickets y facturas										
CSPNT270116 Actualizaci¢n impresiones ticket										
CSPNT280116 Actualizaci¢n facturas (Autorizaci¢n)										
"CSPNT300116 Dinero en caja, mostrar cantidad en SAFE"										
"CSPNT010216 Actualizaci¢n espacios facturas, No imprimir voided"										
CSPNT050216 Actualizaci¢n reporte Z Mensual										
CSPNT060216 Actualizaci¢n reportes XZ										
CSPNT250216 Actualizaci¢n retiros reportes XZ										
"CSPNT260216 Actualizaci¢n total medios de pago, formula precios credito fiscal"										
"CSPNT270216 Actualizaci¢n no series utilizados reportes XZ, actualizaci¢n medios de pago"										
CSPNT030316 Actualizaci¢n descuento Credito fiscal										
"CSPNT090316 Actualizaci¢n reportes XZ retenci¢n, devoluciones"										
CSPNT100316 Actualizaci¢n autorizaci¢n facturas										
CSPNT120316 Actualizaci¢n reporte XZ										
CSPNT140316 Actualizaci¢n reportes XZ										
CSPNT160316 Actualizaci¢n reportes XZ										
CSPNT180316 Actualizaci¢n descripcion item por barra										
*CSPNT060416 Voucher tarjetas DESARROLLO										
"CSPNT070416 Actualizaciones reporte XZ credito fiscal, factura"										
CSPNT110416 Cambiar numero de factura digitado por el NCF										
CSPNT150416 Rollo Auditor automatico										
CSPNT180416 Aumento caracteres total factura										
"CSPNT210416 Linea menos credito fiscal, Retencion reportes XZ"										
CSPNT250416 Linea menos credito fiscal recargas										
CSPNT270416 Actualizaciones reporte XZ										
"CSPNT280416 Aumento caracteres total factura, Sobrantes quitados de medios de pago XZ"										
CSPNT290416 Sobrantes quitados de a retirar de pago XZ										
CSPNT020516 Imprimir ventas a credito										
CSPNT160516 Poner Z en transacciones aunque falle comunicacion en fin de dia										
CSPNT170516 Actualizacion reporte Z Mensual										
CSPNT180516 Actualizacion reporte Z Mensual										
"CSPNT240516 Comanda, Tender Decl. en reporte Z"										
"CSPNT010616 fecha, hora, serie, no. factura, energeticas"										
CSPNT030616 CID dinero en caja										
CSPNT040616 Comanda										
CSPNT240616 Comanda Unidad medida										
"CSPNT250616 Guardar documento de compra siempre, Imprimir comprobante con factura"										
"CSPNT010716 REMISION subtotal, iva credito fiscal"										
CSPNT070716 REMISION lineas productos										
CSPNT130716 N£mero autorizaci¢n en base a fecha de la Transacci¢n										
CSPNT140716 COMANDA direccion 250+										
CSPNT260716 REMISION +2 lineas										
CSPNT150816 REMISIONES										
CSPNT240816 Fecha para ZMENSUAL										
CSPNT290816 Autorizaciones REPORTE XZ ZM										
CSPNT300816 Impresi¢n CESC										
CSPNT010916 CESC reportes XZ ZM										
CSPNT030916 Sbtotal-IVA REMISIONES										
CSPNT070916 Actualizaciones reportes XZ ZM										
CSPNT260916 GIGAUNO?										
CSPNT280916 GIGAUNO? 2										
"CSPNT290916 CESC Facturas matricial, FACTURASHIJAS reimpresion"										
CSPNT051016 Series Line										
CSPNT061016 COPIAS G1										
CSPNT101016 ZM CM-PM										
CSPNT141016 G1 Energeticas										
CSPNT251016 Guardar Respuesta G1										
"CSPNT291016 G1 >= 1000 ,'=',','"										
CSPNT071116 NIT siempre										
CSPNT091116 NO count										
"CSPNT111116 NO > o < ,'=','>'),'=','<'"										
"CSPNT151116 NO & ,'=','&'"										
CSPNT191116 DUI siempre										
CSPNT291116 G1 nodelist antes de guardar										
CSPNT301116 Recargas NO SOLAS										
CSALX091216 Remoci¢n de ABS en la totalizacion de Notas de Remision										
CSPNT051216 Reimpresion G1										
CSPNT121216 G1 Fecha Autorizacion										
CSALX20161222 Agregando numero de serie de factura a Transaction Header										
CSPNT300117 GetCorrelative										
CSALX20170309 Correccion para Notas de Credito de Remisiones (Valores ABS)										
}										
END.										
}										
}										
										
